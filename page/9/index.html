<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.bluexiii.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="IT技术类文章、笔记分享">
<meta property="og:type" content="website">
<meta property="og:title" content="BlueXIII&#39;s Blog">
<meta property="og:url" content="http://blog.bluexiii.com/page/9/index.html">
<meta property="og:site_name" content="BlueXIII&#39;s Blog">
<meta property="og:description" content="IT技术类文章、笔记分享">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="BlueXIII">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://blog.bluexiii.com/page/9/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>BlueXIII's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">BlueXIII's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">热爱技术,持续学习</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201704/Ubuntu%E4%B8%8Bboot%E5%88%86%E5%8C%BA%E7%A9%BA%E9%97%B4%E5%B7%B2%E6%BB%A1%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201704/Ubuntu%E4%B8%8Bboot%E5%88%86%E5%8C%BA%E7%A9%BA%E9%97%B4%E5%B7%B2%E6%BB%A1%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">Ubuntu下boot分区空间已满问题处理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-04-08 08:38:12" itemprop="dateCreated datePublished" datetime="2017-04-08T08:38:12+08:00">2017-04-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-11-06 15:45:42" itemprop="dateModified" datetime="2018-11-06T15:45:42+08:00">2018-11-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>最初安装Ubuntu时，/boot分区只给了200M空间（使用CentOS延续下来的习惯），结果每次生级内核时都会报错/boot空间不足。<br>下次全新安装Ubuntu，一定记得分出2G空间来给/boot。  </p>
<h2 id="临时解决方法"><a href="#临时解决方法" class="headerlink" title="临时解决方法"></a>临时解决方法</h2><ol>
<li><code>uname -a</code> 查看目前在用的内核版本  </li>
<li><code>dpkg --get-selections|grep linux-image</code> 显示所有的内核版本  </li>
<li><code>sudo apt remove linux-image-XXXX-generic</code> 卸载旧内核，注意只保留最新的 <strong>两个</strong> 版本   </li>
<li><code>sudo apt autoremove</code> 清理无用的依赖  </li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201612/%E4%BD%BF%E7%94%A8MarkDown%E5%81%9A%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201612/%E4%BD%BF%E7%94%A8MarkDown%E5%81%9A%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">使用MarkDown做个人知识管理的一些心得</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-04-07 12:18:20" itemprop="dateCreated datePublished" datetime="2017-04-07T12:18:20+08:00">2017-04-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-07-31 08:56:53" itemprop="dateModified" datetime="2019-07-31T08:56:53+08:00">2019-07-31</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="什么是个人知识管理"><a href="#什么是个人知识管理" class="headerlink" title="什么是个人知识管理"></a>什么是个人知识管理</h2><p>个人知识管理，又名PKM（Personal Knowledge Management）, 是一种个人收集，验证，存储，搜索，提取，分享知识的过程。 –WIKI<br>PKM其实是一个很大的命题，包含了很多方面的内容。但我们每个人都在或多或少的使用它，都有自已的一些工具、心得。<br>以下仅讨论一下具体的笔记、摘录等文档的 <strong>编写</strong> 与 <strong>保存</strong>。  </p>
<h2 id="什么是MarkDown"><a href="#什么是MarkDown" class="headerlink" title="什么是MarkDown"></a>什么是MarkDown</h2><p>Markdown是一种轻量级标记语言，它允许人们“使用易读易写的纯文本格式编写文档，然后转换成有效的XHTML(或者HTML)文档”。这种语言吸收了很多在电子邮件中已有的纯文本标记的特性。<br>MarkDown第一眼看上去这个样子的：<br><img src="http://oss.bluexiii.com/czwie.jpg"><br>左侧是”源码”，右侧是渲染好的”结果”</p>
<h2 id="MarkDown的优势"><a href="#MarkDown的优势" class="headerlink" title="MarkDown的优势"></a>MarkDown的优势</h2><p>MarkDown有很多先天的优势，决定了它非常适合用来编写文档、记录笔记、撰写文章：  </p>
<ul>
<li>首先，MarkDown是 <strong>纯文本</strong> ，这意味着我们可以使用任何自已喜欢的文本编辑器来进行写作，例如vi/emacs/SublimeText/Atom/VsCode/记事本/EditPlus/UltraEdit等等。  </li>
<li>然后，MarkDown在纯文本的基础上，加入某些极其简单标记，例如用#表示一级标题，##表示二级标题等。相比起HTML，要简单的多，不会对文章内容造成过多的入侵。  </li>
<li>虽然没有官方机构，但MarkDown目前已经是事实上的标准，而且已经非常流行，在GitHub等网站中有很好的应用。  </li>
<li>市面上目前有许多优秀的MarkDown编辑器（或插件），可以提供更优雅、更舒适的写作体验。   </li>
<li>MarkDown很容易导出为HTML或PDF格式，而且大多数工具都可以提供自定义的样式。  </li>
</ul>
<h2 id="MarkDown语法速成"><a href="#MarkDown语法速成" class="headerlink" title="MarkDown语法速成"></a>MarkDown语法速成</h2><p>MarkDown语法非常简单，下面列出一些基本的标记：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">标题:  </span><br><span class="line"># 一级标题</span><br><span class="line">## 二级标题</span><br><span class="line">### 三级标题</span><br><span class="line">#### 四级标题</span><br><span class="line">##### 五级标题</span><br><span class="line">###### 六级标题</span><br><span class="line"></span><br><span class="line">文字样式：  </span><br><span class="line">**用两个星号标记起来，表示加粗**</span><br><span class="line">*一个星号，表示斜体*</span><br><span class="line">~~这样子表示删除线~~</span><br><span class="line"></span><br><span class="line">插入链接：  </span><br><span class="line">[链接名称](http:&#x2F;&#x2F;url.com&#x2F;)</span><br><span class="line"></span><br><span class="line">邮箱链接:  </span><br><span class="line">&lt;myname@example.com&gt;</span><br><span class="line"></span><br><span class="line">插入图片：  </span><br><span class="line">![图片的信息，可为空](这里是图片的url，可以是本地路径，也可以是远程URL)</span><br><span class="line"></span><br><span class="line">无序列表:  </span><br><span class="line">-   Red</span><br><span class="line">-   Green</span><br><span class="line">-   Blue</span><br><span class="line"></span><br><span class="line">有序列表：  </span><br><span class="line">1.  Bird</span><br><span class="line">2.  McHale</span><br><span class="line">3.  Parish</span><br><span class="line"></span><br><span class="line">内容引用：  </span><br><span class="line">&gt; 你</span><br><span class="line">&gt; 一会看我</span><br><span class="line">&gt; 一会看云</span><br><span class="line">&gt;  我觉得</span><br><span class="line">&gt;  你看我时很远</span><br><span class="line">&gt;  你看云时很近</span><br><span class="line"></span><br><span class="line">分割线：  </span><br><span class="line">&#96;-&#96;加上空格组成，三个以上</span><br><span class="line">- - - - - -</span><br><span class="line"></span><br><span class="line">代码高亮：  </span><br><span class="line">使用3个连续的&#96;，将代码内容包起来</span><br><span class="line">&#96; &#96; &#96;</span><br><span class="line">s &#x3D; &#39;hello world&#39;</span><br><span class="line">&#96; &#96; &#96;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="选择适合自已的编辑器"><a href="#选择适合自已的编辑器" class="headerlink" title="选择适合自已的编辑器"></a>选择适合自已的编辑器</h2><p>MarkDown不需要专门工具就可以编写，任何纯文本编辑器都可以胜任。但选择一款适合自已的工具可以提供代码高亮，实时预览，自定义主题，PDF导出等高级功能，极大的提升我们的写作体验。<br>以下列出一些比较热门的工具：  </p>
<p><strong>全平台：</strong><br><a target="_blank" rel="noopener" href="https://atom.io/">Atom</a>  不用过多介绍了，GitHub出品，被称为是新时代的文本编辑器，Emacs的精神继承者。通过非富的插件，很好的支持MarkDown，并提供了无限的可能性。<br><a target="_blank" rel="noopener" href="https://www.sublimetext.com/3">Sublime Text 3</a>  更不用介绍了，同样是利用插件支持。<br><a target="_blank" rel="noopener" href="http://markeditor.com/app/markeditor">MarkEditor</a>  商业软件，使用Electron写的跨平台应用。功能强大，缺点是启动速度较慢。  </p>
<p><strong>Mac平台：</strong><br><a target="_blank" rel="noopener" href="http://zh.mweb.im/">Mweb</a>  商业软件，作者是国人。<br><a target="_blank" rel="noopener" href="http://25.io/mou/">Mou</a>  商业软件，Mac下老牌的编辑器了。<br><a target="_blank" rel="noopener" href="http://macdown.uranusjr.com/">MacDown</a>    功能与Mou基本相同，免费使用。<br><a target="_blank" rel="noopener" href="http://www.typora.io/">Typora</a>  所见即所得的编辑器，输入MarkDown标记后会立刻渲染出结果。  </p>
<p><strong>Win平台：</strong><br><a target="_blank" rel="noopener" href="http://markdownpad.com/">MarkdownPad</a>  Win下的工具比较少，这是个不错的。  </p>
<p>目前笔者常用的是Atom，跨平台，可以很好在工作在macOS和Ubuntu上。另外因为是通用型的编辑器，且插件非富，不仅限于写MarkDown，其它工作也可以胜任。<br>上面提到的工具各有特色，可以都试用一下再选一款适合自已的。  </p>
<h2 id="使用七牛云保存图片"><a href="#使用七牛云保存图片" class="headerlink" title="使用七牛云保存图片"></a>使用七牛云保存图片</h2><p>因为MarkDown是纯文本格式，所以决定了它不可能像Microsoft Word那样内嵌图片。<br>虽然在平时使用MarkDown做个人知识记录的过程中，是极少使用图片的。但如果要撰写给别人看的博客、教程一类的文档，有一些图片总是好的。<br>MarkDown可以使用本地图片，也可以使用URL远程图片。  </p>
<p>不推荐使用本地图片，虽然图片保存在本地比扔在图床上更”安全”，丢失的风险更小，但本地散乱图片会增加我们文件夹的容量，增加文档管理的难度。而且包含本地图片的文章要发布到博客上时，通常需要一张张手工上传图片，费时费力。<br>所以选择一个靠谱的图床，将图片上传后，以URL的方式嵌入MarkDown是最佳选择。鉴于国内的网络环境，以及前一段时间各大云存储厂商的所做所为，国内靠谱的图床确实不多，这里只推荐 <a target="_blank" rel="noopener" href="http://www.qiniu.com/">七牛云</a>。<br>七牛云的CEO是许式伟，曾是金山WPS2005的首席架构师，大神级的人物，所以七牛云的技术方面我们不用过多担心。重度用户可以适当付费支持一下，让七牛云良性的发展下去。<br>七牛云不仅仅是图片存储这么简单，具体的特性不一一介绍了，注册后可以慢慢在官网上看文档。  </p>
<h2 id="使用iPic快速上传图片"><a href="#使用iPic快速上传图片" class="headerlink" title="使用iPic快速上传图片"></a>使用iPic快速上传图片</h2><p>解决了图床的问题，再来看一下如何使用工具快速将图片上传，并获取生成的URL。<br>因为每插入一张图片，都要找开网站，点击上传按钮，找到存在本地磁盘上的图片，点击确定，成功后然后再把URL复制下来，实在是很繁琐。<br>这里推荐一个Mac下的小工具 <a target="_blank" rel="noopener" href="https://toolinbox.net/iPic/">iPic</a> ，下面是一个演示动画：<br><a target="_blank" rel="noopener" href="https://ww2.sinaimg.cn/large/006tNc79gw1fah02zweq2g30j60as7wh.gif">https://ww2.sinaimg.cn/large/006tNc79gw1fah02zweq2g30j60as7wh.gif</a><br>除了拖拽，还有更快捷的操作方式，只要选中本地图片或者复制网页中的图片，然后按下Command+U快捷键就可自动上传并获取URL。</p>
<h2 id="使用坚果云保存文档并同步"><a href="#使用坚果云保存文档并同步" class="headerlink" title="使用坚果云保存文档并同步"></a>使用坚果云保存文档并同步</h2><p>MarkDown文档写好了，保存在本地。一切看上去都很美好，但接下来，我们又有了更多的需求：  </p>
<ol>
<li>重要的文档，特别是我们辛辛苦苦多年积累下来的知识，只保存在本地是不安全的。不要把鸡蛋放在同一个篮子里，要把它备份到云端。  </li>
<li>要实现多设备间的同步，这样在手机上、iPad上、家里的电脑上可以随时查阅、修改。  </li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.jianguoyun.com/">坚果云</a> 是国内一款非常类似于DropBox的云存储应用，它提供了 <strong>全平台</strong> 的非常 <strong>快速</strong> 且 <strong>稳定</strong> 的 <strong>增量同步</strong> 功能。<br>坚果云可以说是国内硕果仅存的一家了，它的增量同步在国内做的是最好的，与百度云等不同，它专注于”同步”，而不是电影等大文件的存储。<br>坚果云的客户端做的也是非常用心，Linux下可以全功能完美使用。手机和iPad上的APP做的也不错。希望坚果云好好存活下去。<br>坚果云的使用非常简单，这里有一个视频教程：<br><a target="_blank" rel="noopener" href="http://help.jianguoyun.com/?p=1964">视频教程链接</a>  </p>
<h2 id="为什么不直接使用云笔记"><a href="#为什么不直接使用云笔记" class="headerlink" title="为什么不直接使用云笔记"></a>为什么不直接使用云笔记</h2><p>目前市面上有非常多的跨平台的云笔记工具可以做到上面的事情，而且可能做的更好。 例如为知笔记、有道云笔记、EverNote、EssentialPIM等，另外还有一些后起之秀。<br>为什么还要使用 MarkDown + 坚果云 这样看上去略显繁琐的组合？  </p>
<ul>
<li>我需要用纯文的方式来管理知识<br>MarkDown相对来说比较”单纯”，而且又有表达”样式”的能力。举个例子，就像我们写代码，当然是要保存”源码”，而不是编译好的”二进制文件”。<br>我们对纯文本有绝对的控制能力，纯文本方便检索，更重要的是方便日后的加工，可以导出PDF、HTML，可以分享发布到博客和专栏。    </li>
<li>我需要一个能随时替换掉的云服务<br>云服务并不可靠，目前大部分国外的服务已经被封锁，国内的因为没有良好的盈利模式，也纷纷关闭，所以不要重度依赖云。既然MarkDown文档首先保存在本地，掌握在自已手中，这也就意味着我可以使用任何云同步服务，不仅仅是坚果云，还可以是OneDrive、DropBox、iCloud，甚至是自已在VPS上搭建的私有Git。</li>
<li>我为什么抛弃了云笔记软件<br>之前使用过的工具中，为知笔记是我最喜爱的（个人认为比EverNote做的要更好）。但它也是有一些缺点的，例如虽然支持MarkDown编写，但本质上还是会保存成HTML富文本。另外它的Mac版做的不如Win版优秀，Linux版也不友好。<br>另外，使用第三方的工具，所有数据保存在云端，在本地没有原始档的备份，会让人有一种深深的”不安感”。再加上很多工具不提供”导出”功能，这意味着我们一旦使用某个工具，就要一直用下去，谁也无法保证5年后这个厂家还能不能存活下来，继续为我们提供服务。  </li>
<li>个人知识管理，不是简单的将文档编写并保存<br>接下来，我们会对它进行搜索，加工，导出，分享，而这正是MarkDown的优势所在。  </li>
</ul>
<p>基于以上几点，我最终选择了使用 MarkDown + 坚果云 这样的组合进行个人知识管理，并准备长期使用下去。  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201702/%E5%86%85%E7%BD%91%E4%B8%BB%E6%9C%BAPython3%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201702/%E5%86%85%E7%BD%91%E4%B8%BB%E6%9C%BAPython3%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" class="post-title-link" itemprop="url">内网环境下Python3应用部署</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-04-01 16:05:27" itemprop="dateCreated datePublished" datetime="2017-04-01T16:05:27+08:00">2017-04-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-11-06 15:48:21" itemprop="dateModified" datetime="2018-11-06T15:48:21+08:00">2018-11-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>最近在用Python写一些东西，各种第三方库好用极了，写起来也是非常酸爽，但生产环境部署上却略有些繁琐。<br>主要原因是公司的生产环境主机，大都是在内网中的，无法直连Internet，首先要花点力气搞定网络连接问题。<br>另外操作系统也基本上是RedHat，只预装了Python2.7，yum源中也没有3.X，只能通过源码编译的方式安装。如果是Debian系的，就不会这么麻烦了。  </p>
<h2 id="HTTP代理服务器搭建"><a href="#HTTP代理服务器搭建" class="headerlink" title="HTTP代理服务器搭建"></a>HTTP代理服务器搭建</h2><p>要搞定网络连接，最简单的办法还是找一台能出得去的主机，搭一个HTTP代理服务。<br>这里我选择了srelay+polipo的组合。Srelay用于搭建Socks5代理，Polipo用于将Socks5端口转为HTTP端口。<br>PS：当然，还可以使用redsocks+polipo的组合，直接默翻墙，使用yum时可以快很多。  </p>
<h3 id="使用srelay搭建简易Socks5代理"><a href="#使用srelay搭建简易Socks5代理" class="headerlink" title="使用srelay搭建简易Socks5代理"></a>使用srelay搭建简易Socks5代理</h3><p>我们先找一台可以直连外网的主机，注意要新建一个用户，不要以root直接操作。  </p>
<p>官网地址：<br><a target="_blank" rel="noopener" href="http://socks-relay.sourceforge.net/">http://socks-relay.sourceforge.net</a><br>下载<code>srelay-0.4.8b6.tar.gz</code></p>
<p>解压后直接<code>make</code>即可，将编译出的二进制文件srelay随便找一个目录扔进去</p>
<p>启动：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;srelay -i xxx.xxx.xxx.xxx:31080  </span><br></pre></td></tr></table></figure>
<p>无须配置，直接在启动时直接绑定IP+端口，注意IP一定要绑定内网的那个。</p>
<h3 id="使用polipo将Socks5代理转为Http代理"><a href="#使用polipo将Socks5代理转为Http代理" class="headerlink" title="使用polipo将Socks5代理转为Http代理"></a>使用polipo将Socks5代理转为Http代理</h3><p>下载地址：<br><a target="_blank" rel="noopener" href="https://www.irif.fr/~jch/software/polipo/polipo.html">https://www.irif.fr/~jch/software/polipo/polipo.html</a>  </p>
<p>解压后，修改一下Makefile，将PREFIX改为实际安装目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vi Makefile</span><br><span class="line">PREFIX &#x3D; &#x2F;path&#x2F;to&#x2F;your&#x2F;app</span><br><span class="line">BINDIR &#x3D; $(PREFIX)&#x2F;bin</span><br><span class="line">MANDIR &#x3D; $(PREFIX)&#x2F;man</span><br><span class="line">INFODIR &#x3D; $(PREFIX)&#x2F;info</span><br><span class="line">LOCAL_ROOT &#x3D; $(PREFIX)&#x2F;www</span><br><span class="line">DISK_CACHE_ROOT &#x3D; $(PREFIX)&#x2F;cache</span><br></pre></td></tr></table></figure>
<p>然后直接<code>make &amp;&amp; make install</code>即可</p>
<p>新建一个config文件  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi config</span><br><span class="line">socksParentProxy &#x3D; &quot;xxx.xxx.xxx.xxx:31080&quot;</span><br><span class="line">socksProxyType &#x3D; socks5</span><br><span class="line">proxyAddress &#x3D; &quot;0.0.0.0&quot;</span><br><span class="line">proxyPort &#x3D; 31081</span><br></pre></td></tr></table></figure>
<p>其中socksParentProxy是Socks的IP+端口，proxyPort是新开的HTTP端口</p>
<p>启动：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup .&#x2F;polipo -c config</span><br></pre></td></tr></table></figure>

<h2 id="环境变量设置"><a href="#环境变量设置" class="headerlink" title="环境变量设置"></a>环境变量设置</h2><p>现在回到Python3所在的主机，设置一个http_proxy环境变量，指向刚才所搭建的IP:端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export http_proxy&#x3D;&quot;http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:31081&quot;</span><br></pre></td></tr></table></figure>
<p>这时wget、yum等已经可以正常使用了</p>
<h2 id="配置yum使用163的源（可选）"><a href="#配置yum使用163的源（可选）" class="headerlink" title="配置yum使用163的源（可选）"></a>配置yum使用163的源（可选）</h2><p>有时可能需要用yum安装一些依赖，配置成163的源会速度快一些  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;mirrors.163.com&#x2F;centos&#x2F;6&#x2F;os&#x2F;x86_64&#x2F;Packages&#x2F;python-iniparse-0.3.1-2.1.el6.noarch.rpm</span><br><span class="line">wget http:&#x2F;&#x2F;mirrors.163.com&#x2F;centos&#x2F;6&#x2F;os&#x2F;x86_64&#x2F;Packages&#x2F;yum-metadata-parser-1.1.2-16.el6.x86_64.rpm</span><br><span class="line">wget http:&#x2F;&#x2F;mirrors.163.com&#x2F;centos&#x2F;6&#x2F;os&#x2F;x86_64&#x2F;Packages&#x2F;python-urlgrabber-3.9.1-11.el6.noarch.rpm</span><br><span class="line">wget http:&#x2F;&#x2F;mirrors.163.com&#x2F;centos&#x2F;6&#x2F;os&#x2F;x86_64&#x2F;Packages&#x2F;yum-3.2.29-73.el6.centos.noarch.rpm</span><br><span class="line">wget http:&#x2F;&#x2F;mirrors.163.com&#x2F;centos&#x2F;6&#x2F;os&#x2F;x86_64&#x2F;Packages&#x2F;yum-plugin-fastestmirror-1.1.30-37.el6.noarch.rpm\</span><br><span class="line"></span><br><span class="line">rpm -qa | grep yum | xargs rpm -e --nodeps</span><br><span class="line">rpm -ivh python-iniparse-0.3.1-2.1.el6.noarch.rpm</span><br><span class="line">rpm -ivh yum-metadata-parser-1.1.2-16.el6.x86_64.rpm</span><br><span class="line">rpm -ivh python-urlgrabber-3.9.1-11.el6.noarch.rpm --force</span><br><span class="line">rpm -ivh yum-3.2.29-73.el6.centos.noarch.rpm yum-plugin-fastestmirror-1.1.30-37.el6.noarch.rpm</span><br><span class="line"></span><br><span class="line">wget http:&#x2F;&#x2F;mirrors.163.com&#x2F;.help&#x2F;CentOS6-Base-163.repo</span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>
<h2 id="源码方式安装python3"><a href="#源码方式安装python3" class="headerlink" title="源码方式安装python3"></a>源码方式安装python3</h2><p>现在开始，万事俱备，可以编译安装python了。需要使用root权限操作。  </p>
<p>首先，在官网下载最新的3.6源码：<br><a target="_blank" rel="noopener" href="https://www.python.org/ftp/python/3.6.0/Python-3.6.0.tgz">https://www.python.org/ftp/python/3.6.0/Python-3.6.0.tgz</a></p>
<p>安装过程没有什么特别的，缺少依赖时可以直接yum安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;www.python.org&#x2F;ftp&#x2F;python&#x2F;3.6.0&#x2F;Python-3.6.0.tgz</span><br><span class="line">tar -zxcf Python-3.6.0.tgz</span><br><span class="line">.&#x2F;configure</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>源码方式安装完成后，已经是包含pip3的了，不用再单独安装了。  </p>
<h2 id="让pip走代理"><a href="#让pip走代理" class="headerlink" title="让pip走代理"></a>让pip走代理</h2><p>pip3可以通过使用<code>--proxy</code>参数来走代理，在这里我们为了方便，直接建一个alias，以后使用pip时，就不需要再添加参数了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alias pip3&#x3D;&quot;pip3 --proxy 134.32.32.13:31081&quot;</span><br><span class="line">export http_proxy&#x3D;134.32.32.13:31081</span><br><span class="line">export https_proxy&#x3D;134.32.32.13:31081</span><br></pre></td></tr></table></figure>
<h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><p>大部分依赖可以直接通过pip3安装：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pip3 install requests</span><br><span class="line">pip3 install beautifulsoup4</span><br><span class="line">pip3 install mysql-connector</span><br><span class="line">pip3 install fdfs_client-py</span><br></pre></td></tr></table></figure>
<p>某些模块，比如FastDFS客户端，不能直接使用pip3安装，需要下载源码后并手工修改一些代码，操作过程大致如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;jefforeilly&#x2F;fdfs_client-py.git</span><br><span class="line">cd dfs_client-py</span><br><span class="line">vi .&#x2F;fdfs_client&#x2F;storage_client.py</span><br><span class="line">将第12行 from fdfs_client.sendfile import * 注释掉</span><br><span class="line">python3 setup.py install</span><br></pre></td></tr></table></figure>
<p>至此，环境搭建完毕，可以将python代码扔上去跑起来了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201703/%E8%AE%B0%E4%B8%80%E6%AC%A1root%E7%94%A8%E6%88%B7su%E6%8A%A5%E9%94%99%E7%9A%84%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201703/%E8%AE%B0%E4%B8%80%E6%AC%A1root%E7%94%A8%E6%88%B7su%E6%8A%A5%E9%94%99%E7%9A%84%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">记一次root用户su报错的处理过程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-03-30 14:35:43" itemprop="dateCreated datePublished" datetime="2017-03-30T14:35:43+08:00">2017-03-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-11-06 15:47:03" itemprop="dateModified" datetime="2018-11-06T15:47:03+08:00">2018-11-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h2><ol>
<li>直接使用foobar用户SSH登录正常</li>
<li>在root用户下，执行<code>su - foobar</code>，报错：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su: cannot set user id: Resource temporarily unavailable</span><br></pre></td></tr></table></figure>
<p>只有su的时候报错，虽然不影响foobar用户正常的SSH远程登录，但这种资源受限的错误，一般都是系统崩溃的前兆，必须要较点真。</p>
<blockquote>
<p>系统：RHEL 6.5</p>
</blockquote>
<h2 id="排查过程"><a href="#排查过程" class="headerlink" title="排查过程"></a>排查过程</h2><h3 id="先按套路出牌"><a href="#先按套路出牌" class="headerlink" title="先按套路出牌"></a>先按套路出牌</h3><p>首先直接一通<code>free -m</code>、  <code>top</code>、  <code>vmstat</code>等等，试试运气<br>不过也不出所料，并没有什么收获。但这也算是个好消息，至少说明不像是系统级别的资源问题了。  </p>
<p>感觉八成是线程数或者文件打开数搞的鬼了，懒得监控日志，接着排查。  </p>
<h3 id="查看线程数"><a href="#查看线程数" class="headerlink" title="查看线程数"></a>查看线程数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;threads-max</span><br><span class="line">254529</span><br></pre></td></tr></table></figure>
<p>最大线程数254529，没有问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -u foobar -L | wc -l</span><br><span class="line">1045</span><br></pre></td></tr></table></figure>
<p>用户当前线程数1045，虽然挺高了，但这个用户下部署的应用也非常多，算是正常吧。</p>
<h3 id="检查ulimit"><a href="#检查ulimit" class="headerlink" title="检查ulimit"></a>检查ulimit</h3><ol>
<li><p>先用ulimit看一下设置的最大文件打开数<br>用foobar直接登录，然后执行：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ulimit -n</span><br><span class="line">655360</span><br></pre></td></tr></table></figure>
<p>显示655360，没有问题</p>
</li>
<li><p>然后用<code>lsof</code>统计一下当前的文件打开数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lsof | grep foobar | wc -l</span><br><span class="line">1690</span><br></pre></td></tr></table></figure>
<p>1690，大于1024有点多了，接下来仔细看一下。</p>
</li>
<li><p><code>lsof</code>大概的逐条分析一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lsof | grep foobar</span><br><span class="line">blablabla...</span><br><span class="line">blablabla...</span><br><span class="line">blablabla...</span><br></pre></td></tr></table></figure>
<p>既有文件，也有网络连接。不像是那种同时发起了大量网络连接造成的故障。这里算是PASS了。  </p>
</li>
</ol>
<h3 id="检查limits-conf配置"><a href="#检查limits-conf配置" class="headerlink" title="检查limits.conf配置"></a>检查limits.conf配置</h3><p>走到这里，还没查出问题，就有点意外了，索性再检查一下<code>limits.conf</code>吧</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;security&#x2F;limits.conf</span><br><span class="line"></span><br><span class="line">*    soft    nofile    655360</span><br><span class="line">*    hard    nofile    655360</span><br><span class="line">*    soft    noproc    655360</span><br><span class="line">*    hard    noproc    655360</span><br><span class="line">*    soft    core      0</span><br><span class="line">*    hard    core      0</span><br></pre></td></tr></table></figure>
<p>都是655360，一眼看上去没有问题（但这里有个坑，稍后会提到）</p>
<h3 id="检查各个profile配置"><a href="#检查各个profile配置" class="headerlink" title="检查各个profile配置"></a>检查各个profile配置</h3><p>再检查各个profile的配置，例如.bash_profile里是不是手工设置了过小的ulimit，导致登录失败。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;profile</span><br><span class="line">cat &#x2F;foobar&#x2F;.bash_profile</span><br></pre></td></tr></table></figure>
<p>都很正常，并没有添加多余的东西进去</p>
<h3 id="监控系统secure日志"><a href="#监控系统secure日志" class="headerlink" title="监控系统secure日志"></a>监控系统secure日志</h3><p>到这时都没发现出问题，只能监控系统日志<code>/var/log/secure</code>了。<br>一边监控，一边执行<code>su - foobar</code>：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tail -f &#x2F;var&#x2F;log&#x2F;secure</span><br><span class="line">blablabla...</span><br><span class="line"></span><br><span class="line">Mar 30 12:08:02 localhost crond[29226]: pam_limits(crond:session): unknown limit item &#39;noproc&#39;</span><br><span class="line"></span><br><span class="line">blablabla...</span><br></pre></td></tr></table></figure>
<p>终于抓到一个问题：<code>noproc</code>参数是个什么鬼，应该是<code>nproc</code>才对吧，估计管理员当时是直接手撸的，没有复制粘帖。  </p>
<p>于是赶紧修改limits.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;security&#x2F;limits.conf</span><br></pre></td></tr></table></figure>
<p>将</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*    soft    noproc    655360</span><br><span class="line">*    hard    noproc    655360</span><br></pre></td></tr></table></figure>
<p>改为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*    soft    nproc    655360</span><br><span class="line">*    hard    nproc    655360</span><br></pre></td></tr></table></figure>

<h3 id="山穷水尽"><a href="#山穷水尽" class="headerlink" title="山穷水尽"></a>山穷水尽</h3><p>解决完上面那个问题，以为这下可以su成功了吧，然而并没有，报错依旧。</p>
<p>于是继续监控<code>/var/log/secure</code>日志。现在报错变成了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Mar 30 12:10:25 localhost su: pam_unix(su-l:session): session opened for user foobar by monitor(uid&#x3D;0)</span><br><span class="line">Mar 30 12:10:25 localhost su: pam_unix(su-l:session): session closed for user foobar</span><br></pre></td></tr></table></figure>
<p>这种报错，相当于什么也没说啊。看来接下来，想要解决问题，只能靠猜了。  </p>
<p>一通google之后，找到了这么一句话：  </p>
<blockquote>
<p>In Red Hat Enterprise Linux 6, there’s a default setting in /etc/security/limits.d/90-nproc.conf. Change the default limit for all users or add a new limit for the affected user.</p>
</blockquote>
<p>这个<code>limits.d/90-nproc.conf</code>之前从没有注意过，难道它会覆盖 <code>limits.conf</code> 吗？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;security&#x2F;limits.d&#x2F;90-nproc.conf</span><br><span class="line">*          soft    nproc     1024</span><br><span class="line">root       soft    nproc     unlimited</span><br></pre></td></tr></table></figure>
<p>这里的值是1024，尝试改大一点，碰碰运气：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;security&#x2F;limits.d&#x2F;90-nproc.conf</span><br><span class="line">*          soft    nproc     10240</span><br><span class="line">root       soft    nproc     unlimited</span><br></pre></td></tr></table></figure>
<p>然后<code>su - foobar</code> ，竟然成功了。</p>
<h2 id="经验值-3"><a href="#经验值-3" class="headerlink" title="经验值+3"></a>经验值+3</h2><p>到此为止，两个坑都已经被填上了。耗时15分钟，经验值+3：  </p>
<ol>
<li>遇到类似问题，直接监控<code>/var/log/secure</code>，可以少走些弯路  </li>
<li>注意<code>/etc/security/limits.conf</code>的参数拼写  </li>
<li>竟然还有<code>/etc/security/limits.d/90-nproc.conf</code>这么个东西，且生效的时机诡异（只影响su，直接登录不受影响）  </li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201703/%E4%B8%83%E7%89%9B%E4%BA%91%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0%E5%B7%A5%E5%85%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201703/%E4%B8%83%E7%89%9B%E4%BA%91%E5%9B%BE%E7%89%87%E4%B8%8A%E4%BC%A0%E5%B7%A5%E5%85%B7/" class="post-title-link" itemprop="url">qiniu-imgup七牛云图片上传工具分享</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-03-23 09:47:40" itemprop="dateCreated datePublished" datetime="2017-03-23T09:47:40+08:00">2017-03-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-07-31 08:56:53" itemprop="dateModified" datetime="2019-07-31T08:56:53+08:00">2019-07-31</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="qiniu-imgup简介"><a href="#qiniu-imgup简介" class="headerlink" title="qiniu-imgup简介"></a>qiniu-imgup简介</h2><p>qiniu-imgup是一个七牛云图片上传工具，目标是简化MarkDown写作中的贴图的繁琐步骤，可以快速将剪贴板中的图片上传至七牛云，并返回MarkDown格式的链接。<br>适用人群：使用七牛云做为图床的MarkDown编写者。  </p>
<p>由于平时工作主要是用macOS 10.12及Ubuntu 16.04两台笔记本，macOS下之前一直在用一个名为iPic的收费软件（30RMB/年，UX做的非常好），Ubuntu下直接找不到类似工具，于是分别针对两个平台各写了一个小工具。  </p>
<p>两个版本在思路及实现上的差异还是比较大的，Mac版偏重于用Python原生实现，Linux版则借用了一些第三方系统工具，下面简单做一下分享，有需要的同学可以直接拿去用。  </p>
<blockquote>
<p>Linux版本的整体思路及部分代码来自 博客 <a target="_blank" rel="noopener" href="http://nfeng.cc/2016/07/19/markdown-img-tool/">77695的自留地</a> ，侵删  </p>
</blockquote>
<h2 id="使用方法介绍"><a href="#使用方法介绍" class="headerlink" title="使用方法介绍"></a>使用方法介绍</h2><p>在编写MarkDown文档时，如果使用七牛云做图床，插入一张图片需要以下几个繁琐的步骤：</p>
<ol>
<li>截图</li>
<li>保存为文件</li>
<li>打开浏览器，在七牛云后台上传图片</li>
<li>复制图片的HTTP URL</li>
<li>在编辑器中将URL拼接为MarkDown的链接格式</li>
<li>粘帖链接</li>
</ol>
<p>mac版本将整个操作简化为了3个快捷键操作：</p>
<ol>
<li><code>cmd+shift+ctrl+4</code>  -  截图到剪贴板</li>
<li><code>cmd+shift+u</code>  -  使用自定义热键，上传并获取MarkDown链接</li>
<li><code>cmd+v</code>  -  粘帖MarkDown链接</li>
</ol>
<p>linux版本整个操作简化为了2个快捷键操作：</p>
<ul>
<li><code>alt+shift+s</code>  调用<code>simg</code>截图</li>
<li><code>alt+shift+u</code>  调用<code>uimg</code>上传并自动粘帖MarkDown链接</li>
</ul>
<h2 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h2><h3 id="Mac版实现思路"><a href="#Mac版实现思路" class="headerlink" title="Mac版实现思路"></a>Mac版实现思路</h3><ol>
<li>使用系统自带截图工具，或QQ截图工具，截图至剪贴板</li>
<li>使用PIL库中的ImageGrab，将剪贴板中的图片保存</li>
<li>使用qiniu库，生成token，并上传图片</li>
<li>将七牛云返回的URL拼接为MarkDown格式链接</li>
<li>使用clipboard库，将链接放到剪贴板中</li>
<li>使用os.system库，调用<code>osascript</code>发送系统通知，在屏幕右上角提示成功/失败</li>
<li>CMD+V粘帖链接至编辑器</li>
</ol>
<blockquote>
<p>其中2-6步，是由qiniu-imgup来实现的。<br>可以用Automator工具，将shell脚本封装成一个APP，在系统设置中就可以指定一个快捷键了。  </p>
</blockquote>
<h3 id="Linux版实现思路"><a href="#Linux版实现思路" class="headerlink" title="Linux版实现思路"></a>Linux版实现思路</h3><ol>
<li>使用shell脚本，调用第三方截图工具shutter，并将图片保存至临时目录。  </li>
<li>使用qiniu库，生成token，并上传图片</li>
<li>将七牛云返回的URL拼接为MarkDown格式链接</li>
<li>直接使用print打印链接至console</li>
<li>调用libnotify-bin，发送系统通知，在屏幕右上角提示成功/失败</li>
<li>使用shell脚本，将Python输出结果传递给第三方工具xclip，复制到剪贴板</li>
<li>使用shell脚本，调用第三方工具xdotool，模拟键盘Ctrl+V操作，直接进行粘帖</li>
</ol>
<blockquote>
<p>其中2-5步，是由qiniu-imgup来实现的。<br>过程中使用到了第三方工具shutter、xclip及xdotool。<br>由于使用了xdotool，无须手工Ctrl+V粘帖了，节省了一个操作步骤。  </p>
</blockquote>
<h2 id="安装与配置"><a href="#安装与配置" class="headerlink" title="安装与配置"></a>安装与配置</h2><h3 id="Mac版安装与配置"><a href="#Mac版安装与配置" class="headerlink" title="Mac版安装与配置"></a>Mac版安装与配置</h3><ol>
<li>安装依赖<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install -r requirement.txt</span><br></pre></td></tr></table></figure></li>
<li>配置<code>config.py</code>，填入七牛云的AK、SK等参数</li>
<li>使用Automator将shell脚本uimg封装为APP<br><img src="http://oss.bluexiii.com/k6cwa.jpg"></li>
<li>在系统设置中（System Preference-&gt;Keyboard-&gt;Shortcuts-&gt;App Shortcuts），为APP分配快捷键<br><img src="http://oss.bluexiii.com/oknvx.jpg"></li>
</ol>
<h3 id="Linux版安装与配置"><a href="#Linux版安装与配置" class="headerlink" title="Linux版安装与配置"></a>Linux版安装与配置</h3><ol>
<li>依赖及工具安装<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install qiniu</span><br><span class="line">sudo apt-get install shutter</span><br><span class="line">sudo apt-get install xclip</span><br><span class="line">sudo apt-get install parcellite</span><br><span class="line">sudo apt-get install xdotool</span><br><span class="line">sudo apt-get install libnotify-bin</span><br></pre></td></tr></table></figure></li>
<li>将程序目录拷贝至/opt/qimg下</li>
<li>设置环境变量 <code>export PATH=/opt/qimg:$PATH</code></li>
<li>在Shutter设置中，将图片自动保存位置设为<code>/tmp/snap_shutter</code></li>
<li>在System Setting - Keyboard中，设置快捷键分别指向<code>simg</code>截图和<code>uimg</code>上传</li>
</ol>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><ul>
<li><p>macOS版本GitHub源码：<br><a target="_blank" rel="noopener" href="https://github.com/xiiiblue/qiniu-imgup-mac.git">https://github.com/xiiiblue/qiniu-imgup-mac.git</a>  </p>
<blockquote>
<p>目前只支持macOS，有时间会把这个改成for Mac &amp; Win双平台的，先挖个坑  </p>
</blockquote>
</li>
<li><p>Linux版本GitHub源码：<br><a target="_blank" rel="noopener" href="https://github.com/xiiiblue/qiniu-imgup-linux.git">https://github.com/xiiiblue/qiniu-imgup-linux.git</a>  </p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201703/crontab%E9%85%8D%E7%BD%AE%E5%8F%8A%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201703/crontab%E9%85%8D%E7%BD%AE%E5%8F%8A%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8/" class="post-title-link" itemprop="url">crontab配置及简单应用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-03-23 09:39:58" itemprop="dateCreated datePublished" datetime="2017-03-23T09:39:58+08:00">2017-03-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-11-06 15:46:09" itemprop="dateModified" datetime="2018-11-06T15:46:09+08:00">2018-11-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h2><p>crontab并不陌生，在*nix的操作系统之中，使用它设置周期性被执行的指令.每个用户可以拥有自己的crontab文件；<br>同时，操作系统保存一个针对整个系统的crontab文件，该文件通常存放于/etc或者/etc之下的子目录中。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:&#x2F;etc $ ls -al|grep cron</span><br><span class="line">drwxr-xr-x   2 root root    4096 Jan  1  1970 cron.d</span><br><span class="line">drwxr-xr-x   2 root root    4096 Jan  1  1970 cron.daily</span><br><span class="line">drwxr-xr-x   2 root root    4096 Jan  1  1970 cron.hourly</span><br><span class="line">drwxr-xr-x   2 root root    4096 Jan  1  1970 cron.monthly</span><br><span class="line">drwxr-xr-x   2 root root    4096 Jan  1  1970 cron.weekly</span><br><span class="line">-rw-r--r--   1 root root     722 Sep  5  2015 crontab</span><br></pre></td></tr></table></figure>
<h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><ul>
<li>-u user：用来设定某个用户的crontab服务；</li>
<li>file：file是命令文件的名字,表示将file做为crontab的任务列表文件并载入crontab。如果在命令行中没有指定这个文件，crontab命令将接受标准输入（键盘）上键入的命令，并将它们载入crontab。</li>
<li>-e：编辑某个用户的crontab文件内容。如果不指定用户，则表示编辑当前用户的crontab文件。</li>
<li>-l：显示某个用户的crontab文件内容，如果不指定用户，则表示显示当前用户的crontab文件内容。</li>
<li>-r：从/var/spool/cron目录中删除某个用户的crontab文件，如果不指定用户，则默认删除当前用户的crontab文件。</li>
<li>-i：在删除用户的crontab文件时给确认提示。</li>
</ul>
<p>最常用的参数有<code>-l 查询</code>和<code>-e 编辑</code></p>
<h2 id="配置格式"><a href="#配置格式" class="headerlink" title="配置格式"></a>配置格式</h2><ul>
<li>第1列分钟0～59</li>
<li>第2列小时0～23（0表示子夜）</li>
<li>第3列日1～31</li>
<li>第4列月1～12</li>
<li>第5列星期0～7（0和7表示星期天）</li>
<li>第6列要运行的命令</li>
</ul>
<h2 id="配置示例"><a href="#配置示例" class="headerlink" title="配置示例"></a>配置示例</h2><p>每分钟执行一次:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * &#x2F;path&#x2F;to&#x2F;your&#x2F;app.sh</span><br></pre></td></tr></table></figure>
<p>每半分钟执行一次:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*&#x2F;2 * * * * &#x2F;path&#x2F;to&#x2F;your&#x2F;app.sh</span><br></pre></td></tr></table></figure>
<p>每小时的第3和第15分钟执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3,15 * * * * &#x2F;path&#x2F;to&#x2F;your&#x2F;app.sh</span><br></pre></td></tr></table></figure>
<p>在上午8点到11点的第3和第15分钟执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3,15 8-11 * * * &#x2F;path&#x2F;to&#x2F;your&#x2F;app.sh</span><br></pre></td></tr></table></figure>
<p>每周六23点执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 23 * * 6 &#x2F;etc&#x2F;init.d&#x2F;smb restart</span><br></pre></td></tr></table></figure>
<h2 id="简单应用"><a href="#简单应用" class="headerlink" title="简单应用"></a>简单应用</h2><h3 id="检测并自动重启服务"><a href="#检测并自动重启服务" class="headerlink" title="检测并自动重启服务"></a>检测并自动重启服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br><span class="line">*&#x2F;2 * * * * isfound&#x3D;$(ps | grep &quot;redsocks&quot; | grep -v &quot;grep&quot;); if [ -z &quot;$isfound&quot; ]; then echo &quot;$(date): restart redsocks...&quot;&gt;&gt;&#x2F;tmp&#x2F;log&#x2F;redsocks-mon.log &amp;&amp; &#x2F;etc&#x2F;init.d&#x2F;redsocks restart; fi</span><br></pre></td></tr></table></figure>
<h3 id="检测并自动重启tomcat"><a href="#检测并自动重启tomcat" class="headerlink" title="检测并自动重启tomcat"></a>检测并自动重启tomcat</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*&#x2F;2 * * * * sh &#x2F;path&#x2F;to&#x2F;tomcat_monitor.sh</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vi tomcat_monitor.sh</span><br><span class="line">#!&#x2F;bin&#x2F;sh</span><br><span class="line">source &#x2F;home&#x2F;user&#x2F;.bash_profile</span><br><span class="line">export PATH&#x3D;$PATH:.:&#x2F;bin:&#x2F;sbin:&#x2F;usr&#x2F;bin:</span><br><span class="line">pid_count&#x3D;&#96;ps aux|grep java|grep your-tomcat|grep -v grep|wc -l&#96;</span><br><span class="line">if [ $pid_count -ne 1 ]; then</span><br><span class="line">        echo &quot;stop download-tomcat, time: &#96;date&#96;&quot;</span><br><span class="line">        if [ $pid_count -gt 0 ]; then</span><br><span class="line">                 ps aux|grep java|grep your-tomcat|grep -v grep|awk &#39;&#123;print $2&#125;&#39;|xargs kill</span><br><span class="line">        fi</span><br><span class="line">        sh &#x2F;path&#x2F;to&#x2F;tomcat&#x2F;bin&#x2F;startup.sh</span><br><span class="line">        echo &quot;start download-tomcat finished, time: &#96;date&#96;&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<h3 id="清理30天前的tomcat日志"><a href="#清理30天前的tomcat日志" class="headerlink" title="清理30天前的tomcat日志"></a>清理30天前的tomcat日志</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br><span class="line">0 23 * * * sh &#x2F;path&#x2F;to&#x2F;clean_log.sh</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi clean_log.sh</span><br><span class="line">DATE&#x3D;$(date -d &quot;30 days ago&quot; +%Y-%m-%d)</span><br><span class="line">echo $DATE</span><br><span class="line">rm &#x2F;path&#x2F;to&#x2F;tomcat&#x2F;logs&#x2F;*$DATE*</span><br></pre></td></tr></table></figure>
<h3 id="备份并清理catalina-out"><a href="#备份并清理catalina-out" class="headerlink" title="备份并清理catalina.out"></a>备份并清理catalina.out</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br><span class="line">00 22 * * * sh &#x2F;path&#x2F;to&#x2F;clean_catalina_out.sh</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vi clean_catalina_out.sh</span><br><span class="line">y&#x3D;&#96;date &quot;+%Y&quot;&#96;</span><br><span class="line">m&#x3D;&#96;date &quot;+%m&quot;&#96;</span><br><span class="line">d&#x3D;&#96;date &quot;+%d&quot;&#96;</span><br><span class="line">cp &#x2F;path&#x2F;to&#x2F;tomcat&#x2F;logs&#x2F;catalina.out &#x2F;path&#x2F;to&#x2F;tomcat&#x2F;logs&#x2F;catalina.out.$y-$m-$d</span><br><span class="line">echo &gt; &#x2F;path&#x2F;to&#x2F;tomcat&#x2F;logs&#x2F;catalina.out</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>
<h2 id="注意设置环境变量"><a href="#注意设置环境变量" class="headerlink" title="注意设置环境变量"></a>注意设置环境变量</h2><p>由于crontab执行任务时不加载任何环境变量，可以在脚本中加入必要的环境变量，甚至ulimit设置，以保证程序可以正常执行。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vi start.sh</span><br><span class="line"></span><br><span class="line">!&#x2F;bin&#x2F;sh</span><br><span class="line">source &#x2F;etc&#x2F;profile</span><br><span class="line">export YOUR_ENV&#x3D;value</span><br><span class="line">ulimit -n 10240</span><br><span class="line">&#x2F;path&#x2F;to&#x2F;your&#x2F;app&#x2F;run</span><br></pre></td></tr></table></figure>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a target="_blank" rel="noopener" href="http://www.linuxforums.org/forum/programming-scripting/21764-cron-job-not-taking-ulimits.html">http://www.linuxforums.org/forum/programming-scripting/21764-cron-job-not-taking-ulimits.html</a></li>
<li><a target="_blank" rel="noopener" href="http://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/crontab.html">http://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/crontab.html</a></li>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/Cron">https://zh.wikipedia.org/wiki/Cron</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201703/ulimit%E3%80%81limits.conf%E3%80%81sysctl%E5%92%8Cproc%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201703/ulimit%E3%80%81limits.conf%E3%80%81sysctl%E5%92%8Cproc%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" class="post-title-link" itemprop="url">ulimit、limits.conf、sysctl和proc文件系统</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-03-20 13:42:47" itemprop="dateCreated datePublished" datetime="2017-03-20T13:42:47+08:00">2017-03-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-11-06 15:46:36" itemprop="dateModified" datetime="2018-11-06T15:46:36+08:00">2018-11-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>当修改一个Linux系统参数或限制，比如文件打开数时，之前用到过的方式有ulimit、limits.conf、sysctl和/proc文件系统。<br>对这几个东西一直比较困惑，翻了几篇文档，简单写一下它们之间的区别。  </p>
<h2 id="ulimit"><a href="#ulimit" class="headerlink" title="ulimit"></a>ulimit</h2><h3 id="什么是ulimit"><a href="#什么是ulimit" class="headerlink" title="什么是ulimit"></a>什么是ulimit</h3><p>ulimit是linux shell的内键命令，它具有一套参数集，用于对 <strong>shell进程 及其 子进程</strong> 进行 <strong>资源限制</strong>。<br>例如用户同时运行了两个shell终端进程，只在其中一个环境中执行了<code>ulimit – s 100</code>，则该shell进程里创建文件的大小会有相应的限制，而另一个shell终端包括其上运行的子程序都不会受其影响。  </p>
<p>ulimit的设定值是 <strong>per-process</strong> 的，也就是说，每个进程有自己的limits值。<br>使用ulimit进行修改，是 <strong>立即生效</strong> 的。<br>ulimit只影响shell进程及其子进程，用户登出后失效。<br>可以在profile中加入ulimit的设置，变相的做到永久生效。  </p>
<h2 id="查看ulimit的设定值"><a href="#查看ulimit的设定值" class="headerlink" title="查看ulimit的设定值"></a>查看ulimit的设定值</h2><p>使用ulimit -a可以查看所有的设定值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:~ $ ulimit -a</span><br><span class="line">core file size          (blocks, -c) 0</span><br><span class="line">data seg size           (kbytes, -d) unlimited</span><br><span class="line">scheduling priority             (-e) 0</span><br><span class="line">file size               (blocks, -f) unlimited</span><br><span class="line">pending signals                 (-i) 7336</span><br><span class="line">max locked memory       (kbytes, -l) unlimited</span><br><span class="line">max memory size         (kbytes, -m) unlimited</span><br><span class="line">open files                      (-n) 65536</span><br><span class="line">pipe size            (512 bytes, -p) 8</span><br><span class="line">POSIX message queues     (bytes, -q) 819200</span><br><span class="line">real-time priority              (-r) 95</span><br><span class="line">stack size              (kbytes, -s) 8192</span><br><span class="line">cpu time               (seconds, -t) unlimited</span><br><span class="line">max user processes              (-u) 7336</span><br><span class="line">virtual memory          (kbytes, -v) unlimited</span><br><span class="line">file locks                      (-x) unlimited</span><br></pre></td></tr></table></figure>
<h3 id="ulimit的参数"><a href="#ulimit的参数" class="headerlink" title="ulimit的参数"></a>ulimit的参数</h3><ul>
<li>-H 设置硬件资源限制.</li>
<li>-S 设置软件资源限制.</li>
<li>-a 显示当前所有的资源限制.</li>
<li>-c size:设置core文件的最大值.单位:blocks</li>
<li>-d size:设置数据段的最大值.单位:kbytes</li>
<li>-f size:设置创建文件的最大值.单位:blocks</li>
<li>-l size:设置在内存中锁定进程的最大值.单位:kbytes</li>
<li>-m size:设置可以使用的常驻内存的最大值.单位:kbytes</li>
<li>-n size:设置内核可以同时打开的文件描述符的最大值.单位:n</li>
<li>-p size:设置管道缓冲区的最大值.单位:kbytes</li>
<li>-s size:设置堆栈的最大值.单位:kbytes</li>
<li>-t size:设置CPU使用时间的最大上限.单位:seconds</li>
<li>-v size:设置虚拟内存的最大值.单位:kbytes</li>
<li>unlimited 是一个特殊值，用于表示不限制</li>
</ul>
<p>注意：  </p>
<ol>
<li>-n 限制文件描述符的最大值，在Linux下一切资源皆文件，所以该参数也限制了socket链接数</li>
<li>查询时，若不加H或S参数，默认显示的是软限制</li>
<li>修改时，若不加H或S参数，两个参数一起改变</li>
</ol>
<h3 id="设置ulimit的位置"><a href="#设置ulimit的位置" class="headerlink" title="设置ulimit的位置"></a>设置ulimit的位置</h3><p>可以在以下位置进行ulimit设置:  </p>
<ul>
<li><code>/etc/profile</code>  所有用户有效，永久生效  </li>
<li><code>~/.bash_profile</code>  当前用户有效，永久生效  </li>
<li>直接在控制台输入    当前用户有效，临时生效  </li>
<li>放在程序的启动脚本中  </li>
</ul>
<h2 id="limit-conf"><a href="#limit-conf" class="headerlink" title="limit.conf"></a>limit.conf</h2><h3 id="什么是limits-conf"><a href="#什么是limits-conf" class="headerlink" title="什么是limits.conf"></a>什么是limits.conf</h3><p>limits.conf文件实际是Linux PAM中 <strong>pam_limits.so</strong> 的配置文件，pam_limits模块对 <strong>用户的会话</strong> 进行 <strong>资源限制</strong>。    </p>
<p><strong>一个shell的初始limits就是由pam_limits设定的</strong>，用户登录后，pam_limits会给用户的shell设定在limits.conf定义的值。  </p>
<p>pam_limits的设定值也是 <strong>per-process</strong> 的。<br>pam_limits的设置是 <strong>永久生效</strong> 的。  </p>
<h3 id="limits-conf的位置"><a href="#limits-conf的位置" class="headerlink" title="limits.conf的位置"></a>limits.conf的位置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;security&#x2F;limits.conf</span><br></pre></td></tr></table></figure>
<h3 id="配置limits-conf"><a href="#配置limits-conf" class="headerlink" title="配置limits.conf"></a>配置limits.conf</h3><p>示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">*    soft    nofile    655360</span><br><span class="line">*    hard    nofile    655360</span><br><span class="line">*    soft    noproc    655360</span><br><span class="line">*    hard    noproc    655355</span><br><span class="line">*    soft    core      0</span><br><span class="line">*    hard    core      0</span><br></pre></td></tr></table></figure>
<p>4个字段的含义分别为： domain type item value</p>
<ul>
<li>domain:  username|@groupname</li>
<li>type:   soft、hard、-</li>
<li>item:<br>core - 限制内核文件的大小<br>date - 最大数据大小<br>fsize - 最大文件大小<br>memlock - 最大锁定内存地址空间<br>nofile - 打开文件的最大数目<br>rss - 最大持久设置大小<br>stack - 最大栈大小<br>cpu - 以分钟为单位的最多 CPU 时间<br>noproc - 进程的最大数目<br>as - 地址空间限制<br>maxlogins - 此用户允许登录的最大数目</li>
<li>value: 值的大小</li>
</ul>
<h2 id="sysctl"><a href="#sysctl" class="headerlink" title="sysctl"></a>sysctl</h2><h3 id="什么是sysctl"><a href="#什么是sysctl" class="headerlink" title="什么是sysctl"></a>什么是sysctl</h3><p>sysctl是一个允许改变正在运行中的Linux系统的接口，修改的是针对 <strong>整个系统</strong> 的 <strong>内核参数</strong>。<br>sysctl的修改是 <strong>立即</strong> 且 <strong>临时</strong> 的（重启后失效）。<br>可以通过修改sysctl.conf配置文件，达到 <strong>永久</strong> 生效。  </p>
<h3 id="sysctl的选项"><a href="#sysctl的选项" class="headerlink" title="sysctl的选项"></a>sysctl的选项</h3><ul>
<li>-n  打印值时不打印关键字</li>
<li>-e  忽略未知关键字错误</li>
<li>-N  仅打印名称</li>
<li>-w  当改变sysctl设置时使用此项</li>
<li>-p  从配置文件“/etc/sysctl.conf”加载内核参数设置</li>
<li>-a  打印当前所有可用的内核参数变量和值</li>
<li>-A  以表格方式打印当前所有可用的内核参数变量和值</li>
</ul>
<h3 id="查看某个内核参数"><a href="#查看某个内核参数" class="headerlink" title="查看某个内核参数"></a>查看某个内核参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sysctl fs.file-max</span><br><span class="line"></span><br><span class="line">fs.file-max &#x3D; 93796</span><br></pre></td></tr></table></figure>
<h3 id="临时修改某个内核参数"><a href="#临时修改某个内核参数" class="headerlink" title="临时修改某个内核参数"></a>临时修改某个内核参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w fs.file-max&#x3D;100000  # 设置文件打开数</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w net.ipv4.ip_forward&#x3D;1  # 开启IP转发</span><br></pre></td></tr></table></figure>
<h3 id="sysctl-conf配置文件"><a href="#sysctl-conf配置文件" class="headerlink" title="sysctl.conf配置文件"></a>sysctl.conf配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;sysctl.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="修改sysctl-conf并使其生效"><a href="#修改sysctl-conf并使其生效" class="headerlink" title="修改sysctl.conf并使其生效"></a>修改sysctl.conf并使其生效</h3><p>修改<code>/etc/sysctl.conf</code>可以做到永久生效：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;sysctl.conf</span><br><span class="line"></span><br><span class="line">fs.file-max &#x3D; 100000</span><br></pre></td></tr></table></figure>
<p>最后使用<code>-p</code>命令从配置文件中加载内核参数，使其立即生效：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>
<h3 id="sysctl-conf配置示例"><a href="#sysctl-conf配置示例" class="headerlink" title="sysctl.conf配置示例"></a>sysctl.conf配置示例</h3><p>下面是一个摘抄的配置示例，出处：<a target="_blank" rel="noopener" href="http://www.jianshu.com/p/9a8e383b5b49">http://www.jianshu.com/p/9a8e383b5b49</a>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"># Kernel sysctl configuration file for Red Hat Linux</span><br><span class="line">#</span><br><span class="line"># For binary values, 0 is disabled, 1 is enabled.  See sysctl(8) and</span><br><span class="line"># sysctl.conf(5) for more details.</span><br><span class="line"></span><br><span class="line"># Controls IP packet forwarding</span><br><span class="line">net.ipv4.ip_forward &#x3D; 0</span><br><span class="line"></span><br><span class="line"># Controls source route verification</span><br><span class="line">net.ipv4.conf.default.rp_filter &#x3D; 1</span><br><span class="line"></span><br><span class="line"># Do not accept source routing</span><br><span class="line">net.ipv4.conf.default.accept_source_route &#x3D; 0</span><br><span class="line"></span><br><span class="line"># Controls the System Request debugging functionality of the kernel</span><br><span class="line"></span><br><span class="line"># Controls whether core dumps will append the PID to the core filename.</span><br><span class="line"># Useful for debugging multi-threaded applications.</span><br><span class="line">kernel.core_uses_pid &#x3D; 1</span><br><span class="line"></span><br><span class="line"># Controls the use of TCP syncookies</span><br><span class="line">net.ipv4.tcp_syncookies &#x3D; 1</span><br><span class="line"></span><br><span class="line"># Disable netfilter on bridges.</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables &#x3D; 0</span><br><span class="line">net.bridge.bridge-nf-call-iptables &#x3D; 0</span><br><span class="line">net.bridge.bridge-nf-call-arptables &#x3D; 0</span><br><span class="line"></span><br><span class="line"># Controls the default maxmimum size of a mesage queue</span><br><span class="line">kernel.msgmnb &#x3D; 65536</span><br><span class="line"></span><br><span class="line"># Controls the maximum size of a message, in bytes</span><br><span class="line">kernel.msgmax &#x3D; 65536</span><br><span class="line"></span><br><span class="line"># Controls the maximum shared segment size, in bytes</span><br><span class="line">kernel.shmmax &#x3D; 68719476736</span><br><span class="line"></span><br><span class="line"># Controls the maximum number of shared memory segments, in pages</span><br><span class="line">kernel.shmall &#x3D; 4294967296</span><br><span class="line">net.ipv4.conf.all.send_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.default.send_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.all.secure_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.default.secure_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.all.accept_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.default.accept_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.all.send_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.default.send_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.all.secure_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.default.secure_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.all.accept_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.default.accept_redirects &#x3D; 0</span><br><span class="line">net.netfilter.nf_conntrack_max &#x3D; 1000000</span><br><span class="line">kernel.unknown_nmi_panic &#x3D; 0</span><br><span class="line">kernel.sysrq &#x3D; 0</span><br><span class="line">fs.file-max &#x3D; 1000000</span><br><span class="line">vm.swappiness &#x3D; 10</span><br><span class="line">fs.inotify.max_user_watches &#x3D; 10000000</span><br><span class="line">net.core.wmem_max &#x3D; 327679</span><br><span class="line">net.core.rmem_max &#x3D; 327679</span><br><span class="line">net.ipv4.conf.all.send_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.default.send_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.all.secure_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.default.secure_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.all.accept_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.default.accept_redirects &#x3D; 0</span><br></pre></td></tr></table></figure>

<h2 id="proc文件系统"><a href="#proc文件系统" class="headerlink" title="/proc文件系统"></a>/proc文件系统</h2><h3 id="什么是-proc文件系统"><a href="#什么是-proc文件系统" class="headerlink" title="什么是/proc文件系统"></a>什么是/proc文件系统</h3><p>Linux内核提供了一种通过<code>/proc</code>文件系统，在运行时访问内核内部数据结构、改变内核设置的机制。<br>proc文件系统是一个伪文件系统，它只存在内存当中，而不占用外存空间。它以文件系统的方式为访问系统内核数据的操作提供接口。<br>最初开发/proc文件系统是为了提供有关系统中进程的信息。但是由于这个文件系统非常有用，因此内核中的很多元素也开始使用它来报告信息，或启用动态运行时配置。  </p>
<p>对/proc中内核文件的修改，针对的是 <strong>整个系统</strong> 的 <strong>内核参数</strong> ，修改后 <strong>立即生效</strong> ，但修改是 <strong>临时</strong> 的（重启后失效）。</p>
<h3 id="proc文件系统与sysctl-conf的对应关系"><a href="#proc文件系统与sysctl-conf的对应关系" class="headerlink" title="/proc文件系统与sysctl.conf的对应关系"></a>/proc文件系统与sysctl.conf的对应关系</h3><p>/proc/sys下内核文件与配置文件sysctl.conf中变量的对应关系:  </p>
<ol>
<li>去掉前面部分/proc/sys</li>
<li>将文件名中的斜杠变为点</li>
</ol>
<p>例如：</p>
<ul>
<li>/proc/sys/net/ipv4/ip_forward -&gt; net.ipv4.ip_forward</li>
<li>/proc/sys/kernel/hostname -&gt; kernel.hostname</li>
</ul>
<h3 id="proc文件系统中几个常用的内核文件"><a href="#proc文件系统中几个常用的内核文件" class="headerlink" title="/proc文件系统中几个常用的内核文件"></a>/proc文件系统中几个常用的内核文件</h3><p>下面几个是经常会用到的文件：  </p>
<ul>
<li>/proc/meminfo    内存信息</li>
<li>/proc/cpuinfo    CPU信息</li>
<li>/proc/sys/fs/file-max   文件打开数</li>
<li>/proc/sys/fs/file-nr   整个系统目前使用的文件句柄数量</li>
</ul>
<h3 id="proc文件系统中文件的权限"><a href="#proc文件系统中文件的权限" class="headerlink" title="/proc文件系统中文件的权限"></a>/proc文件系统中文件的权限</h3><p>proc 中的每个文件都有一组分配给它的非常特殊的文件许可权，并且每个文件属于特定的用户标识。  </p>
<ul>
<li>只读：任何用户都不能更改该文件；它用于表示系统信息  </li>
<li>root 写：如果 /proc 中的某个文件是可写的，则通常只能由 root 用户来写  </li>
<li>root 读：有些文件对一般系统用户是不可见的，而只对 root 用户是可见的  </li>
</ul>
<h3 id="对-proc进行读写"><a href="#对-proc进行读写" class="headerlink" title="对/proc进行读写"></a>对/proc进行读写</h3><p>以开启IP转发为例：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;ip_forward</span><br><span class="line">0</span><br><span class="line">echo &quot;1&quot; &gt; &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;ip_forward</span><br><span class="line">cat &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;ip_forward</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>当然，也可以使用sysctl来配置这些内核条目</p>
<h3 id="内核文件详解"><a href="#内核文件详解" class="headerlink" title="内核文件详解"></a>内核文件详解</h3><ul>
<li>/proc/buddyinfo 每个内存区中的每个order有多少块可用，和内存碎片问题有关</li>
<li>/proc/cmdline 启动时传递给kernel的参数信息</li>
<li>/proc/cpuinfo cpu的信息</li>
<li>/proc/crypto 内核使用的所有已安装的加密密码及细节</li>
<li>/proc/devices 已经加载的设备并分类</li>
<li>/proc/dma 已注册使用的ISA DMA频道列表</li>
<li>/proc/execdomains Linux内核当前支持的execution domains</li>
<li>/proc/fb 帧缓冲设备列表，包括数量和控制它的驱动</li>
<li>/proc/filesystems 内核当前支持的文件系统类型</li>
<li>/proc/interrupts x86架构中的每个IRQ中断数</li>
<li>/proc/iomem 每个物理设备当前在系统内存中的映射</li>
<li>/proc/ioports 一个设备的输入输出所使用的注册端口范围</li>
<li>/proc/kcore 代表系统的物理内存，存储为核心文件格式，里边显示的是字节数，等于RAM大小加上4kb</li>
<li>/proc/kmsg 记录内核生成的信息，可以通过/sbin/klogd或/bin/dmesg来处理</li>
<li>/proc/loadavg 根据过去一段时间内CPU和IO的状态得出的负载状态，与uptime命令有关</li>
<li>/proc/locks 内核锁住的文件列表</li>
<li>/proc/mdstat 多硬盘，RAID配置信息(md=multiple disks)</li>
<li>/proc/meminfo RAM使用的相关信息</li>
<li>/proc/misc 其他的主要设备(设备号为10)上注册的驱动</li>
<li>/proc/modules 所有加载到内核的模块列表</li>
<li>/proc/mounts 系统中使用的所有挂载</li>
<li>/proc/mtrr 系统使用的Memory Type Range Registers (MTRRs)</li>
<li>/proc/partitions 分区中的块分配信息</li>
<li>/proc/pci 系统中的PCI设备列表</li>
<li>/proc/slabinfo 系统中所有活动的 slab 缓存信息</li>
<li>/proc/stat 所有的CPU活动信息</li>
<li>/proc/sysrq-trigger 使用echo命令来写这个文件的时候，远程root用户可以执行大多数的系统请求关键命令，就好- 像在本地终端执行一样。要写入这个文件，需要把/proc/sys/kernel/sysrq不能设置为0。这个文件对root也是不可- 读的</li>
<li>/proc/uptime 系统已经运行了多久</li>
<li>/proc/swaps 交换空间的使用情况</li>
<li>/proc/version Linux内核版本和gcc版本</li>
<li>/proc/bus 系统总线(Bus)信息，例如pci/usb等</li>
<li>/proc/driver 驱动信息</li>
<li>/proc/fs 文件系统信息</li>
<li>/proc/ide ide设备信息</li>
<li>/proc/irq 中断请求设备信息</li>
<li>/proc/net 网卡设备信息</li>
<li>/proc/scsi scsi设备信息</li>
<li>/proc/tty tty设备信息</li>
<li>/proc/net/dev 显示网络适配器及统计信息</li>
<li>/proc/vmstat 虚拟内存统计信息</li>
<li>/proc/vmcore 内核panic时的内存映像</li>
<li>/proc/diskstats 取得磁盘信息</li>
<li>/proc/schedstat kernel调度器的统计信息</li>
<li>/proc/zoneinfo 显示内存空间的统计信息，对分析虚拟内存行为很有用</li>
</ul>
<p>以下是/proc目录中进程N的信息：</p>
<ul>
<li>/proc/N pid为N的进程信息</li>
<li>/proc/N/cmdline 进程启动命令</li>
<li>/proc/N/cwd 链接到进程当前工作目录</li>
<li>/proc/N/environ 进程环境变量列表</li>
<li>/proc/N/exe 链接到进程的执行命令文件</li>
<li>/proc/N/fd 包含进程相关的所有的文件描述符</li>
<li>/proc/N/maps 与进程相关的内存映射信息</li>
<li>/proc/N/mem 指代进程持有的内存，不可读</li>
<li>/proc/N/root 链接到进程的根目录</li>
<li>/proc/N/stat 进程的状态</li>
<li>/proc/N/statm 进程使用的内存的状态</li>
<li>/proc/N/status 进程状态信息，比stat/statm更具可读性</li>
<li>/proc/self 链接到当前正在运行的进程</li>
</ul>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.ibm.com/developerworks/cn/linux/l-cn-ulimit/">https://www.ibm.com/developerworks/cn/linux/l-cn-ulimit/</a>  </li>
<li><a target="_blank" rel="noopener" href="http://www.linuxhowtos.org/Tips%20and%20Tricks/ulimit.htm">http://www.linuxhowtos.org/Tips%20and%20Tricks/ulimit.htm</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cyberciti.biz/faq/linux-increase-the-maximum-number-of-open-files/">https://www.cyberciti.biz/faq/linux-increase-the-maximum-number-of-open-files/</a></li>
<li><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/23ee9db2a620">http://www.jianshu.com/p/23ee9db2a620</a></li>
<li><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/9a8e383b5b49">http://www.jianshu.com/p/9a8e383b5b49</a></li>
<li><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/d71e20f51aab">http://www.jianshu.com/p/d71e20f51aab</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ibm.com/developerworks/cn/linux/l-proc.html">https://www.ibm.com/developerworks/cn/linux/l-proc.html</a></li>
<li><a target="_blank" rel="noopener" href="http://feichashao.com/ulimit_demo/">http://feichashao.com/ulimit_demo/</a></li>
<li><a target="_blank" rel="noopener" href="http://www.linux-pam.org/Linux-PAM-html/sag-pam_limits.html">http://www.linux-pam.org/Linux-PAM-html/sag-pam_limits.<strong>html</strong></a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201703/%E8%BD%BB%E9%87%8F%E7%BA%A7ORM%E5%B7%A5%E5%85%B7peewee%E5%88%9D%E6%8E%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201703/%E8%BD%BB%E9%87%8F%E7%BA%A7ORM%E5%B7%A5%E5%85%B7peewee%E5%88%9D%E6%8E%A2/" class="post-title-link" itemprop="url">轻量级ORM框架peewee初探</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-03-15 10:30:24" itemprop="dateCreated datePublished" datetime="2017-03-15T10:30:24+08:00">2017-03-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-11-06 15:47:10" itemprop="dateModified" datetime="2018-11-06T15:47:10+08:00">2018-11-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="peewee简介"><a href="#peewee简介" class="headerlink" title="peewee简介"></a>peewee简介</h2><p>peewee是Python一个ORM框架，相比于著名的SQLAlchemy，peewee更为轻量，且更加简单易上手。<br>peewee原生支持sqlite、mysql以及postgresql。  </p>
<h2 id="学习资源"><a href="#学习资源" class="headerlink" title="学习资源"></a>学习资源</h2><p><a target="_blank" rel="noopener" href="http://docs.peewee-orm.com/">peewee官网</a><br><a target="_blank" rel="noopener" href="https://github.com/coleifer/peewee">GitHub页面</a></p>
<h2 id="数据建模"><a href="#数据建模" class="headerlink" title="数据建模"></a>数据建模</h2><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">from peewee import *</span><br><span class="line">import datetime</span><br><span class="line">from playhouse.sqlite_ext import SqliteExtDatabase</span><br><span class="line"></span><br><span class="line">db &#x3D; MySQLDatabase(host&#x3D;&#39;localhost&#39;, user&#x3D;&#39;playground&#39;, passwd&#x3D;&#39;playground&#39;, database&#x3D;&#39;playground&#39;)</span><br><span class="line"># db &#x3D; SqliteExtDatabase(&#39;my_database.db&#39;)</span><br><span class="line"></span><br><span class="line">class BaseModel(Model):</span><br><span class="line">    class Meta:</span><br><span class="line">        database &#x3D; db</span><br><span class="line"></span><br><span class="line"># 用户表</span><br><span class="line">class User(BaseModel):</span><br><span class="line">    username &#x3D; CharField(unique&#x3D;True)</span><br><span class="line"></span><br><span class="line"># Twitter表</span><br><span class="line">class Tweet(BaseModel):</span><br><span class="line">    user &#x3D; ForeignKeyField(User, related_name&#x3D;&#39;tweets&#39;)</span><br><span class="line">    message &#x3D; TextField()</span><br><span class="line">    created_date &#x3D; DateTimeField(default&#x3D;datetime.datetime.now)</span><br><span class="line">    is_published &#x3D; BooleanField(default&#x3D;True)</span><br></pre></td></tr></table></figure>
<h3 id="支持的字段类型"><a href="#支持的字段类型" class="headerlink" title="支持的字段类型"></a>支持的字段类型</h3><ul>
<li>CharField    varchar    varchar    varchar  </li>
<li>FixedCharField    char    char    char  </li>
<li>TextField    text    text    longtext  </li>
<li>DateTimeField    datetime    timestamp    datetime  </li>
<li>IntegerField    integer    integer    integer  </li>
<li>BooleanField    integer    boolean    bool  </li>
<li>FloatField    real    real    real  </li>
<li>DoubleField    real    double precision    double precision  </li>
<li>BigIntegerField    integer    bigint    bigint  </li>
<li>SmallIntegerField    integer    smallint    smallint  </li>
<li>DecimalField    decimal    numeric    numeric  </li>
<li>PrimaryKeyField    integer    serial    integer  </li>
<li>ForeignKeyField    integer    integer    integer  </li>
<li>DateField    date    date    date  </li>
<li>TimeField    time    time    time  </li>
<li>TimestampField    integer    integer    integer  </li>
<li>BlobField    blob    bytea    blob  </li>
<li>UUIDField    text    uuid    varchar(40)  </li>
<li>BareField    untyped    not supported    not supported  </li>
</ul>
<h3 id="支持的参数"><a href="#支持的参数" class="headerlink" title="支持的参数"></a>支持的参数</h3><ul>
<li>null = False – boolean indicating whether null values are allowed to be stored  </li>
<li>index = False – boolean indicating whether to create an index on this column  </li>
<li>unique = False – boolean indicating whether to create a unique index on this column. See - also adding composite indexes.  </li>
<li>verbose_name = None – string representing the “user-friendly” name of this field  </li>
<li>help_text = None – string representing any helpful text for this field  </li>
<li>db_column = None – string representing the underlying column to use if different, useful - for legacy databases  </li>
<li>default = None – any value to use as a default for uninitialized models  </li>
<li>choices = None – an optional iterable containing 2-tuples of value, display  </li>
<li>primary_key = False – whether this field is the primary key for the table  </li>
<li>sequence = None – sequence to populate field (if backend supports it)  </li>
<li>constraints = None - a list of one or more constraints, e.g. [Check(‘price &gt; 0’)]  </li>
<li>schema = None – optional name of the schema to use, if your db supports this.  <h3 id="特殊的参数"><a href="#特殊的参数" class="headerlink" title="特殊的参数"></a>特殊的参数</h3></li>
<li>CharField    max_length</li>
<li>FixedCharField    max_length</li>
<li>DateTimeField    formats</li>
<li>DateField    formats</li>
<li>TimeField    formats</li>
<li>TimestampField    resolution, utc</li>
<li>DecimalField    max_digits, decimal_places, auto_round, rounding</li>
<li>ForeignKeyField    rel_model, related_name, to_field, on_delete, on_update, extra</li>
<li>BareField    coerce</li>
</ul>
<h2 id="连接数据库并生成表"><a href="#连接数据库并生成表" class="headerlink" title="连接数据库并生成表"></a>连接数据库并生成表</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def create_table():</span><br><span class="line">    db.connect()</span><br><span class="line">    db.create_tables([User, Tweet])</span><br></pre></td></tr></table></figure>
<h2 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h2><h3 id="插入记录"><a href="#插入记录" class="headerlink" title="插入记录"></a>插入记录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">charlie &#x3D; User.create(username&#x3D;&#39;charlie&#39;)</span><br><span class="line"></span><br><span class="line">huey &#x3D; User(username&#x3D;&#39;huey&#39;)</span><br><span class="line">huey.save()</span><br><span class="line"></span><br><span class="line"># 不需要设置 &#96;is_published&#96; 或 &#96;created_date&#96;，保存时会自动使用模型中指定的默认值</span><br><span class="line">Tweet.create(user&#x3D;charlie, message&#x3D;&#39;My first tweet&#39;)</span><br></pre></td></tr></table></figure>
<h3 id="查询单条记录"><a href="#查询单条记录" class="headerlink" title="查询单条记录"></a>查询单条记录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user &#x3D; User.get(User.id &#x3D;&#x3D; 1)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user &#x3D; User.get(User.username &#x3D;&#x3D; &#39;charlie&#39;)</span><br></pre></td></tr></table></figure>
<h3 id="查询多条记录"><a href="#查询多条记录" class="headerlink" title="查询多条记录"></a>查询多条记录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for user in User.select():</span><br><span class="line">    print(user.username)</span><br></pre></td></tr></table></figure>
<h3 id="多条件查询"><a href="#多条件查询" class="headerlink" title="多条件查询"></a>多条件查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tweet.select().where(Tweet.user &#x3D;&#x3D; user, Tweet.is_published &#x3D;&#x3D; True)</span><br></pre></td></tr></table></figure>
<h3 id="in查询，使用”-lt-lt-”来代入多个条件"><a href="#in查询，使用”-lt-lt-”来代入多个条件" class="headerlink" title="in查询，使用”&lt;&lt;”来代入多个条件"></a>in查询，使用”&lt;&lt;”来代入多个条件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">usernames &#x3D; [&#39;charlie&#39;, &#39;huey&#39;, &#39;mickey&#39;]</span><br><span class="line">users &#x3D; User.select().where(User.username &lt;&lt; usernames)</span><br></pre></td></tr></table></figure>

<h3 id="join查询"><a href="#join查询" class="headerlink" title="join查询"></a>join查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tweets &#x3D; (Tweet</span><br><span class="line">          .select()</span><br><span class="line">          .join(User)</span><br><span class="line">          .where(User.username &lt;&lt; usernames))</span><br></pre></td></tr></table></figure>
<h3 id="count"><a href="#count" class="headerlink" title="count"></a>count</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tweet.select().where(Tweet.id &gt; 50).count()</span><br></pre></td></tr></table></figure>
<h3 id="count今天发布了几条Twitter"><a href="#count今天发布了几条Twitter" class="headerlink" title="count今天发布了几条Twitter"></a>count今天发布了几条Twitter</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tweets_today &#x3D; (Tweet</span><br><span class="line">                .select()</span><br><span class="line">                .where(</span><br><span class="line">    (Tweet.created_date &gt;&#x3D; datetime.date.today()) &amp;</span><br><span class="line">    (Tweet.is_published &#x3D;&#x3D; True))</span><br><span class="line">                .count())</span><br></pre></td></tr></table></figure>
<h3 id="排序及分页"><a href="#排序及分页" class="headerlink" title="排序及分页"></a>排序及分页</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User.select().order_by(User.username).paginate(3, 20)</span><br><span class="line">Tweet.select().join(User).order_by(User.username, Tweet.created_date.desc())</span><br></pre></td></tr></table></figure>
<h3 id="join和gruopby，将用户按Twitter数排序"><a href="#join和gruopby，将用户按Twitter数排序" class="headerlink" title="join和gruopby，将用户按Twitter数排序"></a>join和gruopby，将用户按Twitter数排序</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tweet_ct &#x3D; fn.Count(Tweet.id)</span><br><span class="line">users &#x3D; (User</span><br><span class="line">         .select(User, tweet_ct.alias(&#39;ct&#39;))</span><br><span class="line">         .join(Tweet, JOIN.LEFT_OUTER)</span><br><span class="line">         .group_by(User)</span><br><span class="line">         .order_by(tweet_ct.desc()))</span><br></pre></td></tr></table></figure>
<h3 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">User.update(username&#x3D;&#39;foo&#39;).where(User.id &#x3D;&#x3D; 2).execute()</span><br><span class="line"></span><br><span class="line">user &#x3D; User.get(User.id &#x3D;&#x3D; 1)</span><br><span class="line">user.username&#x3D;&#39;bar&#39;</span><br><span class="line">user.save()</span><br></pre></td></tr></table></figure>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Tweet.delete().where(id&#x3D;&#x3D;1).execute()</span><br><span class="line"></span><br><span class="line">user &#x3D; User.get(User.id &#x3D;&#x3D; 8)</span><br><span class="line">user.delete_instance()</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201703/%E4%BD%BF%E7%94%A8virtualenv%E9%9A%94%E7%A6%BBPython%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201703/%E4%BD%BF%E7%94%A8virtualenv%E9%9A%94%E7%A6%BBPython%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83/" class="post-title-link" itemprop="url">使用virtualenv创建Python虚拟环境</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-03-13 12:20:21" itemprop="dateCreated datePublished" datetime="2017-03-13T12:20:21+08:00">2017-03-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-07-31 08:56:53" itemprop="dateModified" datetime="2019-07-31T08:56:53+08:00">2019-07-31</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="什么是virtualenv"><a href="#什么是virtualenv" class="headerlink" title="什么是virtualenv"></a>什么是virtualenv</h2><p>virtualenv是一个用于创建Python虚拟环境的工具。  </p>
<p>虚拟环境又是什么呢？它是Python解释器的一个私有副本，在这个环境中可以安装私有包，而不会影响到系统中安装的全局Python解释器。<br>当一台主机上运行着多个Python应用时，使用虚拟环境可以有效的避免包的混乱和版本的冲突。  </p>
<h2 id="virtualenv官网"><a href="#virtualenv官网" class="headerlink" title="virtualenv官网"></a>virtualenv官网</h2><p>如果懒得看作者瞎BB，可以跳过下面的章节，直接访问官网：<br><a target="_blank" rel="noopener" href="https://virtualenv.pypa.io/">https://virtualenv.pypa.io</a>  </p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>在Linux或Mac中，可以使用<code>pip</code>或<code>easy_install</code>来快速安装virturlenv：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install virtualenv</span><br></pre></td></tr></table></figure>
<p>或：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo easy_install virutalenv</span><br></pre></td></tr></table></figure>
<p>测试安装是否成功：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">virtualenv --version</span><br><span class="line">15.1.0</span><br></pre></td></tr></table></figure>
<h2 id="创建虚拟环境"><a href="#创建虚拟环境" class="headerlink" title="创建虚拟环境"></a>创建虚拟环境</h2><p>下面以macOS为例，创建一个python3的虚拟环境。<br>假设已经有一个工程目录pyapp，进入工程目录中，执行以下命令：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd pyapp</span><br><span class="line">virtualenv venv</span><br><span class="line"></span><br><span class="line">Using base prefix &#39;&#x2F;Library&#x2F;Frameworks&#x2F;Python.framework&#x2F;Versions&#x2F;3.5&#39;</span><br><span class="line">New python executable in &#x2F;Users&#x2F;foobar&#x2F;tmp&#x2F;pyapp&#x2F;venv&#x2F;bin&#x2F;python3.5</span><br><span class="line">Also creating executable in &#x2F;Users&#x2F;foobar&#x2F;tmp&#x2F;pyapp&#x2F;venv&#x2F;bin&#x2F;python</span><br><span class="line">Installing setuptools, pip, wheel...done.</span><br></pre></td></tr></table></figure>
<p>现在，virtualenv为我们在工程目录中，创建了一个名为<code>venv</code>的子目录，它里面保存了一个全新的虚拟环境，非常简单。  </p>
<p>现在可以进入ven/bin目录下，看看里面都有些什么东西：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cd venv&#x2F;bin</span><br><span class="line">ls -al</span><br><span class="line">total 160</span><br><span class="line">drwxr-xr-x  16 foobar  staff    544 Mar 13 09:44 .</span><br><span class="line">drwxr-xr-x   7 foobar  staff    238 Mar 13 09:44 ..</span><br><span class="line">-rw-r--r--   1 foobar  staff   2089 Mar 13 09:44 activate</span><br><span class="line">-rw-r--r--   1 foobar  staff   1031 Mar 13 09:44 activate.csh</span><br><span class="line">-rw-r--r--   1 foobar  staff   2185 Mar 13 09:44 activate.fish</span><br><span class="line">-rw-r--r--   1 foobar  staff   1137 Mar 13 09:44 activate_this.py</span><br><span class="line">-rwxr-xr-x   1 foobar  staff    262 Mar 13 09:44 easy_install</span><br><span class="line">-rwxr-xr-x   1 foobar  staff    262 Mar 13 09:44 easy_install-3.5</span><br><span class="line">-rwxr-xr-x   1 foobar  staff    234 Mar 13 09:44 pip</span><br><span class="line">-rwxr-xr-x   1 foobar  staff    234 Mar 13 09:44 pip3</span><br><span class="line">-rwxr-xr-x   1 foobar  staff    234 Mar 13 09:44 pip3.5</span><br><span class="line">lrwxr-xr-x   1 foobar  staff      9 Mar 13 09:43 python -&gt; python3.5</span><br><span class="line">-rwxr-xr-x   1 foobar  staff   2348 Mar 13 09:44 python-config</span><br><span class="line">lrwxr-xr-x   1 foobar  staff      9 Mar 13 09:43 python3 -&gt; python3.5</span><br><span class="line">-rwxrwxr-x   1 foobar  staff  25384 Mar 13 09:43 python3.5</span><br><span class="line">-rwxr-xr-x   1 foobar  staff    241 Mar 13 09:44 wheel</span><br></pre></td></tr></table></figure>
<p>可以看到virtuanenv为我们创建了一个python3的虚拟环境。  </p>
<p>但在Ubuntu16.04下，virtualenv默认会创建python2.7的虚拟环境。这时，只要在创建时加入<code>-p python3</code>参数即可解决。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virtualenv -p python3 venv</span><br></pre></td></tr></table></figure>
<h2 id="激活和退出虚拟环境"><a href="#激活和退出虚拟环境" class="headerlink" title="激活和退出虚拟环境"></a>激活和退出虚拟环境</h2><p>在使用虚拟环境之前，必须将其激活，命令如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">source venv&#x2F;bin&#x2F;activate</span><br><span class="line">或</span><br><span class="line">. venv&#x2F;bin&#x2F;activate</span><br></pre></td></tr></table></figure>
<p>这时，可以看到shell提示符前面加上了<code>(venv)</code>前缀，说明已经工作在虚拟环境之下了  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(venv)➜pyapp</span><br></pre></td></tr></table></figure>
<p>退出虚拟环境只要执行：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deactivate</span><br></pre></td></tr></table></figure>
<h2 id="在虚拟环境中安装依赖"><a href="#在虚拟环境中安装依赖" class="headerlink" title="在虚拟环境中安装依赖"></a>在虚拟环境中安装依赖</h2><p>在虚拟环境中，可以像平时一样使用pip安装依赖，操作完全没有区别：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pip3 install requests</span><br><span class="line"></span><br><span class="line">Collecting requests</span><br><span class="line">  Downloading requests-2.13.0-py2.py3-none-any.whl (584kB)</span><br><span class="line">    100% |████████████████████████████████| 593kB 13kB&#x2F;s</span><br><span class="line">Installing collected packages: requests</span><br><span class="line">Successfully installed requests-2.13.0</span><br></pre></td></tr></table></figure>
<p>但依赖会安装到<code>venv/lib/python3.5/site-packages</code>目录下，可以进去看一下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd venv&#x2F;lib&#x2F;python3.5&#x2F;site-packages</span><br><span class="line">ls -al</span><br></pre></td></tr></table></figure>
<p>当然还可以使用<code>-r requirements.txt</code>来批量安装依赖，也是没有问题的：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pip3 install -r requirements.txt</span><br><span class="line"></span><br><span class="line">Collecting beautifulsoup4 (from -r requirements.txt (line 1))</span><br><span class="line">  Downloading beautifulsoup4-4.5.3-py3-none-any.whl (85kB)</span><br><span class="line">    100% |████████████████████████████████| 92kB 13kB&#x2F;s</span><br><span class="line">Installing collected packages: beautifulsoup4</span><br><span class="line">Successfully installed beautifulsoup4-4.5.3</span><br></pre></td></tr></table></figure>
<h2 id="删除虚拟环境"><a href="#删除虚拟环境" class="headerlink" title="删除虚拟环境"></a>删除虚拟环境</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rmvirtualenv venv</span><br></pre></td></tr></table></figure>
<h2 id="在PyCharm中使用virtualenv"><a href="#在PyCharm中使用virtualenv" class="headerlink" title="在PyCharm中使用virtualenv"></a>在PyCharm中使用virtualenv</h2><p>PyCharm已经提供了对virtualenv的支持，详情可查看官方文档：<br><a target="_blank" rel="noopener" href="https://www.jetbrains.com/help/pycharm/2016.1/creating-virtual-environment.html">https://www.jetbrains.com/help/pycharm/2016.1/creating-virtual-environment.html</a></p>
<p>首先是设置virtualenv的路径，PyCharm应该会自动发现并配置上，查看一下即可。  </p>
<p>位置：  <code>CMD+,</code>  –&gt;  Project  –&gt;  Project Interpreter，点击右上角的齿轮图标，选择<code>Create VirtualEnv</code>：<br><img src="http://oss.bluexiii.com/8hspu.jpg">  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201702/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E4%BD%BF%E7%94%A8SSH/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201702/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E4%BD%BF%E7%94%A8SSH/" class="post-title-link" itemprop="url">如何优(zhe)雅(teng)的使用SSH</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-03-13 10:49:17" itemprop="dateCreated datePublished" datetime="2017-03-13T10:49:17+08:00">2017-03-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-07-31 08:56:53" itemprop="dateModified" datetime="2019-07-31T08:56:53+08:00">2019-07-31</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="引子"><a href="#引子" class="headerlink" title="引子"></a>引子</h2><p>SSH连接是我们与服务器交互的主要手段，每个程序员每天都会用到，就像喝白开水一样普通。<br>就是这样一个简单而又高频的动作，如果配置得当，或许能极大的提高我们工作的幸福感吧。  </p>
<p>前不久一个同事刚从Windows切换到macOS平台，问我SecureCRT有没有mac下的版本，我说即然都用上了基于BSD的mac了，应该不再需要SecureCRT这样的东西了才对，SSH如果配置好了，体验应该完爆Windows。于是就有了写下这篇文章的念头，填一下之前的坑。  </p>
<h2 id="选择终端GUI工具"><a href="#选择终端GUI工具" class="headerlink" title="选择终端GUI工具"></a>选择终端GUI工具</h2><p>首先第一步是选择一个好用的GUI工具，毕竟大多数人都是在DE下工作，极少人会喜欢工作在tty1这样的文字介面下。  </p>
<h3 id="Windows平台"><a href="#Windows平台" class="headerlink" title="Windows平台"></a>Windows平台</h3><p>Windows平台下的工具比较多，下面捡几个主要的来说一说优缺点：  </p>
<ul>
<li>SecureCRT - 老牌的商业软件，同时也提供Mac和Linux版本，功能强大，费用昂贵，但貌似身边所有人都在用盗版，PASS  </li>
<li>Xshell - 有免费的License，但只允许非商业场景下使用，这个也PASS  </li>
<li>Putty - 好吧，只能是它了，免费，功能简单，但是也足够用了  </li>
<li>Cygwin - 差点把这个忘了，严格来说它并不仅仅是一个SSH工具，也值得推荐  </li>
</ul>
<h3 id="macOS平台"><a href="#macOS平台" class="headerlink" title="macOS平台"></a>macOS平台</h3><p>macOS平台的终端工具比较好选，公认的只有iTerm2一个：  </p>
<ul>
<li>原生Terminal - 开箱即用，功能上也不过不失，但抛弃它，只是因为有更好的iTerm2。。。  </li>
<li>iTerm2 - 免费，支持众多的自定义选项，可以完全替代原生Terminal，没得选，就是它了</li>
</ul>
<h3 id="Ubuntu平台"><a href="#Ubuntu平台" class="headerlink" title="Ubuntu平台"></a>Ubuntu平台</h3><p>Ubuntu默认自带一个gnome-terminal，虽然不像iTerm2那样讨喜，但胜在简洁，个人认为是最优的选择吧：  </p>
<ul>
<li>Terminator - 支持窗口拆分，但界面丑，不能忍，PASS  </li>
<li>Guake - 支持下拉式的呼出，但界面更丑，PASS  </li>
<li>原生Terminal - 界面简洁，功能够用，最终还是用回了它</li>
</ul>
<h2 id="iTerm2使用简介"><a href="#iTerm2使用简介" class="headerlink" title="iTerm2使用简介"></a>iTerm2使用简介</h2><p>Putty和gnome-terminal的配置都比较简单，记住几个快捷键就可以了，macOS下的iTerm2配置和使用都要麻烦些，这里单独拿出来写一下。   </p>
<h3 id="配置呼出快捷键"><a href="#配置呼出快捷键" class="headerlink" title="配置呼出快捷键"></a>配置呼出快捷键</h3><p>使用<code>Cmd+,</code>打开设置界面，切换到<code>Keys</code>一栏<br><img src="http://oss.bluexiii.com/dtu48.jpg"><br>在左下方可以设置 <strong>呼出/隐藏</strong> iTerm2的快捷键，这里我设置成了<code>Cmd+ESC</code>，瞬间呼出，比Alfred/Spotlight还要方便。<br>另外还可以在Profile一栏中修改窗口为全屏+半透明，完美。  </p>
<h3 id="选中即复制"><a href="#选中即复制" class="headerlink" title="选中即复制"></a>选中即复制</h3><p>使用鼠标选中一段文字后，默认就已经复制到剪贴板了，直接用<code>Cmd+V</code>粘帖即可。  </p>
<h3 id="Profile设置"><a href="#Profile设置" class="headerlink" title="Profile设置"></a>Profile设置</h3><p>使用<code>Cmd+,</code>打开设置界面，切换到<code>Profile</code>一栏<br>在这里可以配置远程服务器的连接参数<br><img src="http://oss.bluexiii.com/6rl7i.jpg"></p>
<p>配合sshpass这个命令，可以实现类似SecureCRT的Session管理的功能。<br>注意，sshpass直接使用明文保存密码（SecureCRT是加密后存在本地），已经不推荐使用，下面会介绍一个更好的方式。  </p>
<h3 id="分屏"><a href="#分屏" class="headerlink" title="分屏"></a>分屏</h3><p>分屏功能相当好用，例如我们可以在屏幕左侧查看日志，右侧进行常规操作<br><code>Cmd+D</code> 垂直分割<br><code>Cmd+Shift+D </code>水平分割<br><img src="http://oss.bluexiii.com/a4e4b.jpg">  </p>
<h3 id="自动完成"><a href="#自动完成" class="headerlink" title="自动完成"></a>自动完成</h3><p>输入前几个关键字后，按<code>Cmd+;</code>，会有一个自动补全功能<br><img src="http://oss.bluexiii.com/cl4f4.jpg"></p>
<h3 id="命令历史记录"><a href="#命令历史记录" class="headerlink" title="命令历史记录"></a>命令历史记录</h3><p>使用<code>Cmd+shift+H</code>可以打开命令历史记录<br><img src="http://oss.bluexiii.com/7t5al.jpg"></p>
<h2 id="使用Tmux窗口管理工具"><a href="#使用Tmux窗口管理工具" class="headerlink" title="使用Tmux窗口管理工具"></a>使用Tmux窗口管理工具</h2><p>GUI工具有了，我们还缺一个通用的窗口管理工具–<strong>Tmux</strong>。  </p>
<p>Tmux是一个终端复用器，它可以激活多个终端或窗口, 还可以将屏幕水平或纵向切分成多个窗口。<br>类似于screen，它可以关闭窗口将程序放在后台运行，需要的时候再重新连接。  </p>
<p>其实iTerm2等GUI工具也可以实现类似的功能，但Tmux的好处是:  </p>
<ol>
<li>它是一个字符终端软件，不需要任何GUI的支持，通用性更好  </li>
<li>tmux可以 <strong>保持多个会话</strong> ，只要不关机，就可以随时恢复Session  </li>
</ol>
<p>macOS下的安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install tmux</span><br></pre></td></tr></table></figure>
<p>Ubuntu下的安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install tmux</span><br></pre></td></tr></table></figure>
<p>tmux的主要元素分为三层：</p>
<ul>
<li>Session 一组窗口的集合，通常用来概括同一个任务</li>
<li>Window 单个可见窗口，和ITerm2中的Tab类似</li>
<li>Pane 窗格，被划分成小块的窗口</li>
</ul>
<p><img src="http://oss.bluexiii.com/uf00l.jpg"></p>
<p>tmux默认的前置操作是<code>CTRL+b</code>。例如，我们想要新建一个窗体，就需要先在键盘上摁下CTRL+b，松开后再摁下n键。<br>下面所有的<code>prefix</code>均代表<code>CTRL+b</code></p>
<ul>
<li>查看/切换session    <code>prefix s</code>  </li>
<li>离开Session    <code>prefix d</code>  </li>
<li>重命名当前Session    <code>prefix $</code>  </li>
</ul>
<ul>
<li>新建窗口    <code>prefix c</code>  </li>
<li>切换到上一个活动的窗口     <code>prefix space</code>  </li>
<li>关闭一个窗口    <code>prefix &amp;</code>  </li>
<li>使用窗口号切换    <code>prefix 窗口号</code>  </li>
</ul>
<ul>
<li>切换到下一个窗格    <code>prefix o</code></li>
<li>查看所有窗格的编号    <code>prefix q</code></li>
<li>垂直拆分出一个新窗格    <code>prefix “</code></li>
<li>水平拆分出一个新窗格    <code>prefix %</code></li>
<li>暂时把一个窗体放到最大    <code>prefix z</code></li>
</ul>
<h2 id="使用oh-my-zsh"><a href="#使用oh-my-zsh" class="headerlink" title="使用oh my zsh"></a>使用oh my zsh</h2><p>工具已经齐全，但攘外必先安内，在连接远程服务器之前，我们先优化一下本机的Shell。  </p>
<p>Linux系统中已经内置了几种shell，一般默认的是bash<br><img src="http://oss.bluexiii.com/akhn0.jpg">  </p>
<p>zsh比bash更加好用，且完全兼容bash，但它配置繁琐。幸亏有了oh-my-zsh，让zsh的配置难度大大降低。  </p>
<p>首先安装一下zsh，mac系统无需安装，Ubuntu可以通过apt安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install zsh</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://ohmyz.sh/">这里是oh my zsh官网</a></p>
<p>根据官网的介绍，安装相当的简单，只需要一行命令即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sh -c &quot;$(curl -fsSL https:&#x2F;&#x2F;raw.github.com&#x2F;robbyrussell&#x2F;oh-my-zsh&#x2F;master&#x2F;tools&#x2F;install.sh)&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>zsh的配置文件是<code>~/.zshrc</code>，各项配置都有对应的注释，非常清晰，在这里可以修改主题，其实默认的已经很好看了<br><img src="http://oss.bluexiii.com/70dnw.jpg"></p>
<p>以下是zsh的一些使用技巧，请尽量记住，因为都很常用：</p>
<ul>
<li>连按两次Tab会列出所有的补全列表并直接开始选择，补全项可以使用 ctrl+n/p/f/b上下左右切换</li>
<li>命令选项补全。在zsh中只需要键入 tar -<tab> 就会列出所有的选项和帮助说明</li>
<li>命令参数补全。键入 kill <tab> 就会列出所有的进程名和对应的进程号</li>
<li>更智能的历史命令。在用或者方向上键查找历史命令时，zsh支持限制查找。比如，输入ls,然后再按方向上键，则只会查找用过的ls命令。而此时使用则会仍然按之前的方式查找，忽略 ls</li>
<li>智能跳转，安装了 autojump 之后，zsh 会自动记录你访问过的目录，通过 <code>j 目录名</code> 可以直接进行目录跳转，而且目录名支持模糊匹配和自动补全，例如你访问过 hadoop-1.0.0 目录，输入<code>j hado</code> 即可正确跳转。<code>j --stat</code> 可以看你的历史路径库。</li>
<li>目录浏览和跳转：输入 <code>d</code>，即可列出你在这个会话里访问的目录列表，输入列表前的序号，即可直接跳转。</li>
<li>在当前目录下输入 <code>..</code> 或 <code>...</code> ，或直接输入当前目录名都可以跳转，你甚至不再需要输入 <code>cd</code> 命令了。在你知道路径的情况下，比如 /usr/local/bin 你可以输入 <code>cd /u/l/b</code> 然后按进行补全快速输入</li>
<li>通配符搜索：<code>ls -l **/*.sh</code>，可以递归显示当前目录下的 shell 文件，文件少时可以代替 find。使用 <code>**/</code> 来递归搜索</li>
<li>扩展环境变量，输入环境变量然后按 就可以转换成表达的值</li>
</ul>
<h2 id="使用config记录远程连接"><a href="#使用config记录远程连接" class="headerlink" title="使用config记录远程连接"></a>使用config记录远程连接</h2><p>现在开始，我们再看一下如何连接远程服务器。</p>
<p>如果要管理几十台至上百台的主机，那么有没有什么方法能实现类似SecureCRT中Session管理那样的功能呢？  </p>
<p>最简单的是使用iTerm2中的profile功能，它可以配置多台主机的连接，并可以使用tag进行归类。<br>但这种方式首先太依赖于GUI工具，离开了iTerm2就完全用不了。<br>其次是通用性不够好，配置文件不能跨平台，我们辛辛苦苦在Mac上配好了一份主机清单，但回家扔到Ubuntu下就没法用了。  </p>
<p>有没有一种更为通用的方法呢？答案是直接使用openssh自带的config功能</p>
<p>配置文件的路径是：<code>~/.ssh/config</code>，如果不存在，可以新建一个</p>
<p>内容非常简单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Host demohost</span><br><span class="line">  HostName 192.168.1.1</span><br><span class="line">  User username</span><br><span class="line">  Port 10022</span><br></pre></td></tr></table></figure>
<p>第一行<code>Host</code>后面，可以为这个连接起一个简单的名字<br>后面几行记得缩进，<code>HostName</code>后面是IP地址，<code>User</code>后面是用户名，这两项是必填的。如果端口不是标准的22，还可以用<code>Port</code>指定端口。</p>
<p>配置好后，我们只需要输入<code>ssh demohost</code>，即可快速打开SSH连接了。</p>
<p>如果记不清连接名也没有关系，利用zsh的自动补全功能，输入<code>ssh 关键字</code>，再按一下<code>TAB</code>键，会列出所有包含关键字的连接，使用方向键选择后，回车确认即可。<br><img src="http://oss.bluexiii.com/swlk8.jpg">  </p>
<h2 id="使用ssh-copy-id免密码登录"><a href="#使用ssh-copy-id免密码登录" class="headerlink" title="使用ssh-copy-id免密码登录"></a>使用ssh-copy-id免密码登录</h2><p>接着再看一下，如何实现免密码登录远程主机。</p>
<p>之前我们提到过使用sshpass这个工具，可以直接将密码写进命令行中，从而实现非交互式的免密码登录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sshpass -p password ssh demouser@92.168.1.1</span><br></pre></td></tr></table></figure>
<p>但这种方式使用明文保存密码，非常不安全，不建议使用。</p>
<p>其实还有一种更好更直接的方式，那就是使用<code>ssh-copy-id</code>建立ssh信任关系，从而免密码登录。</p>
<ol>
<li><p>首先，在本地机器上使用ssh-keygen产生公钥私钥对</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure>
<p>一路回车即可，会在<code>~/.ssh</code>目录下生成公钥私钥对。此命令只需执行一次即可。  </p>
</li>
<li><p>然后，用ssh-copy-id将公钥复制到远程机器中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id -i demouser@192.168.1.1</span><br></pre></td></tr></table></figure>
<p>按提示输入一次密码，ssh-copy-id就会自动将刚才生成的公钥<code>id_rsa.pub</code>追加到远程主机的<code>~/.ssh/authorized_keys</code>后面了，以后的 <strong>ssh</strong> 以及 <strong>sftp</strong> 连接，都不用输入密码了。  </p>
</li>
</ol>
<p>至此，我们只要输入<code>ssh demouser</code>或<code>sftp demouser</code>，回车，就可以直接登录远程主机了。  </p>
<h2 id="安利一个小工具"><a href="#安利一个小工具" class="headerlink" title="安利一个小工具"></a>安利一个小工具</h2><p>最后的最后，再介绍一个很恶搞，但相当有用的小工具，<strong>thefuck</strong>  <a target="_blank" rel="noopener" href="https://github.com/nvbn/thefuck">GitHub页面</a>  </p>
<p>当我们敲错了命令，比如忘记加<code>sudo</code>时，只需要输入<code>fuck</code>并大力敲下回车，它就会非常智能的帮助我们更正了，非常有趣。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜ apt-get install vim</span><br><span class="line">E: Could not open lock file &#x2F;var&#x2F;lib&#x2F;dpkg&#x2F;lock - open (13: Permission denied)</span><br><span class="line">E: Unable to lock the administration directory (&#x2F;var&#x2F;lib&#x2F;dpkg&#x2F;), are you root?</span><br><span class="line"></span><br><span class="line">➜ fuck</span><br><span class="line">sudo apt-get install vim [enter&#x2F;↑&#x2F;↓&#x2F;ctrl+c]</span><br><span class="line">[sudo] password for nvbn:</span><br><span class="line">Reading package lists... Done</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="http://cenalulu.github.io/linux/tmux/">http://cenalulu.github.io/linux/tmux/</a><br><a target="_blank" rel="noopener" href="http://harttle.com/2015/11/06/tmux-startup.html">http://harttle.com/2015/11/06/tmux-startup.html</a><br><a target="_blank" rel="noopener" href="http://wulfric.me/2015/08/iterm2/">http://wulfric.me/2015/08/iterm2/</a><br><a target="_blank" rel="noopener" href="http://yijiebuyi.com/blog/e310fc437f32006eb6aa42cad1783587.html">http://yijiebuyi.com/blog/e310fc437f32006eb6aa42cad1783587.html</a><br><a target="_blank" rel="noopener" href="http://wdxtub.com/2016/02/18/oh-my-zsh/">http://wdxtub.com/2016/02/18/oh-my-zsh/</a>  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">BlueXIII</p>
  <div class="site-description" itemprop="description">IT技术类文章、笔记分享</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">113</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/xiiiblue" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;xiiiblue" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/bluexiii" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;bluexiii" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备18050487号-1 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BlueXIII</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
