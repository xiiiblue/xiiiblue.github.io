<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.bluexiii.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="IT技术类文章、笔记分享">
<meta property="og:type" content="website">
<meta property="og:title" content="BlueXIII&#39;s Blog">
<meta property="og:url" content="http://www.bluexiii.com/page/23/index.html">
<meta property="og:site_name" content="BlueXIII&#39;s Blog">
<meta property="og:description" content="IT技术类文章、笔记分享">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="BlueXIII">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://www.bluexiii.com/page/23/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>BlueXIII's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">BlueXIII's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">热爱技术,持续学习</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201611/GitLab%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201611/GitLab%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/" class="post-title-link" itemprop="url">GitLab服务搭建</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-06 15:50:47" itemprop="dateCreated datePublished" datetime="2018-11-06T15:50:47+08:00">2018-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>yum install curl openssh-server openssh-clients postfix cronie<br>service postfix start<br>chkconfig postfix on<br>lokkit -s http -s ssh<br>rpm -i gitlab-ce-8.13.1-ce.0.el6.x86_64.rpm<br>gitlab-ctl reconfigure</p>
<h2 id="配置脚本修改IP"><a href="#配置脚本修改IP" class="headerlink" title="配置脚本修改IP"></a>配置脚本修改IP</h2><p>vi /etc/gitlab/gitlab.rb<br>external_url ‘<a target="_blank" rel="noopener" href="http://134.32.51.31&/#39;">http://134.32.51.31&#39;</a></p>
<h2 id="访问"><a href="#访问" class="headerlink" title="访问"></a>访问</h2><p><a target="_blank" rel="noopener" href="http://134.32.51.31/">http://134.32.51.31</a></p>
<h2 id="启停"><a href="#启停" class="headerlink" title="启停"></a>启停</h2><p>service gitlab start</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201611/Docker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201611/Docker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">Docker学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-06 15:50:37" itemprop="dateCreated datePublished" datetime="2018-11-06T15:50:37+08:00">2018-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h1><h2 id="docker-for-mac"><a href="#docker-for-mac" class="headerlink" title="docker for mac"></a>docker for mac</h2><p><a target="_blank" rel="noopener" href="https://docs.docker.com/docker-for-mac/">https://docs.docker.com/docker-for-mac/</a><br>HyperKit VM</p>
<h2 id="helloworld"><a href="#helloworld" class="headerlink" title="helloworld"></a>helloworld</h2><p>docker –version<br>docker-compose –version<br>docker-machine –version<br>docker ps<br>docker run hello-world<br>docker run -d -p 80:80 –name webserver nginx<br>docker run -it ubuntu bash<br>docker run docker/whalesay cowsay boo<br>docker run docker/whalesay cowsay boo-boo</p>
<h2 id="build-image"><a href="#build-image" class="headerlink" title="build image"></a>build image</h2><p>vi Dockerfile<br>FROM docker/whalesay:latest<br>RUN apt-get -y update &amp;&amp; apt-get install -y fortunes<br>CMD /usr/games/fortune -a | cowsay</p>
<p>docker build -t docker-whale .<br>docker images<br>docker run docker-whale</p>
<h2 id="tag-amp-push"><a href="#tag-amp-push" class="headerlink" title="tag &amp; push"></a>tag &amp; push</h2><p>docker tag 038cc8845778 bluexiii/docker-whale:latest<br>docker login<br>docker push maryatdocker/docker-whale<br>docker rmi -f docker-whale<br>docker run bluexiii/docker-whale</p>
<h2 id="容器命名"><a href="#容器命名" class="headerlink" title="容器命名"></a>容器命名</h2><p>docker run –name bob_the_container -i -t ubuntu /bin/bash</p>
<h2 id="重新启动已停止的容器"><a href="#重新启动已停止的容器" class="headerlink" title="重新启动已停止的容器"></a>重新启动已停止的容器</h2><p>docker start bob_the_container</p>
<h2 id="附着到容器上"><a href="#附着到容器上" class="headerlink" title="附着到容器上"></a>附着到容器上</h2><p>docker attach bob_the_container</p>
<h2 id="创建守护式容器"><a href="#创建守护式容器" class="headerlink" title="创建守护式容器"></a>创建守护式容器</h2><p>docker run –name daemon_dave -d ubuntu /bin/sh -c “while true; do echo hello world; sleep 1;done”</p>
<h2 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h2><p>docker logs -ft daemon_dave</p>
<h2 id="查看容器中的进程"><a href="#查看容器中的进程" class="headerlink" title="查看容器中的进程"></a>查看容器中的进程</h2><p>docker top daemon_dave</p>
<h2 id="查看统计信息"><a href="#查看统计信息" class="headerlink" title="查看统计信息"></a>查看统计信息</h2><p>docker stats daemon_dave</p>
<h2 id="停止守护式容器"><a href="#停止守护式容器" class="headerlink" title="停止守护式容器"></a>停止守护式容器</h2><p>docker stop daemon_dave</p>
<h2 id="自动重启容器"><a href="#自动重启容器" class="headerlink" title="自动重启容器"></a>自动重启容器</h2><p>–restart=always<br>–restart=on-failure:5<br>docker run –restart=always –name daemon_dave2 -d ubuntu /bin/sh -c “while true; do echo hello world; sleep 1;done”</p>
<h2 id="获取容器详情"><a href="#获取容器详情" class="headerlink" title="获取容器详情"></a>获取容器详情</h2><p>docker inspect daemon_dave2</p>
<h2 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h2><p>docker rm</p>
<h2 id="删除所有容器"><a href="#删除所有容器" class="headerlink" title="删除所有容器"></a>删除所有容器</h2><p>docker rm <code>docker ps -a -q</code></p>
<h2 id="本地镜像位置"><a href="#本地镜像位置" class="headerlink" title="本地镜像位置"></a>本地镜像位置</h2><p>$HOME/Library/Containers/com.docker.docker/Data/com.docker.driver.amd64-linux/Docker.qcow2</p>
<h2 id="拉取镜像到本机"><a href="#拉取镜像到本机" class="headerlink" title="拉取镜像到本机"></a>拉取镜像到本机</h2><p>docker pull fedora</p>
<h2 id="查找镜像"><a href="#查找镜像" class="headerlink" title="查找镜像"></a>查找镜像</h2><p>docker search fedora</p>
<h1 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h1><h2 id="使用commit构建镜像"><a href="#使用commit构建镜像" class="headerlink" title="使用commit构建镜像"></a>使用commit构建镜像</h2><h3 id="基于Ubuntu构建"><a href="#基于Ubuntu构建" class="headerlink" title="基于Ubuntu构建"></a>基于Ubuntu构建</h3><p>docker run -i -t ubuntu /bin/bash</p>
<h3 id="内网环境下设置apt代理"><a href="#内网环境下设置apt代理" class="headerlink" title="内网环境下设置apt代理"></a>内网环境下设置apt代理</h3><p>cat &gt; /etc/apt/apt.conf.d/10proxy<br>Acquire::http::Proxy “<a target="_blank" rel="noopener" href="http://134.32.32.13:31315/&quot;">http://134.32.32.13:31315/&quot;</a>;<br>^d</p>
<h3 id="安装基础包"><a href="#安装基础包" class="headerlink" title="安装基础包"></a>安装基础包</h3><p>apt update<br>apt install nginx</p>
<h3 id="commit提交"><a href="#commit提交" class="headerlink" title="commit提交"></a>commit提交</h3><p>docker commit cb051b49a4cd bluexiii/mynginx<br>or<br>docker commit -m ‘message’ -a ‘author’ cb051b49a4cd bluexiii/mynginx:tag<br>类似git，只提交差异部分，速度很快</p>
<p>docker inspect bluexiii/mynginx</p>
<h2 id="使用Dockfile构建镜像"><a href="#使用Dockfile构建镜像" class="headerlink" title="使用Dockfile构建镜像"></a>使用Dockfile构建镜像</h2><p>vi Dockerfile<br>FROM ubuntu<br>RUN echo ‘Acquire::http::Proxy “<a href="http://IP:PORT/&quot;;&#39;">http://IP:PORT/&quot;;&#39;</a> &gt; /etc/apt/apt.conf.d/10proxy<br>RUN apt-get -y update &amp;&amp; apt-get install -y nginx<br>RUN echo ‘hello world’ &gt;  /usr/share/nginx/html/index.html<br>EXPOSE 80<br>docker build -t bluexiii/mynginx2 .</p>
<h2 id="运行镜像"><a href="#运行镜像" class="headerlink" title="运行镜像"></a>运行镜像</h2><p>docker run -d -p 40080:80 –name mynginx2  bluexiii/mynginx2 nginx -g “daemon off;”</p>
<h2 id="查看端口映射情况"><a href="#查看端口映射情况" class="headerlink" title="查看端口映射情况"></a>查看端口映射情况</h2><p>docker port mynginx2 80</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201611/Docker%E5%9C%A8RHEL6.5%E4%B8%8B%E7%9A%84%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201611/Docker%E5%9C%A8RHEL6.5%E4%B8%8B%E7%9A%84%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">Docker在内网环境中的RHEL6.5下的安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-06 15:50:29" itemprop="dateCreated datePublished" datetime="2018-11-06T15:50:29+08:00">2018-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="配置yum的HTTP代理"><a href="#配置yum的HTTP代理" class="headerlink" title="配置yum的HTTP代理"></a>配置yum的HTTP代理</h2><p>vi /etc/yum.conf<br>export proxy=<a href="http://IP:PORT/">http://IP:PORT/</a></p>
<h2 id="导入系统HTTP代理环境变量"><a href="#导入系统HTTP代理环境变量" class="headerlink" title="导入系统HTTP代理环境变量"></a>导入系统HTTP代理环境变量</h2><p>export http_proxy=”IP:PORT”</p>
<h2 id="配置yum使用163源"><a href="#配置yum使用163源" class="headerlink" title="配置yum使用163源"></a>配置yum使用163源</h2><p>mkdir src<br>wget <a target="_blank" rel="noopener" href="http://mirrors.163.com/centos/6/os/x86_64/Packages/yum-3.2.29-73.el6.centos.noarch.rpm">http://mirrors.163.com/centos/6/os/x86_64/Packages/yum-3.2.29-73.el6.centos.noarch.rpm</a><br>wget <a target="_blank" rel="noopener" href="http://mirrors.163.com/centos/6/os/x86_64/Packages/yum-metadata-parser-1.1.2-16.el6.x86_64.rpm">http://mirrors.163.com/centos/6/os/x86_64/Packages/yum-metadata-parser-1.1.2-16.el6.x86_64.rpm</a><br>wget <a target="_blank" rel="noopener" href="http://mirrors.163.com/centos/6/os/x86_64/Packages/yum-plugin-fastestmirror-1.1.30-37.el6.noarch.rpm">http://mirrors.163.com/centos/6/os/x86_64/Packages/yum-plugin-fastestmirror-1.1.30-37.el6.noarch.rpm</a><br>wget <a target="_blank" rel="noopener" href="http://mirrors.163.com/centos/6/os/x86_64/Packages/python-iniparse-0.3.1-2.1.el6.noarch.rpm">http://mirrors.163.com/centos/6/os/x86_64/Packages/python-iniparse-0.3.1-2.1.el6.noarch.rpm</a><br>wget <a target="_blank" rel="noopener" href="http://mirrors.163.com/centos/6/os/x86_64/Packages/python-urlgrabber-3.9.1-11.el6.noarch.rpm">http://mirrors.163.com/centos/6/os/x86_64/Packages/python-urlgrabber-3.9.1-11.el6.noarch.rpm</a><br>rpm -aq|grep yum|xargs rpm -e –nodeps<br>rpm -ivh xxxxxx<br>cd /etc/yum.repos.d/<br>先编辑其它repo，将enabled=0<br>vi 163.repo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[base]</span><br><span class="line">name&#x3D;CentOS-$releasever - Base</span><br><span class="line">baseurl&#x3D;http:&#x2F;&#x2F;mirrors.163.com&#x2F;centos&#x2F;6&#x2F;os&#x2F;$basearch&#x2F;</span><br><span class="line">gpgcheck&#x3D;1</span><br><span class="line">gpgkey&#x3D;http:&#x2F;&#x2F;mirrors.163.com&#x2F;centos&#x2F;RPM-GPG-KEY-CentOS-6</span><br><span class="line">#released updates</span><br><span class="line">[updates]</span><br><span class="line">name&#x3D;CentOS-$releasever - Updates</span><br><span class="line">baseurl&#x3D;http:&#x2F;&#x2F;mirrors.163.com&#x2F;centos&#x2F;6&#x2F;updates&#x2F;$basearch&#x2F;</span><br><span class="line">gpgcheck&#x3D;1</span><br><span class="line">gpgkey&#x3D;http:&#x2F;&#x2F;mirrors.163.com&#x2F;centos&#x2F;RPM-GPG-KEY-CentOS-6</span><br><span class="line">#packages used&#x2F;produced in the build but not released</span><br><span class="line">#[addons]</span><br><span class="line">#name&#x3D;CentOS-$releasever - Addons</span><br><span class="line">#baseurl&#x3D;http:&#x2F;&#x2F;mirrors.163.com&#x2F;centos&#x2F;$releasever&#x2F;addons&#x2F;$basearch&#x2F;</span><br><span class="line">#gpgcheck&#x3D;1</span><br><span class="line">#gpgkey&#x3D;http:&#x2F;&#x2F;mirrors.163.com&#x2F;centos&#x2F;RPM-GPG-KEY-CentOS-6</span><br><span class="line">#additional packages that may be useful</span><br><span class="line">[extras]</span><br><span class="line">name&#x3D;CentOS-$releasever - Extras</span><br><span class="line">baseurl&#x3D;http:&#x2F;&#x2F;mirrors.163.com&#x2F;centos&#x2F;6&#x2F;extras&#x2F;$basearch&#x2F;</span><br><span class="line">gpgcheck&#x3D;1</span><br><span class="line">gpgkey&#x3D;http:&#x2F;&#x2F;mirrors.163.com&#x2F;centos&#x2F;RPM-GPG-KEY-CentOS-6</span><br><span class="line">#additional packages that extend functionality of existing packages</span><br><span class="line">[centosplus]</span><br><span class="line">name&#x3D;CentOS-$releasever - Plus</span><br><span class="line">baseurl&#x3D;http:&#x2F;&#x2F;mirrors.163.com&#x2F;centos&#x2F;6&#x2F;centosplus&#x2F;$basearch&#x2F;</span><br><span class="line">gpgcheck&#x3D;1</span><br><span class="line">enabled&#x3D;0</span><br><span class="line">gpgkey&#x3D;http:&#x2F;&#x2F;mirrors.163.com&#x2F;centos&#x2F;RPM-GPG-KEY-CentOS-6</span><br></pre></td></tr></table></figure>
<h2 id="Enable-EPEL"><a href="#Enable-EPEL" class="headerlink" title="Enable EPEL"></a>Enable EPEL</h2><p>rpm -Uvh <a target="_blank" rel="noopener" href="http://www.gtlib.gatech.edu/pub/fedora-epel/6/i386/epel-release-6-8.noarch.rpm">http://www.gtlib.gatech.edu/pub/fedora-epel/6/i386/epel-release-6-8.noarch.rpm</a></p>
<h2 id="使用yum安装Docker"><a href="#使用yum安装Docker" class="headerlink" title="使用yum安装Docker"></a>使用yum安装Docker</h2><p>yum -y install docker-io</p>
<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><p>service docker start</p>
<h2 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h2><p>cd /var/log<br>tail -f docker</p>
<h2 id="解决dm-task-get-info-with-deferred-remove-version-Base-not-defined-in-file-libdevmapper-so-1-02-with-link-time-reference报错"><a href="#解决dm-task-get-info-with-deferred-remove-version-Base-not-defined-in-file-libdevmapper-so-1-02-with-link-time-reference报错" class="headerlink" title="解决dm_task_get_info_with_deferred_remove, version Base not defined in file libdevmapper.so.1.02 with link time reference报错"></a>解决dm_task_get_info_with_deferred_remove, version Base not defined in file libdevmapper.so.1.02 with link time reference报错</h2><p>yum upgrade device-mapper-event-libs</p>
<h2 id="设置Docker代理"><a href="#设置Docker代理" class="headerlink" title="设置Docker代理"></a>设置Docker代理</h2><p>vi /etc/init.d/docker<br>export HTTP_PROXY=”<a href="http://IP:PORT&quot;">http://IP:PORT&quot;</a><br>export HTTPS_PROXY=”<a href="http://IP:PORT&quot;">http://IP:PORT&quot;</a></p>
<p>export ALL_PROXY=socks5://127.0.0.1:1080</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201611/Cordova%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201611/Cordova%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">Cordova常用操作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-06 15:50:18" itemprop="dateCreated datePublished" datetime="2018-11-06T15:50:18+08:00">2018-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>sudo npm install -g cordova<br>cordova create AppName<br>cordova platform add browser<br>cordova run browser<br>cordova platform add android –save<br>cordova platform ls<br>cordova requirements</p>
<h2 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h2><p>cordova build android<br>cordova build android -release<br>cordova emulate android</p>
<h2 id="配置XML"><a href="#配置XML" class="headerlink" title="配置XML"></a>配置XML</h2><p>vi config.xml<br>    <content src="http://IP:PORT/index.html" /><br>    <allow-navigation href="http://*/*" /><br>    <preference name="Fullscreen" value="true" /></p>
<h2 id="签名"><a href="#签名" class="headerlink" title="签名"></a>签名</h2><p>keytool -genkey -v -keystore release-key.keystore -alias cordova-demo -keyalg RSA -keysize 2048 -validity 10000<br>vi build.json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;android&quot;: &#123;</span><br><span class="line">    &quot;release&quot;: &#123;</span><br><span class="line">      &quot;keystore&quot;: &quot;release-key.keystore&quot;,</span><br><span class="line">      &quot;alias&quot;: &quot;cordova-demo&quot;,</span><br><span class="line">      &quot;storePassword&quot;: &quot;password&quot;,</span><br><span class="line">      &quot;password&quot;: &quot;password&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="禁用缓存"><a href="#禁用缓存" class="headerlink" title="禁用缓存"></a>禁用缓存</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import android.webkit.WebSettings;</span><br><span class="line">import android.webkit.WebView;</span><br><span class="line">@Override</span><br><span class="line">protected void onResume() &#123;</span><br><span class="line">    super.onResume();</span><br><span class="line">    &#x2F;&#x2F; Disable caching ..</span><br><span class="line">    WebView wv &#x3D; (WebView) appView.getEngine().getView();</span><br><span class="line">    WebSettings ws &#x3D; wv.getSettings();</span><br><span class="line">    ws.setAppCacheEnabled(false);</span><br><span class="line">    ws.setCacheMode(WebSettings.LOAD_NO_CACHE);</span><br><span class="line">    loadUrl(launchUrl); &#x2F;&#x2F; launchUrl is the default url specified in Config.xml</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201612/AIX%E4%B8%8B%E4%BD%BF%E7%94%A8zip+split%E5%AE%9E%E7%8E%B0%E5%88%86%E5%8D%B7%E5%8E%8B%E7%BC%A9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201612/AIX%E4%B8%8B%E4%BD%BF%E7%94%A8zip+split%E5%AE%9E%E7%8E%B0%E5%88%86%E5%8D%B7%E5%8E%8B%E7%BC%A9/" class="post-title-link" itemprop="url">AIX下使用zip+split实现分卷压缩</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-06 15:49:28" itemprop="dateCreated datePublished" datetime="2018-11-06T15:49:28+08:00">2018-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>与某第三方厂商使用文件接口传递数据。我们是发送方，对方是接收方，对方的接口规范要求对于大于500M文件，必须使用zip格式分卷压缩。<br>本来在linux下使用zip分卷压缩轻而易举，直接调用系统的zip命令，加上-b参数即可，但恰巧我们的接口机是台IBM小机，AIX系统下的zip不支持分卷功能，需要与split命令结合实现分卷功能。  </p>
<h2 id="实现方案"><a href="#实现方案" class="headerlink" title="实现方案"></a>实现方案</h2><ol>
<li>先使用zip命令将目录打包成单独的zip文件</li>
<li>使用split命令将zip文件拆分</li>
<li>对于拆分出来的散乱文件，按格式要求批量重命名</li>
</ol>
<h2 id="格式要求"><a href="#格式要求" class="headerlink" title="格式要求"></a>格式要求</h2><p>生成的文件名格式如下：<br>yyyymmdd_zzzz_RetentionPhotosSync_iiii_xxxx.zip<br>其中yyyymmdd为时间，xxxx为分卷序列号  </p>
<h2 id="分卷压缩脚本"><a href="#分卷压缩脚本" class="headerlink" title="分卷压缩脚本"></a>分卷压缩脚本</h2><p>下面以名为<code>testfolder</code>的目录为例，以5M大小，进行分卷  </p>
<h3 id="使用zip命令，将整个目录压缩成-zip（对于目录需要使用-r参数）"><a href="#使用zip命令，将整个目录压缩成-zip（对于目录需要使用-r参数）" class="headerlink" title="使用zip命令，将整个目录压缩成.zip（对于目录需要使用-r参数）"></a>使用zip命令，将整个目录压缩成.zip（对于目录需要使用-r参数）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip -r tmpfile.zip testfolder</span><br></pre></td></tr></table></figure>
<h3 id="使用split命令，以5M为单位，将-zip进行拆分，生成xaa、xab、xac…（以此类推）等多个文件"><a href="#使用split命令，以5M为单位，将-zip进行拆分，生成xaa、xab、xac…（以此类推）等多个文件" class="headerlink" title="使用split命令，以5M为单位，将.zip进行拆分，生成xaa、xab、xac…（以此类推）等多个文件"></a>使用split命令，以5M为单位，将.zip进行拆分，生成xaa、xab、xac…（以此类推）等多个文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">split -b 5m tmpfile.zip splitfile-</span><br></pre></td></tr></table></figure>
<h3 id="对于生成的xaa、xab、xac…散乱文件，按格式重命名"><a href="#对于生成的xaa、xab、xac…散乱文件，按格式重命名" class="headerlink" title="对于生成的xaa、xab、xac…散乱文件，按格式重命名"></a>对于生成的xaa、xab、xac…散乱文件，按格式重命名</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nowdate&#x3D;&#96;date +%Y%m%d&#96;;n&#x3D;0; for filename in &#96;ls splitfile* &#96;; do n&#x3D;&#96;expr $&#123;n&#125; + 1&#96;; suffix&#x3D;&#96;printf %04d $&#123;n&#125;&#96;; mv $&#123;filename&#125; $&#123;nowdate&#125;_zzzz_RetentionPhotosSync_iiii_$&#123;suffix&#125;.zip ; done</span><br></pre></td></tr></table></figure>
<h3 id="清理临时文件"><a href="#清理临时文件" class="headerlink" title="清理临时文件"></a>清理临时文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm tmpfile.zip</span><br></pre></td></tr></table></figure>
<h2 id="分卷解压脚本"><a href="#分卷解压脚本" class="headerlink" title="分卷解压脚本"></a>分卷解压脚本</h2><p>如果对端恰巧也是AIX系统，可以用如下方式解压缩  </p>
<h3 id="使用cat命令合并文件"><a href="#使用cat命令合并文件" class="headerlink" title="使用cat命令合并文件"></a>使用cat命令合并文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat yyyymmdd_zzzz_RetentionPhotosSync_iiii_*.zip &gt; yyyymmdd_zzzz_RetentionPhotosSync_iiii.zip</span><br></pre></td></tr></table></figure>
<h3 id="使用unzip命令解压"><a href="#使用unzip命令解压" class="headerlink" title="使用unzip命令解压"></a>使用unzip命令解压</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip yyyymmdd_zzzz_RetentionPhotosSync_iiii.zip</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201702/%E5%86%85%E7%BD%91%E4%B8%BB%E6%9C%BAPython3%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201702/%E5%86%85%E7%BD%91%E4%B8%BB%E6%9C%BAPython3%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" class="post-title-link" itemprop="url">内网环境下Python3应用部署</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-06 15:48:21" itemprop="dateCreated datePublished" datetime="2018-11-06T15:48:21+08:00">2018-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>最近在用Python写一些东西，各种第三方库好用极了，写起来也是非常酸爽，但生产环境部署上却略有些繁琐。<br>主要原因是公司的生产环境主机，大都是在内网中的，无法直连Internet，首先要花点力气搞定网络连接问题。<br>另外操作系统也基本上是RedHat，只预装了Python2.7，yum源中也没有3.X，只能通过源码编译的方式安装。如果是Debian系的，就不会这么麻烦了。  </p>
<h2 id="HTTP代理服务器搭建"><a href="#HTTP代理服务器搭建" class="headerlink" title="HTTP代理服务器搭建"></a>HTTP代理服务器搭建</h2><p>要搞定网络连接，最简单的办法还是找一台能出得去的主机，搭一个HTTP代理服务。<br>这里我选择了srelay+polipo的组合。Srelay用于搭建Socks5代理，Polipo用于将Socks5端口转为HTTP端口。<br>PS：当然，还可以使用redsocks+polipo的组合，直接默翻墙，使用yum时可以快很多。  </p>
<h3 id="使用srelay搭建简易Socks5代理"><a href="#使用srelay搭建简易Socks5代理" class="headerlink" title="使用srelay搭建简易Socks5代理"></a>使用srelay搭建简易Socks5代理</h3><p>我们先找一台可以直连外网的主机，注意要新建一个用户，不要以root直接操作。  </p>
<p>官网地址：<br><a target="_blank" rel="noopener" href="http://socks-relay.sourceforge.net/">http://socks-relay.sourceforge.net</a><br>下载<code>srelay-0.4.8b6.tar.gz</code></p>
<p>解压后直接<code>make</code>即可，将编译出的二进制文件srelay随便找一个目录扔进去</p>
<p>启动：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;srelay -i xxx.xxx.xxx.xxx:31080  </span><br></pre></td></tr></table></figure>
<p>无须配置，直接在启动时直接绑定IP+端口，注意IP一定要绑定内网的那个。</p>
<h3 id="使用polipo将Socks5代理转为Http代理"><a href="#使用polipo将Socks5代理转为Http代理" class="headerlink" title="使用polipo将Socks5代理转为Http代理"></a>使用polipo将Socks5代理转为Http代理</h3><p>下载地址：<br><a target="_blank" rel="noopener" href="https://www.irif.fr/~jch/software/polipo/polipo.html">https://www.irif.fr/~jch/software/polipo/polipo.html</a>  </p>
<p>解压后，修改一下Makefile，将PREFIX改为实际安装目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vi Makefile</span><br><span class="line">PREFIX &#x3D; &#x2F;path&#x2F;to&#x2F;your&#x2F;app</span><br><span class="line">BINDIR &#x3D; $(PREFIX)&#x2F;bin</span><br><span class="line">MANDIR &#x3D; $(PREFIX)&#x2F;man</span><br><span class="line">INFODIR &#x3D; $(PREFIX)&#x2F;info</span><br><span class="line">LOCAL_ROOT &#x3D; $(PREFIX)&#x2F;www</span><br><span class="line">DISK_CACHE_ROOT &#x3D; $(PREFIX)&#x2F;cache</span><br></pre></td></tr></table></figure>
<p>然后直接<code>make &amp;&amp; make install</code>即可</p>
<p>新建一个config文件  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi config</span><br><span class="line">socksParentProxy &#x3D; &quot;xxx.xxx.xxx.xxx:31080&quot;</span><br><span class="line">socksProxyType &#x3D; socks5</span><br><span class="line">proxyAddress &#x3D; &quot;0.0.0.0&quot;</span><br><span class="line">proxyPort &#x3D; 31081</span><br></pre></td></tr></table></figure>
<p>其中socksParentProxy是Socks的IP+端口，proxyPort是新开的HTTP端口</p>
<p>启动：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup .&#x2F;polipo -c config</span><br></pre></td></tr></table></figure>

<h2 id="环境变量设置"><a href="#环境变量设置" class="headerlink" title="环境变量设置"></a>环境变量设置</h2><p>现在回到Python3所在的主机，设置一个http_proxy环境变量，指向刚才所搭建的IP:端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export http_proxy&#x3D;&quot;http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:31081&quot;</span><br></pre></td></tr></table></figure>
<p>这时wget、yum等已经可以正常使用了</p>
<h2 id="配置yum使用163的源（可选）"><a href="#配置yum使用163的源（可选）" class="headerlink" title="配置yum使用163的源（可选）"></a>配置yum使用163的源（可选）</h2><p>有时可能需要用yum安装一些依赖，配置成163的源会速度快一些  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;mirrors.163.com&#x2F;centos&#x2F;6&#x2F;os&#x2F;x86_64&#x2F;Packages&#x2F;python-iniparse-0.3.1-2.1.el6.noarch.rpm</span><br><span class="line">wget http:&#x2F;&#x2F;mirrors.163.com&#x2F;centos&#x2F;6&#x2F;os&#x2F;x86_64&#x2F;Packages&#x2F;yum-metadata-parser-1.1.2-16.el6.x86_64.rpm</span><br><span class="line">wget http:&#x2F;&#x2F;mirrors.163.com&#x2F;centos&#x2F;6&#x2F;os&#x2F;x86_64&#x2F;Packages&#x2F;python-urlgrabber-3.9.1-11.el6.noarch.rpm</span><br><span class="line">wget http:&#x2F;&#x2F;mirrors.163.com&#x2F;centos&#x2F;6&#x2F;os&#x2F;x86_64&#x2F;Packages&#x2F;yum-3.2.29-73.el6.centos.noarch.rpm</span><br><span class="line">wget http:&#x2F;&#x2F;mirrors.163.com&#x2F;centos&#x2F;6&#x2F;os&#x2F;x86_64&#x2F;Packages&#x2F;yum-plugin-fastestmirror-1.1.30-37.el6.noarch.rpm\</span><br><span class="line"></span><br><span class="line">rpm -qa | grep yum | xargs rpm -e --nodeps</span><br><span class="line">rpm -ivh python-iniparse-0.3.1-2.1.el6.noarch.rpm</span><br><span class="line">rpm -ivh yum-metadata-parser-1.1.2-16.el6.x86_64.rpm</span><br><span class="line">rpm -ivh python-urlgrabber-3.9.1-11.el6.noarch.rpm --force</span><br><span class="line">rpm -ivh yum-3.2.29-73.el6.centos.noarch.rpm yum-plugin-fastestmirror-1.1.30-37.el6.noarch.rpm</span><br><span class="line"></span><br><span class="line">wget http:&#x2F;&#x2F;mirrors.163.com&#x2F;.help&#x2F;CentOS6-Base-163.repo</span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>
<h2 id="源码方式安装python3"><a href="#源码方式安装python3" class="headerlink" title="源码方式安装python3"></a>源码方式安装python3</h2><p>现在开始，万事俱备，可以编译安装python了。需要使用root权限操作。  </p>
<p>首先，在官网下载最新的3.6源码：<br><a target="_blank" rel="noopener" href="https://www.python.org/ftp/python/3.6.0/Python-3.6.0.tgz">https://www.python.org/ftp/python/3.6.0/Python-3.6.0.tgz</a></p>
<p>安装过程没有什么特别的，缺少依赖时可以直接yum安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;www.python.org&#x2F;ftp&#x2F;python&#x2F;3.6.0&#x2F;Python-3.6.0.tgz</span><br><span class="line">tar -zxcf Python-3.6.0.tgz</span><br><span class="line">.&#x2F;configure</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>源码方式安装完成后，已经是包含pip3的了，不用再单独安装了。  </p>
<h2 id="让pip走代理"><a href="#让pip走代理" class="headerlink" title="让pip走代理"></a>让pip走代理</h2><p>pip3可以通过使用<code>--proxy</code>参数来走代理，在这里我们为了方便，直接建一个alias，以后使用pip时，就不需要再添加参数了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alias pip3&#x3D;&quot;pip3 --proxy 134.32.32.13:31081&quot;</span><br><span class="line">export http_proxy&#x3D;134.32.32.13:31081</span><br><span class="line">export https_proxy&#x3D;134.32.32.13:31081</span><br></pre></td></tr></table></figure>
<h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><p>大部分依赖可以直接通过pip3安装：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pip3 install requests</span><br><span class="line">pip3 install beautifulsoup4</span><br><span class="line">pip3 install mysql-connector</span><br><span class="line">pip3 install fdfs_client-py</span><br></pre></td></tr></table></figure>
<p>某些模块，比如FastDFS客户端，不能直接使用pip3安装，需要下载源码后并手工修改一些代码，操作过程大致如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;jefforeilly&#x2F;fdfs_client-py.git</span><br><span class="line">cd dfs_client-py</span><br><span class="line">vi .&#x2F;fdfs_client&#x2F;storage_client.py</span><br><span class="line">将第12行 from fdfs_client.sendfile import * 注释掉</span><br><span class="line">python3 setup.py install</span><br></pre></td></tr></table></figure>
<p>至此，环境搭建完毕，可以将python代码扔上去跑起来了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201702/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7Redmine%E7%9A%84%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201702/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7Redmine%E7%9A%84%E9%83%A8%E7%BD%B2/" class="post-title-link" itemprop="url">项目管理工具Redmine的部署</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-06 15:48:00" itemprop="dateCreated datePublished" datetime="2018-11-06T15:48:00+08:00">2018-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="什么是Redmine"><a href="#什么是Redmine" class="headerlink" title="什么是Redmine"></a>什么是Redmine</h2><p>Redmine是用Ruby On Rails开发的一款基于WEB的项目管理软件。<br>它集成了项目管理所需的各项功能：日历、甘特图、问题跟踪和版本控制，可以同时处理多个项目。  </p>
<p>相比禅道等软件，Redmine的安装还是比较繁琐的，一方面是因为它没有一个自动化的安装脚本，另一方面主要是个人对于Ruby初次接触，需要花一些时间在Ruby的学习上。<br>本文仅讨论Redmine的部署方式，关于Redmine使用今后会单独写一篇博文来讲解。  </p>
<h2 id="相关资源"><a href="#相关资源" class="headerlink" title="相关资源"></a>相关资源</h2><p><a target="_blank" rel="noopener" href="http://www.redmine.org/">官网WIKI</a>  </p>
<h2 id="主机环境"><a href="#主机环境" class="headerlink" title="主机环境"></a>主机环境</h2><p>RedHat/CentOS 6.X</p>
<h2 id="代理服务器配置"><a href="#代理服务器配置" class="headerlink" title="代理服务器配置"></a>代理服务器配置</h2><p>如果主机处于内网环境中，无法直连Internet时，需要首先配置可用的网络环境，最简单的方式是使用代理服务器。<br>关于代理服务器的搭建不再赘述了，可以使用<code>srelay</code>+<code>polipo</code>这样的组合，详细步骤请参考之前的一篇文章《内网主机Python3环境搭建》。  </p>
<p>代理服务器配置好之后，我们导入两条环境变量即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export http_proxy&#x3D;&quot;http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:31081&quot;</span><br><span class="line">export https_proxy&#x3D;&quot;http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:31081&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这时wget、curl、yum等已经可以正常使用了。</p>
<h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><p>首先使用yum安装一些基本依赖，以下只是一些参考，可以在具体编译时缺什么补什么。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install nano zip unzip libyaml-devel zlib-devel curl-devel openssl-devel httpd-devel apr-devel apr-util-devel mysql-devel gcc ruby-devel gcc-c++ make postgresql-devel ImageMagick-devel sqlite-devel perl-LDAP mod_perl perl-Digest-SHA</span><br></pre></td></tr></table></figure>
<h2 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h2><p>这里为了省事，使用最简单的yum的方式，直接在本机安装一套MySQL。yumd源中的MySQL版本比较老旧，是5.1.73。如果时间充裕的话，建议使用源码或二进制方式进行安装。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install mysql mysql-server</span><br></pre></td></tr></table></figure>
<p>将MySQL设置为开机自启，并手工启动服务：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chkconfig mysqld on</span><br><span class="line">service mysqld start</span><br></pre></td></tr></table></figure>
<p>初次运行，进行密码等安全性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;bin&#x2F;mysql_secure_installation</span><br></pre></td></tr></table></figure>
<p><code>Disallow root login remotely</code>这一项可以选NO</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Enter current password for root (enter for none):</span><br><span class="line">Set root password? [Y&#x2F;n] y</span><br><span class="line">Remove anonymous users? [Y&#x2F;n] y</span><br><span class="line">Disallow root login remotely? [Y&#x2F;n] n</span><br><span class="line">Remove test database and access to it? [Y&#x2F;n] y</span><br><span class="line">Reload privilege tables now? [Y&#x2F;n] y</span><br></pre></td></tr></table></figure>

<h2 id="新建MySQL数据库及用户"><a href="#新建MySQL数据库及用户" class="headerlink" title="新建MySQL数据库及用户"></a>新建MySQL数据库及用户</h2><p>直接在本机登录mysql，新建一个数据库及用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line">&gt; create database redmine_db character set utf8;</span><br><span class="line">&gt; create user &#39;redmine_admin&#39;@&#39;localhost&#39; identified by &#39;your_new_password&#39;;</span><br><span class="line">&gt; grant all privileges on redmine_db.* to &#39;redmine_admin&#39;@&#39;localhost&#39;;</span><br></pre></td></tr></table></figure>

<h2 id="关闭SELinux"><a href="#关闭SELinux" class="headerlink" title="关闭SELinux"></a>关闭SELinux</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;selinux&#x2F;config</span><br><span class="line">SELINUX&#x3D;disabled</span><br><span class="line"></span><br><span class="line">&#x2F;usr&#x2F;sbin&#x2F;setenforce 0 立刻关闭</span><br></pre></td></tr></table></figure>
<h2 id="配置iptables"><a href="#配置iptables" class="headerlink" title="配置iptables"></a>配置iptables</h2><p>配置iptables防火墙，将3000端口打开</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;sysconfig&#x2F;iptables</span><br><span class="line"></span><br><span class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 3000 -j ACCEPT</span><br></pre></td></tr></table></figure>
<p>重启iptables：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;init.d&#x2F;iptables restart</span><br></pre></td></tr></table></figure>
<h2 id="安装Ruby"><a href="#安装Ruby" class="headerlink" title="安装Ruby"></a>安装Ruby</h2><p>使用RVM进行Ruby的安装。RVM是一个命令行工具,可以提供一个便捷的多版本Ruby环境的管理和切换。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -L https:&#x2F;&#x2F;get.rvm.io | bash</span><br><span class="line">source &#x2F;etc&#x2F;profile.d&#x2F;rvm.sh</span><br></pre></td></tr></table></figure>
<p>列出已知的Ruby版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rvm list known</span><br></pre></td></tr></table></figure>
<p>这里我们选择安装2.3.0：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rvm install 2.3.0</span><br></pre></td></tr></table></figure>
<p>等待编译安装完成之后，可以查看一下版本号，确认安装成功：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ruby -v</span><br><span class="line">ruby 2.3.0p0 (2015-12-25 revision 53290) [x86_64-linux]</span><br></pre></td></tr></table></figure>

<h2 id="安装Rubygems"><a href="#安装Rubygems" class="headerlink" title="安装Rubygems"></a>安装Rubygems</h2><p>RubyGems简称gems，是一个用于对Ruby组件进行打包的Ruby打包系统。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install rubygems</span><br></pre></td></tr></table></figure>

<h2 id="下载Redmine"><a href="#下载Redmine" class="headerlink" title="下载Redmine"></a>下载Redmine</h2><p>我们新建一个redmine用户来进行接下来的操作。首先是从官网下载redmine的安装包并解压：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;www.redmine.org&#x2F;releases&#x2F;redmine-3.3.2.tar.gz</span><br><span class="line">tar -zxvf redmine-3.3.2.tar.gz</span><br><span class="line">mv redmine-3.3.2 redmine</span><br></pre></td></tr></table></figure>
<h2 id="配置数据库连接"><a href="#配置数据库连接" class="headerlink" title="配置数据库连接"></a>配置数据库连接</h2><p>从示例中复制一份database.yml出来：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;path&#x2F;to&#x2F;redmine&#x2F;config</span><br><span class="line">cp database.yml.example database.yml</span><br></pre></td></tr></table></figure>
<p>编辑database.yml，填写刚才新建的数据库的各项参数:   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vi database.yml</span><br><span class="line"></span><br><span class="line">production:</span><br><span class="line">  adapter: mysql2</span><br><span class="line">  database: redmine_db</span><br><span class="line">  host: localhost</span><br><span class="line">  username: redmine_admin</span><br><span class="line">  password: &quot;redmine_password&quot;</span><br><span class="line">  encoding: utf8</span><br></pre></td></tr></table></figure>
<h2 id="使用Bundle设置Rails"><a href="#使用Bundle设置Rails" class="headerlink" title="使用Bundle设置Rails"></a>使用Bundle设置Rails</h2><p>使用Bundle安装依赖的库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gem install bundler</span><br><span class="line">bundle install</span><br><span class="line">rake generate_secret_token</span><br></pre></td></tr></table></figure>
<h2 id="初始化数据库表及数据"><a href="#初始化数据库表及数据" class="headerlink" title="初始化数据库表及数据"></a>初始化数据库表及数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RAILS_ENV&#x3D;production rake db:migrate</span><br><span class="line">RAILS_ENV&#x3D;production rake redmine:load_default_data</span><br></pre></td></tr></table></figure>
<h2 id="设置文件系统权限"><a href="#设置文件系统权限" class="headerlink" title="设置文件系统权限"></a>设置文件系统权限</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p tmp tmp&#x2F;pdf public&#x2F;plugin_assets</span><br><span class="line">sudo chown -R redmine:redmine files log tmp public&#x2F;plugin_assets</span><br><span class="line">sudo chmod -R 755 files log tmp public&#x2F;plugin_assets</span><br></pre></td></tr></table></figure>
<h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bundle exec rails server -b 0.0.0.0 webrick -e production -d</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201702/Python3%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201702/Python3%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">Python3个人学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-06 15:47:45" itemprop="dateCreated datePublished" datetime="2018-11-06T15:47:45+08:00">2018-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="推荐学习书目"><a href="#推荐学习书目" class="headerlink" title="推荐学习书目"></a>推荐学习书目</h2><ul>
<li><a target="_blank" rel="noopener" href="http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000">廖雪峰的官方网站</a>  </li>
<li><a target="_blank" rel="noopener" href="https://learnpythonthehardway.org/book/">Learn Python the Hard Way</a>  </li>
<li><a target="_blank" rel="noopener" href="https://www.amazon.cn/mn/detailApp/ref=as_li_ss_tl?_encoding=UTF8&tag=v06-23&linkCode=as2&asin=B003TSBAMM&camp=536&creative=3132&creativeASIN=B003TSBAMM">Python基础教程(第2版)</a>  </li>
<li><a target="_blank" rel="noopener" href="https://www.amazon.cn/mn/detailApp/ref=as_li_ss_tl?_encoding=UTF8&tag=v06-23&linkCode=as2&asin=B004TUJ7A6&camp=536&creative=3132&creativeASIN=B004TUJ7A6">Python学习手册(第4版)</a>  </li>
</ul>
<h2 id="推荐网站"><a href="#推荐网站" class="headerlink" title="推荐网站"></a>推荐网站</h2><ul>
<li><a target="_blank" rel="noopener" href="https://pypi.python.org/pypi">pypi.python.org</a>  </li>
<li><a target="_blank" rel="noopener" href="http://www.simple-is-better.com/">www.simple-is-better.com</a>  </li>
<li><a target="_blank" rel="noopener" href="https://www.v2ex.com/go/python">v2ex.com</a></li>
<li><a target="_blank" rel="noopener" href="https://www.python.org/">www.python.org</a></li>
</ul>
<h2 id="推荐IDE"><a href="#推荐IDE" class="headerlink" title="推荐IDE"></a>推荐IDE</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.jetbrains.com/pycharm/">PyCharm</a></li>
</ul>
<h2 id="其它资料"><a href="#其它资料" class="headerlink" title="其它资料"></a>其它资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://taizilongxu.gitbooks.io/stackoverflow-about-python/content/index.html">Stack Overflow About Python</a>  </li>
</ul>
<h2 id="好用的第三方库"><a href="#好用的第三方库" class="headerlink" title="好用的第三方库"></a>好用的第三方库</h2><ul>
<li>requests - HTTP库</li>
<li>Flask - RestfulAPI</li>
<li>peewee - 读写数据库，替代SQLAlchemy</li>
<li>aiohttp - 替代requests</li>
<li>BeautifulSoup - HTML解析</li>
<li>scipy - 科学计算</li>
<li>pandas - 处理csv及excel</li>
<li>fdfs_client-py - FastDFS客户端</li>
</ul>
<h2 id="代码风格规范"><a href="#代码风格规范" class="headerlink" title="代码风格规范"></a>代码风格规范</h2><p>参考文档：<br><a target="_blank" rel="noopener" href="http://zh-google-styleguide.readthedocs.io/en/latest/google-python-styleguide/">Google开源项目风格指南</a><br><a target="_blank" rel="noopener" href="http://www.wklken.me/posts/2016/11/03/python-code-style.html">Python代码规范小结</a>  </p>
<h3 id="分号"><a href="#分号" class="headerlink" title="分号"></a>分号</h3><p>不要在行尾加分号, 也不要用分号将两条命令放在同一行.</p>
<h3 id="行长度"><a href="#行长度" class="headerlink" title="行长度"></a>行长度</h3><p>每行不超过80个字符<br>例外:  </p>
<ol>
<li>长的导入模块语句  </li>
<li>注释里的URL  </li>
</ol>
<h3 id="括号"><a href="#括号" class="headerlink" title="括号"></a>括号</h3><p>宁缺毋滥的使用括号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Yes: if foo:</span><br><span class="line">         bar()</span><br><span class="line">     while x:</span><br><span class="line">         x &#x3D; bar()</span><br><span class="line">     if x and y:</span><br><span class="line">         bar()</span><br><span class="line">     if not x:</span><br><span class="line">         bar()</span><br><span class="line">     return foo</span><br><span class="line">     for (x, y) in dict.items(): ...</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">No:  if (x):</span><br><span class="line">        bar()</span><br><span class="line">    if not(x):</span><br><span class="line">        bar()</span><br><span class="line">    return (foo)</span><br></pre></td></tr></table></figure>
<h3 id="缩进"><a href="#缩进" class="headerlink" title="缩进"></a>缩进</h3><p>用4个空格来缩进代码，绝对不要用tab, 也不要tab和空格混用</p>
<h3 id="空行"><a href="#空行" class="headerlink" title="空行"></a>空行</h3><p>顶级定义之间空两行, 方法定义之间空一行</p>
<h3 id="空格"><a href="#空格" class="headerlink" title="空格"></a>空格</h3><p>按照标准的排版规范来使用标点两边的空格<br>括号内不要有空格</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Yes: spam(ham[1], &#123;eggs: 2&#125;, [])</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">No:  spam( ham[ 1 ], &#123; eggs: 2 &#125;, [ ] )</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>不要在逗号, 分号, 冒号前面加空格, 但应该在它们后面加(除了在行尾).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Yes: if x &#x3D;&#x3D; 4:</span><br><span class="line">         print x, y</span><br><span class="line">     x, y &#x3D; y, x</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">No:  if x &#x3D;&#x3D; 4 :</span><br><span class="line">         print x , y</span><br><span class="line">     x , y &#x3D; y , x</span><br></pre></td></tr></table></figure>
<p>参数列表, 索引或切片的左括号前不应加空格.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Yes: spam(1)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">no: spam (1)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Yes: dict[&#39;key&#39;] &#x3D; list[index]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">No:  dict [&#39;key&#39;] &#x3D; list [index]</span><br></pre></td></tr></table></figure>
<p>在二元操作符两边都加上一个空格, 比如赋值(=), 比较(==, &lt;, &gt;, !=, &lt;&gt;, &lt;=, &gt;=, in, not in, is, is not), 布尔(and, or, not). 至于算术操作符两边的空格该如何使用, 需要你自己好好判断. 不过两侧务必要保持一致.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Yes: x &#x3D;&#x3D; 1</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">No:  x&lt;1</span><br></pre></td></tr></table></figure>
<p>当’=’用于指示关键字参数或默认参数值时, 不要在其两侧使用空格.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Yes: def complex(real, imag&#x3D;0.0): return magic(r&#x3D;real, i&#x3D;imag)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">No:  def complex(real, imag &#x3D; 0.0): return magic(r &#x3D; real, i &#x3D; imag)</span><br></pre></td></tr></table></figure>

<p>不要用空格来垂直对齐多行间的标记, 因为这会成为维护的负担(适用于:, #, =等):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Yes:</span><br><span class="line">     foo &#x3D; 1000  # comment</span><br><span class="line">     long_name &#x3D; 2  # comment that should not be aligned</span><br><span class="line"></span><br><span class="line">     dictionary &#x3D; &#123;</span><br><span class="line">         &quot;foo&quot;: 1,</span><br><span class="line">         &quot;long_name&quot;: 2,</span><br><span class="line">         &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">No:</span><br><span class="line">     foo       &#x3D; 1000  # comment</span><br><span class="line">     long_name &#x3D; 2     # comment that should not be aligned</span><br><span class="line"></span><br><span class="line">     dictionary &#x3D; &#123;</span><br><span class="line">         &quot;foo&quot;      : 1,</span><br><span class="line">         &quot;long_name&quot;: 2,</span><br><span class="line">         &#125;</span><br></pre></td></tr></table></figure>
<h3 id="Shebang"><a href="#Shebang" class="headerlink" title="Shebang"></a>Shebang</h3><p>大部分.py文件不必以#!作为文件的开始. 根据 PEP-394 , 程序的main文件应该以 #!/usr/bin/python2或者 #!/usr/bin/python3开始.</p>
<h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><h4 id="文档字符串"><a href="#文档字符串" class="headerlink" title="文档字符串"></a>文档字符串</h4><p>Python有一种独一无二的的注释方式: 使用文档字符串. 文档字符串是包, 模块, 类或函数里的第一个语句. 这些字符串可以通过对象的__doc__成员被自动提取, 并且被pydoc所用. 一个文档字符串应该这样组织: 首先是一行以句号, 问号或惊叹号结尾的概述(或者该文档字符串单纯只有一行). 接着是一个空行. 接着是文档字符串剩下的部分, 它应该与文档字符串的第一行的第一个引号对齐.</p>
<h4 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h4><p>每个文件应该包含一个许可样板. 根据项目使用的许可(例如, Apache 2.0, BSD, LGPL, GPL), 选择合适的样板.</p>
<h4 id="函数和方法"><a href="#函数和方法" class="headerlink" title="函数和方法"></a>函数和方法</h4><p>关于函数的几个方面应该在特定的小节中进行描述记录， 这几个方面如下文所述. 每节应该以一个标题行开始. 标题行以冒号结尾. 除标题行外, 节的其他内容应被缩进2个空格.<br>Args:<br>列出每个参数的名字, 并在名字后使用一个冒号和一个空格, 分隔对该参数的描述.如果描述太长超过了单行80字符,使用2或者4个空格的悬挂缩进(与文件其他部分保持一致). 描述应该包括所需的类型和含义. 如果一个函数接受<em>foo(可变长度参数列表)或者**bar (任意关键字参数), 应该详细列出</em>foo和**bar.<br>Returns: (或者 Yields: 用于生成器)<br>描述返回值的类型和语义. 如果函数返回None, 这一部分可以省略.<br>Raises:<br>列出与接口有关的所有异常.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">def fetch_bigtable_rows(big_table, keys, other_silly_variable&#x3D;None):</span><br><span class="line">    &quot;&quot;&quot;Fetches rows from a Bigtable.</span><br><span class="line"></span><br><span class="line">    Retrieves rows pertaining to the given keys from the Table instance</span><br><span class="line">    represented by big_table.  Silly things may happen if</span><br><span class="line">    other_silly_variable is not None.</span><br><span class="line"></span><br><span class="line">    Args:</span><br><span class="line">        big_table: An open Bigtable Table instance.</span><br><span class="line">        keys: A sequence of strings representing the key of each table row</span><br><span class="line">            to fetch.</span><br><span class="line">        other_silly_variable: Another optional variable, that has a much</span><br><span class="line">            longer name than the other args, and which does nothing.</span><br><span class="line"></span><br><span class="line">    Returns:</span><br><span class="line">        A dict mapping keys to the corresponding table row data</span><br><span class="line">        fetched. Each row is represented as a tuple of strings. For</span><br><span class="line">        example:</span><br><span class="line"></span><br><span class="line">        &#123;&#39;Serak&#39;: (&#39;Rigel VII&#39;, &#39;Preparer&#39;),</span><br><span class="line">         &#39;Zim&#39;: (&#39;Irk&#39;, &#39;Invader&#39;),</span><br><span class="line">         &#39;Lrrr&#39;: (&#39;Omicron Persei 8&#39;, &#39;Emperor&#39;)&#125;</span><br><span class="line"></span><br><span class="line">        If a key from the keys argument is missing from the dictionary,</span><br><span class="line">        then that row was not found in the table.</span><br><span class="line"></span><br><span class="line">    Raises:</span><br><span class="line">        IOError: An error occurred accessing the bigtable.Table object.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>

<h4 id="类"><a href="#类" class="headerlink" title="类"></a>类</h4><p>类应该在其定义下有一个用于描述该类的文档字符串. 如果你的类有公共属性(Attributes), 那么文档中应该有一个属性(Attributes)段. 并且应该遵守和函数参数相同的格式.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">class SampleClass(object):</span><br><span class="line">    &quot;&quot;&quot;Summary of class here.</span><br><span class="line"></span><br><span class="line">    Longer class information....</span><br><span class="line">    Longer class information....</span><br><span class="line"></span><br><span class="line">    Attributes:</span><br><span class="line">        likes_spam: A boolean indicating if we like SPAM or not.</span><br><span class="line">        eggs: An integer count of the eggs we have laid.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self, likes_spam&#x3D;False):</span><br><span class="line">        &quot;&quot;&quot;Inits SampleClass with blah.&quot;&quot;&quot;</span><br><span class="line">        self.likes_spam &#x3D; likes_spam</span><br><span class="line">        self.eggs &#x3D; 0</span><br><span class="line"></span><br><span class="line">    def public_method(self):</span><br><span class="line">        &quot;&quot;&quot;Performs operation blah.&quot;&quot;&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="块注释和行注释"><a href="#块注释和行注释" class="headerlink" title="块注释和行注释"></a>块注释和行注释</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># We use a weighted dictionary search to find out where i is in</span><br><span class="line"># the array.  We extrapolate position based on the largest num</span><br><span class="line"># in the array and the array size and then do binary search to</span><br><span class="line"># get the exact number.</span><br><span class="line"></span><br><span class="line">if i &amp; (i-1) &#x3D;&#x3D; 0:        # true iff i is a power of 2</span><br></pre></td></tr></table></figure>
<h3 id="类-1"><a href="#类-1" class="headerlink" title="类"></a>类</h3><p>如果一个类不继承自其它类, 就显式的从object继承. 嵌套类也一样.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Yes: class SampleClass(object):</span><br><span class="line">         pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     class OuterClass(object):</span><br><span class="line"></span><br><span class="line">         class InnerClass(object):</span><br><span class="line">             pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     class ChildClass(ParentClass):</span><br><span class="line">         &quot;&quot;&quot;Explicitly inherits from another class already.&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">No: class SampleClass:</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    class OuterClass:</span><br><span class="line"></span><br><span class="line">        class InnerClass:</span><br><span class="line">            pass</span><br></pre></td></tr></table></figure>
<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><p>即使参数都是字符串, 使用%操作符或者格式化方法格式化字符串. 不过也不能一概而论, 你需要在+和%之间好好判定.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Yes: x &#x3D; a + b</span><br><span class="line">     x &#x3D; &#39;%s, %s!&#39; % (imperative, expletive)</span><br><span class="line">     x &#x3D; &#39;&#123;&#125;, &#123;&#125;!&#39;.format(imperative, expletive)</span><br><span class="line">     x &#x3D; &#39;name: %s; score: %d&#39; % (name, n)</span><br><span class="line">     x &#x3D; &#39;name: &#123;&#125;; score: &#123;&#125;&#39;.format(name, n)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">No: x &#x3D; &#39;%s%s&#39; % (a, b)  # use + in this case</span><br><span class="line">    x &#x3D; &#39;&#123;&#125;&#123;&#125;&#39;.format(a, b)  # use + in this case</span><br><span class="line">    x &#x3D; imperative + &#39;, &#39; + expletive + &#39;!&#39;</span><br><span class="line">    x &#x3D; &#39;name: &#39; + name + &#39;; score: &#39; + str(n)</span><br></pre></td></tr></table></figure>
<p>避免在循环中用+和+=操作符来累加字符串. 由于字符串是不可变的, 这样做会创建不必要的临时对象, 并且导致二次方而不是线性的运行时间. 作为替代方案, 你可以将每个子串加入列表, 然后在循环结束后用 .join 连接列表. (也可以将每个子串写入一个 cStringIO.StringIO 缓存中.)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Yes: items &#x3D; [&#39;&lt;table&gt;&#39;]</span><br><span class="line">     for last_name, first_name in employee_list:</span><br><span class="line">         items.append(&#39;&lt;tr&gt;&lt;td&gt;%s, %s&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&#39; % (last_name, first_name))</span><br><span class="line">     items.append(&#39;&lt;&#x2F;table&gt;&#39;)</span><br><span class="line">     employee_table &#x3D; &#39;&#39;.join(items)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">No: employee_table &#x3D; &#39;&lt;table&gt;&#39;</span><br><span class="line">    for last_name, first_name in employee_list:</span><br><span class="line">        employee_table +&#x3D; &#39;&lt;tr&gt;&lt;td&gt;%s, %s&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&#39; % (last_name, first_name)</span><br><span class="line">    employee_table +&#x3D; &#39;&lt;&#x2F;table&gt;&#39;</span><br></pre></td></tr></table></figure>
<p>在同一个文件中, 保持使用字符串引号的一致性. 使用单引号’或者双引号”之一用以引用字符串, 并在同一文件中沿用. 在字符串内可以使用另外一种引号, 以避免在字符串中使用.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Yes:</span><br><span class="line">     Python(&#39;Why are you hiding your eyes?&#39;)</span><br><span class="line">     Gollum(&quot;I&#39;m scared of lint errors.&quot;)</span><br><span class="line">     Narrator(&#39;&quot;Good!&quot; thought a happy Python reviewer.&#39;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">No:</span><br><span class="line">     Python(&quot;Why are you hiding your eyes?&quot;)</span><br><span class="line">     Gollum(&#39;The lint. It burns. It burns us.&#39;)</span><br><span class="line">     Gollum(&quot;Always the great lint. Watching. Watching.&quot;)</span><br></pre></td></tr></table></figure>
<p>为多行字符串使用三重双引号”“”而非三重单引号’‘’. 当且仅当项目中使用单引号’来引用字符串时, 才可能会使用三重’‘’为非文档字符串的多行字符串来标识引用. 文档字符串必须使用三重双引号”“”. 不过要注意, 通常用隐式行连接更清晰, 因为多行字符串与程序其他部分的缩进方式不一致.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Yes:</span><br><span class="line">    print (&quot;This is much nicer.\n&quot;</span><br><span class="line">           &quot;Do it this way.\n&quot;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">No:</span><br><span class="line">      print &quot;&quot;&quot;This is pretty ugly.</span><br><span class="line">  Don&#39;t do this.</span><br><span class="line">  &quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<h3 id="文件和sockets"><a href="#文件和sockets" class="headerlink" title="文件和sockets"></a>文件和sockets</h3><p>在文件和sockets结束时, 显式的关闭它.<br>推荐使用 “with”语句 以管理文件:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">with open(&quot;hello.txt&quot;) as hello_file:</span><br><span class="line">    for line in hello_file:</span><br><span class="line">        print line</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>对于不支持使用”with”语句的类似文件的对象,使用 contextlib.closing():</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import contextlib</span><br><span class="line"></span><br><span class="line">with contextlib.closing(urllib.urlopen(&quot;http:&#x2F;&#x2F;www.python.org&#x2F;&quot;)) as front_page:</span><br><span class="line">    for line in front_page:</span><br><span class="line">        print line</span><br></pre></td></tr></table></figure>
<h3 id="TODO注释"><a href="#TODO注释" class="headerlink" title="TODO注释"></a>TODO注释</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># TODO(kl@gmail.com): Use a &quot;*&quot; here for string repetition.</span><br><span class="line"># TODO(Zeke) Change this to use relations.</span><br></pre></td></tr></table></figure>
<h3 id="导入格式"><a href="#导入格式" class="headerlink" title="导入格式"></a>导入格式</h3><p>每个导入应该独占一行  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Yes: import os</span><br><span class="line">     import sys</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">No:  import os, sys</span><br></pre></td></tr></table></figure>
<p>每种分组中, 应该根据每个模块的完整包路径按字典序排序, 忽略大小写.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import foo</span><br><span class="line">from foo import bar</span><br><span class="line">from foo.bar import baz</span><br><span class="line">from foo.bar import Quux</span><br><span class="line">from Foob import ar</span><br></pre></td></tr></table></figure>
<h3 id="语句"><a href="#语句" class="headerlink" title="语句"></a>语句</h3><p>通常每个语句应该独占一行<br>不过, 如果测试结果与测试语句在一行放得下, 你也可以将它们放在同一行. 如果是if语句, 只有在没有else时才能这样做. 特别地, 绝不要对 try/except 这样做, 因为try和except不能放在同一行.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Yes:</span><br><span class="line"></span><br><span class="line">  if foo: bar(foo)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">No:</span><br><span class="line"></span><br><span class="line">  if foo: bar(foo)</span><br><span class="line">  else:   baz(foo)</span><br><span class="line"></span><br><span class="line">  try:               bar(foo)</span><br><span class="line">  except ValueError: baz(foo)</span><br><span class="line"></span><br><span class="line">  try:</span><br><span class="line">      bar(foo)</span><br><span class="line">  except ValueError: baz(foo)</span><br></pre></td></tr></table></figure>
<h3 id="访问控制"><a href="#访问控制" class="headerlink" title="访问控制"></a>访问控制</h3><p>在Python中, 对于琐碎又不太重要的访问函数, 你应该直接使用公有变量来取代它们, 这样可以避免额外的函数调用开销. 当添加更多功能时, 你可以用属性(property)来保持语法的一致性.<br>另一方面, 如果访问更复杂, 或者变量的访问开销很显著, 那么你应该使用像 get_foo() 和 set_foo() 这样的函数调用. 如果之前的代码行为允许通过属性(property)访问 , 那么就不要将新的访问函数与属性绑定. 这样, 任何试图通过老方法访问变量的代码就没法运行, 使用者也就会意识到复杂性发生了变化.</p>
<h3 id="命名"><a href="#命名" class="headerlink" title="命名"></a>命名</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">module_name</span><br><span class="line">package_name</span><br><span class="line">ClassName</span><br><span class="line">method_name</span><br><span class="line">ExceptionName</span><br><span class="line">function_name</span><br><span class="line">GLOBAL_VAR_NAME</span><br><span class="line">instance_var_name</span><br><span class="line">function_parameter_name</span><br><span class="line">local_var_name</span><br></pre></td></tr></table></figure>
<p>应该避免的名称：  </p>
<ol>
<li>单字符名称, 除了计数器和迭代器.</li>
<li>包/模块名中的连字符(-)</li>
<li>双下划线开头并结尾的名称(Python保留, 例如<strong>init</strong>)</li>
</ol>
<p>命名约定：  </p>
<ol>
<li>所谓”内部(Internal)”表示仅模块内可用, 或者, 在类内是保护或私有的.</li>
<li>用单下划线( _ )开头表示模块变量或函数是protected的(使用import * from时不会包含).</li>
<li>用双下划线( __ )开头的实例变量或方法表示类内私有.</li>
<li>将相关的类和顶级函数放在同一个模块里. 不像Java, 没必要限制一个类一个模块.</li>
<li>对类名使用大写字母开头的单词(如CapWords, 即Pascal风格), 但是模块名应该用小写加下划线的方式(如lower_with_under.py). 尽管已经有很多现存的模块使用类似于CapWords.py这样的命名, 但现在已经不鼓励这样做, 因为如果模块名碰巧和类名一致, 这会让人困扰.</li>
</ol>
<h3 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h3><p>即使是一个打算被用作脚本的文件, 也应该是可导入的. 并且简单的导入不应该导致这个脚本的主功能(main functionality)被执行, 这是一种副作用. 主功能应该放在一个main()函数中.</p>
<p>在Python中, pydoc以及单元测试要求模块必须是可导入的. 你的代码应该在执行主程序前总是检查 if <strong>name</strong> == ‘<strong>main</strong>‘ , 这样当模块被导入时主程序就不会被执行.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def main():</span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>所有的顶级代码在模块导入时都会被执行. 要小心不要去调用函数, 创建对象, 或者执行那些不应该在使用pydoc时执行的操作.</p>
<h2 id="语法备忘"><a href="#语法备忘" class="headerlink" title="语法备忘"></a>语法备忘</h2><h3 id="Python解释器"><a href="#Python解释器" class="headerlink" title="Python解释器"></a>Python解释器</h3><ul>
<li>CPython - 官方版本的解释,C开发</li>
<li>IPython -  基于CPython之上的一个交互式解释器</li>
<li>PyPy - 采用JIT技术，对Python代码进行动态编译，提高执行速度</li>
<li>Jython - 运行在Java平台</li>
<li>IronPython - 运行在微软.Net平台</li>
</ul>
<h3 id="基本输入输出"><a href="#基本输入输出" class="headerlink" title="基本输入输出"></a>基本输入输出</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(&#39;hello, world&#39;)</span><br><span class="line">name &#x3D; input()</span><br></pre></td></tr></table></figure>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><h4 id="整数"><a href="#整数" class="headerlink" title="整数"></a>整数</h4><p>1，100，-8080，0<br>十六进制 0xff00，0xa5b4c3d2  </p>
<h4 id="浮点数"><a href="#浮点数" class="headerlink" title="浮点数"></a>浮点数</h4><p>1.23，3.14，-9.01<br>浮点数运算有误差  </p>
<h4 id="字符串-1"><a href="#字符串-1" class="headerlink" title="字符串"></a>字符串</h4><p>字符串是以单引号’或双引号”括起来的任意文本，比如’abc’，”xyz”<br>如果字符串内部既包含’又包含”，可以用转义字符\来标识  </p>
<p>\n表示换行，\t表示制表符，字符 \ 本身也要转义</p>
<p>Python允许用’’’…’’’的格式表示多行内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(&#39;&#39;&#39;line1</span><br><span class="line">line2</span><br><span class="line">line3&#39;&#39;&#39;)</span><br></pre></td></tr></table></figure>
<h4 id="布尔值"><a href="#布尔值" class="headerlink" title="布尔值"></a>布尔值</h4><p>True False</p>
<h4 id="空值"><a href="#空值" class="headerlink" title="空值"></a>空值</h4><p>None</p>
<h4 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a &#x3D; 123 # a是整数</span><br><span class="line">print(a)</span><br><span class="line">a &#x3D; &#39;ABC&#39; # a变为字符串</span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>
<h4 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h4><p>通常用全部大写的变量名表示常量：<br>PI = 3.14159265359<br>但事实上PI仍然是一个变量，Python根本没有任何机制保证PI不会被改变  </p>
<h4 id="除法"><a href="#除法" class="headerlink" title="除法"></a>除法</h4><p>有两种除法，一种除法是/，即使是两个整数恰好整除，结果也是浮点数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; 10 &#x2F; 3</span><br><span class="line">3.3333333333333335</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; 9 &#x2F; 3</span><br><span class="line">3.0</span><br></pre></td></tr></table></figure>
<p>还有一种除法是//，称为地板除，两个整数的除法仍然是整数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; 10 &#x2F;&#x2F; 3</span><br><span class="line">3</span><br></pre></td></tr></table></figure>
<p>余数运算：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; 10 % 3</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<h3 id="字符串-2"><a href="#字符串-2" class="headerlink" title="字符串"></a>字符串</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; ord(&#39;A&#39;)</span><br><span class="line">65</span><br><span class="line">&gt;&gt;&gt; ord(&#39;中&#39;)</span><br><span class="line">20013</span><br><span class="line">&gt;&gt;&gt; chr(66)</span><br><span class="line">&#39;B&#39;</span><br><span class="line">&gt;&gt;&gt; chr(25991)</span><br><span class="line">&#39;文&#39;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; len(&#39;ABC&#39;)</span><br><span class="line">3</span><br><span class="line">&gt;&gt;&gt; len(&#39;中文&#39;)</span><br><span class="line">2</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python3</span><br><span class="line"># -*- coding: utf-8 -*-</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; &#39;Hello, %s&#39; % &#39;world&#39;</span><br><span class="line">&#39;Hello, world&#39;</span><br><span class="line">&gt;&gt;&gt; &#39;Hi, %s, you have $%d.&#39; % (&#39;Michael&#39;, 1000000)</span><br><span class="line">&#39;Hi, Michael, you have $1000000.&#39;</span><br></pre></td></tr></table></figure>
<p>%d    整数<br>%f    浮点数<br>%s    字符串<br>%x    十六进制整数</p>
<h3 id="list"><a href="#list" class="headerlink" title="list"></a>list</h3><p>list是一种有序的集合，可以随时添加和删除其中的元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; classmates &#x3D; [&#39;Michael&#39;, &#39;Bob&#39;, &#39;Tracy&#39;]</span><br><span class="line">&gt;&gt;&gt; classmates</span><br><span class="line">[&#39;Michael&#39;, &#39;Bob&#39;, &#39;Tracy&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; len(classmates)</span><br><span class="line">3</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; classmates[0]</span><br><span class="line">&#39;Michael&#39;</span><br><span class="line">&gt;&gt;&gt; classmates[1]</span><br><span class="line">&#39;Bob&#39;</span><br><span class="line">&gt;&gt;&gt; classmates[2]</span><br><span class="line">&#39;Tracy&#39;</span><br><span class="line">&gt;&gt;&gt; classmates[-1]</span><br><span class="line">&#39;Tracy&#39;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; classmates.append(&#39;Adam&#39;)</span><br><span class="line">&gt;&gt;&gt; classmates</span><br><span class="line">[&#39;Michael&#39;, &#39;Bob&#39;, &#39;Tracy&#39;, &#39;Adam&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; classmates.insert(1, &#39;Jack&#39;)</span><br><span class="line">&gt;&gt;&gt; classmates</span><br><span class="line">[&#39;Michael&#39;, &#39;Jack&#39;, &#39;Bob&#39;, &#39;Tracy&#39;, &#39;Adam&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; classmates.pop()</span><br><span class="line">&#39;Adam&#39;</span><br><span class="line">&gt;&gt;&gt; classmates</span><br><span class="line">[&#39;Michael&#39;, &#39;Jack&#39;, &#39;Bob&#39;, &#39;Tracy&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; classmates.pop(1)</span><br><span class="line">&#39;Jack&#39;</span><br><span class="line">&gt;&gt;&gt; classmates</span><br><span class="line">[&#39;Michael&#39;, &#39;Bob&#39;, &#39;Tracy&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; classmates[1] &#x3D; &#39;Sarah&#39;</span><br><span class="line">&gt;&gt;&gt; classmates</span><br><span class="line">[&#39;Michael&#39;, &#39;Sarah&#39;, &#39;Tracy&#39;]</span><br></pre></td></tr></table></figure>
<p>list里面的元素的数据类型也可以不同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; L &#x3D; [&#39;Apple&#39;, 123, True]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>list元素也可以是另一个list，比如  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s &#x3D; [&#39;python&#39;, &#39;java&#39;, [&#39;asp&#39;, &#39;php&#39;], &#39;scheme&#39;]</span><br><span class="line">&gt;&gt;&gt; len(s)</span><br><span class="line">4</span><br></pre></td></tr></table></figure>
<h3 id="tuple"><a href="#tuple" class="headerlink" title="tuple"></a>tuple</h3><p>tuple和list非常类似，但是tuple一旦初始化就不能修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; classmates &#x3D; (&#39;Michael&#39;, &#39;Bob&#39;, &#39;Tracy&#39;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>只有1个元素的tuple定义时必须加一个逗号,，来消除歧义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; t &#x3D; (1,)</span><br><span class="line">&gt;&gt;&gt; t</span><br><span class="line">(1,)</span><br></pre></td></tr></table></figure>
<h3 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">age &#x3D; 3</span><br><span class="line">if age &gt;&#x3D; 18:</span><br><span class="line">    print(&#39;adult&#39;)</span><br><span class="line">elif age &gt;&#x3D; 6:</span><br><span class="line">    print(&#39;teenager&#39;)</span><br><span class="line">else:</span><br><span class="line">    print(&#39;kid&#39;)</span><br></pre></td></tr></table></figure>
<h3 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">names &#x3D; [&#39;Michael&#39;, &#39;Bob&#39;, &#39;Tracy&#39;]</span><br><span class="line">for name in names:</span><br><span class="line">    print(name)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sum &#x3D; 0</span><br><span class="line">n &#x3D; 99</span><br><span class="line">while n &gt; 0:</span><br><span class="line">    sum &#x3D; sum + n</span><br><span class="line">    n &#x3D; n - 2</span><br><span class="line">print(sum)</span><br></pre></td></tr></table></figure>
<h3 id="dict"><a href="#dict" class="headerlink" title="dict"></a>dict</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; &#123;&#39;Michael&#39;: 95, &#39;Bob&#39;: 75, &#39;Tracy&#39;: 85&#125;</span><br><span class="line">&gt;&gt;&gt; d[&#39;Michael&#39;]</span><br><span class="line">95</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; &#39;Thomas&#39; in d</span><br><span class="line">False</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; d.pop(&#39;Bob&#39;)</span><br><span class="line">75</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">&#123;&#39;Michael&#39;: 95, &#39;Tracy&#39;: 85&#125;</span><br></pre></td></tr></table></figure>
<h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><p>set和dict类似，也是一组key的集合，但不存储value。由于key不能重复，所以，在set中，没有重复的key。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s &#x3D; set([1, 1, 2, 2, 3, 3])</span><br><span class="line">&gt;&gt;&gt; s</span><br><span class="line">&#123;1, 2, 3&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s.add(4)</span><br><span class="line">&gt;&gt;&gt; s</span><br><span class="line">&#123;1, 2, 3, 4&#125;</span><br><span class="line">&gt;&gt;&gt; s.add(4)</span><br><span class="line">&gt;&gt;&gt; s</span><br><span class="line">&#123;1, 2, 3, 4&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s.remove(4)</span><br><span class="line">&gt;&gt;&gt; s</span><br><span class="line">&#123;1, 2, 3&#125;</span><br></pre></td></tr></table></figure>
<h3 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; abs(-20)</span><br><span class="line">20</span><br><span class="line">max(2, 3, 1, -5)</span><br><span class="line">3</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; int(12.34)</span><br><span class="line">12</span><br><span class="line">&gt;&gt;&gt; float(&#39;12.34&#39;)</span><br><span class="line">12.34</span><br><span class="line">&gt;&gt;&gt; str(1.23)</span><br><span class="line">&#39;1.23&#39;</span><br><span class="line">&gt;&gt;&gt; str(100)</span><br><span class="line">&#39;100&#39;</span><br><span class="line">&gt;&gt;&gt; bool(1)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; bool(&#39;&#39;)</span><br><span class="line">False</span><br></pre></td></tr></table></figure>
<h3 id="定义函数"><a href="#定义函数" class="headerlink" title="定义函数"></a>定义函数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def power(x):</span><br><span class="line">    return x * x</span><br></pre></td></tr></table></figure>
<p>默认参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def power(x, n&#x3D;2):</span><br><span class="line">    s &#x3D; 1</span><br><span class="line">    while n &gt; 0:</span><br><span class="line">        n &#x3D; n - 1</span><br><span class="line">        s &#x3D; s * x</span><br><span class="line">    return s</span><br></pre></td></tr></table></figure>
<p>可变参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">def calc(*numbers):</span><br><span class="line">    sum &#x3D; 0</span><br><span class="line">    for n in numbers:</span><br><span class="line">        sum &#x3D; sum + n * n</span><br><span class="line">    return sum</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; calc(1, 2)</span><br><span class="line">5</span><br><span class="line">&gt;&gt;&gt; calc()</span><br><span class="line">0</span><br><span class="line">&gt;&gt;&gt; nums &#x3D; [1, 2, 3]</span><br><span class="line">&gt;&gt;&gt; calc(*nums)</span><br><span class="line">14</span><br></pre></td></tr></table></figure>
<p>关键字参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">def person(name, age, **kw):</span><br><span class="line">    print(&#39;name:&#39;, name, &#39;age:&#39;, age, &#39;other:&#39;, kw)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; person(&#39;Bob&#39;, 35, city&#x3D;&#39;Beijing&#39;)</span><br><span class="line">name: Bob age: 35 other: &#123;&#39;city&#39;: &#39;Beijing&#39;&#125;</span><br><span class="line">&gt;&gt;&gt; person(&#39;Adam&#39;, 45, gender&#x3D;&#39;M&#39;, job&#x3D;&#39;Engineer&#39;)</span><br><span class="line">name: Adam age: 45 other: &#123;&#39;gender&#39;: &#39;M&#39;, &#39;job&#39;: &#39;Engineer&#39;&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; extra &#x3D; &#123;&#39;city&#39;: &#39;Beijing&#39;, &#39;job&#39;: &#39;Engineer&#39;&#125;</span><br><span class="line">&gt;&gt;&gt; person(&#39;Jack&#39;, 24, **extra)</span><br><span class="line">name: Jack age: 24 other: &#123;&#39;city&#39;: &#39;Beijing&#39;, &#39;job&#39;: &#39;Engineer&#39;&#125;</span><br></pre></td></tr></table></figure>
<p>命名关键字参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def person(name, age, **kw):</span><br><span class="line">    if &#39;city&#39; in kw:</span><br><span class="line">        # 有city参数</span><br><span class="line">        pass</span><br><span class="line">    if &#39;job&#39; in kw:</span><br><span class="line">        # 有job参数</span><br><span class="line">        pass</span><br><span class="line">    print(&#39;name:&#39;, name, &#39;age:&#39;, age, &#39;other:&#39;, kw)</span><br></pre></td></tr></table></figure>
<p>参数组合</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def f1(a, b, c&#x3D;0, *args, **kw):</span><br><span class="line">    print(&#39;a &#x3D;&#39;, a, &#39;b &#x3D;&#39;, b, &#39;c &#x3D;&#39;, c, &#39;args &#x3D;&#39;, args, &#39;kw &#x3D;&#39;, kw)</span><br><span class="line"></span><br><span class="line">def f2(a, b, c&#x3D;0, *, d, **kw):</span><br><span class="line">    print(&#39;a &#x3D;&#39;, a, &#39;b &#x3D;&#39;, b, &#39;c &#x3D;&#39;, c, &#39;d &#x3D;&#39;, d, &#39;kw &#x3D;&#39;, kw)</span><br></pre></td></tr></table></figure>
<h3 id="递归函数"><a href="#递归函数" class="headerlink" title="递归函数"></a>递归函数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def fact(n):</span><br><span class="line">    return fact_iter(n, 1)</span><br><span class="line"></span><br><span class="line">def fact_iter(num, product):</span><br><span class="line">    if num &#x3D;&#x3D; 1:</span><br><span class="line">        return product</span><br><span class="line">    return fact_iter(num - 1, num * product)</span><br></pre></td></tr></table></figure>
<h3 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; L &#x3D; [&#39;Michael&#39;, &#39;Sarah&#39;, &#39;Tracy&#39;, &#39;Bob&#39;, &#39;Jack&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; L[0:3]</span><br><span class="line">[&#39;Michael&#39;, &#39;Sarah&#39;, &#39;Tracy&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; L[:3]</span><br><span class="line">[&#39;Michael&#39;, &#39;Sarah&#39;, &#39;Tracy&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; L[-2:]</span><br><span class="line">[&#39;Bob&#39;, &#39;Jack&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; L[-2:-1]</span><br><span class="line">[&#39;Bob&#39;]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; L &#x3D; list(range(100))</span><br><span class="line">&gt;&gt;&gt; L</span><br><span class="line">[0, 1, 2, 3, ..., 99]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; L[:10:2]  # 前10个数，每两个取一个：</span><br><span class="line">[0, 2, 4, 6, 8]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; L[::5]  # 所有数，每5个取一个</span><br><span class="line">[0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75, 80, 85, 90, 95]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; L[:]  # 原样复制一个list</span><br><span class="line">[0, 1, 2, 3, ..., 99]</span><br></pre></td></tr></table></figure>
<h3 id="迭代"><a href="#迭代" class="headerlink" title="迭代"></a>迭代</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; &#123;&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;c&#39;: 3&#125;</span><br><span class="line">&gt;&gt;&gt; for key in d:</span><br><span class="line">...     print(key)</span><br><span class="line">...</span><br><span class="line">a</span><br><span class="line">c</span><br><span class="line">b</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; &#123;&#39;x&#39;: &#39;A&#39;, &#39;y&#39;: &#39;B&#39;, &#39;z&#39;: &#39;C&#39; &#125;</span><br><span class="line">&gt;&gt;&gt; for k, v in d.items():</span><br><span class="line">...     print(k, &#39;&#x3D;&#39;, v)</span><br><span class="line">...</span><br><span class="line">y &#x3D; B</span><br><span class="line">x &#x3D; A</span><br><span class="line">z &#x3D; C</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; for ch in &#39;ABC&#39;:</span><br><span class="line">...     print(ch)</span><br><span class="line">...</span><br><span class="line">A</span><br><span class="line">B</span><br><span class="line">C</span><br></pre></td></tr></table></figure>


<p>判断一个对象是可迭代对象：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import Iterable</span><br><span class="line">&gt;&gt;&gt; isinstance(&#39;abc&#39;, Iterable) # str是否可迭代</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; isinstance([1,2,3], Iterable) # list是否可迭代</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; isinstance(123, Iterable) # 整数是否可迭代</span><br><span class="line">False</span><br></pre></td></tr></table></figure>
<h3 id="列表生成"><a href="#列表生成" class="headerlink" title="列表生成"></a>列表生成</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; list(range(1, 11))</span><br><span class="line">[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; [x * x for x in range(1, 11)]</span><br><span class="line">[1, 4, 9, 16, 25, 36, 49, 64, 81, 100]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; [x * x for x in range(1, 11) if x % 2 &#x3D;&#x3D; 0]</span><br><span class="line">[4, 16, 36, 64, 100]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; &#123;&#39;x&#39;: &#39;A&#39;, &#39;y&#39;: &#39;B&#39;, &#39;z&#39;: &#39;C&#39; &#125;</span><br><span class="line">&gt;&gt;&gt; [k + &#39;&#x3D;&#39; + v for k, v in d.items()]</span><br><span class="line">[&#39;y&#x3D;B&#39;, &#39;x&#x3D;A&#39;, &#39;z&#x3D;C&#39;]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; L &#x3D; [&#39;Hello&#39;, &#39;World&#39;, &#39;IBM&#39;, &#39;Apple&#39;]</span><br><span class="line">&gt;&gt;&gt; [s.lower() for s in L]</span><br><span class="line">[&#39;hello&#39;, &#39;world&#39;, &#39;ibm&#39;, &#39;apple&#39;]</span><br></pre></td></tr></table></figure>
<h3 id="生成器"><a href="#生成器" class="headerlink" title="生成器"></a>生成器</h3><p>这种一边循环一边计算的机制，称为生成器：generator。<br>只要把一个列表生成式的[]改成()，就创建了一个generator  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; L &#x3D; [x * x for x in range(10)]</span><br><span class="line">&gt;&gt;&gt; L</span><br><span class="line">[0, 1, 4, 9, 16, 25, 36, 49, 64, 81]</span><br><span class="line">&gt;&gt;&gt; g &#x3D; (x * x for x in range(10))</span><br><span class="line">&gt;&gt;&gt; g</span><br><span class="line">&lt;generator object &lt;genexpr&gt; at 0x1022ef630&gt;</span><br></pre></td></tr></table></figure>
<h3 id="定义模块"><a href="#定义模块" class="headerlink" title="定义模块"></a>定义模块</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python3</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">&#39; a test module &#39;</span><br><span class="line"></span><br><span class="line">__author__ &#x3D; &#39;Michael Liao&#39;</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">def test():</span><br><span class="line">    args &#x3D; sys.argv</span><br><span class="line">    if len(args)&#x3D;&#x3D;1:</span><br><span class="line">        print(&#39;Hello, world!&#39;)</span><br><span class="line">    elif len(args)&#x3D;&#x3D;2:</span><br><span class="line">        print(&#39;Hello, %s!&#39; % args[1])</span><br><span class="line">    else:</span><br><span class="line">        print(&#39;Too many arguments!&#39;)</span><br><span class="line"></span><br><span class="line">if __name__&#x3D;&#x3D;&#39;__main__&#39;:</span><br><span class="line">    test()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="第三方模块"><a href="#第三方模块" class="headerlink" title="第三方模块"></a>第三方模块</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install Pillow</span><br></pre></td></tr></table></figure>
<p>默认情况下，Python解释器会搜索当前目录、所有已安装的内置模块和第三方模块，搜索路径存放在sys模块的path变量中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import sys</span><br><span class="line">&gt;&gt;&gt; sys.path</span><br><span class="line">[&#39;&#39;, &#39;&#x2F;Library&#x2F;Frameworks&#x2F;Python.framework&#x2F;Versions&#x2F;3.4&#x2F;lib&#x2F;python34.zip&#39;, &#39;&#x2F;Library&#x2F;Frameworks&#x2F;Python.framework&#x2F;Versions&#x2F;3.4&#x2F;lib&#x2F;python3.4&#39;, &#39;&#x2F;Library&#x2F;Frameworks&#x2F;Python.framework&#x2F;Versions&#x2F;3.4&#x2F;lib&#x2F;python3.4&#x2F;plat-darwin&#39;, &#39;&#x2F;Library&#x2F;Frameworks&#x2F;Python.framework&#x2F;Versions&#x2F;3.4&#x2F;lib&#x2F;python3.4&#x2F;lib-dynload&#39;, &#39;&#x2F;Library&#x2F;Frameworks&#x2F;Python.framework&#x2F;Versions&#x2F;3.4&#x2F;lib&#x2F;python3.4&#x2F;site-packages&#39;]</span><br></pre></td></tr></table></figure>
<p>添加自己的搜索目录，一是直接修改sys.path，添加要搜索的目录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import sys</span><br><span class="line">&gt;&gt;&gt; sys.path.append(&#39;&#x2F;Users&#x2F;michael&#x2F;my_py_scripts&#39;)</span><br></pre></td></tr></table></figure>
<p>第二种方法是设置环境变量PYTHONPATH，该环境变量的内容会被自动添加到模块搜索路径中。</p>
<h3 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class Student(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self, name, score):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.score &#x3D; score</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; bart &#x3D; Student(&#39;Bart Simpson&#39;, 59)</span><br><span class="line">&gt;&gt;&gt; bart.name</span><br><span class="line">&#39;Bart Simpson&#39;</span><br><span class="line">&gt;&gt;&gt; bart.score</span><br><span class="line">59</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class Student(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self, name, score):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.score &#x3D; score</span><br><span class="line"></span><br><span class="line">    def print_score(self):</span><br><span class="line">        print(&#39;%s: %s&#39; % (self.name, self.score))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; bart.print_score()</span><br><span class="line">Bart Simpson: 59</span><br></pre></td></tr></table></figure>

<h3 id="访问限制"><a href="#访问限制" class="headerlink" title="访问限制"></a>访问限制</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">class Student(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self, name, score):</span><br><span class="line">        self.__name &#x3D; name</span><br><span class="line">        self.__score &#x3D; score</span><br><span class="line"></span><br><span class="line">    def print_score(self):</span><br><span class="line">        print(&#39;%s: %s&#39; % (self.__name, self.__score))</span><br><span class="line"></span><br><span class="line">    def get_name(self):</span><br><span class="line">        return self.__name</span><br><span class="line"></span><br><span class="line">    def get_score(self):</span><br><span class="line">        return self.__score</span><br><span class="line"></span><br><span class="line">    def set_score(self, score):</span><br><span class="line">        self.__score &#x3D; score</span><br></pre></td></tr></table></figure>
<h3 id="继承和多态"><a href="#继承和多态" class="headerlink" title="继承和多态"></a>继承和多态</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class Animal(object):</span><br><span class="line">    def run(self):</span><br><span class="line">        print(&#39;Animal is running...&#39;)</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class Dog(Animal):</span><br><span class="line"></span><br><span class="line">    def run(self):</span><br><span class="line">        print(&#39;Dog is running...&#39;)</span><br><span class="line"></span><br><span class="line">class Cat(Animal):</span><br><span class="line"></span><br><span class="line">    def run(self):</span><br><span class="line">        print(&#39;Cat is running...&#39;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; isinstance(a, list)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; isinstance(b, Animal)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; isinstance(c, Dog)</span><br><span class="line">True</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="获取对象信息"><a href="#获取对象信息" class="headerlink" title="获取对象信息"></a>获取对象信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; type(123)</span><br><span class="line">&lt;class &#39;int&#39;&gt;</span><br><span class="line">&gt;&gt;&gt; type(&#39;str&#39;)</span><br><span class="line">&lt;class &#39;str&#39;&gt;</span><br><span class="line">&gt;&gt;&gt; type(None)</span><br><span class="line">&lt;type(None) &#39;NoneType&#39;&gt;</span><br><span class="line">&gt;&gt;&gt; type(abs)</span><br><span class="line">&lt;class &#39;builtin_function_or_method&#39;&gt;</span><br><span class="line">&gt;&gt;&gt; type(a)</span><br><span class="line">&lt;class &#39;__main__.Animal&#39;&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import types</span><br><span class="line">&gt;&gt;&gt; def fn():</span><br><span class="line">...     pass</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; type(fn)&#x3D;&#x3D;types.FunctionType</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; type(abs)&#x3D;&#x3D;types.BuiltinFunctionType</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; type(lambda x: x)&#x3D;&#x3D;types.LambdaType</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; type((x for x in range(10)))&#x3D;&#x3D;types.GeneratorType</span><br><span class="line">True</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; isinstance(h, Husky)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; isinstance(&#39;a&#39;, str)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; isinstance(123, int)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; isinstance(b&#39;a&#39;, bytes)</span><br><span class="line">True</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt;&gt;&gt; dir(&#39;ABC&#39;)</span><br><span class="line">[&#39;__add__&#39;, &#39;__class__&#39;, &#39;__contains__&#39;, &#39;__delattr__&#39;, &#39;__dir__&#39;, &#39;__doc__&#39;, &#39;__eq__&#39;, &#39;__format__&#39;, &#39;__ge__&#39;, &#39;__getattribute__&#39;, &#39;__getitem__&#39;, &#39;__getnewargs__&#39;, &#39;__gt__&#39;, &#39;__hash__&#39;, &#39;__init__&#39;, &#39;__iter__&#39;, &#39;__le__&#39;, &#39;__len__&#39;, &#39;__lt__&#39;, &#39;__mod__&#39;, &#39;__mul__&#39;, &#39;__ne__&#39;, &#39;__new__&#39;, &#39;__reduce__&#39;, &#39;__reduce_ex__&#39;, &#39;__repr__&#39;, &#39;__rmod__&#39;, &#39;__rmul__&#39;, &#39;__setattr__&#39;, &#39;__sizeof__&#39;, &#39;__str__&#39;, &#39;__subclasshook__&#39;, &#39;capitalize&#39;, &#39;casefold&#39;, &#39;center&#39;, &#39;count&#39;, &#39;encode&#39;, &#39;endswith&#39;, &#39;expandtabs&#39;, &#39;find&#39;, &#39;format&#39;, &#39;format_map&#39;, &#39;index&#39;, &#39;isalnum&#39;, &#39;isalpha&#39;, &#39;isdecimal&#39;, &#39;isdigit&#39;, &#39;isidentifier&#39;, &#39;islower&#39;, &#39;isnumeric&#39;, &#39;isprintable&#39;, &#39;isspace&#39;, &#39;istitle&#39;, &#39;isupper&#39;, &#39;join&#39;, &#39;ljust&#39;, &#39;lower&#39;, &#39;lstrip&#39;, &#39;maketrans&#39;, &#39;partition&#39;, &#39;replace&#39;, &#39;rfind&#39;, &#39;rindex&#39;, &#39;rjust&#39;, &#39;rpartition&#39;, &#39;rsplit&#39;, &#39;rstrip&#39;, &#39;split&#39;, &#39;splitlines&#39;, &#39;startswith&#39;, &#39;strip&#39;, &#39;swapcase&#39;, &#39;title&#39;, &#39;translate&#39;, &#39;upper&#39;, &#39;zfill&#39;]</span><br></pre></td></tr></table></figure>
<h3 id="实例属性和类属性"><a href="#实例属性和类属性" class="headerlink" title="实例属性和类属性"></a>实例属性和类属性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; class Student(object):</span><br><span class="line">...     name &#x3D; &#39;Student&#39;</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; s &#x3D; Student() # 创建实例s</span><br><span class="line">&gt;&gt;&gt; print(s.name) # 打印name属性，因为实例并没有name属性，所以会继续查找class的name属性</span><br><span class="line">Student</span><br><span class="line">&gt;&gt;&gt; print(Student.name) # 打印类的name属性</span><br><span class="line">Student</span><br><span class="line">&gt;&gt;&gt; s.name &#x3D; &#39;Michael&#39; # 给实例绑定name属性</span><br><span class="line">&gt;&gt;&gt; print(s.name) # 由于实例属性优先级比类属性高，因此，它会屏蔽掉类的name属性</span><br><span class="line">Michael</span><br><span class="line">&gt;&gt;&gt; print(Student.name) # 但是类属性并未消失，用Student.name仍然可以访问</span><br><span class="line">Student</span><br><span class="line">&gt;&gt;&gt; del s.name # 如果删除实例的name属性</span><br><span class="line">&gt;&gt;&gt; print(s.name) # 再次调用s.name，由于实例的name属性没有找到，类的name属性就显示出来了</span><br><span class="line">Student</span><br></pre></td></tr></table></figure>
<h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">    print(&#39;try...&#39;)</span><br><span class="line">    r &#x3D; 10 &#x2F; 0</span><br><span class="line">    print(&#39;result:&#39;, r)</span><br><span class="line">except ZeroDivisionError as e:</span><br><span class="line">    print(&#39;except:&#39;, e)</span><br><span class="line">finally:</span><br><span class="line">    print(&#39;finally...&#39;)</span><br><span class="line">print(&#39;END&#39;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def foo(s):</span><br><span class="line">    n &#x3D; int(s)</span><br><span class="line">    assert n !&#x3D; 0, &#39;n is zero!&#39;</span><br><span class="line">    return 10 &#x2F; n</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    foo(&#39;0&#39;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line"></span><br><span class="line">s &#x3D; &#39;0&#39;</span><br><span class="line">n &#x3D; int(s)</span><br><span class="line">logging.info(&#39;n &#x3D; %d&#39; % n)</span><br><span class="line">print(10 &#x2F; n)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python3 -m pdb err.py</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="文件读写"><a href="#文件读写" class="headerlink" title="文件读写"></a>文件读写</h3><p>读文件  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; f &#x3D; open(&#39;&#x2F;Users&#x2F;michael&#x2F;test.txt&#39;, &#39;r&#39;)</span><br><span class="line">&gt;&gt;&gt; f.read()</span><br><span class="line">&#39;Hello, world!&#39;</span><br><span class="line">&gt;&gt;&gt; f.close()</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">with open(&#39;&#x2F;path&#x2F;to&#x2F;file&#39;, &#39;r&#39;) as f:</span><br><span class="line">    print(f.read())</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for line in f.readlines():</span><br><span class="line">    print(line.strip())</span><br></pre></td></tr></table></figure>
<p>二进制文件  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; f &#x3D; open(&#39;&#x2F;Users&#x2F;michael&#x2F;test.jpg&#39;, &#39;rb&#39;)</span><br><span class="line">&gt;&gt;&gt; f.read()</span><br><span class="line">b&#39;\xff\xd8\xff\xe1\x00\x18Exif\x00\x00...&#39; # 十六进制表示的字节</span><br></pre></td></tr></table></figure>
<p>指定字符编码  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; f &#x3D; open(&#39;&#x2F;Users&#x2F;michael&#x2F;gbk.txt&#39;, &#39;r&#39;, encoding&#x3D;&#39;gbk&#39;)</span><br><span class="line">&gt;&gt;&gt; f.read()</span><br><span class="line">&#39;测试&#39;</span><br></pre></td></tr></table></figure>
<p>写文件  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; f &#x3D; open(&#39;&#x2F;Users&#x2F;michael&#x2F;test.txt&#39;, &#39;w&#39;)</span><br><span class="line">&gt;&gt;&gt; f.write(&#39;Hello, world!&#39;)</span><br><span class="line">&gt;&gt;&gt; f.close()</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">with open(&#39;&#x2F;Users&#x2F;michael&#x2F;test.txt&#39;, &#39;w&#39;) as f:</span><br><span class="line">    f.write(&#39;Hello, world!&#39;)</span><br></pre></td></tr></table></figure>
<h3 id="操作文件与目录"><a href="#操作文件与目录" class="headerlink" title="操作文件与目录"></a>操作文件与目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import os</span><br><span class="line">&gt;&gt;&gt; os.name # 操作系统类型</span><br><span class="line">&#39;posix&#39;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; os.uname()</span><br><span class="line">posix.uname_result(sysname&#x3D;&#39;Darwin&#39;, nodename&#x3D;&#39;MichaelMacPro.local&#39;, release&#x3D;&#39;14.3.0&#39;, version&#x3D;&#39;Darwin Kernel Version 14.3.0: Mon Mar 23 11:59:05 PDT 2015; root:xnu-2782.20.48~5&#x2F;RELEASE_X86_64&#39;, machine&#x3D;&#39;x86_64&#39;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; os.environ</span><br><span class="line">environ(&#123;&#39;VERSIONER_PYTHON_PREFER_32_BIT&#39;: &#39;no&#39;, &#39;TERM_PROGRAM_VERSION&#39;: &#39;326&#39;, &#39;LOGNAME&#39;: &#39;michael&#39;, &#39;USER&#39;: &#39;michael&#39;, &#39;PATH&#39;: &#39;&#x2F;usr&#x2F;bin:&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;opt&#x2F;X11&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#39;, ...&#125;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; os.environ.get(&#39;PATH&#39;)</span><br><span class="line">&#39;&#x2F;usr&#x2F;bin:&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;opt&#x2F;X11&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#39;</span><br><span class="line">&gt;&gt;&gt; os.environ.get(&#39;x&#39;, &#39;default&#39;)</span><br><span class="line">&#39;default&#39;</span><br><span class="line"></span><br><span class="line"># 查看当前目录的绝对路径:</span><br><span class="line">&gt;&gt;&gt; os.path.abspath(&#39;.&#39;)</span><br><span class="line">&#39;&#x2F;Users&#x2F;michael&#39;</span><br><span class="line"># 在某个目录下创建一个新目录，首先把新目录的完整路径表示出来:</span><br><span class="line">&gt;&gt;&gt; os.path.join(&#39;&#x2F;Users&#x2F;michael&#39;, &#39;testdir&#39;)</span><br><span class="line">&#39;&#x2F;Users&#x2F;michael&#x2F;testdir&#39;</span><br><span class="line"># 然后创建一个目录:</span><br><span class="line">&gt;&gt;&gt; os.mkdir(&#39;&#x2F;Users&#x2F;michael&#x2F;testdir&#39;)</span><br><span class="line"># 删掉一个目录:</span><br><span class="line">&gt;&gt;&gt; os.rmdir(&#39;&#x2F;Users&#x2F;michael&#x2F;testdir&#39;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; os.path.split(&#39;&#x2F;Users&#x2F;michael&#x2F;testdir&#x2F;file.txt&#39;)</span><br><span class="line">(&#39;&#x2F;Users&#x2F;michael&#x2F;testdir&#39;, &#39;file.txt&#39;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; os.path.splitext(&#39;&#x2F;path&#x2F;to&#x2F;file.txt&#39;)</span><br><span class="line">(&#39;&#x2F;path&#x2F;to&#x2F;file&#39;, &#39;.txt&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 对文件重命名:</span><br><span class="line">&gt;&gt;&gt; os.rename(&#39;test.txt&#39;, &#39;test.py&#39;)</span><br><span class="line"># 删掉文件:</span><br><span class="line">&gt;&gt;&gt; os.remove(&#39;test.py&#39;)</span><br></pre></td></tr></table></figure>

<h3 id="内建模块datatime"><a href="#内建模块datatime" class="headerlink" title="内建模块datatime"></a>内建模块datatime</h3><p>获取当前日期和时间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime</span><br><span class="line">&gt;&gt;&gt; now &#x3D; datetime.now() # 获取当前datetime</span><br><span class="line">&gt;&gt;&gt; print(now)</span><br><span class="line">2015-05-18 16:28:07.198690</span><br></pre></td></tr></table></figure>
<p>获取指定日期和时间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime</span><br><span class="line">&gt;&gt;&gt; dt &#x3D; datetime(2015, 4, 19, 12, 20) # 用指定日期时间创建datetime</span><br><span class="line">&gt;&gt;&gt; print(dt)</span><br><span class="line">2015-04-19 12:20:00</span><br></pre></td></tr></table></figure>
<p>datetime转换为timestamp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime</span><br><span class="line">&gt;&gt;&gt; dt &#x3D; datetime(2015, 4, 19, 12, 20) # 用指定日期时间创建datetime</span><br><span class="line">&gt;&gt;&gt; dt.timestamp() # 把datetime转换为timestamp</span><br><span class="line">1429417200.0</span><br></pre></td></tr></table></figure>
<p>timestamp转换为datetime</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime</span><br><span class="line">&gt;&gt;&gt; t &#x3D; 1429417200.0</span><br><span class="line">&gt;&gt;&gt; print(datetime.fromtimestamp(t))</span><br><span class="line">2015-04-19 12:20:00</span><br></pre></td></tr></table></figure>
<p>str转换为datetime</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime</span><br><span class="line">&gt;&gt;&gt; cday &#x3D; datetime.strptime(&#39;2015-6-1 18:19:59&#39;, &#39;%Y-%m-%d %H:%M:%S&#39;)</span><br><span class="line">&gt;&gt;&gt; print(cday)</span><br><span class="line">2015-06-01 18:19:59</span><br></pre></td></tr></table></figure>
<p>datetime转换为str</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime</span><br><span class="line">&gt;&gt;&gt; now &#x3D; datetime.now()</span><br><span class="line">&gt;&gt;&gt; print(now.strftime(&#39;%a, %b %d %H:%M&#39;))</span><br><span class="line">Mon, May 05 16:28</span><br></pre></td></tr></table></figure>
<p>datetime加减</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime, timedelta</span><br><span class="line">&gt;&gt;&gt; now &#x3D; datetime.now()</span><br><span class="line">&gt;&gt;&gt; now</span><br><span class="line">datetime.datetime(2015, 5, 18, 16, 57, 3, 540997)</span><br><span class="line">&gt;&gt;&gt; now + timedelta(hours&#x3D;10)</span><br><span class="line">datetime.datetime(2015, 5, 19, 2, 57, 3, 540997)</span><br><span class="line">&gt;&gt;&gt; now - timedelta(days&#x3D;1)</span><br><span class="line">datetime.datetime(2015, 5, 17, 16, 57, 3, 540997)</span><br><span class="line">&gt;&gt;&gt; now + timedelta(days&#x3D;2, hours&#x3D;12)</span><br><span class="line">datetime.datetime(2015, 5, 21, 4, 57, 3, 540997)</span><br></pre></td></tr></table></figure>
<h3 id="内建模块base64"><a href="#内建模块base64" class="headerlink" title="内建模块base64"></a>内建模块base64</h3><p>Base64是一种用64个字符来表示任意二进制数据的方法。<br>Base64编码会把3字节的二进制数据编码为4字节的文本数据，长度增加33%。<br>如果二进制数据不是3的倍数，最后剩下1个或2个字节，Base64用<code>\x00</code>字节在末尾补足后，再在编码的末尾加上1个或2个=号，表示补了多少字节，解码的时候，会自动去掉。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import base64</span><br><span class="line">&gt;&gt;&gt; base64.b64encode(b&#39;binary\x00string&#39;)</span><br><span class="line">b&#39;YmluYXJ5AHN0cmluZw&#x3D;&#x3D;&#39;</span><br><span class="line">&gt;&gt;&gt; base64.b64decode(b&#39;YmluYXJ5AHN0cmluZw&#x3D;&#x3D;&#39;)</span><br><span class="line">b&#39;binary\x00string&#39;</span><br></pre></td></tr></table></figure>
<h3 id="内建模块hashlib"><a href="#内建模块hashlib" class="headerlink" title="内建模块hashlib"></a>内建模块hashlib</h3><p>hashlib提供了常见的摘要算法，如MD5，SHA1等等  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line">md5 &#x3D; hashlib.md5()</span><br><span class="line">md5.update(&#39;how to use md5 in python hashlib?&#39;.encode(&#39;utf-8&#39;))</span><br><span class="line">print(md5.hexdigest())</span><br><span class="line">d26a53750bc40b38b65a520292f69306</span><br></pre></td></tr></table></figure>
<h3 id="内建模块contextlib"><a href="#内建模块contextlib" class="headerlink" title="内建模块contextlib"></a>内建模块contextlib</h3><p>使用<code>try...finally</code>关闭资源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">    f &#x3D; open(&#39;&#x2F;path&#x2F;to&#x2F;file&#39;, &#39;r&#39;)</span><br><span class="line">    f.read()</span><br><span class="line">finally:</span><br><span class="line">    if f:</span><br><span class="line">        f.close()</span><br></pre></td></tr></table></figure>
<p>使用<code>with</code>关闭资源，必须实现了上下文管理（通过__enter__和__exit__）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">with open(&#39;&#x2F;path&#x2F;to&#x2F;file&#39;, &#39;r&#39;) as f:</span><br><span class="line">    f.read()</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">class Query(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self, name):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line"></span><br><span class="line">    def __enter__(self):</span><br><span class="line">        print(&#39;Begin&#39;)</span><br><span class="line">        return self</span><br><span class="line"></span><br><span class="line">    def __exit__(self, exc_type, exc_value, traceback):</span><br><span class="line">        if exc_type:</span><br><span class="line">            print(&#39;Error&#39;)</span><br><span class="line">        else:</span><br><span class="line">            print(&#39;End&#39;)</span><br><span class="line"></span><br><span class="line">    def query(self):</span><br><span class="line">        print(&#39;Query info about %s...&#39; % self.name)</span><br><span class="line"></span><br><span class="line">with Query(&#39;Bob&#39;) as q:</span><br><span class="line">    q.query()</span><br></pre></td></tr></table></figure>
<p>@contextmanager，用于简化<strong>enter__和__exit</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">from contextlib import contextmanager</span><br><span class="line"></span><br><span class="line">class Query(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self, name):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line"></span><br><span class="line">    def query(self):</span><br><span class="line">        print(&#39;Query info about %s...&#39; % self.name)</span><br><span class="line"></span><br><span class="line">@contextmanager</span><br><span class="line">def create_query(name):</span><br><span class="line">    print(&#39;Begin&#39;)</span><br><span class="line">    q &#x3D; Query(name)</span><br><span class="line">    yield q</span><br><span class="line">    print(&#39;End&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">with create_query(&#39;Bob&#39;) as q:</span><br><span class="line">    q.query()</span><br></pre></td></tr></table></figure>
<p>望在某段代码执行前后自动执行特定代码，也可以用@contextmanager实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@contextmanager</span><br><span class="line">def tag(name):</span><br><span class="line">    print(&quot;&lt;%s&gt;&quot; % name)</span><br><span class="line">    yield</span><br><span class="line">    print(&quot;&lt;&#x2F;%s&gt;&quot; % name)</span><br><span class="line"></span><br><span class="line">with tag(&quot;h1&quot;):</span><br><span class="line">    print(&quot;hello&quot;)</span><br><span class="line">    print(&quot;world&quot;)</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;</span><br><span class="line">hello</span><br><span class="line">world</span><br><span class="line">&lt;&#x2F;h1&gt;</span><br></pre></td></tr></table></figure>
<p>@closing，把对象变为上下文对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from contextlib import closing</span><br><span class="line">from urllib.request import urlopen</span><br><span class="line"></span><br><span class="line">with closing(urlopen(&#39;https:&#x2F;&#x2F;www.python.org&#39;)) as page:</span><br><span class="line">    for line in page:</span><br><span class="line">        print(line)</span><br></pre></td></tr></table></figure>
<h3 id="内建模块urllib"><a href="#内建模块urllib" class="headerlink" title="内建模块urllib"></a>内建模块urllib</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from urllib import request</span><br><span class="line">with request.urlopen(&#39;https:&#x2F;&#x2F;api.douban.com&#x2F;v2&#x2F;book&#x2F;2129650&#39;) as f:</span><br><span class="line">    data &#x3D; f.read()</span><br><span class="line">    print(&#39;Status:&#39;, f.status, f.reason)</span><br><span class="line">    for k, v in f.getheaders():</span><br><span class="line">        print(&#39;%s: %s&#39; % (k, v))</span><br><span class="line">    print(&#39;Data:&#39;, data.decode(&#39;utf-8&#39;))</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">from urllib import request, parse</span><br><span class="line"></span><br><span class="line">print(&#39;Login to weibo.cn...&#39;)</span><br><span class="line">email &#x3D; input(&#39;Email: &#39;)</span><br><span class="line">passwd &#x3D; input(&#39;Password: &#39;)</span><br><span class="line">login_data &#x3D; parse.urlencode([</span><br><span class="line">    (&#39;username&#39;, email),</span><br><span class="line">    (&#39;password&#39;, passwd),</span><br><span class="line">    (&#39;entry&#39;, &#39;mweibo&#39;),</span><br><span class="line">    (&#39;client_id&#39;, &#39;&#39;),</span><br><span class="line">    (&#39;savestate&#39;, &#39;1&#39;),</span><br><span class="line">    (&#39;ec&#39;, &#39;&#39;),</span><br><span class="line">    (&#39;pagerefer&#39;, &#39;https:&#x2F;&#x2F;passport.weibo.cn&#x2F;signin&#x2F;welcome?entry&#x3D;mweibo&amp;r&#x3D;http%3A%2F%2Fm.weibo.cn%2F&#39;)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">req &#x3D; request.Request(&#39;https:&#x2F;&#x2F;passport.weibo.cn&#x2F;sso&#x2F;login&#39;)</span><br><span class="line">req.add_header(&#39;Origin&#39;, &#39;https:&#x2F;&#x2F;passport.weibo.cn&#39;)</span><br><span class="line">req.add_header(&#39;User-Agent&#39;, &#39;Mozilla&#x2F;6.0 (iPhone; CPU iPhone OS 8_0 like Mac OS X) AppleWebKit&#x2F;536.26 (KHTML, like Gecko) Version&#x2F;8.0 Mobile&#x2F;10A5376e Safari&#x2F;8536.25&#39;)</span><br><span class="line">req.add_header(&#39;Referer&#39;, &#39;https:&#x2F;&#x2F;passport.weibo.cn&#x2F;signin&#x2F;login?entry&#x3D;mweibo&amp;res&#x3D;wel&amp;wm&#x3D;3349&amp;r&#x3D;http%3A%2F%2Fm.weibo.cn%2F&#39;)</span><br><span class="line"></span><br><span class="line">with request.urlopen(req, data&#x3D;login_data.encode(&#39;utf-8&#39;)) as f:</span><br><span class="line">    print(&#39;Status:&#39;, f.status, f.reason)</span><br><span class="line">    for k, v in f.getheaders():</span><br><span class="line">        print(&#39;%s: %s&#39; % (k, v))</span><br><span class="line">    print(&#39;Data:&#39;, f.read().decode(&#39;utf-8&#39;))</span><br></pre></td></tr></table></figure>
<p>urllib可以用requests替代</p>
<h3 id="第三方模块PIL"><a href="#第三方模块PIL" class="headerlink" title="第三方模块PIL"></a>第三方模块PIL</h3><p>安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install pillow</span><br></pre></td></tr></table></figure>
<p>图像缩放</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image</span><br><span class="line"></span><br><span class="line"># 打开一个jpg图像文件，注意是当前路径:</span><br><span class="line">im &#x3D; Image.open(&#39;test.jpg&#39;)</span><br><span class="line"># 获得图像尺寸:</span><br><span class="line">w, h &#x3D; im.size</span><br><span class="line">print(&#39;Original image size: %sx%s&#39; % (w, h))</span><br><span class="line"># 缩放到50%:</span><br><span class="line">im.thumbnail((w&#x2F;&#x2F;2, h&#x2F;&#x2F;2))</span><br><span class="line">print(&#39;Resize image to: %sx%s&#39; % (w&#x2F;&#x2F;2, h&#x2F;&#x2F;2))</span><br><span class="line"># 把缩放后的图像用jpeg格式保存:</span><br><span class="line">im.save(&#39;thumbnail.jpg&#39;, &#39;jpeg&#39;)</span><br></pre></td></tr></table></figure>
<p>生成字母验证码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image, ImageDraw, ImageFont, ImageFilter</span><br><span class="line">import random</span><br><span class="line"></span><br><span class="line"># 随机字母:</span><br><span class="line">def rndChar():</span><br><span class="line">    return chr(random.randint(65, 90))</span><br><span class="line"></span><br><span class="line"># 随机颜色1:</span><br><span class="line">def rndColor():</span><br><span class="line">    return (random.randint(64, 255), random.randint(64, 255), random.randint(64, 255))</span><br><span class="line"></span><br><span class="line"># 随机颜色2:</span><br><span class="line">def rndColor2():</span><br><span class="line">    return (random.randint(32, 127), random.randint(32, 127), random.randint(32, 127))</span><br><span class="line"></span><br><span class="line"># 240 x 60:</span><br><span class="line">width &#x3D; 60 * 4</span><br><span class="line">height &#x3D; 60</span><br><span class="line">image &#x3D; Image.new(&#39;RGB&#39;, (width, height), (255, 255, 255))</span><br><span class="line"># 创建Font对象:</span><br><span class="line">font &#x3D; ImageFont.truetype(&#39;Arial.ttf&#39;, 36)</span><br><span class="line"># 创建Draw对象:</span><br><span class="line">draw &#x3D; ImageDraw.Draw(image)</span><br><span class="line"># 填充每个像素:</span><br><span class="line">for x in range(width):</span><br><span class="line">    for y in range(height):</span><br><span class="line">        draw.point((x, y), fill&#x3D;rndColor())</span><br><span class="line"># 输出文字:</span><br><span class="line">for t in range(4):</span><br><span class="line">    draw.text((60 * t + 10, 10), rndChar(), font&#x3D;font, fill&#x3D;rndColor2())</span><br><span class="line"># 模糊:</span><br><span class="line">image &#x3D; image.filter(ImageFilter.BLUR)</span><br><span class="line">image.save(&#39;code.jpg&#39;, &#39;jpeg&#39;)</span><br></pre></td></tr></table></figure>
<h3 id="图形界面"><a href="#图形界面" class="headerlink" title="图形界面"></a>图形界面</h3><p>Python支持多种图形界面的第三方库，包括：  </p>
<ul>
<li>Tk  </li>
<li>wxWidgets  </li>
<li>Qt  </li>
<li>GTK<br>Python自带的库是支持Tk的Tkinter，使用Tkinter，无需安装任何包</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">from tkinter import *</span><br><span class="line">import tkinter.messagebox as messagebox</span><br><span class="line"></span><br><span class="line">class Application(Frame):</span><br><span class="line">    def __init__(self, master&#x3D;None):</span><br><span class="line">        Frame.__init__(self, master)</span><br><span class="line">        self.pack()</span><br><span class="line">        self.createWidgets()</span><br><span class="line"></span><br><span class="line">    def createWidgets(self):</span><br><span class="line">        self.nameInput &#x3D; Entry(self)</span><br><span class="line">        self.nameInput.pack()</span><br><span class="line">        self.alertButton &#x3D; Button(self, text&#x3D;&#39;Hello&#39;, command&#x3D;self.hello)</span><br><span class="line">        self.alertButton.pack()</span><br><span class="line"></span><br><span class="line">    def hello(self):</span><br><span class="line">        name &#x3D; self.nameInput.get() or &#39;world&#39;</span><br><span class="line">        messagebox.showinfo(&#39;Message&#39;, &#39;Hello, %s&#39; % name)</span><br><span class="line"></span><br><span class="line">app &#x3D; Application()</span><br><span class="line"># 设置窗口标题:</span><br><span class="line">app.master.title(&#39;Hello World&#39;)</span><br><span class="line"># 主消息循环:</span><br><span class="line">app.mainloop()</span><br></pre></td></tr></table></figure>
<h3 id="发送邮件"><a href="#发送邮件" class="headerlink" title="发送邮件"></a>发送邮件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">from email import encoders</span><br><span class="line">from email.header import Header</span><br><span class="line">from email.mime.text import MIMEText</span><br><span class="line">from email.utils import parseaddr, formataddr</span><br><span class="line"></span><br><span class="line">import smtplib</span><br><span class="line"></span><br><span class="line">def _format_addr(s):</span><br><span class="line">    name, addr &#x3D; parseaddr(s)</span><br><span class="line">    return formataddr((Header(name, &#39;utf-8&#39;).encode(), addr))</span><br><span class="line"></span><br><span class="line">from_addr &#x3D; input(&#39;From: &#39;)</span><br><span class="line">password &#x3D; input(&#39;Password: &#39;)</span><br><span class="line">to_addr &#x3D; input(&#39;To: &#39;)</span><br><span class="line">smtp_server &#x3D; input(&#39;SMTP server: &#39;)</span><br><span class="line"></span><br><span class="line">msg &#x3D; MIMEText(&#39;hello, send by Python...&#39;, &#39;plain&#39;, &#39;utf-8&#39;)</span><br><span class="line">msg[&#39;From&#39;] &#x3D; _format_addr(&#39;Python爱好者 &lt;%s&gt;&#39; % from_addr)</span><br><span class="line">msg[&#39;To&#39;] &#x3D; _format_addr(&#39;管理员 &lt;%s&gt;&#39; % to_addr)</span><br><span class="line">msg[&#39;Subject&#39;] &#x3D; Header(&#39;来自SMTP的问候……&#39;, &#39;utf-8&#39;).encode()</span><br><span class="line"></span><br><span class="line"># 邮件正文是MIMEText:</span><br><span class="line">msg.attach(MIMEText(&#39;send with file...&#39;, &#39;plain&#39;, &#39;utf-8&#39;))</span><br><span class="line"></span><br><span class="line"># 添加附件就是加上一个MIMEBase，从本地读取一个图片:</span><br><span class="line">with open(&#39;&#x2F;Users&#x2F;michael&#x2F;Downloads&#x2F;test.png&#39;, &#39;rb&#39;) as f:</span><br><span class="line">    # 设置附件的MIME和文件名，这里是png类型:</span><br><span class="line">    mime &#x3D; MIMEBase(&#39;image&#39;, &#39;png&#39;, filename&#x3D;&#39;test.png&#39;)</span><br><span class="line">    # 加上必要的头信息:</span><br><span class="line">    mime.add_header(&#39;Content-Disposition&#39;, &#39;attachment&#39;, filename&#x3D;&#39;test.png&#39;)</span><br><span class="line">    mime.add_header(&#39;Content-ID&#39;, &#39;&lt;0&gt;&#39;)</span><br><span class="line">    mime.add_header(&#39;X-Attachment-Id&#39;, &#39;0&#39;)</span><br><span class="line">    # 把附件的内容读进来:</span><br><span class="line">    mime.set_payload(f.read())</span><br><span class="line">    # 用Base64编码:</span><br><span class="line">    encoders.encode_base64(mime)</span><br><span class="line">    # 添加到MIMEMultipart:</span><br><span class="line">    msg.attach(mime)</span><br><span class="line"></span><br><span class="line">server &#x3D; smtplib.SMTP(smtp_server, 25)</span><br><span class="line">server.set_debuglevel(1)</span><br><span class="line">server.login(from_addr, password)</span><br><span class="line">server.sendmail(from_addr, [to_addr], msg.as_string())</span><br><span class="line">server.quit()</span><br></pre></td></tr></table></figure>

<h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install mysql-connector</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 导入MySQL驱动:</span><br><span class="line">&gt;&gt;&gt; import mysql.connector</span><br><span class="line"># 注意把password设为你的root口令:</span><br><span class="line">&gt;&gt;&gt; conn &#x3D; mysql.connector.connect(user&#x3D;&#39;root&#39;, password&#x3D;&#39;password&#39;, database&#x3D;&#39;test&#39;)</span><br><span class="line">&gt;&gt;&gt; cursor &#x3D; conn.cursor()</span><br><span class="line"># 创建user表:</span><br><span class="line">&gt;&gt;&gt; cursor.execute(&#39;create table user (id varchar(20) primary key, name varchar(20))&#39;)</span><br><span class="line"># 插入一行记录，注意MySQL的占位符是%s:</span><br><span class="line">&gt;&gt;&gt; cursor.execute(&#39;insert into user (id, name) values (%s, %s)&#39;, [&#39;1&#39;, &#39;Michael&#39;])</span><br><span class="line">&gt;&gt;&gt; cursor.rowcount</span><br><span class="line">1</span><br><span class="line"># 提交事务:</span><br><span class="line">&gt;&gt;&gt; conn.commit()</span><br><span class="line">&gt;&gt;&gt; cursor.close()</span><br><span class="line"># 运行查询:</span><br><span class="line">&gt;&gt;&gt; cursor &#x3D; conn.cursor()</span><br><span class="line">&gt;&gt;&gt; cursor.execute(&#39;select * from user where id &#x3D; %s&#39;, (&#39;1&#39;,))</span><br><span class="line">&gt;&gt;&gt; values &#x3D; cursor.fetchall()</span><br><span class="line">&gt;&gt;&gt; values</span><br><span class="line">[(&#39;1&#39;, &#39;Michael&#39;)]</span><br><span class="line"># 关闭Cursor和Connection:</span><br><span class="line">&gt;&gt;&gt; cursor.close()</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; conn.close()</span><br></pre></td></tr></table></figure>

<h3 id="多进程"><a href="#多进程" class="headerlink" title="多进程"></a>多进程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line"></span><br><span class="line">print(&#39;Process (%s) start...&#39; % os.getpid())</span><br><span class="line"># Only works on Unix&#x2F;Linux&#x2F;Mac:</span><br><span class="line">pid &#x3D; os.fork()</span><br><span class="line">if pid &#x3D;&#x3D; 0:</span><br><span class="line">    print(&#39;I am child process (%s) and my parent is %s.&#39; % (os.getpid(), os.getppid()))</span><br><span class="line">else:</span><br><span class="line">    print(&#39;I (%s) just created a child process (%s).&#39; % (os.getpid(), pid))</span><br></pre></td></tr></table></figure>
<p>multiprocessing模块就是跨平台版本的多进程模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from multiprocessing import Process</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line"># 子进程要执行的代码</span><br><span class="line">def run_proc(name):</span><br><span class="line">    print(&#39;Run child process %s (%s)...&#39; % (name, os.getpid()))</span><br><span class="line"></span><br><span class="line">if __name__&#x3D;&#x3D;&#39;__main__&#39;:</span><br><span class="line">    print(&#39;Parent process %s.&#39; % os.getpid())</span><br><span class="line">    p &#x3D; Process(target&#x3D;run_proc, args&#x3D;(&#39;test&#39;,))</span><br><span class="line">    print(&#39;Child process will start.&#39;)</span><br><span class="line">    p.start()</span><br><span class="line">    p.join()</span><br><span class="line">    print(&#39;Child process end.&#39;)</span><br></pre></td></tr></table></figure>
<p>用进程池的方式批量创建子进程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">from multiprocessing import Pool</span><br><span class="line">import os, time, random</span><br><span class="line"></span><br><span class="line">def long_time_task(name):</span><br><span class="line">    print(&#39;Run task %s (%s)...&#39; % (name, os.getpid()))</span><br><span class="line">    start &#x3D; time.time()</span><br><span class="line">    time.sleep(random.random() * 3)</span><br><span class="line">    end &#x3D; time.time()</span><br><span class="line">    print(&#39;Task %s runs %0.2f seconds.&#39; % (name, (end - start)))</span><br><span class="line"></span><br><span class="line">if __name__&#x3D;&#x3D;&#39;__main__&#39;:</span><br><span class="line">    print(&#39;Parent process %s.&#39; % os.getpid())</span><br><span class="line">    p &#x3D; Pool(4)</span><br><span class="line">    for i in range(5):</span><br><span class="line">        p.apply_async(long_time_task, args&#x3D;(i,))</span><br><span class="line">    print(&#39;Waiting for all subprocesses done...&#39;)</span><br><span class="line">    p.close()</span><br><span class="line">    p.join()</span><br><span class="line">    print(&#39;All subprocesses done.&#39;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201703/%E8%BD%BB%E9%87%8F%E7%BA%A7ORM%E5%B7%A5%E5%85%B7peewee%E5%88%9D%E6%8E%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201703/%E8%BD%BB%E9%87%8F%E7%BA%A7ORM%E5%B7%A5%E5%85%B7peewee%E5%88%9D%E6%8E%A2/" class="post-title-link" itemprop="url">轻量级ORM框架peewee初探</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-06 15:47:10" itemprop="dateCreated datePublished" datetime="2018-11-06T15:47:10+08:00">2018-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="peewee简介"><a href="#peewee简介" class="headerlink" title="peewee简介"></a>peewee简介</h2><p>peewee是Python一个ORM框架，相比于著名的SQLAlchemy，peewee更为轻量，且更加简单易上手。<br>peewee原生支持sqlite、mysql以及postgresql。  </p>
<h2 id="学习资源"><a href="#学习资源" class="headerlink" title="学习资源"></a>学习资源</h2><p><a target="_blank" rel="noopener" href="http://docs.peewee-orm.com/">peewee官网</a><br><a target="_blank" rel="noopener" href="https://github.com/coleifer/peewee">GitHub页面</a></p>
<h2 id="数据建模"><a href="#数据建模" class="headerlink" title="数据建模"></a>数据建模</h2><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">from peewee import *</span><br><span class="line">import datetime</span><br><span class="line">from playhouse.sqlite_ext import SqliteExtDatabase</span><br><span class="line"></span><br><span class="line">db &#x3D; MySQLDatabase(host&#x3D;&#39;localhost&#39;, user&#x3D;&#39;playground&#39;, passwd&#x3D;&#39;playground&#39;, database&#x3D;&#39;playground&#39;)</span><br><span class="line"># db &#x3D; SqliteExtDatabase(&#39;my_database.db&#39;)</span><br><span class="line"></span><br><span class="line">class BaseModel(Model):</span><br><span class="line">    class Meta:</span><br><span class="line">        database &#x3D; db</span><br><span class="line"></span><br><span class="line"># 用户表</span><br><span class="line">class User(BaseModel):</span><br><span class="line">    username &#x3D; CharField(unique&#x3D;True)</span><br><span class="line"></span><br><span class="line"># Twitter表</span><br><span class="line">class Tweet(BaseModel):</span><br><span class="line">    user &#x3D; ForeignKeyField(User, related_name&#x3D;&#39;tweets&#39;)</span><br><span class="line">    message &#x3D; TextField()</span><br><span class="line">    created_date &#x3D; DateTimeField(default&#x3D;datetime.datetime.now)</span><br><span class="line">    is_published &#x3D; BooleanField(default&#x3D;True)</span><br></pre></td></tr></table></figure>
<h3 id="支持的字段类型"><a href="#支持的字段类型" class="headerlink" title="支持的字段类型"></a>支持的字段类型</h3><ul>
<li>CharField    varchar    varchar    varchar  </li>
<li>FixedCharField    char    char    char  </li>
<li>TextField    text    text    longtext  </li>
<li>DateTimeField    datetime    timestamp    datetime  </li>
<li>IntegerField    integer    integer    integer  </li>
<li>BooleanField    integer    boolean    bool  </li>
<li>FloatField    real    real    real  </li>
<li>DoubleField    real    double precision    double precision  </li>
<li>BigIntegerField    integer    bigint    bigint  </li>
<li>SmallIntegerField    integer    smallint    smallint  </li>
<li>DecimalField    decimal    numeric    numeric  </li>
<li>PrimaryKeyField    integer    serial    integer  </li>
<li>ForeignKeyField    integer    integer    integer  </li>
<li>DateField    date    date    date  </li>
<li>TimeField    time    time    time  </li>
<li>TimestampField    integer    integer    integer  </li>
<li>BlobField    blob    bytea    blob  </li>
<li>UUIDField    text    uuid    varchar(40)  </li>
<li>BareField    untyped    not supported    not supported  </li>
</ul>
<h3 id="支持的参数"><a href="#支持的参数" class="headerlink" title="支持的参数"></a>支持的参数</h3><ul>
<li>null = False – boolean indicating whether null values are allowed to be stored  </li>
<li>index = False – boolean indicating whether to create an index on this column  </li>
<li>unique = False – boolean indicating whether to create a unique index on this column. See - also adding composite indexes.  </li>
<li>verbose_name = None – string representing the “user-friendly” name of this field  </li>
<li>help_text = None – string representing any helpful text for this field  </li>
<li>db_column = None – string representing the underlying column to use if different, useful - for legacy databases  </li>
<li>default = None – any value to use as a default for uninitialized models  </li>
<li>choices = None – an optional iterable containing 2-tuples of value, display  </li>
<li>primary_key = False – whether this field is the primary key for the table  </li>
<li>sequence = None – sequence to populate field (if backend supports it)  </li>
<li>constraints = None - a list of one or more constraints, e.g. [Check(‘price &gt; 0’)]  </li>
<li>schema = None – optional name of the schema to use, if your db supports this.  <h3 id="特殊的参数"><a href="#特殊的参数" class="headerlink" title="特殊的参数"></a>特殊的参数</h3></li>
<li>CharField    max_length</li>
<li>FixedCharField    max_length</li>
<li>DateTimeField    formats</li>
<li>DateField    formats</li>
<li>TimeField    formats</li>
<li>TimestampField    resolution, utc</li>
<li>DecimalField    max_digits, decimal_places, auto_round, rounding</li>
<li>ForeignKeyField    rel_model, related_name, to_field, on_delete, on_update, extra</li>
<li>BareField    coerce</li>
</ul>
<h2 id="连接数据库并生成表"><a href="#连接数据库并生成表" class="headerlink" title="连接数据库并生成表"></a>连接数据库并生成表</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def create_table():</span><br><span class="line">    db.connect()</span><br><span class="line">    db.create_tables([User, Tweet])</span><br></pre></td></tr></table></figure>
<h2 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h2><h3 id="插入记录"><a href="#插入记录" class="headerlink" title="插入记录"></a>插入记录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">charlie &#x3D; User.create(username&#x3D;&#39;charlie&#39;)</span><br><span class="line"></span><br><span class="line">huey &#x3D; User(username&#x3D;&#39;huey&#39;)</span><br><span class="line">huey.save()</span><br><span class="line"></span><br><span class="line"># 不需要设置 &#96;is_published&#96; 或 &#96;created_date&#96;，保存时会自动使用模型中指定的默认值</span><br><span class="line">Tweet.create(user&#x3D;charlie, message&#x3D;&#39;My first tweet&#39;)</span><br></pre></td></tr></table></figure>
<h3 id="查询单条记录"><a href="#查询单条记录" class="headerlink" title="查询单条记录"></a>查询单条记录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user &#x3D; User.get(User.id &#x3D;&#x3D; 1)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user &#x3D; User.get(User.username &#x3D;&#x3D; &#39;charlie&#39;)</span><br></pre></td></tr></table></figure>
<h3 id="查询多条记录"><a href="#查询多条记录" class="headerlink" title="查询多条记录"></a>查询多条记录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for user in User.select():</span><br><span class="line">    print(user.username)</span><br></pre></td></tr></table></figure>
<h3 id="多条件查询"><a href="#多条件查询" class="headerlink" title="多条件查询"></a>多条件查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tweet.select().where(Tweet.user &#x3D;&#x3D; user, Tweet.is_published &#x3D;&#x3D; True)</span><br></pre></td></tr></table></figure>
<h3 id="in查询，使用”-lt-lt-”来代入多个条件"><a href="#in查询，使用”-lt-lt-”来代入多个条件" class="headerlink" title="in查询，使用”&lt;&lt;”来代入多个条件"></a>in查询，使用”&lt;&lt;”来代入多个条件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">usernames &#x3D; [&#39;charlie&#39;, &#39;huey&#39;, &#39;mickey&#39;]</span><br><span class="line">users &#x3D; User.select().where(User.username &lt;&lt; usernames)</span><br></pre></td></tr></table></figure>

<h3 id="join查询"><a href="#join查询" class="headerlink" title="join查询"></a>join查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tweets &#x3D; (Tweet</span><br><span class="line">          .select()</span><br><span class="line">          .join(User)</span><br><span class="line">          .where(User.username &lt;&lt; usernames))</span><br></pre></td></tr></table></figure>
<h3 id="count"><a href="#count" class="headerlink" title="count"></a>count</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tweet.select().where(Tweet.id &gt; 50).count()</span><br></pre></td></tr></table></figure>
<h3 id="count今天发布了几条Twitter"><a href="#count今天发布了几条Twitter" class="headerlink" title="count今天发布了几条Twitter"></a>count今天发布了几条Twitter</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tweets_today &#x3D; (Tweet</span><br><span class="line">                .select()</span><br><span class="line">                .where(</span><br><span class="line">    (Tweet.created_date &gt;&#x3D; datetime.date.today()) &amp;</span><br><span class="line">    (Tweet.is_published &#x3D;&#x3D; True))</span><br><span class="line">                .count())</span><br></pre></td></tr></table></figure>
<h3 id="排序及分页"><a href="#排序及分页" class="headerlink" title="排序及分页"></a>排序及分页</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User.select().order_by(User.username).paginate(3, 20)</span><br><span class="line">Tweet.select().join(User).order_by(User.username, Tweet.created_date.desc())</span><br></pre></td></tr></table></figure>
<h3 id="join和gruopby，将用户按Twitter数排序"><a href="#join和gruopby，将用户按Twitter数排序" class="headerlink" title="join和gruopby，将用户按Twitter数排序"></a>join和gruopby，将用户按Twitter数排序</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tweet_ct &#x3D; fn.Count(Tweet.id)</span><br><span class="line">users &#x3D; (User</span><br><span class="line">         .select(User, tweet_ct.alias(&#39;ct&#39;))</span><br><span class="line">         .join(Tweet, JOIN.LEFT_OUTER)</span><br><span class="line">         .group_by(User)</span><br><span class="line">         .order_by(tweet_ct.desc()))</span><br></pre></td></tr></table></figure>
<h3 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">User.update(username&#x3D;&#39;foo&#39;).where(User.id &#x3D;&#x3D; 2).execute()</span><br><span class="line"></span><br><span class="line">user &#x3D; User.get(User.id &#x3D;&#x3D; 1)</span><br><span class="line">user.username&#x3D;&#39;bar&#39;</span><br><span class="line">user.save()</span><br></pre></td></tr></table></figure>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Tweet.delete().where(id&#x3D;&#x3D;1).execute()</span><br><span class="line"></span><br><span class="line">user &#x3D; User.get(User.id &#x3D;&#x3D; 8)</span><br><span class="line">user.delete_instance()</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201703/%E8%AE%B0%E4%B8%80%E6%AC%A1root%E7%94%A8%E6%88%B7su%E6%8A%A5%E9%94%99%E7%9A%84%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201703/%E8%AE%B0%E4%B8%80%E6%AC%A1root%E7%94%A8%E6%88%B7su%E6%8A%A5%E9%94%99%E7%9A%84%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">记一次root用户su报错的处理过程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-06 15:47:03" itemprop="dateCreated datePublished" datetime="2018-11-06T15:47:03+08:00">2018-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h2><ol>
<li>直接使用foobar用户SSH登录正常</li>
<li>在root用户下，执行<code>su - foobar</code>，报错：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su: cannot set user id: Resource temporarily unavailable</span><br></pre></td></tr></table></figure>
<p>只有su的时候报错，虽然不影响foobar用户正常的SSH远程登录，但这种资源受限的错误，一般都是系统崩溃的前兆，必须要较点真。</p>
<blockquote>
<p>系统：RHEL 6.5</p>
</blockquote>
<h2 id="排查过程"><a href="#排查过程" class="headerlink" title="排查过程"></a>排查过程</h2><h3 id="先按套路出牌"><a href="#先按套路出牌" class="headerlink" title="先按套路出牌"></a>先按套路出牌</h3><p>首先直接一通<code>free -m</code>、  <code>top</code>、  <code>vmstat</code>等等，试试运气<br>不过也不出所料，并没有什么收获。但这也算是个好消息，至少说明不像是系统级别的资源问题了。  </p>
<p>感觉八成是线程数或者文件打开数搞的鬼了，懒得监控日志，接着排查。  </p>
<h3 id="查看线程数"><a href="#查看线程数" class="headerlink" title="查看线程数"></a>查看线程数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;threads-max</span><br><span class="line">254529</span><br></pre></td></tr></table></figure>
<p>最大线程数254529，没有问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -u foobar -L | wc -l</span><br><span class="line">1045</span><br></pre></td></tr></table></figure>
<p>用户当前线程数1045，虽然挺高了，但这个用户下部署的应用也非常多，算是正常吧。</p>
<h3 id="检查ulimit"><a href="#检查ulimit" class="headerlink" title="检查ulimit"></a>检查ulimit</h3><ol>
<li><p>先用ulimit看一下设置的最大文件打开数<br>用foobar直接登录，然后执行：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ulimit -n</span><br><span class="line">655360</span><br></pre></td></tr></table></figure>
<p>显示655360，没有问题</p>
</li>
<li><p>然后用<code>lsof</code>统计一下当前的文件打开数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lsof | grep foobar | wc -l</span><br><span class="line">1690</span><br></pre></td></tr></table></figure>
<p>1690，大于1024有点多了，接下来仔细看一下。</p>
</li>
<li><p><code>lsof</code>大概的逐条分析一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lsof | grep foobar</span><br><span class="line">blablabla...</span><br><span class="line">blablabla...</span><br><span class="line">blablabla...</span><br></pre></td></tr></table></figure>
<p>既有文件，也有网络连接。不像是那种同时发起了大量网络连接造成的故障。这里算是PASS了。  </p>
</li>
</ol>
<h3 id="检查limits-conf配置"><a href="#检查limits-conf配置" class="headerlink" title="检查limits.conf配置"></a>检查limits.conf配置</h3><p>走到这里，还没查出问题，就有点意外了，索性再检查一下<code>limits.conf</code>吧</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;security&#x2F;limits.conf</span><br><span class="line"></span><br><span class="line">*    soft    nofile    655360</span><br><span class="line">*    hard    nofile    655360</span><br><span class="line">*    soft    noproc    655360</span><br><span class="line">*    hard    noproc    655360</span><br><span class="line">*    soft    core      0</span><br><span class="line">*    hard    core      0</span><br></pre></td></tr></table></figure>
<p>都是655360，一眼看上去没有问题（但这里有个坑，稍后会提到）</p>
<h3 id="检查各个profile配置"><a href="#检查各个profile配置" class="headerlink" title="检查各个profile配置"></a>检查各个profile配置</h3><p>再检查各个profile的配置，例如.bash_profile里是不是手工设置了过小的ulimit，导致登录失败。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;profile</span><br><span class="line">cat &#x2F;foobar&#x2F;.bash_profile</span><br></pre></td></tr></table></figure>
<p>都很正常，并没有添加多余的东西进去</p>
<h3 id="监控系统secure日志"><a href="#监控系统secure日志" class="headerlink" title="监控系统secure日志"></a>监控系统secure日志</h3><p>到这时都没发现出问题，只能监控系统日志<code>/var/log/secure</code>了。<br>一边监控，一边执行<code>su - foobar</code>：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tail -f &#x2F;var&#x2F;log&#x2F;secure</span><br><span class="line">blablabla...</span><br><span class="line"></span><br><span class="line">Mar 30 12:08:02 localhost crond[29226]: pam_limits(crond:session): unknown limit item &#39;noproc&#39;</span><br><span class="line"></span><br><span class="line">blablabla...</span><br></pre></td></tr></table></figure>
<p>终于抓到一个问题：<code>noproc</code>参数是个什么鬼，应该是<code>nproc</code>才对吧，估计管理员当时是直接手撸的，没有复制粘帖。  </p>
<p>于是赶紧修改limits.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;security&#x2F;limits.conf</span><br></pre></td></tr></table></figure>
<p>将</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*    soft    noproc    655360</span><br><span class="line">*    hard    noproc    655360</span><br></pre></td></tr></table></figure>
<p>改为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*    soft    nproc    655360</span><br><span class="line">*    hard    nproc    655360</span><br></pre></td></tr></table></figure>

<h3 id="山穷水尽"><a href="#山穷水尽" class="headerlink" title="山穷水尽"></a>山穷水尽</h3><p>解决完上面那个问题，以为这下可以su成功了吧，然而并没有，报错依旧。</p>
<p>于是继续监控<code>/var/log/secure</code>日志。现在报错变成了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Mar 30 12:10:25 localhost su: pam_unix(su-l:session): session opened for user foobar by monitor(uid&#x3D;0)</span><br><span class="line">Mar 30 12:10:25 localhost su: pam_unix(su-l:session): session closed for user foobar</span><br></pre></td></tr></table></figure>
<p>这种报错，相当于什么也没说啊。看来接下来，想要解决问题，只能靠猜了。  </p>
<p>一通google之后，找到了这么一句话：  </p>
<blockquote>
<p>In Red Hat Enterprise Linux 6, there’s a default setting in /etc/security/limits.d/90-nproc.conf. Change the default limit for all users or add a new limit for the affected user.</p>
</blockquote>
<p>这个<code>limits.d/90-nproc.conf</code>之前从没有注意过，难道它会覆盖 <code>limits.conf</code> 吗？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;security&#x2F;limits.d&#x2F;90-nproc.conf</span><br><span class="line">*          soft    nproc     1024</span><br><span class="line">root       soft    nproc     unlimited</span><br></pre></td></tr></table></figure>
<p>这里的值是1024，尝试改大一点，碰碰运气：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;security&#x2F;limits.d&#x2F;90-nproc.conf</span><br><span class="line">*          soft    nproc     10240</span><br><span class="line">root       soft    nproc     unlimited</span><br></pre></td></tr></table></figure>
<p>然后<code>su - foobar</code> ，竟然成功了。</p>
<h2 id="经验值-3"><a href="#经验值-3" class="headerlink" title="经验值+3"></a>经验值+3</h2><p>到此为止，两个坑都已经被填上了。耗时15分钟，经验值+3：  </p>
<ol>
<li>遇到类似问题，直接监控<code>/var/log/secure</code>，可以少走些弯路  </li>
<li>注意<code>/etc/security/limits.conf</code>的参数拼写  </li>
<li>竟然还有<code>/etc/security/limits.d/90-nproc.conf</code>这么个东西，且生效的时机诡异（只影响su，直接登录不受影响）  </li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/22/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/22/">22</a><span class="page-number current">23</span><a class="page-number" href="/page/24/">24</a><span class="space">&hellip;</span><a class="page-number" href="/page/28/">28</a><a class="extend next" rel="next" href="/page/24/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">BlueXIII</p>
  <div class="site-description" itemprop="description">IT技术类文章、笔记分享</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">273</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/xiiiblue" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;xiiiblue" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/bluexiii" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;bluexiii" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备18050487号-1 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BlueXIII</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
