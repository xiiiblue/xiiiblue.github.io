<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.bluexiii.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="IT技术类文章、笔记分享">
<meta property="og:type" content="website">
<meta property="og:title" content="BlueXIII&#39;s Blog">
<meta property="og:url" content="http://www.bluexiii.com/page/4/index.html">
<meta property="og:site_name" content="BlueXIII&#39;s Blog">
<meta property="og:description" content="IT技术类文章、笔记分享">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="BlueXIII">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://www.bluexiii.com/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>BlueXIII's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">BlueXIII's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">热爱技术,持续学习</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202305/Rancher%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202305/Rancher%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B2/" class="post-title-link" itemprop="url">Rancher离线部署</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-05-29 14:29:06" itemprop="dateCreated datePublished" datetime="2023-05-29T14:29:06+08:00">2023-05-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-06-27 11:21:20" itemprop="dateModified" datetime="2024-06-27T11:21:20+08:00">2024-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://ranchermanager.docs.rancher.com/zh/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/install-rancher-ha">https://ranchermanager.docs.rancher.com/zh/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/install-rancher-ha</a></li>
<li><a target="_blank" rel="noopener" href="https://ranchermanager.docs.rancher.com/zh/pages-for-subheaders/other-installation-methods#%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85">https://ranchermanager.docs.rancher.com/zh/pages-for-subheaders/other-installation-methods#%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85</a></li>
<li><a target="_blank" rel="noopener" href="https://ranchermanager.docs.rancher.com/zh/pages-for-subheaders/install-upgrade-on-a-kubernetes-cluster">https://ranchermanager.docs.rancher.com/zh/pages-for-subheaders/install-upgrade-on-a-kubernetes-cluster</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/4af939917851">https://www.jianshu.com/p/4af939917851</a></li>
</ul>
<h2 id="Helm方式部署"><a href="#Helm方式部署" class="headerlink" title="Helm方式部署"></a>Helm方式部署</h2><h3 id="cert-manager安装"><a href="#cert-manager安装" class="headerlink" title="cert-manager安装"></a>cert-manager安装</h3><p>镜像清单:  </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">quay.io/jetstack/cert-manager-acmesolver:v1.11.0</span><br><span class="line">quay.io/jetstack/cert-manager-cainjector:v1.11.0</span><br><span class="line">quay.io/jetstack/cert-manager-controller:v1.11.0</span><br><span class="line">quay.io/jetstack/cert-manager-ctl:v1.11.0</span><br><span class="line">quay.io/jetstack/cert-manager-webhook:v1.11.0</span><br></pre></td></tr></table></figure>
<p>安装:  </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装crd</span></span><br><span class="line">wget https://github.com/cert-manager/cert-manager/releases/download/v1.11.0/cert-manager.crds.yaml</span><br><span class="line">kubectl apply -f cert-manager.crds.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装chart</span></span><br><span class="line">helm repo add jetstack https://charts.jetstack.io</span><br><span class="line">helm pull jetstack/cert-manager --version=v1.11.0</span><br><span class="line">helm install cert-manager ./cert-manager --namespace cert-manager </span><br></pre></td></tr></table></figure>
<h3 id="rancher安装"><a href="#rancher安装" class="headerlink" title="rancher安装"></a>rancher安装</h3><p>镜像清单:  </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rancher/rancher:v2.7.3</span><br><span class="line">rancher/shell:v0.1.19</span><br><span class="line">rancher/gitjob:v0.1.37</span><br><span class="line">rancher/rancher-webhook:v0.3.3</span><br><span class="line">rancher/fleet:v0.6.0</span><br><span class="line">rancher/fleet-agent:v0.6.0</span><br></pre></td></tr></table></figure>
<p>安装:  </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># helm安装</span></span><br><span class="line">helm repo add rancher-stable https://releases.rancher.com/server-charts/stable</span><br><span class="line">helm search repo rancher-stable/rancher --versions  <span class="comment"># 2.7.3</span></span><br><span class="line">helm pull rancher-stable/rancher --version=2.7.3</span><br><span class="line">helm install rancher ./rancher \</span><br><span class="line">  --namespace cattle-system \</span><br><span class="line">  --<span class="built_in">set</span> hostname=rancher.dubhe \</span><br><span class="line">  --<span class="built_in">set</span> bootstrapPassword=admin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看初始密码</span></span><br><span class="line"><span class="built_in">echo</span> https://rancher.dubhe/dashboard/?setup=$(kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=<span class="string">&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#x27;</span>)</span><br><span class="line">kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=<span class="string">&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#123;&#123; &quot;\n&quot; &#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202305/%E5%B8%B8%E7%94%A8%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%98%E6%96%B9Helm%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202305/%E5%B8%B8%E7%94%A8%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%AE%98%E6%96%B9Helm%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">常用中间件官方Helm安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-05-29 14:25:09" itemprop="dateCreated datePublished" datetime="2023-05-29T14:25:09+08:00">2023-05-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-06-27 11:24:06" itemprop="dateModified" datetime="2024-06-27T11:24:06+08:00">2024-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><p><a target="_blank" rel="noopener" href="https://artifacthub.io/packages/helm/bitnami/mysql">https://artifacthub.io/packages/helm/bitnami/mysql</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加仓库</span></span><br><span class="line">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br><span class="line">helm repo update</span><br><span class="line"><span class="comment"># 拉取chart(可选)</span></span><br><span class="line">helm pull bitnami/mysql --version 9.9.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 离线安装</span></span><br><span class="line">dockemon chart bitnami mysql 9.9.1</span><br><span class="line">helm install mysql ./mysql --namespace mysql --create-namespace</span><br><span class="line">helm status mysql -n mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># DNS</span></span><br><span class="line">mysql.mysql.svc.cluster.local:3306</span><br><span class="line"><span class="comment"># 查看root用户名</span></span><br><span class="line">MYSQL_ROOT_PASSWORD=$(kubectl get secret --namespace mysql mysql -o jsonpath=<span class="string">&quot;&#123;.data.mysql-root-password&#125;&quot;</span> | base64 -d)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$MYSQL_ROOT_PASSWORD</span>  <span class="comment"># rVrmiKcXOo</span></span><br><span class="line"><span class="comment"># 运行客户端</span></span><br><span class="line">kubectl run mysql-client --rm --tty -i --restart=<span class="string">&#x27;Never&#x27;</span> --image  docker.io/bitnami/mysql:8.0.33-debian-11-r7 --namespace mysql --env MYSQL_ROOT_PASSWORD=<span class="variable">$MYSQL_ROOT_PASSWORD</span> --<span class="built_in">command</span> -- bash</span><br><span class="line">mysql -h mysql.mysql.svc.cluster.local -uroot -p<span class="string">&quot;<span class="variable">$MYSQL_ROOT_PASSWORD</span>&quot;</span></span><br><span class="line"><span class="comment"># 本机port-forward</span></span><br><span class="line">kubectl port-forward --namespace mysql svc/mysql 3306:3306</span><br></pre></td></tr></table></figure>
<h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><p><a target="_blank" rel="noopener" href="https://artifacthub.io/packages/helm/bitnami/redis">https://artifacthub.io/packages/helm/bitnami/redis</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加仓库</span></span><br><span class="line">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br><span class="line">helm repo update</span><br><span class="line"><span class="comment"># 查看所有版本号</span></span><br><span class="line">helm search repo bitnami/redis --versions --devel</span><br><span class="line"><span class="comment"># 拉取chart(可选)</span></span><br><span class="line">helm pull bitnami/redis --version 17.10.3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 离线安装</span></span><br><span class="line">dockemon chart bitnami redis 17.10.3</span><br><span class="line">helm install redis ./redis --namespace redis --create-namespace</span><br><span class="line">helm status redis -n redis</span><br><span class="line"></span><br><span class="line"><span class="comment"># DNS</span></span><br><span class="line">redis-master.redis.svc.cluster.local <span class="keyword">for</span> <span class="built_in">read</span>/write operations (port 6379)</span><br><span class="line">redis-replicas.redis.svc.cluster.local <span class="keyword">for</span> read-only operations (port 6379)</span><br><span class="line"><span class="comment"># 查看密码</span></span><br><span class="line"><span class="built_in">export</span> REDIS_PASSWORD=$(kubectl get secret --namespace redis redis -o jsonpath=<span class="string">&quot;&#123;.data.redis-password&#125;&quot;</span> | base64 -d)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$REDIS_PASSWORD</span> <span class="comment"># 4BEkvq5vdW</span></span><br><span class="line"><span class="comment"># 运行Client</span></span><br><span class="line">kubectl run --namespace redis redis-client --restart=<span class="string">&#x27;Never&#x27;</span>  --env REDIS_PASSWORD=<span class="variable">$REDIS_PASSWORD</span>  --image docker.io/bitnami/redis:7.0.11-debian-11-r7 --<span class="built_in">command</span> -- sleep infinity</span><br><span class="line">kubectl <span class="built_in">exec</span> --tty -i redis-client --namespace redis -- bash</span><br><span class="line">REDISCLI_AUTH=<span class="string">&quot;<span class="variable">$REDIS_PASSWORD</span>&quot;</span> redis-cli -h redis-master</span><br><span class="line"><span class="comment"># 本机port-forward</span></span><br><span class="line">kubectl port-forward --namespace redis svc/redis-master 6379:6379</span><br><span class="line">REDISCLI_AUTH=<span class="string">&quot;<span class="variable">$REDIS_PASSWORD</span>&quot;</span> redis-cli -h 127.0.0.1 -p 6379</span><br></pre></td></tr></table></figure>
<h2 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h2><p><a target="_blank" rel="noopener" href="https://artifacthub.io/packages/helm/bitnami/zookeeper">https://artifacthub.io/packages/helm/bitnami/zookeeper</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加仓库</span></span><br><span class="line">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br><span class="line">helm repo update</span><br><span class="line"><span class="comment"># 查看所有版本号</span></span><br><span class="line">helm search repo bitnami/zookeeper --versions --devel</span><br><span class="line"><span class="comment"># 拉取chart(可选)</span></span><br><span class="line">helm pull bitnami/zookeeper --version 11.3.2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 离线安装</span></span><br><span class="line">dockemon chart bitnami zookeeper 11.3.2</span><br><span class="line">helm install zookeeper ./zookeeper --namespace zookeeper --create-namespace</span><br><span class="line">helm status zookeeper -n zookeeper</span><br><span class="line"></span><br><span class="line"><span class="comment"># DNS</span></span><br><span class="line">zookeeper.zookeeper.svc.cluster.local</span><br><span class="line"><span class="comment"># 客户端</span></span><br><span class="line"><span class="built_in">export</span> POD_NAME=$(kubectl get pods --namespace zookeeper -l <span class="string">&quot;app.kubernetes.io/name=zookeeper,app.kubernetes.io/instance=zookeeper,app.kubernetes.io/component=zookeeper&quot;</span> -o jsonpath=<span class="string">&quot;&#123;.items[0].metadata.name&#125;&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$POD_NAME</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it  --namespace zookeeper <span class="variable">$POD_NAME</span> -- zkCli.sh</span><br><span class="line"><span class="comment"># 本机port-forward</span></span><br><span class="line">kubectl port-forward --namespace zookeeper svc/zookeeper 2181:2181</span><br><span class="line">zkCli.sh 127.0.0.1:2181</span><br></pre></td></tr></table></figure>
<h2 id="Minio"><a href="#Minio" class="headerlink" title="Minio"></a>Minio</h2><p><a target="_blank" rel="noopener" href="https://helm.min.io/">https://helm.min.io/</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加仓库</span></span><br><span class="line">helm repo add minio https://helm.min.io/</span><br><span class="line">helm update</span><br><span class="line"><span class="comment"># 查看所有版本号</span></span><br><span class="line">helm search repo minio/minio --versions --devel</span><br><span class="line"><span class="comment"># 拉取chart(可选)</span></span><br><span class="line">helm pull minio/minio --version 8.0.10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 离线安装</span></span><br><span class="line">dockemon chart minio minio 8.0.10</span><br><span class="line">helm install minio ./minio --namespace minio --create-namespace</span><br><span class="line">helm status minio -n minio</span><br><span class="line"></span><br><span class="line"><span class="comment"># 本机portforward</span></span><br><span class="line"><span class="built_in">export</span> POD_NAME=$(kubectl get pods --namespace minio -l <span class="string">&quot;release=minio&quot;</span> -o jsonpath=<span class="string">&quot;&#123;.items[0].metadata.name&#125;&quot;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$POD_NAME</span></span><br><span class="line">kubectl port-forward <span class="variable">$POD_NAME</span> 9000 --namespace minio</span><br><span class="line"><span class="comment"># 查看access_key/secret_key</span></span><br><span class="line">ACCESS_KEY=$(kubectl get secret minio --namespace minio -o jsonpath=<span class="string">&quot;&#123;.data.accesskey&#125;&quot;</span> | base64 --decode) </span><br><span class="line">SECRET_KEY=$(kubectl get secret minio --namespace minio -o jsonpath=<span class="string">&quot;&#123;.data.secretkey&#125;&quot;</span> | base64 --decode)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$ACCESS_KEY</span> <span class="variable">$SECRET_KEY</span></span><br></pre></td></tr></table></figure>

<h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><p><a target="_blank" rel="noopener" href="https://artifacthub.io/packages/helm/bitnami/nginx">https://artifacthub.io/packages/helm/bitnami/nginx</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加仓库</span></span><br><span class="line">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br><span class="line">helm repo update</span><br><span class="line"><span class="comment"># 查看所有版本号</span></span><br><span class="line">helm search repo bitnami/nginx --versions --devel</span><br><span class="line"><span class="comment"># 拉取chart(可选)</span></span><br><span class="line">helm pull bitnami/nginx --version 14.2.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 离线安装</span></span><br><span class="line">dockemon chart bitnami nginx 14.2.1</span><br><span class="line">helm install nginx ./nginx --namespace nginx --create-namespace</span><br><span class="line">helm status nginx -n nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> SERVICE_PORT=$(kubectl get --namespace nginx -o jsonpath=<span class="string">&quot;&#123;.spec.ports[0].port&#125;&quot;</span> services nginx)</span><br><span class="line"><span class="built_in">export</span> SERVICE_IP=$(kubectl get svc --namespace nginx nginx -o jsonpath=<span class="string">&#x27;&#123;.status.loadBalancer.ingress[0].ip&#125;&#x27;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;http://<span class="variable">$&#123;SERVICE_IP&#125;</span>:<span class="variable">$&#123;SERVICE_PORT&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="Neo4j"><a href="#Neo4j" class="headerlink" title="Neo4j"></a>Neo4j</h2><p><a target="_blank" rel="noopener" href="https://github.com/neo4j-contrib/neo4j-helm">https://github.com/neo4j-contrib/neo4j-helm</a><br><a target="_blank" rel="noopener" href="https://artifacthub.io/packages/helm/neo4j-helm-charts/neo4j">https://artifacthub.io/packages/helm/neo4j-helm-charts/neo4j</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑镜像清单</span></span><br><span class="line">dockemon edit</span><br><span class="line">neo4j:4.4.10-enterprise</span><br><span class="line">gcr.io/neo4j-helm/restore:4.1.0-1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送离线镜像</span></span><br><span class="line">dockemon image</span><br><span class="line"></span><br><span class="line"><span class="comment"># 手工下载Chart</span></span><br><span class="line">https://github.com/neo4j-contrib/neo4j-helm/releases</span><br><span class="line">tar -zxvf neo4j-4.4.10.1.tgz &amp; <span class="built_in">cd</span> neo4j</span><br><span class="line"><span class="comment"># 注意修改values.yaml，pvc.size改小</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Chart安装</span></span><br><span class="line">helm install neo4j ./neo4j --<span class="built_in">set</span> core.standalone=<span class="literal">true</span> --<span class="built_in">set</span> acceptLicenseAgreement=yes --<span class="built_in">set</span> neo4jPassword=abcd1234 --namespace neo4j --create-namespace</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202305/Longhorn%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202305/Longhorn%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B2/" class="post-title-link" itemprop="url">Longhorn离线部署</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-05-29 14:24:44" itemprop="dateCreated datePublished" datetime="2023-05-29T14:24:44+08:00">2023-05-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-06-27 11:20:44" itemprop="dateModified" datetime="2024-06-27T11:20:44+08:00">2024-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.k3s.io/zh/storage">https://docs.k3s.io/zh/storage</a></li>
<li><a target="_blank" rel="noopener" href="https://longhorn.io/docs/1.4.1/">https://longhorn.io/docs/1.4.1/</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/longhorn/longhorn">https://github.com/longhorn/longhorn</a></li>
<li><a target="_blank" rel="noopener" href="https://ranchermanager.docs.rancher.com/zh/integrations-in-rancher/longhorn">https://ranchermanager.docs.rancher.com/zh/integrations-in-rancher/longhorn</a></li>
</ul>
<h2 id="版本选择"><a href="#版本选择" class="headerlink" title="版本选择"></a>版本选择</h2><p>1.4.1</p>
<h2 id="镜像列表"><a href="#镜像列表" class="headerlink" title="镜像列表"></a>镜像列表</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">longhornio/backing-image-manager:v1.4.2</span><br><span class="line">longhornio/csi-attacher:v3.4.0</span><br><span class="line">longhornio/csi-node-driver-registrar:v2.7.0</span><br><span class="line">longhornio/csi-provisioner:v2.1.2</span><br><span class="line">longhornio/csi-provisioner:v3.4.1</span><br><span class="line">longhornio/csi-resizer:v1.3.0</span><br><span class="line">longhornio/csi-snapshotter:v5.0.1</span><br><span class="line">longhornio/livenessprobe:v2.8.0</span><br><span class="line">longhornio/livenessprobe:v2.9.0</span><br><span class="line">longhornio/longhorn-engine:v1.4.2</span><br><span class="line">longhornio/longhorn-instance-manager:v1.4.2</span><br><span class="line">longhornio/longhorn-manager:v1.4.2</span><br><span class="line">longhornio/longhorn-share-manager:v1.4.2</span><br><span class="line">longhornio/longhorn-ui:v1.4.2</span><br><span class="line">longhornio/support-bundle-kit:v0.0.24</span><br></pre></td></tr></table></figure>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># helm下载</span></span><br><span class="line">helm repo add longhorn https://charts.longhorn.io</span><br><span class="line">helm repo update</span><br><span class="line">helm pull longhorn/longhorn</span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数调整</span></span><br><span class="line">defaultClassReplicaCount: 1</span><br><span class="line">defaultDataLocality: best-effort <span class="comment"># best-effort otherwise</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">helm install longhorn ./longhorn_chart --namespace longhorn --create-namespace</span><br><span class="line"><span class="comment"># 更新</span></span><br><span class="line">helm upgrade longhorn ./longhorn_chart --namespace longhorn --create-namespace</span><br><span class="line"><span class="comment"># 删除</span></span><br><span class="line">helm uninstall longhorn -n longhorn</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="添加自定义StorageClass"><a href="#添加自定义StorageClass" class="headerlink" title="添加自定义StorageClass"></a>添加自定义StorageClass</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">StorageClass</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">longhorn-retain</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">storageclass.kubernetes.io/is-default-class:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">    <span class="attr">storageclass.kubesphere.io/allow-clone:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">    <span class="attr">storageclass.kubesphere.io/allow-snapshot:</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line"><span class="attr">provisioner:</span> <span class="string">driver.longhorn.io</span></span><br><span class="line"><span class="attr">parameters:</span></span><br><span class="line">  <span class="attr">dataLocality:</span> <span class="string">best-effort</span></span><br><span class="line">  <span class="attr">fromBackup:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="attr">fsType:</span> <span class="string">ext4</span></span><br><span class="line">  <span class="attr">numberOfReplicas:</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line">  <span class="attr">staleReplicaTimeout:</span> <span class="string">&#x27;30&#x27;</span></span><br><span class="line"><span class="attr">reclaimPolicy:</span> <span class="string">Retain</span></span><br><span class="line"><span class="attr">allowVolumeExpansion:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">volumeBindingMode:</span> <span class="string">Immediate</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202305/KubeSphere%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202305/KubeSphere%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B2/" class="post-title-link" itemprop="url">KubeSphere离线部署</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-05-29 14:24:17" itemprop="dateCreated datePublished" datetime="2023-05-29T14:24:17+08:00">2023-05-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-06-27 11:20:29" itemprop="dateModified" datetime="2024-06-27T11:20:29+08:00">2024-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="https://kubesphere.io/zh/docs/v3.3/installing-on-kubernetes/on-prem-kubernetes/install-ks-on-linux-airgapped/">https://kubesphere.io/zh/docs/v3.3/installing-on-kubernetes/on-prem-kubernetes/install-ks-on-linux-airgapped/</a></p>
<h2 id="版本选择"><a href="#版本选择" class="headerlink" title="版本选择"></a>版本选择</h2><ul>
<li>Kubernetes: v1.24.13+k3s1</li>
<li>KubeSphere: v3.3.1</li>
</ul>
<h2 id="导入镜像"><a href="#导入镜像" class="headerlink" title="导入镜像"></a>导入镜像</h2><p>使用<code>dockemon</code>工具将镜像离线导入Harbor</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">kubesphere/ks-installer:v3.3.1</span><br><span class="line">kubesphere/ks-apiserver:v3.3.1</span><br><span class="line">kubesphere/ks-console:v3.3.1</span><br><span class="line">kubesphere/ks-controller-manager:v3.3.1</span><br><span class="line">kubesphere/ks-upgrade:v3.3.1</span><br><span class="line">kubesphere/kubectl:v1.22.0</span><br><span class="line">kubesphere/kubectl:v1.21.0</span><br><span class="line">kubesphere/kubectl:v1.20.0</span><br><span class="line">kubesphere/kubefed:v0.8.1</span><br><span class="line">kubesphere/tower:v0.2.0</span><br><span class="line">minio/minio:RELEASE.2019-08-07T01-59-21Z</span><br><span class="line">minio/mc:RELEASE.2019-08-07T23-14-43Z</span><br><span class="line">csiplugin/snapshot-controller:v4.0.0</span><br><span class="line">kubesphere/nginx-ingress-controller:v1.1.0</span><br><span class="line">mirrorgooglecontainers/defaultbackend-amd64:1.4</span><br><span class="line">kubesphere/metrics-server:v0.4.2</span><br><span class="line">redis:5.0.14-alpine</span><br><span class="line">haproxy:2.0.25-alpine</span><br><span class="line">alpine:3.14</span><br><span class="line">osixia/openldap:1.3.0</span><br><span class="line">kubesphere/netshoot:v1.0</span><br><span class="line">jimmidyson/configmap-reload:v0.5.0</span><br><span class="line">prom/prometheus:v2.34.0</span><br><span class="line">kubesphere/prometheus-config-reloader:v0.55.1</span><br><span class="line">kubesphere/prometheus-operator:v0.55.1</span><br><span class="line">kubesphere/kube-rbac-proxy:v0.11.0</span><br><span class="line">kubesphere/kube-state-metrics:v2.5.0</span><br><span class="line">prom/node-exporter:v1.3.1</span><br><span class="line">prom/alertmanager:v0.23.0</span><br><span class="line">thanosio/thanos:v0.25.2</span><br><span class="line">grafana/grafana:8.3.3</span><br><span class="line">kubesphere/kube-rbac-proxy:v0.8.0</span><br><span class="line">kubesphere/notification-manager-operator:v1.4.0</span><br><span class="line">kubesphere/notification-manager:v1.4.0</span><br><span class="line">kubesphere/notification-tenant-sidecar:v3.2.0</span><br><span class="line">kubesphere/elasticsearch-curator:v5.7.6</span><br><span class="line">kubesphere/elasticsearch-oss:6.8.22</span><br><span class="line">kubesphere/fluentbit-operator:v0.13.0</span><br><span class="line">docker:19.03</span><br><span class="line">kubesphere/fluent-bit:v1.8.11</span><br><span class="line">kubesphere/log-sidecar-injector:1.1</span><br><span class="line">elastic/filebeat:6.7.0</span><br><span class="line">kubesphere/kube-events-operator:v0.4.0</span><br><span class="line">kubesphere/kube-events-exporter:v0.4.0</span><br><span class="line">kubesphere/kube-events-ruler:v0.4.0</span><br><span class="line">kubesphere/kube-auditing-operator:v0.2.0</span><br><span class="line">kubesphere/kube-auditing-webhook:v0.2.0</span><br><span class="line">kubesphere/devops-tools:v3.3.1</span><br><span class="line">kubesphere/devops-controller:v3.3.1</span><br><span class="line">kubesphere/devops-apiserver:v3.3.1</span><br><span class="line">kubesphere/ks-jenkins:v3.3.0-2.319.1</span><br><span class="line">kubesphere/s2ioperator:v3.2.1</span><br><span class="line">redis:6.2.6-alpine</span><br><span class="line">quay.io/argoproj/argocd:v2.3.3</span><br><span class="line">quay.io/argoproj/argocd-applicationset:v0.4.1</span><br><span class="line">ghcr.io/dexidp/dex:v2.30.2</span><br><span class="line">kubesphere/builder-nodejs:v3.2.0-podman</span><br><span class="line">kubesphere/builder-maven:v3.2.0-podman</span><br><span class="line">jenkins/inbound-agent:4.10-2</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">harbor.dubhe:30002/library/alpine:3.14</span><br><span class="line">harbor.dubhe:30002/library/redis:5.0.14-alpine</span><br><span class="line">harbor.dubhe:30002/kubesphere/ks-console:v3.3.1</span><br><span class="line">harbor.dubhe:30002/kubesphere/ks-controller-manager:v3.3.1</span><br><span class="line">harbor.dubhe:30002/kubesphere/ks-installer:v3.3.1</span><br><span class="line">harbor.dubhe:30002/kubesphere/ks-apiserver:v3.3.1</span><br><span class="line">harbor.dubhe:30002/kubesphere/ks-upgrade:v3.3.1</span><br><span class="line">harbor.dubhe:30002/kubesphere/kube-state-metrics:v2.5.0</span><br><span class="line">harbor.dubhe:30002/kubesphere/fluent-bit:v1.8.11</span><br><span class="line">harbor.dubhe:30002/kubesphere/prometheus-config-reloader:v0.55.1</span><br><span class="line">harbor.dubhe:30002/kubesphere/prometheus-operator:v0.55.1</span><br><span class="line">harbor.dubhe:30002/thanosio/thanos:v0.25.2</span><br><span class="line">harbor.dubhe:30002/prom/prometheus:v2.34.0</span><br><span class="line">harbor.dubhe:30002/kubesphere/fluentbit-operator:v0.13.0</span><br><span class="line">harbor.dubhe:30002/kubesphere/kube-events-ruler:v0.4.0</span><br><span class="line">harbor.dubhe:30002/kubesphere/kube-events-operator:v0.4.0</span><br><span class="line">harbor.dubhe:30002/kubesphere/kube-events-exporter:v0.4.0</span><br><span class="line">harbor.dubhe:30002/kubesphere/elasticsearch-oss:6.8.22</span><br><span class="line">harbor.dubhe:30002/grafana/grafana:8.3.3</span><br><span class="line">harbor.dubhe:30002/prom/node-exporter:v1.3.1</span><br><span class="line">harbor.dubhe:30002/library/haproxy:2.0.25-alpine</span><br><span class="line">harbor.dubhe:30002/kubesphere/nginx-ingress-controller:v1.1.0</span><br><span class="line">harbor.dubhe:30002/kubesphere/kubectl:v1.22.0</span><br><span class="line">harbor.dubhe:30002/kubesphere/kubectl:v1.21.0</span><br><span class="line">harbor.dubhe:30002/kubesphere/notification-manager:v1.4.0</span><br><span class="line">harbor.dubhe:30002/kubesphere/notification-tenant-sidecar:v3.2.0</span><br><span class="line">harbor.dubhe:30002/kubesphere/notification-manager-operator:v1.4.0</span><br><span class="line">harbor.dubhe:30002/kubesphere/kubefed:v0.8.1</span><br><span class="line">harbor.dubhe:30002/prom/alertmanager:v0.23.0</span><br><span class="line">harbor.dubhe:30002/kubesphere/kube-auditing-operator:v0.2.0</span><br><span class="line">harbor.dubhe:30002/kubesphere/kube-auditing-webhook:v0.2.0</span><br><span class="line">harbor.dubhe:30002/kubesphere/kube-rbac-proxy:v0.11.0</span><br><span class="line">harbor.dubhe:30002/kubesphere/kubectl:v1.20.0</span><br><span class="line">harbor.dubhe:30002/kubesphere/tower:v0.2.0</span><br><span class="line">harbor.dubhe:30002/library/docker:19.03</span><br><span class="line">harbor.dubhe:30002/kubesphere/metrics-server:v0.4.2</span><br><span class="line">harbor.dubhe:30002/jimmidyson/configmap-reload:v0.5.0</span><br><span class="line">harbor.dubhe:30002/csiplugin/snapshot-controller:v4.0.0</span><br><span class="line">harbor.dubhe:30002/kubesphere/kube-rbac-proxy:v0.8.0</span><br><span class="line">harbor.dubhe:30002/kubesphere/log-sidecar-injector:1.1</span><br><span class="line">harbor.dubhe:30002/osixia/openldap:1.3.0</span><br><span class="line">harbor.dubhe:30002/kubesphere/elasticsearch-curator:v5.7.6</span><br><span class="line">harbor.dubhe:30002/minio/mc:RELEASE.2019-08-07T23-14-43Z</span><br><span class="line">harbor.dubhe:30002/minio/minio:RELEASE.2019-08-07T01-59-21Z</span><br><span class="line">harbor.dubhe:30002/elastic/filebeat:6.7.0</span><br><span class="line">harbor.dubhe:30002/kubesphere/netshoot:v1.0</span><br><span class="line">harbor.dubhe:30002/mirrorgooglecontainers/defaultbackend-amd64:1.4</span><br></pre></td></tr></table></figure>
<h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载安装工具</span></span><br><span class="line">curl -L -O https://github.com/kubesphere/ks-installer/releases/download/v3.3.1/offline-installation-tool.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载部署脚本</span></span><br><span class="line">curl -L -O https://github.com/kubesphere/ks-installer/releases/download/v3.3.1/cluster-configuration.yaml</span><br><span class="line">curl -L -O https://github.com/kubesphere/ks-installer/releases/download/v3.3.1/kubesphere-installer.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改为本地仓库(可选项)</span></span><br><span class="line">vi cluster-configuration.yaml</span><br><span class="line">spec.local_registry: <span class="string">&quot;harbor.dubhe:30002&quot;</span></span><br><span class="line">sed -i <span class="string">&quot;s#^\s*image: kubesphere.*/ks-installer:.*#        image: harbor.dubhe:30002/kubesphere/ks-installer:v3.0.0#&quot;</span> kubesphere-installer.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始安装</span></span><br><span class="line">kubectl apply -f kubesphere-installer.yaml</span><br><span class="line">kubectl apply -f cluster-configuration.yaml</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202305/TiDB%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202305/TiDB%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B2/" class="post-title-link" itemprop="url">KubeSphere离线部署</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-05-29 14:23:55" itemprop="dateCreated datePublished" datetime="2023-05-29T14:23:55+08:00">2023-05-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-06-27 11:20:37" itemprop="dateModified" datetime="2024-06-27T11:20:37+08:00">2024-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://docs.pingcap.com/zh/tidb-in-kubernetes/v1.5/prerequisites">https://docs.pingcap.com/zh/tidb-in-kubernetes/v1.5/prerequisites</a></p>
<h2 id="镜像列表"><a href="#镜像列表" class="headerlink" title="镜像列表"></a>镜像列表</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">alpine:3.16.0</span><br><span class="line">bitnami/kubectl:latest</span><br><span class="line">busybox:1.26.2</span><br><span class="line">grafana/grafana:6.0.1</span><br><span class="line">grafana/grafana:7.5.7</span><br><span class="line">k8s.gcr.io/kube-scheduler:v1.24.13</span><br><span class="line">pingcap/advanced-statefulset:v0.3.3</span><br><span class="line">pingcap/advanced-statefulset:v0.4.0</span><br><span class="line">pingcap/ng-monitoring:v6.5.0</span><br><span class="line">pingcap/pd:v6.5.0</span><br><span class="line">pingcap/ticdc:v6.5.0</span><br><span class="line">pingcap/tidb-backup-manager:v1.5.0-beta.1</span><br><span class="line">pingcap/tidb-binlog:v6.5.0</span><br><span class="line">pingcap/tidb-dashboard:v6.5.0</span><br><span class="line">pingcap/tidb-monitor-initializer:v6.5.0</span><br><span class="line">pingcap/tidb-monitor-reloader:v1.0.1</span><br><span class="line">pingcap/tidb-operator:v1.5.0-beta.1</span><br><span class="line">pingcap/tidb:v6.5.0</span><br><span class="line">pingcap/tiflash:v6.5.0</span><br><span class="line">pingcap/tikv:v6.5.0</span><br><span class="line">prom/prometheus:v2.18.1</span><br><span class="line">quay.io/prometheus-operator/prometheus-config-reloader:v0.49.0</span><br><span class="line">tnir/mysqlclient:latest</span><br></pre></td></tr></table></figure>
<p>注意手工处理一下kube-scheduler镜像，将其移动到默认库中。并同时修改TidbOperator的values.yaml:  </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nerdctl tag harbor.dubhe:30002/k8s.gcr.io/kube-scheduler:v1.24.13 harbor.dubhe:30002/library/kube-scheduler:v1.24.13</span><br><span class="line">nerdctl push harbor.dubhe:30002/library/kube-scheduler:v1.24.13</span><br></pre></td></tr></table></figure>
<h2 id="使用Helm安装tidb-operator"><a href="#使用Helm安装tidb-operator" class="headerlink" title="使用Helm安装tidb-operator"></a>使用Helm安装tidb-operator</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget http://charts.pingcap.org/tidb-operator-v1.5.0-beta.1.tgz <span class="comment"># 下载HelmRepo</span></span><br><span class="line">tar -zxvf tidb-operator-v1.5.0-beta.1.tgz</span><br><span class="line"></span><br><span class="line">helm install tidb-operator ./tidb-operator --namespace=tidb-admin --create-namespace</span><br></pre></td></tr></table></figure>
<h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><p>yaml示例:<br><a target="_blank" rel="noopener" href="https://github.com/pingcap/tidb-operator/blob/master/examples/advanced/tidb-cluster.yaml">https://github.com/pingcap/tidb-operator/blob/master/examples/advanced/tidb-cluster.yaml</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建CRD</span></span><br><span class="line">kubectl create -f ./crd.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改tidb-cluster.yaml</span></span><br><span class="line">name: tidb-dubhe</span><br><span class="line">namespace: default  <span class="comment"># 注释掉</span></span><br><span class="line">requests:  <span class="comment"># 限制CPU/MEM，可选</span></span><br><span class="line">storageClassName:  <span class="comment"># 可以默认不填或写成&quot;local-path&quot;</span></span><br><span class="line">externalTrafficPolicy: <span class="comment"># Local改为Cluster，可选</span></span><br><span class="line">mysqlNodePort: 30550 <span class="comment"># 取消注释</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 部署tidb</span></span><br><span class="line">kubectl create namespace tidb</span><br><span class="line">kubectl apply -f tidb-cluster.yaml -n tidb</span><br></pre></td></tr></table></figure>
<h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><p>yaml示例:<br><a target="_blank" rel="noopener" href="https://github.com/pingcap/tidb-operator/blob/master/manifests/initializer/tidb-initializer.yaml">https://github.com/pingcap/tidb-operator/blob/master/manifests/initializer/tidb-initializer.yaml</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改tidb-initializer.yaml</span></span><br><span class="line">apiVersion: pingcap.com/v1alpha1</span><br><span class="line">kind: TidbInitializer</span><br><span class="line">metadata:</span><br><span class="line">  name: tidb-dubhe-init</span><br><span class="line">  <span class="comment"># namespace: demo</span></span><br><span class="line">spec:</span><br><span class="line">  image: tnir/mysqlclient</span><br><span class="line">  cluster:</span><br><span class="line">    <span class="comment"># namespace: demo</span></span><br><span class="line">    name: tidb-dubhe</span><br><span class="line">  initSql: |-</span><br><span class="line">    create database app;</span><br><span class="line">  passwordSecret: tidb-secret</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建secret</span></span><br><span class="line">kubectl create secret generic tidb-secret --from-literal=root=yourpass --namespace=tidb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化tidb</span></span><br><span class="line">kubectl apply -f tidb-initializer.yaml -n tidb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问tidb</span></span><br><span class="line">kubectl get svc -n tidb</span><br><span class="line">mysql://10.193.35.11:300550</span><br><span class="line">root/yourpass</span><br></pre></td></tr></table></figure>

<h2 id="安装monitoring"><a href="#安装monitoring" class="headerlink" title="安装monitoring"></a>安装monitoring</h2><p>yaml示例:  </p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/pingcap/tidb-operator/blob/master/manifests/monitor/tidb-monitor.yaml">https://github.com/pingcap/tidb-operator/blob/master/manifests/monitor/tidb-monitor.yaml</a></li>
<li><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/pingcap/tidb-operator/master/examples/basic/tidb-monitor.yaml">https://raw.githubusercontent.com/pingcap/tidb-operator/master/examples/basic/tidb-monitor.yaml</a></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f tidb-monitor.yaml -n tidb</span><br><span class="line"></span><br><span class="line"><span class="comment"># Console</span></span><br><span class="line">http://10.193.35.11:30552</span><br></pre></td></tr></table></figure>
<h2 id="安装dashboard"><a href="#安装dashboard" class="headerlink" title="安装dashboard"></a>安装dashboard</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f tidb-dashboard.yaml -n tidb</span><br><span class="line">kubectl apply -f tidb-ng-monitoring.yaml -n tidb</span><br><span class="line"></span><br><span class="line"><span class="comment"># Console</span></span><br><span class="line">http://10.193.35.11:30551/dashboard</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202305/DockEmon%E9%95%9C%E5%83%8F%E5%B7%A5%E5%85%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202305/DockEmon%E9%95%9C%E5%83%8F%E5%B7%A5%E5%85%B7/" class="post-title-link" itemprop="url">DOCKEMON镜像工具</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-05-29 14:17:55" itemprop="dateCreated datePublished" datetime="2023-05-29T14:17:55+08:00">2023-05-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-06-27 11:21:35" itemprop="dateModified" datetime="2024-06-27T11:21:35+08:00">2024-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><strong>DOCKEMON</strong>是一个Docker镜像工具包，用于简化离线K8S环境下的镜像的拉取、打标、推送、导出导入等批量操作</p>
<p>同时支持<strong>一键安装Chart</strong>、<strong>一键推送镜像</strong>等快捷操作</p>
<h2 id="GitHub下载地址"><a href="#GitHub下载地址" class="headerlink" title="GitHub下载地址"></a>GitHub下载地址</h2><p><a target="_blank" rel="noopener" href="https://github.com/xiiiblue/dockemon">https://github.com/xiiiblue/dockemon</a></p>
<h2 id="系统要求"><a href="#系统要求" class="headerlink" title="系统要求"></a>系统要求</h2><ul>
<li>推荐macOS、Linux下的bash或zsh环境，Windows下的mobaXterm未经测试</li>
<li>涉及镜像相关操作，需要安装DockerDesktop或Nerdctl</li>
<li>涉及Chart相关操作，需要安装Helm</li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>将<code>dockemon-installer.sh</code>安装脚本下载到本机或服务器，并执行: </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x dockemon-installer.sh &amp; ./dockemon-installer.sh</span><br></pre></td></tr></table></figure>
<p>安装完成后，在任意路径下执行 <code>dockemon</code> 即可启动程序</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><ol>
<li>执行<code>dockemon help</code>查看帮助信息</li>
<li>执行<code>dockemon conf</code>配置Harbor地址等常用参数(可选)</li>
<li>执行<code>dockemon edit</code>配置要处理的镜像清单，<code>dockemon show</code>查看清单(可选)</li>
</ol>
<h2 id="常用功能"><a href="#常用功能" class="headerlink" title="常用功能"></a>常用功能</h2><h3 id="一键安装Chart"><a href="#一键安装Chart" class="headerlink" title="一键安装Chart"></a>一键安装Chart</h3><p>一键安装Chart。包含: 下载Chart-&gt;分析镜像清单-&gt;拉取镜像-&gt;打标-&gt;建仓库-&gt;推送镜像</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dockemon chart [仓库名称] [Chart名称] [版本号]  </span><br></pre></td></tr></table></figure>
<p>示例:   </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dockemon chart bitnami redis 17.10.3</span><br></pre></td></tr></table></figure>
<h3 id="一键推送镜像"><a href="#一键推送镜像" class="headerlink" title="一键推送镜像"></a>一键推送镜像</h3><p>一键推送镜像。包含: 拉取镜像-&gt;打标-&gt;建仓库-&gt;推送镜像。如果不传入镜像名，则批量处理镜像清单</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dockemon image [镜像名]</span><br></pre></td></tr></table></figure>
<p>示例:   </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dockemon image nginx:alpine</span><br></pre></td></tr></table></figure>
<h3 id="其它批量操作"><a href="#其它批量操作" class="headerlink" title="其它批量操作"></a>其它批量操作</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dockemon pull  <span class="comment"># 拉取镜像</span></span><br><span class="line">dockemon tag   <span class="comment"># 打标签</span></span><br><span class="line">dockemon tag_group [仓库名]  <span class="comment"># 打标签归到同一个仓库，必须传入一个仓库名</span></span><br><span class="line">dockemon push  <span class="comment"># 推送镜像</span></span><br><span class="line">dockemon save  <span class="comment"># 导出镜像</span></span><br><span class="line">dockemon load  <span class="comment"># 导入镜像</span></span><br><span class="line">dockemon login <span class="comment"># 登录HARBOR</span></span><br><span class="line">dockemon repo  <span class="comment"># 创建HARBOR仓库</span></span><br><span class="line">dockemon values <span class="comment"># 分析helm配置文件并生成镜像清单</span></span><br></pre></td></tr></table></figure>


<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ol>
<li><p>Helm操作在本机联网环境下远程执行，请确保<code>～/.kube/config</code>配置正确，<code>kubectl get nodes</code>能连接到集群</p>
</li>
<li><p> 安装Chart前需要先添加好仓库并更新，示例:  </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br><span class="line">helm repo update</span><br></pre></td></tr></table></figure></li>
<li><p>Harbor仓库如果使用域名连接，请先配置好<code>/etc/hosts</code>的指向</p>
</li>
<li><p>如果无法通过VPN连接到离线集群(例如隔着堡垒机)，则只能分步操作上传镜像，大体步骤为:  </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pull -&gt; tag -&gt; save -&gt; 手工上传 -&gt; load</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202304/Docker%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202304/Docker%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B2/" class="post-title-link" itemprop="url">Docker离线部署</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-05-29 14:15:33" itemprop="dateCreated datePublished" datetime="2023-05-29T14:15:33+08:00">2023-05-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-06-27 11:19:44" itemprop="dateModified" datetime="2024-06-27T11:19:44+08:00">2024-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Docker二进制方式离线"><a href="#Docker二进制方式离线" class="headerlink" title="Docker二进制方式离线"></a>Docker二进制方式离线</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://download.docker.com/linux/static/stable/x86_64/docker-23.0.4.tgz</span><br><span class="line">tar -zxvf docker-23.0.4.tgz</span><br><span class="line">cp docker/* /usr/bin/</span><br><span class="line">dockerd &amp;</span><br></pre></td></tr></table></figure>
<h1 id="DockerUbuntu下在线安装"><a href="#DockerUbuntu下在线安装" class="headerlink" title="DockerUbuntu下在线安装"></a>DockerUbuntu下在线安装</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y docker.io</span><br><span class="line">sudo gpasswd -a <span class="variable">$USER</span> docker</span><br><span class="line">newgrp docker</span><br><span class="line">docker version</span><br><span class="line">docker info</span><br></pre></td></tr></table></figure>
<h2 id="DockerCompose离线安装"><a href="#DockerCompose离线安装" class="headerlink" title="DockerCompose离线安装"></a>DockerCompose离线安装</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载</span></span><br><span class="line">wget https://github.com/docker/compose/releases/download/v2.17.3/docker-compose-linux-x86_64</span><br><span class="line">sudo cp docker-compose-linux-x86_64 /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line">chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202304/Containerd%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202304/Containerd%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">Containerd常用操作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-05-29 14:05:01" itemprop="dateCreated datePublished" datetime="2023-05-29T14:05:01+08:00">2023-05-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-06-27 11:19:53" itemprop="dateModified" datetime="2024-06-27T11:19:53+08:00">2024-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://os.51cto.com/article/705519.html">https://os.51cto.com/article/705519.html</a> 如何在命令行下优雅地管理 Containerd</li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/338484552">https://zhuanlan.zhihu.com/p/338484552</a> Containerd 的前世今生和保姆级入门教程</li>
<li><a target="_blank" rel="noopener" href="https://aijishu.com/a/1060000000083155">https://aijishu.com/a/1060000000083155</a>  如何优雅地使用containerd</li>
<li><a target="_blank" rel="noopener" href="https://www.zhangbj.com/p/1095.html">https://www.zhangbj.com/p/1095.html</a>  k3s设置镜像</li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/0f7940258b7a">https://www.jianshu.com/p/0f7940258b7a</a> crictl 命令用法及与docker-cli的命令对比</li>
<li><a target="_blank" rel="noopener" href="https://www.qikqiak.com/k8strain2/containerd/nerdctl/">https://www.qikqiak.com/k8strain2/containerd/nerdctl/</a> Containerd 高级命令行工具 nerdctl</li>
</ul>
<h2 id="docker下containerd配置信息"><a href="#docker下containerd配置信息" class="headerlink" title="docker下containerd配置信息"></a>docker下containerd配置信息</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># address</span></span><br><span class="line">/var/run/docker/containerd/containerd.sock</span><br><span class="line"><span class="comment"># namespace</span></span><br><span class="line">moby</span><br><span class="line"><span class="comment"># 手动配置路径</span></span><br><span class="line">/etc/docker</span><br><span class="line"><span class="comment"># 自动生成的配置路径</span></span><br><span class="line">/var/run/docker/containerd/containerd.toml</span><br><span class="line"><span class="comment"># ctr访问</span></span><br><span class="line">ctr --address /var/run/docker/containerd/containerd.sock --namespace moby c ls</span><br></pre></td></tr></table></figure>
<h2 id="k3s下containerd配置信息"><a href="#k3s下containerd配置信息" class="headerlink" title="k3s下containerd配置信息"></a>k3s下containerd配置信息</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># address</span></span><br><span class="line">/run/k3s/containerd/containerd.sock</span><br><span class="line"><span class="comment"># namespace</span></span><br><span class="line">k8s.io</span><br><span class="line"><span class="comment"># 手动配置路径</span></span><br><span class="line">cat /etc/rancher/k3s/registries.yaml</span><br><span class="line"><span class="comment"># 自动生成配置路径</span></span><br><span class="line">cat /var/lib/rancher/k3s/agent/etc/containerd/config.toml</span><br><span class="line"><span class="comment"># ctr访问</span></span><br><span class="line">ctr --address /run/k3s/containerd/containerd.sock --namespace k8s.io c ls</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="ctr常用管理命令"><a href="#ctr常用管理命令" class="headerlink" title="ctr常用管理命令"></a>ctr常用管理命令</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># k3s下的alias配置</span></span><br><span class="line"><span class="built_in">alias</span> ctr=<span class="string">&quot;ctr --address /run/k3s/containerd/containerd.sock --namespace k8s.io&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看命名空间</span></span><br><span class="line">ctr ns ls</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看镜像</span></span><br><span class="line">ctr i ls</span><br><span class="line"><span class="comment"># 拉取镜像</span></span><br><span class="line">ctr i pull docker.io/library/nginx:1.21</span><br><span class="line"><span class="comment"># 导入镜像</span></span><br><span class="line">ctr i import image.tar</span><br><span class="line"><span class="comment"># 删除镜像</span></span><br><span class="line">ctr i remove docker.io/library/nginx:1.21</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行(本质上是容器创建+任务启动)</span></span><br><span class="line">ctr run --rm -t docker.io/library/debian:latest cont1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建容器</span></span><br><span class="line">ctr c create -t docker.io/library/nginx:latest nginx_1</span><br><span class="line"><span class="comment"># 查看容器</span></span><br><span class="line">ctr c ls</span><br><span class="line"><span class="comment"># 创建任务</span></span><br><span class="line">ctr t start -d nginx_1</span><br><span class="line"><span class="comment"># 查看任务</span></span><br><span class="line">ctr t ls</span><br><span class="line"><span class="comment"># 在容器中执行一个任务</span></span><br><span class="line">ctr t <span class="built_in">exec</span> -t --exec-id bash_1 nginx_1 bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止任务</span></span><br><span class="line">ctr t <span class="built_in">kill</span> -9 nginx_1</span><br><span class="line">ctr t rm -f nginx_1</span><br><span class="line"><span class="comment"># 删除容器</span></span><br><span class="line">ctr c rm nginx_1</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="crictl常用管理命令"><a href="#crictl常用管理命令" class="headerlink" title="crictl常用管理命令"></a>crictl常用管理命令</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看pod</span></span><br><span class="line">crictl pods</span><br><span class="line"><span class="comment"># 查看镜像</span></span><br><span class="line">crictl images</span><br><span class="line"><span class="comment"># 查看容器</span></span><br><span class="line">crictl ps -a</span><br><span class="line"><span class="comment"># 在容器中执行</span></span><br><span class="line">crictl <span class="built_in">exec</span> -it 21c8007a90eea ls</span><br><span class="line"><span class="comment"># 查看容器日志</span></span><br><span class="line">crictl logs -f 21c8007a90eea</span><br><span class="line"><span class="comment"># 拉取镜像</span></span><br><span class="line">crictl pull busybox</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="nerdctl常用管理命令"><a href="#nerdctl常用管理命令" class="headerlink" title="nerdctl常用管理命令"></a>nerdctl常用管理命令</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># k3s下alias配置</span></span><br><span class="line"><span class="built_in">alias</span> nerdctl=<span class="string">&#x27;nerdctl --host=/run/k3s/containerd/containerd.sock --namespace k8s.io --insecure-registry&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 基本兼容docker cmd，直接使用 nerdctl --help 查看帮助即可</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202304/Helm%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202304/Helm%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">Helm常用操作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-05-29 14:01:45" itemprop="dateCreated datePublished" datetime="2023-05-29T14:01:45+08:00">2023-05-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-06-27 11:19:44" itemprop="dateModified" datetime="2024-06-27T11:19:44+08:00">2024-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="https://helm.sh/zh/docs/intro/install/">https://helm.sh/zh/docs/intro/install/</a></p>
<h2 id="中心仓库"><a href="#中心仓库" class="headerlink" title="中心仓库"></a>中心仓库</h2><p><a target="_blank" rel="noopener" href="https://artifacthub.io/">https://artifacthub.io/</a></p>
<h2 id="离线安装"><a href="#离线安装" class="headerlink" title="离线安装"></a>离线安装</h2><p><a target="_blank" rel="noopener" href="https://github.com/helm/helm/releases">https://github.com/helm/helm/releases</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf helm-v3.11.3-linux-amd64.tar.gz</span><br><span class="line">mv linux-amd64/helm /usr/<span class="built_in">local</span>/bin/helm</span><br></pre></td></tr></table></figure>
<h2 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加私有仓库</span></span><br><span class="line">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br><span class="line">helm update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看仓库列表</span></span><br><span class="line">helm repo list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在ArtifactHub中查找</span></span><br><span class="line">helm search hub wordpress</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找所有版本号</span></span><br><span class="line">helm search repo bitnami/redis --versions --devel</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加三方仓库并查找</span></span><br><span class="line">helm repo add brigade https://brigadecore.github.io/charts</span><br><span class="line">helm search repo brigade</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line"><span class="comment">## 在线安装</span></span><br><span class="line">helm install happy-panda bitnami/wordpress</span><br><span class="line"><span class="comment">## 本地安装，并指定命名空间</span></span><br><span class="line">helm install redis ./redis --namespace redis --create-namespace</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看安装状态</span></span><br><span class="line">helm status happy-panda</span><br><span class="line">helm status redis --namespace redis</span><br><span class="line"></span><br><span class="line"><span class="comment"># 升级</span></span><br><span class="line">helm upgrade -f panda.yaml happy-panda bitnami/wordpress</span><br><span class="line">helm upgrade redis ./redis</span><br><span class="line"></span><br><span class="line"><span class="comment"># 回滚</span></span><br><span class="line">helm status redis --namespace redis</span><br><span class="line"></span><br><span class="line"><span class="comment"># 卸载</span></span><br><span class="line">helm uninstall redis --namespace redis</span><br></pre></td></tr></table></figure>

<h2 id="3-8以下通过cm-push插件推送"><a href="#3-8以下通过cm-push插件推送" class="headerlink" title="3.8以下通过cm-push插件推送"></a>3.8以下通过cm-push插件推送</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装cm-push插件，3.8以上虽然自带push命令，但无法实现向http仓库推送</span></span><br><span class="line">helm plugin install https://github.com/chartmuseum/helm-push</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加HarborHelm仓库</span></span><br><span class="line">helm repo add dubhe http://harbor.dubhe:30002/chartrepo/dubhe</span><br><span class="line">helm repo update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传chart</span></span><br><span class="line">helm cm-push ./gogs.tgz dubhe --username admin --password yourpass </span><br></pre></td></tr></table></figure>

<h2 id="3-8以上支持OCI规范直接推送"><a href="#3-8以上支持OCI规范直接推送" class="headerlink" title="3.8以上支持OCI规范直接推送"></a>3.8以上支持OCI规范直接推送</h2><p><a target="_blank" rel="noopener" href="https://helm.sh/zh/docs/helm/helm_push/">https://helm.sh/zh/docs/helm/helm_push/</a><br><a target="_blank" rel="noopener" href="https://helm.sh/zh/docs/topics/registries/">https://helm.sh/zh/docs/topics/registries/</a><br><a target="_blank" rel="noopener" href="https://github.com/helm/helm/pull/11599">https://github.com/helm/helm/pull/11599</a><br><a target="_blank" rel="noopener" href="https://github.com/helm/helm/issues/11683">https://github.com/helm/helm/issues/11683</a><br><a target="_blank" rel="noopener" href="https://github.com/helm/helm/issues/6324">https://github.com/helm/helm/issues/6324</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">helm registry login -u admin harbor.dubhe:30002 --insecure</span><br><span class="line">helm push  dubhe-register.tgz oci://harbor.dubhe:30003/dubhe-chart   <span class="comment"># 此方式不支持http</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202304/K8S%E5%B8%B8%E7%94%A8API%E5%AF%B9%E8%B1%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202304/K8S%E5%B8%B8%E7%94%A8API%E5%AF%B9%E8%B1%A1/" class="post-title-link" itemprop="url">K8S常用API对象</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-05-17 09:19:51" itemprop="dateCreated datePublished" datetime="2023-05-17T09:19:51+08:00">2023-05-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-06-27 11:20:17" itemprop="dateModified" datetime="2024-06-27T11:20:17+08:00">2024-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="https://github.com/chronolaw/k8s_study">https://github.com/chronolaw/k8s_study</a></p>
<h2 id="Pod"><a href="#Pod" class="headerlink" title="Pod"></a>Pod</h2><p>ngx-pod.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ngx-pod</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">env:</span> <span class="string">demo</span></span><br><span class="line">    <span class="attr">owner:</span> <span class="string">chrono</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">nginx:alpine</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">ngx</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建Pod</span></span><br><span class="line">kubectl apply -f ngx-pod.yml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝文件</span></span><br><span class="line">kubectl cp a.txt ngx-pod:/tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入console</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it ngx-pod -- sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看日志</span></span><br><span class="line">kubectl logs busy-pod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除</span></span><br><span class="line">kubectl delete -f busy-pod.yaml</span><br><span class="line">kubectl delete pod busy-pod</span><br></pre></td></tr></table></figure>
<h2 id="Job"><a href="#Job" class="headerlink" title="Job"></a>Job</h2><p>cronjob.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Job</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">echo-job</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">OnFailure</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">echo-job</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;/bin/echo&quot;</span>]</span><br><span class="line">        <span class="attr">args:</span> [<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建Job</span></span><br><span class="line">kubectl apply -f job.yml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Pod和Job</span></span><br><span class="line">kubectl get pod -o wide</span><br><span class="line">kubectl get <span class="built_in">jobs</span> -o wide</span><br></pre></td></tr></table></figure>
<h2 id="CronJob"><a href="#CronJob" class="headerlink" title="CronJob"></a>CronJob</h2><p>cronjob.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CronJob</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">echo-cj</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">schedule:</span> <span class="string">&#x27;*/1 * * * *&#x27;</span></span><br><span class="line">  <span class="attr">jobTemplate:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">template:</span></span><br><span class="line">        <span class="attr">spec:</span></span><br><span class="line">          <span class="attr">restartPolicy:</span> <span class="string">OnFailure</span></span><br><span class="line">          <span class="attr">containers:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">echo-cj</span></span><br><span class="line">            <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">            <span class="attr">command:</span> [<span class="string">&quot;/bin/echo&quot;</span>]</span><br><span class="line">            <span class="attr">args:</span> [<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建Job</span></span><br><span class="line">kubectl apply -f cronjob.yml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看</span></span><br><span class="line">kubectl get cj</span><br></pre></td></tr></table></figure>
<h2 id="ConfigMap-amp-Secret"><a href="#ConfigMap-amp-Secret" class="headerlink" title="ConfigMap&amp;Secret"></a>ConfigMap&amp;Secret</h2><p>cm.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">info</span></span><br><span class="line"></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">count:</span> <span class="string">&#x27;10&#x27;</span></span><br><span class="line">  <span class="attr">debug:</span> <span class="string">&#x27;on&#x27;</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">&#x27;/etc/systemd&#x27;</span></span><br><span class="line">  <span class="attr">greeting:</span> <span class="string">|</span></span><br><span class="line">    <span class="string">say</span> <span class="string">hello</span> <span class="string">to</span> <span class="string">kubernetes.</span></span><br></pre></td></tr></table></figure>
<p>secret.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">user</span></span><br><span class="line"></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cm9vdA==</span></span><br><span class="line">  <span class="attr">pwd:</span> <span class="string">MTIzNDU2</span></span><br><span class="line">  <span class="attr">db:</span> <span class="string">bXlzcWw=</span></span><br></pre></td></tr></table></figure>
<p>env-pod.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">env-pod</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">env:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">COUNT</span></span><br><span class="line">        <span class="attr">valueFrom:</span></span><br><span class="line">          <span class="attr">configMapKeyRef:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">info</span></span><br><span class="line">            <span class="attr">key:</span> <span class="string">count</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">GREETING</span></span><br><span class="line">        <span class="attr">valueFrom:</span></span><br><span class="line">          <span class="attr">configMapKeyRef:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">info</span></span><br><span class="line">            <span class="attr">key:</span> <span class="string">greeting</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">USERNAME</span></span><br><span class="line">        <span class="attr">valueFrom:</span></span><br><span class="line">          <span class="attr">secretKeyRef:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">user</span></span><br><span class="line">            <span class="attr">key:</span> <span class="string">name</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">PASSWORD</span></span><br><span class="line">        <span class="attr">valueFrom:</span></span><br><span class="line">          <span class="attr">secretKeyRef:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">user</span></span><br><span class="line">            <span class="attr">key:</span> <span class="string">pwd</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">busy</span></span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;/bin/sleep&quot;</span>, <span class="string">&quot;300&quot;</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ConfigMap</span></span><br><span class="line">kubectl apply  -f cm.yml</span><br><span class="line">kubectl get configmap</span><br><span class="line">kubectl describe cm info</span><br><span class="line"></span><br><span class="line"><span class="comment"># Secret</span></span><br><span class="line">kubectl apply  -f secret.yml</span><br><span class="line">kubectl get secret</span><br><span class="line">kubectl describe secret user</span><br><span class="line"></span><br><span class="line"><span class="comment"># Pod</span></span><br><span class="line">kubectl apply -f env-pod.yml</span><br><span class="line">kubectl <span class="built_in">exec</span> -it env-pod -- sh</span><br><span class="line">env</span><br></pre></td></tr></table></figure>


<h2 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h2><p>deploy.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ngx-conf</span></span><br><span class="line"></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">default.conf:</span> <span class="string">|</span></span><br><span class="line">    <span class="string">server</span> &#123;</span><br><span class="line">      <span class="string">listen</span> <span class="number">80</span><span class="string">;</span></span><br><span class="line">      <span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">        <span class="string">default_type</span> <span class="string">text/plain;</span></span><br><span class="line">        <span class="string">return</span> <span class="number">200</span></span><br><span class="line">          <span class="string">&#x27;srv : $server_addr:$server_port\nhost: $hostname\nuri : $request_method $host $request_uri\ndate: $time_iso8601\n&#x27;</span><span class="string">;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ngx-dep</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">ngx-dep</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">ngx-dep</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">ngx-dep</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ngx-conf-vol</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">ngx-conf</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">nginx:alpine</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/etc/nginx/conf.d</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">ngx-conf-vol</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建</span></span><br><span class="line">kubectl apply -f deploy.yml</span><br><span class="line"><span class="comment"># 伸缩</span></span><br><span class="line">kubectl scale --replicas=3 deploy ngx-dep</span><br><span class="line"><span class="comment"># 查看</span></span><br><span class="line">kubectl get pod -o wide</span><br><span class="line">kubectl get pod -l app=nginx</span><br><span class="line">kubectl get pod -l <span class="string">&#x27;app in (ngx, nginx, ngx-dep)&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="DaemonSet"><a href="#DaemonSet" class="headerlink" title="DaemonSet"></a>DaemonSet</h2><p>ds.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis-ds</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">redis-ds</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">redis-ds</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">redis-ds</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis5</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">redis:5-alpine</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">6379</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">      <span class="comment"># this toleration is to have the daemonset runnable on master nodes</span></span><br><span class="line">      <span class="comment"># remove it if your masters can&#x27;t run pods</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">node-role.kubernetes.io/master</span></span><br><span class="line">        <span class="attr">effect:</span> <span class="string">NoSchedule</span></span><br><span class="line">        <span class="attr">operator:</span> <span class="string">Exists</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建</span></span><br><span class="line">kubectl apply -f ds.yml</span><br><span class="line"><span class="comment"># 查看主节点</span></span><br><span class="line">kubectl describe node master</span><br><span class="line"><span class="comment"># 删除污点(不推荐)</span></span><br><span class="line"><span class="comment"># kubectl taint node master node-role.kubernetes.io/master:NoSchedule</span></span><br><span class="line"><span class="comment"># kubectl taint node master node-role.kubernetes.io/master:NoSchedule-</span></span><br></pre></td></tr></table></figure>
<h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><p>svc.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ngx-svc</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">ngx-dep</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#type: ClusterIP</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建</span></span><br><span class="line">kubectl apply -f svc.yml</span><br><span class="line"><span class="comment"># 查看</span></span><br><span class="line">kubectl describe svc ngx-svc</span><br></pre></td></tr></table></figure>

<h2 id="PV-amp-PVC"><a href="#PV-amp-PVC" class="headerlink" title="PV&amp;PVC"></a>PV&amp;PVC</h2><p>host-path-pv.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">host-10m-pv</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">host-test</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">10Mi</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># mkdir -p /tmp/host-10m-pv/</span></span><br><span class="line">  <span class="attr">hostPath:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/tmp/host-10m-pv/</span></span><br></pre></td></tr></table></figure>

<p>host-path-pvc.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">host-5m-pvc</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">host-test</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">5Mi</span></span><br></pre></td></tr></table></figure>
<p>host-path-pod.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">host-pvc-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">host-pvc-vol</span></span><br><span class="line">    <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">      <span class="attr">claimName:</span> <span class="string">host-5m-pvc</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ngx-pvc-pod</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">nginx:alpine</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">host-pvc-vol</span></span><br><span class="line">        <span class="attr">mountPath:</span> <span class="string">/tmp</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># PV</span></span><br><span class="line">kubectl apply -f host-path-pv.yml</span><br><span class="line">kubectl get pv</span><br><span class="line"><span class="comment"># PVC</span></span><br><span class="line">kubectl apply -f host-path-pvc.yml</span><br><span class="line">kubectl get pvc</span><br><span class="line"><span class="comment"># POD</span></span><br><span class="line">kubectl apply -f host-path-pod.yml</span><br><span class="line">kubectl get pod -o wide</span><br></pre></td></tr></table></figure>
<h2 id="NFS"><a href="#NFS" class="headerlink" title="NFS"></a>NFS</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># server端</span></span><br><span class="line">sudo apt -y install nfs-kernel-server</span><br><span class="line">sudo systemctl start  nfs-server</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> nfs-server</span><br><span class="line">sudo systemctl status nfs-server</span><br><span class="line"></span><br><span class="line">mkdir -p /tmp/nfs</span><br><span class="line"></span><br><span class="line">sudo vi /etc/exports</span><br><span class="line">/tmp/nfs 192.168.101.0/24(rw,sync,no_subtree_check,no_root_squash,insecure)</span><br><span class="line">sudo exportfs -ra</span><br><span class="line">sudo exportfs -v</span><br><span class="line">showmount -e 127.0.0.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># client端</span></span><br><span class="line">sudo apt -y install nfs-common</span><br><span class="line">mkdir -p /tmp/<span class="built_in">test</span></span><br><span class="line">sudo mount -t nfs 192.168.101.242:/tmp/nfs /tmp/<span class="built_in">test</span></span><br></pre></td></tr></table></figure>
<p>nfs-static-pv.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-1g-pv</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">nfs</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">1Gi</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># you must write the right path</span></span><br><span class="line">  <span class="comment"># in nfs server</span></span><br><span class="line">  <span class="comment"># mkdir -p /tmp/nfs/1g-pv</span></span><br><span class="line">  <span class="attr">nfs:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/tmp/nfs/1g-pv</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.101</span><span class="number">.242</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pvc</span></span><br><span class="line"><span class="comment"># try to find the most suitable pv</span></span><br><span class="line"><span class="comment"># capacity/accessModes</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-static-pvc</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">nfs</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">1Gi</span></span><br><span class="line">      <span class="comment">#storage: 100Mi</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pod</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-static-pod</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-pvc-vol</span></span><br><span class="line">    <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">      <span class="attr">claimName:</span> <span class="string">nfs-static-pvc</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-pvc-test</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">nginx:alpine</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-pvc-vol</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/tmp</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f nfs-static-pv.yml</span><br><span class="line">kubectl get pv</span><br><span class="line">kubectl get pvc</span><br><span class="line">kubectl get pod</span><br></pre></td></tr></table></figure>
<h2 id="NFS-Provisioner"><a href="#NFS-Provisioner" class="headerlink" title="NFS Provisioner"></a>NFS Provisioner</h2><p>安装参考: <a target="_blank" rel="noopener" href="https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner">https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">helm repo add nfs-subdir-external-provisioner https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner/</span><br><span class="line">helm install nfs-subdir-external-provisioner nfs-subdir-external-provisioner/nfs-subdir-external-provisioner \</span><br><span class="line">    --<span class="built_in">set</span> nfs.server=192.168.101.242 \</span><br><span class="line">    --<span class="built_in">set</span> nfs.path=/tmp/nfs</span><br><span class="line"></span><br><span class="line">helm uninstall nfs-subdir-external-provisioner</span><br></pre></td></tr></table></figure>
<p>nfs-dynamic-pv.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-dyn-10m-pvc</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># in class.yaml</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">nfs-client</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">10Mi</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-dyn-pod</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-dyn-10m-vol</span></span><br><span class="line">    <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">      <span class="attr">claimName:</span> <span class="string">nfs-dyn-10m-pvc</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-dyn-test</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">nginx:alpine</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-dyn-10m-vol</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/tmp</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f nfs-dynamic-pv.yml</span><br><span class="line">kubectl get pv</span><br><span class="line">kubectl get pvc</span><br><span class="line">kubectl get pod</span><br></pre></td></tr></table></figure>


<h2 id="StatefulSet"><a href="#StatefulSet" class="headerlink" title="StatefulSet"></a>StatefulSet</h2><p>redis-pv-sts.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis-pv-sts</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment"># headless svc</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">redis-pv-svc</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># pvc</span></span><br><span class="line">  <span class="attr">volumeClaimTemplates:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">redis-100m-pvc</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">storageClassName:</span> <span class="string">nfs-client</span></span><br><span class="line">      <span class="attr">accessModes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">      <span class="attr">resources:</span></span><br><span class="line">        <span class="attr">requests:</span></span><br><span class="line">          <span class="attr">storage:</span> <span class="string">100Mi</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">redis-pv-sts</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">redis-pv-sts</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">redis:5-alpine</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">redis</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">6379</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-100m-pvc</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/data</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis-pv-svc</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">redis-pv-sts</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># headless</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">6379</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f redis-pv-sts.yml</span><br><span class="line">kubectl get pvc</span><br><span class="line">kubectl get sts</span><br><span class="line">kubectl get pod</span><br><span class="line"></span><br><span class="line">kubectl <span class="built_in">exec</span> -it redis-pv-sts-0 -- redis-cli</span><br><span class="line"><span class="built_in">set</span> a 111</span><br><span class="line"><span class="built_in">set</span> b 222</span><br><span class="line">keys *</span><br><span class="line">quit</span><br><span class="line">kubectl delete pod redis-pv-sts-0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Version"><a href="#Version" class="headerlink" title="Version"></a>Version</h2><p>ngx-v1.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ngx-conf</span></span><br><span class="line"></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">default.conf:</span> <span class="string">|</span></span><br><span class="line">    <span class="string">server</span> &#123;</span><br><span class="line">      <span class="string">listen</span> <span class="number">80</span><span class="string">;</span></span><br><span class="line">      <span class="string">location</span> <span class="string">/</span> &#123;</span><br><span class="line">        <span class="string">default_type</span> <span class="string">text/plain;</span></span><br><span class="line">        <span class="string">return</span> <span class="number">200</span></span><br><span class="line">          <span class="string">&#x27;ver : $nginx_version\nsrv : $server_addr:$server_port\nhost: $hostname\n&#x27;</span><span class="string">;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ngx-dep</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/change-cause:</span> <span class="string">v1,</span> <span class="string">ngx=1.21</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment">#minReadySeconds: 5</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">4</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">ngx-dep</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">ngx-dep</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ngx-conf-vol</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">ngx-conf</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">nginx:1.21-alpine</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/etc/nginx/conf.d</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">ngx-conf-vol</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ngx-svc</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">ngx-dep</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 部署V1</span></span><br><span class="line">kubectl apply -f ngx-v1.yml</span><br><span class="line">kubectl get deployment</span><br><span class="line">kubectl get pod -o wide</span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">kubectl port-forward svc/ngx-svc 8080:80 &amp;</span><br><span class="line">curl 127.1:8080</span><br><span class="line"><span class="comment"># 更新V2</span></span><br><span class="line">kubectl apply -f ngx-v2.yml</span><br><span class="line"><span class="comment"># 查看更新状态</span></span><br><span class="line">kubectl rollout status deployment ngx-dep</span><br><span class="line"><span class="comment"># 查看日志</span></span><br><span class="line">kubectl describe deploy ngx-dep</span><br><span class="line"><span class="comment"># 查看历史</span></span><br><span class="line">kubectl rollout <span class="built_in">history</span> deploy ngx-dep</span><br><span class="line">kubectl rollout <span class="built_in">history</span> deploy --revision=2</span><br><span class="line"><span class="comment"># 回滚</span></span><br><span class="line">kubectl rollout undo deploy ngx-dep</span><br></pre></td></tr></table></figure>
<h2 id="NameSpace"><a href="#NameSpace" class="headerlink" title="NameSpace"></a>NameSpace</h2><p>test-ns.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-ns</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ngx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">test-ns</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">nginx:alpine</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">ngx</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl create ns test-ns </span><br><span class="line">kubectl get ns</span><br><span class="line"></span><br><span class="line">kubectl apply -f test-ns.yml</span><br><span class="line">kubectl get pod -n test-ns</span><br></pre></td></tr></table></figure>
<h2 id="ResourceQuota-amp-LimitRange"><a href="#ResourceQuota-amp-LimitRange" class="headerlink" title="ResourceQuota&amp;LimitRange"></a>ResourceQuota&amp;LimitRange</h2><p>quota-ns.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dev-ns</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ResourceQuota</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dev-qt</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev-ns</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">hard:</span></span><br><span class="line">    <span class="attr">requests.cpu:</span> <span class="number">10</span></span><br><span class="line">    <span class="attr">requests.memory:</span> <span class="string">10Gi</span></span><br><span class="line">    <span class="attr">limits.cpu:</span> <span class="number">10</span></span><br><span class="line">    <span class="attr">limits.memory:</span> <span class="string">20Gi</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">requests.storage:</span> <span class="string">100Gi</span></span><br><span class="line">    <span class="attr">persistentvolumeclaims:</span> <span class="number">100</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">pods:</span> <span class="number">100</span></span><br><span class="line">    <span class="attr">configmaps:</span> <span class="number">100</span></span><br><span class="line">    <span class="attr">secrets:</span> <span class="number">100</span></span><br><span class="line">    <span class="attr">services:</span> <span class="number">10</span></span><br><span class="line">    <span class="attr">services.nodeports:</span> <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">count/jobs.batch:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">count/cronjobs.batch:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">count/deployments.apps:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">LimitRange</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dev-limits</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev-ns</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">limits:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">Container</span></span><br><span class="line">    <span class="attr">defaultRequest:</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="string">200m</span></span><br><span class="line">      <span class="attr">memory:</span> <span class="string">50Mi</span></span><br><span class="line">    <span class="attr">default:</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="string">500m</span></span><br><span class="line">      <span class="attr">memory:</span> <span class="string">100Mi</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">Pod</span></span><br><span class="line">    <span class="attr">max:</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="string">800m</span></span><br><span class="line">      <span class="attr">memory:</span> <span class="string">200Mi</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f quota-ns.yml</span><br><span class="line"></span><br><span class="line">kubectl get quota -n dev-ns</span><br><span class="line">kubectl describe quota -n dev-ns</span><br><span class="line"></span><br><span class="line">kubectl get limitranges -n dev-ns</span><br><span class="line">kubectl describe limitranges -n dev-ns</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/28/">28</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">BlueXIII</p>
  <div class="site-description" itemprop="description">IT技术类文章、笔记分享</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">273</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/xiiiblue" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;xiiiblue" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/bluexiii" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;bluexiii" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备18050487号-1 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BlueXIII</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
