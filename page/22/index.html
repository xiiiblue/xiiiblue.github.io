<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.bluexiii.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="IT技术类文章、笔记分享">
<meta property="og:type" content="website">
<meta property="og:title" content="BlueXIII&#39;s Blog">
<meta property="og:url" content="http://blog.bluexiii.com/page/22/index.html">
<meta property="og:site_name" content="BlueXIII&#39;s Blog">
<meta property="og:description" content="IT技术类文章、笔记分享">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="BlueXIII">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://blog.bluexiii.com/page/22/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>BlueXIII's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">BlueXIII's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">热爱技术,持续学习</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201702/WEB%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%96%E4%B8%8D%E5%88%B0%E7%94%A8%E6%88%B7%E7%9A%84MAC%E5%9C%B0%E5%9D%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201702/WEB%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%96%E4%B8%8D%E5%88%B0%E7%94%A8%E6%88%B7%E7%9A%84MAC%E5%9C%B0%E5%9D%80/" class="post-title-link" itemprop="url">WEB服务器为什么取不到用户的MAC地址</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-03-01 14:00:42" itemprop="dateCreated datePublished" datetime="2017-03-01T14:00:42+08:00">2017-03-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-26 09:44:33" itemprop="dateModified" datetime="2021-01-26T09:44:33+08:00">2021-01-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>起因是某个同事接到了领导安排下来的一个需求，要在一个Web应用（Java+Tomcat）中，记录用户登录时的IP地址和MAC地址，用于安全审计，于是咨询我如何实现。  </p>
<p>第一反应是，这个需求本身是不成立的，根据以往的了解，MAC地址应该是过不了路由器的才对。<br>以往做开发，都是用engineer的思维：先动手做，遇到问题再解决问题。但这个需求，应当用scientist的思维去思考：首先确定能不能做，然后才是怎么做。  </p>
<p>翻查了一些资料，想来证实”<strong>为什么WEB服务器，可以获取到客户端的IP地址，但获取不到MAC地址</strong>“，看着看着才发现，这是个挺大的命题，够写一篇BLOG了。   </p>
<p>PS：由于个人对这块内容了解的不够彻底，<strong>本文很可能会有谬误</strong>，请读者先不要太当真，另外希望平台组的同事给予指证。  </p>
<h2 id="先说结论"><a href="#先说结论" class="headerlink" title="先说结论"></a>先说结论</h2><p>我所认为的结论应该是这样的：  </p>
<ol>
<li>获取远程主机的IP地址是可行的（先不讨论使用代理的情况）  </li>
<li>本地网络下，当我们已知一个IPv4地址后，可以通过ARP请求，获取对应的MAC地址。换句话说，MAC地址，只在本地网络下才有意义。  </li>
<li>但我们无法透过路由器，获取其它网络下的IPv4节点的MAC地址。  </li>
</ol>
<p>下面一步步解释一下。  </p>
<h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><p>先从HTTP说起。<br>HTTP是一个应用层的协议，它建立在TCP协议之上。<br>HTTP请求就是用来发送一段文本。关于这段文本如何组织，第一行写什么，第二行写什么，哪里加一个空行，就是HTTP协议所要规范的内容。<br>举个直接的例子，下面是一个简单的HTTP GET请求，有兴趣可以用telnet模拟一下。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET http:&#x2F;&#x2F;www.fiddler2.com&#x2F;UpdateCheck.aspx?isBeta&#x3D;False HTTP&#x2F;1.1</span><br><span class="line">User-Agent: Fiddler&#x2F;4.6.3.50306 (.NET 4.0; WinNT 5.1.2600 SP3; zh-CN; 2xx86; Auto Update; Full Instance; Extensions: Geoedge, AutoSaveExt, HostsFile, SAZClipboardFactory, EventLog, SimpleFilter, Timeline, APITesting)</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Host: www.fiddler2.com</span><br><span class="line">Accept-Language: zh-CN</span><br><span class="line">Referer: http:&#x2F;&#x2F;fiddler2.com&#x2F;client&#x2F;4.6.3.50306</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>
<p>我们可以看到，HTTP的这段请求中，完全找不到客户端的MAC地址，甚至连IP地址都没有描述。<br>那IP地址是从哪里取到的呢？接下来我们再深入一点，看下一个内容：Socket  </p>
<h2 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h2><p>HTTP的客户端和服务端，是通过Socket进行连接的。  </p>
<p>Socket是什么呢？<strong>Socket是对OSI模型第4层-传输层中的TCP/IP协议的封装</strong>。Socket本身并不是协议，而<strong>是一个调用接口</strong>(API)。Socket和TCP/IP协议没有必然的联系。但通过Socket，我们才能使用TCP/IP协议。应用层不必了解TCP/IP协议细节，直接通过对Socket接口函数的调用完成数据在IP网络的传输。  </p>
<p>Socket包含了网络通信必须的五种信息：<strong>连接使用的协议，本地主机的IP地址，本地进程的协议端口，远地主机的IP地址，远地进程的协议端口</strong>。</p>
<p>所以，因为有了Socket，客户端和服务端完全不需要了解底层细节，直接通过调用Socket来实现就可以了。</p>
<p>这也就是为什么服务器端<strong>可以获取到客户端的IP地址</strong>的原因，因为Socket中包含了远地主机的IP地址。（当然，通过代理服务器进行访问的除外，这种要依靠HTTP协议的X-Forwarded-For头来确认IP，不在本次的讨论范围中）  </p>
<p>那为什么<strong>无法获取到客户端的MAC地址</strong>呢？很简单，同理，因为Socket中无法取到MAC地址。。。</p>
<p>如果继续发问，为什么Socket中都既然都包含IP地址了，为什么偏偏不包含MAC地址信息呢？看来我们还要更深入一点，看一下OSI模型吧。  </p>
<h2 id="OSI七层模型"><a href="#OSI七层模型" class="headerlink" title="OSI七层模型"></a>OSI七层模型</h2><p>首先祭出这张经典的OSI七层模型图，计算机网络的基石，请先盯着看一会儿，认真复习一下<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/um3vu.gif"></p>
<p>这里还有一张OSI七层模型与TCP/IP四层模型的对照图<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/9kstc.jpg"></p>
<p>为了方便理解，再放上一张更直观的，每一层对应的数据型式和主要协议的示意图<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/xifqu.jpg">  </p>
<p>通过上图大体可以知道：  </p>
<ul>
<li>MAC地址是记录在第2层-数据链路层的  </li>
<li>IP地址是记录在第3层-网络层的  </li>
<li>端口号（TCP/UDP）是位于于第4层-传输层的  </li>
<li>HTTP请求报文是记录在第7层-应用层的  </li>
</ul>
<h2 id="当打开一个URL时，究竟发生了什么"><a href="#当打开一个URL时，究竟发生了什么" class="headerlink" title="当打开一个URL时，究竟发生了什么"></a>当打开一个URL时，究竟发生了什么</h2><p>下面举个栗子，当我们在浏览器中打开一个链接后，看看OSI各层倒底发生了什么：<br>这里撇开DNS解析之类东西，只说一下HTTP报文的发送  </p>
<h3 id="1、发送端"><a href="#1、发送端" class="headerlink" title="1、发送端"></a>1、发送端</h3><p>首先来看一下发送端（浏览器所在的主机）。参照第一张OSI模型图，按照从上向下的顺序来看。应用层数据其实只有那么几行文本，然后往下，每过一层，都要被加上首部/尾部。<strong>这个过程就像是一层一层的穿衣服</strong>。   </p>
<p>HTTP请求文本：<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/48yqg.jpg"><br>最后到了数据链路层之后，数据就变成了这个肥肥的样子，最后转换成0和1的电信号发出：  </p>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/w3bim.jpg"><br>下面看看，现实中，每一层都做了些什么（现实中的分层和OSI模型还是有区别的）：  </p>
<ul>
<li><p>第7,6,5层，也就是OSI中的应用层,表示层,会话层（也是TCP/IP分层中的应用层），它创建了一个HTTP请求(例如 GET / HTTP/1.1)，并交给下一层。一个普通的HTTP GET请求就是几行纯文本。<br>处理这三层，是<strong>浏览器</strong>和<strong>WEB服务器</strong>所要做的工作，浏览器发出请求，WEB服务器做出响应。  </p>
</li>
<li><p>第4,3层，也就是传输层/网络层。TCP/IP栈将上层的数据分成包（packets），并将它送往下一层-数据链路层。  </p>
</li>
</ul>
<p><strong>IP地址、端口号记录在这两层中</strong>。<br>处理这两层，是<strong>操作系统</strong>要做的工作，操作系统将这两层封装为了Socket，方便调用。  </p>
<ul>
<li>第2层，数据链路层，将包（package）封装成帧（frame），并将它送到下一层物理层。  </li>
</ul>
<p><strong>MAC地址记录在这一层中</strong>。<br>这一层的工作，交由<strong>网卡</strong>来处理。  </p>
<ul>
<li>第1层，物理层，使用电信号来传送0和1。<br>最后这一层就是<strong>传输介质</strong>的工作了，例如双绞线、光纤、同轴电缆。  </li>
</ul>
<h3 id="2、数据流转"><a href="#2、数据流转" class="headerlink" title="2、数据流转"></a>2、数据流转</h3><p>数据发出去后，再看一下数据在网络上的流转。<br>数据一般要经过交换机、路由器等网络设备，层层转发，这些设备所做的事情就像是： <strong>脱掉一件或几件衣服，做一些修修补补，然后再重新穿回去</strong>。  </p>
<ul>
<li>这里先以L2交换机为例看一下，因为L2交换机会认别到帧这一层，记录/学习MAC地址，并将帧发送到目的地。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/5ad0a.jpg">  </li>
</ul>
<p>通过上面这张图，我们就可以理解，MAC地址在本地网络下的重要作用了。也理解了，本地网络下，是可以查出每个节点的MAC地址的。  </p>
<ul>
<li>下面，再来看一下路由器。当一个LAN希望连接到另一个LAN时，就必须使用路由器设备了。当然，可以通过构建超大型的LAN，来避免使用路由器，但这时，交换机就需要管理大量的MAC地址，同时进行大量的广播通信，设备的负担就会相当大。路由器会进行路由选择，让数据达到下一跳。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/18783.jpg">  </li>
</ul>
<p>经过路由器后，为了能到达下一跳，数据链路层中的MAC地址就被篡改了，下面这张图很能说明问题：<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/js6ab.jpg">  </p>
<h3 id="3、接收端"><a href="#3、接收端" class="headerlink" title="3、接收端"></a>3、接收端</h3><p>最后看一下接收端（WEB服务器所在的主机）。参照第一张OSI模型图，按照从下至上的顺序来看，它要做的事情是： <strong>将衣服一件一件全部脱掉</strong> ，最后WEB服务器就取到了最初的应用层数据。  </p>
<h3 id="4、结论"><a href="#4、结论" class="headerlink" title="4、结论"></a>4、结论</h3><p>所以，当一个以太网帧到达目的主机后，其中的MAC地址早已经不是原来客户端的MAC了，操作系统的Socket自然也无法获取原始的MAC地址了。  </p>
<h2 id="可不可以通过其它方式获取MAC地址"><a href="#可不可以通过其它方式获取MAC地址" class="headerlink" title="可不可以通过其它方式获取MAC地址"></a>可不可以通过其它方式获取MAC地址</h2><p>上面已经证明了，WEB服务端，是无法获取客户端的MAC地址的。<br>那么，能不能通过一些trick来绕道实现呢？<br>想了想，大概可以有如下的思路：</p>
<ol>
<li>通过JavaScrip获取客户端的某块网卡的MAC地址，最好还要同时获取路由表，挑选出走默认路由的那块网卡。  </li>
<li>将MAC地址，偷偷写入应用层的HTTP协议的Header中（类似Content-Type和User-Agent）</li>
<li>服务端直接读Header，就可以取到Mac地址了</li>
</ol>
<p>那么这个思路可不可行呢？  </p>
<ul>
<li>如果客户端是浏览器的话，首先第一步就会被打脸，我想也没有哪个浏览器会允许这种不安全的操作的。但如果硬要通过IE下的ActiveX来取的话，貌似也不是不可以。。。  </li>
<li>但如果客户端是APP的话，通过WebView+JS Bridge方式调用私有的API，应该也是可行的。。。</li>
</ul>
<h2 id="记录MAC地址的意义"><a href="#记录MAC地址的意义" class="headerlink" title="记录MAC地址的意义"></a>记录MAC地址的意义</h2><p>最后的最后，不禁思考，获取MAC的意义在哪里呢？<br>如果单纯是为了取证和审计，我想意义是不大的，甚至不如直接记录IP地址。<br>因为：    </p>
<ul>
<li>对于普通的正常用户而言，通过IP地址，是可以直接定位操作人的，即使IP是动态的。  </li>
<li>对于初级以上Hacker来说，伪造MAC地址和伪造IP地址一样简单，甚至更简单。  </li>
</ul>
<p>所以，一般的安全管控要求下，还是只记录IP吧。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.amazon.cn/%E5%9B%BE%E8%A7%A3%E7%BD%91%E7%BB%9C%E7%A1%AC%E4%BB%B6-%E6%97%A5-%E4%B8%89%E8%BD%AE%E8%B4%A4%E4%B8%80/dp/B01531731E/ref=sr_1_1?s=digital-text&ie=UTF8&qid=1488177601&sr=1-1&keywords=%E5%9B%BE%E8%A7%A3%E7%BD%91%E7%BB%9C%E7%A1%AC%E4%BB%B6">https://www.amazon.cn/图解网络硬件-日-三轮贤一/dp/B01531731E/ref=sr_1_1?s=digital-text&amp;ie=UTF8&amp;qid=1488177601&amp;sr=1-1&amp;keywords=图解网络硬件</a>  </li>
<li><a target="_blank" rel="noopener" href="https://www.amazon.cn/TCP-IP%E5%85%A5%E9%97%A8%E7%BB%8F%E5%85%B8-%E7%BE%8E-Joe-Casad/dp/B00L0WLUGA/ref=sr_1_1?s=digital-text&ie=UTF8&qid=1488177636&sr=1-1&keywords=tcp/ip%E5%85%A5%E9%97%A8">https://www.amazon.cn/图解网络硬件-日-三轮贤一/dp/B01531731E/ref=sr_1_1?s=digital-text&amp;ie=UTF8&amp;qid=1488177601&amp;sr=1-1&amp;keywords=图解网络硬件</a>  </li>
<li><a target="_blank" rel="noopener" href="https://www.amazon.cn/HTTP%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-%E7%BE%8E-David-Gourley-Brian-Totty-Marjorie-Sayer-Sailu-Reddy-Aushu-Aggarwal/dp/B00M2DKYRC/ref=sr_1_1?s=digital-text&ie=UTF8&qid=1488178503&sr=1-1&keywords=HTTP%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97">https://www.amazon.cn/HTTP权威指南-美-David-Gourley-Brian-Totty-Marjorie-Sayer-Sailu-Reddy-Aushu-Aggarwal/dp/B00M2DKYRC/ref=sr_1_1?s=digital-text&amp;ie=UTF8&amp;qid=1488178503&amp;sr=1-1&amp;keywords=HTTP权威指南</a>  </li>
<li><a target="_blank" rel="noopener" href="http://superuser.com/questions/801788/role-of-osi-layers-when-we-open-a-url-in-browser">http://superuser.com/questions/801788/role-of-osi-layers-when-we-open-a-url-in-browser</a>  </li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201702/Python3%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201702/Python3%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">Python3个人学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-02-27 09:21:03" itemprop="dateCreated datePublished" datetime="2017-02-27T09:21:03+08:00">2017-02-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-11-06 15:47:45" itemprop="dateModified" datetime="2018-11-06T15:47:45+08:00">2018-11-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="推荐学习书目"><a href="#推荐学习书目" class="headerlink" title="推荐学习书目"></a>推荐学习书目</h2><ul>
<li><a target="_blank" rel="noopener" href="http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000">廖雪峰的官方网站</a>  </li>
<li><a target="_blank" rel="noopener" href="https://learnpythonthehardway.org/book/">Learn Python the Hard Way</a>  </li>
<li><a target="_blank" rel="noopener" href="https://www.amazon.cn/mn/detailApp/ref=as_li_ss_tl?_encoding=UTF8&tag=v06-23&linkCode=as2&asin=B003TSBAMM&camp=536&creative=3132&creativeASIN=B003TSBAMM">Python基础教程(第2版)</a>  </li>
<li><a target="_blank" rel="noopener" href="https://www.amazon.cn/mn/detailApp/ref=as_li_ss_tl?_encoding=UTF8&tag=v06-23&linkCode=as2&asin=B004TUJ7A6&camp=536&creative=3132&creativeASIN=B004TUJ7A6">Python学习手册(第4版)</a>  </li>
</ul>
<h2 id="推荐网站"><a href="#推荐网站" class="headerlink" title="推荐网站"></a>推荐网站</h2><ul>
<li><a target="_blank" rel="noopener" href="https://pypi.python.org/pypi">pypi.python.org</a>  </li>
<li><a target="_blank" rel="noopener" href="http://www.simple-is-better.com/">www.simple-is-better.com</a>  </li>
<li><a target="_blank" rel="noopener" href="https://www.v2ex.com/go/python">v2ex.com</a></li>
<li><a target="_blank" rel="noopener" href="https://www.python.org/">www.python.org</a></li>
</ul>
<h2 id="推荐IDE"><a href="#推荐IDE" class="headerlink" title="推荐IDE"></a>推荐IDE</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.jetbrains.com/pycharm/">PyCharm</a></li>
</ul>
<h2 id="其它资料"><a href="#其它资料" class="headerlink" title="其它资料"></a>其它资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://taizilongxu.gitbooks.io/stackoverflow-about-python/content/index.html">Stack Overflow About Python</a>  </li>
</ul>
<h2 id="好用的第三方库"><a href="#好用的第三方库" class="headerlink" title="好用的第三方库"></a>好用的第三方库</h2><ul>
<li>requests - HTTP库</li>
<li>Flask - RestfulAPI</li>
<li>peewee - 读写数据库，替代SQLAlchemy</li>
<li>aiohttp - 替代requests</li>
<li>BeautifulSoup - HTML解析</li>
<li>scipy - 科学计算</li>
<li>pandas - 处理csv及excel</li>
<li>fdfs_client-py - FastDFS客户端</li>
</ul>
<h2 id="代码风格规范"><a href="#代码风格规范" class="headerlink" title="代码风格规范"></a>代码风格规范</h2><p>参考文档：<br><a target="_blank" rel="noopener" href="http://zh-google-styleguide.readthedocs.io/en/latest/google-python-styleguide/">Google开源项目风格指南</a><br><a target="_blank" rel="noopener" href="http://www.wklken.me/posts/2016/11/03/python-code-style.html">Python代码规范小结</a>  </p>
<h3 id="分号"><a href="#分号" class="headerlink" title="分号"></a>分号</h3><p>不要在行尾加分号, 也不要用分号将两条命令放在同一行.</p>
<h3 id="行长度"><a href="#行长度" class="headerlink" title="行长度"></a>行长度</h3><p>每行不超过80个字符<br>例外:  </p>
<ol>
<li>长的导入模块语句  </li>
<li>注释里的URL  </li>
</ol>
<h3 id="括号"><a href="#括号" class="headerlink" title="括号"></a>括号</h3><p>宁缺毋滥的使用括号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Yes: if foo:</span><br><span class="line">         bar()</span><br><span class="line">     while x:</span><br><span class="line">         x &#x3D; bar()</span><br><span class="line">     if x and y:</span><br><span class="line">         bar()</span><br><span class="line">     if not x:</span><br><span class="line">         bar()</span><br><span class="line">     return foo</span><br><span class="line">     for (x, y) in dict.items(): ...</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">No:  if (x):</span><br><span class="line">        bar()</span><br><span class="line">    if not(x):</span><br><span class="line">        bar()</span><br><span class="line">    return (foo)</span><br></pre></td></tr></table></figure>
<h3 id="缩进"><a href="#缩进" class="headerlink" title="缩进"></a>缩进</h3><p>用4个空格来缩进代码，绝对不要用tab, 也不要tab和空格混用</p>
<h3 id="空行"><a href="#空行" class="headerlink" title="空行"></a>空行</h3><p>顶级定义之间空两行, 方法定义之间空一行</p>
<h3 id="空格"><a href="#空格" class="headerlink" title="空格"></a>空格</h3><p>按照标准的排版规范来使用标点两边的空格<br>括号内不要有空格</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Yes: spam(ham[1], &#123;eggs: 2&#125;, [])</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">No:  spam( ham[ 1 ], &#123; eggs: 2 &#125;, [ ] )</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>不要在逗号, 分号, 冒号前面加空格, 但应该在它们后面加(除了在行尾).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Yes: if x &#x3D;&#x3D; 4:</span><br><span class="line">         print x, y</span><br><span class="line">     x, y &#x3D; y, x</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">No:  if x &#x3D;&#x3D; 4 :</span><br><span class="line">         print x , y</span><br><span class="line">     x , y &#x3D; y , x</span><br></pre></td></tr></table></figure>
<p>参数列表, 索引或切片的左括号前不应加空格.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Yes: spam(1)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">no: spam (1)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Yes: dict[&#39;key&#39;] &#x3D; list[index]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">No:  dict [&#39;key&#39;] &#x3D; list [index]</span><br></pre></td></tr></table></figure>
<p>在二元操作符两边都加上一个空格, 比如赋值(=), 比较(==, &lt;, &gt;, !=, &lt;&gt;, &lt;=, &gt;=, in, not in, is, is not), 布尔(and, or, not). 至于算术操作符两边的空格该如何使用, 需要你自己好好判断. 不过两侧务必要保持一致.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Yes: x &#x3D;&#x3D; 1</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">No:  x&lt;1</span><br></pre></td></tr></table></figure>
<p>当’=’用于指示关键字参数或默认参数值时, 不要在其两侧使用空格.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Yes: def complex(real, imag&#x3D;0.0): return magic(r&#x3D;real, i&#x3D;imag)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">No:  def complex(real, imag &#x3D; 0.0): return magic(r &#x3D; real, i &#x3D; imag)</span><br></pre></td></tr></table></figure>

<p>不要用空格来垂直对齐多行间的标记, 因为这会成为维护的负担(适用于:, #, =等):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Yes:</span><br><span class="line">     foo &#x3D; 1000  # comment</span><br><span class="line">     long_name &#x3D; 2  # comment that should not be aligned</span><br><span class="line"></span><br><span class="line">     dictionary &#x3D; &#123;</span><br><span class="line">         &quot;foo&quot;: 1,</span><br><span class="line">         &quot;long_name&quot;: 2,</span><br><span class="line">         &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">No:</span><br><span class="line">     foo       &#x3D; 1000  # comment</span><br><span class="line">     long_name &#x3D; 2     # comment that should not be aligned</span><br><span class="line"></span><br><span class="line">     dictionary &#x3D; &#123;</span><br><span class="line">         &quot;foo&quot;      : 1,</span><br><span class="line">         &quot;long_name&quot;: 2,</span><br><span class="line">         &#125;</span><br></pre></td></tr></table></figure>
<h3 id="Shebang"><a href="#Shebang" class="headerlink" title="Shebang"></a>Shebang</h3><p>大部分.py文件不必以#!作为文件的开始. 根据 PEP-394 , 程序的main文件应该以 #!/usr/bin/python2或者 #!/usr/bin/python3开始.</p>
<h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><h4 id="文档字符串"><a href="#文档字符串" class="headerlink" title="文档字符串"></a>文档字符串</h4><p>Python有一种独一无二的的注释方式: 使用文档字符串. 文档字符串是包, 模块, 类或函数里的第一个语句. 这些字符串可以通过对象的__doc__成员被自动提取, 并且被pydoc所用. 一个文档字符串应该这样组织: 首先是一行以句号, 问号或惊叹号结尾的概述(或者该文档字符串单纯只有一行). 接着是一个空行. 接着是文档字符串剩下的部分, 它应该与文档字符串的第一行的第一个引号对齐.</p>
<h4 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h4><p>每个文件应该包含一个许可样板. 根据项目使用的许可(例如, Apache 2.0, BSD, LGPL, GPL), 选择合适的样板.</p>
<h4 id="函数和方法"><a href="#函数和方法" class="headerlink" title="函数和方法"></a>函数和方法</h4><p>关于函数的几个方面应该在特定的小节中进行描述记录， 这几个方面如下文所述. 每节应该以一个标题行开始. 标题行以冒号结尾. 除标题行外, 节的其他内容应被缩进2个空格.<br>Args:<br>列出每个参数的名字, 并在名字后使用一个冒号和一个空格, 分隔对该参数的描述.如果描述太长超过了单行80字符,使用2或者4个空格的悬挂缩进(与文件其他部分保持一致). 描述应该包括所需的类型和含义. 如果一个函数接受<em>foo(可变长度参数列表)或者**bar (任意关键字参数), 应该详细列出</em>foo和**bar.<br>Returns: (或者 Yields: 用于生成器)<br>描述返回值的类型和语义. 如果函数返回None, 这一部分可以省略.<br>Raises:<br>列出与接口有关的所有异常.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">def fetch_bigtable_rows(big_table, keys, other_silly_variable&#x3D;None):</span><br><span class="line">    &quot;&quot;&quot;Fetches rows from a Bigtable.</span><br><span class="line"></span><br><span class="line">    Retrieves rows pertaining to the given keys from the Table instance</span><br><span class="line">    represented by big_table.  Silly things may happen if</span><br><span class="line">    other_silly_variable is not None.</span><br><span class="line"></span><br><span class="line">    Args:</span><br><span class="line">        big_table: An open Bigtable Table instance.</span><br><span class="line">        keys: A sequence of strings representing the key of each table row</span><br><span class="line">            to fetch.</span><br><span class="line">        other_silly_variable: Another optional variable, that has a much</span><br><span class="line">            longer name than the other args, and which does nothing.</span><br><span class="line"></span><br><span class="line">    Returns:</span><br><span class="line">        A dict mapping keys to the corresponding table row data</span><br><span class="line">        fetched. Each row is represented as a tuple of strings. For</span><br><span class="line">        example:</span><br><span class="line"></span><br><span class="line">        &#123;&#39;Serak&#39;: (&#39;Rigel VII&#39;, &#39;Preparer&#39;),</span><br><span class="line">         &#39;Zim&#39;: (&#39;Irk&#39;, &#39;Invader&#39;),</span><br><span class="line">         &#39;Lrrr&#39;: (&#39;Omicron Persei 8&#39;, &#39;Emperor&#39;)&#125;</span><br><span class="line"></span><br><span class="line">        If a key from the keys argument is missing from the dictionary,</span><br><span class="line">        then that row was not found in the table.</span><br><span class="line"></span><br><span class="line">    Raises:</span><br><span class="line">        IOError: An error occurred accessing the bigtable.Table object.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>

<h4 id="类"><a href="#类" class="headerlink" title="类"></a>类</h4><p>类应该在其定义下有一个用于描述该类的文档字符串. 如果你的类有公共属性(Attributes), 那么文档中应该有一个属性(Attributes)段. 并且应该遵守和函数参数相同的格式.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">class SampleClass(object):</span><br><span class="line">    &quot;&quot;&quot;Summary of class here.</span><br><span class="line"></span><br><span class="line">    Longer class information....</span><br><span class="line">    Longer class information....</span><br><span class="line"></span><br><span class="line">    Attributes:</span><br><span class="line">        likes_spam: A boolean indicating if we like SPAM or not.</span><br><span class="line">        eggs: An integer count of the eggs we have laid.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self, likes_spam&#x3D;False):</span><br><span class="line">        &quot;&quot;&quot;Inits SampleClass with blah.&quot;&quot;&quot;</span><br><span class="line">        self.likes_spam &#x3D; likes_spam</span><br><span class="line">        self.eggs &#x3D; 0</span><br><span class="line"></span><br><span class="line">    def public_method(self):</span><br><span class="line">        &quot;&quot;&quot;Performs operation blah.&quot;&quot;&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="块注释和行注释"><a href="#块注释和行注释" class="headerlink" title="块注释和行注释"></a>块注释和行注释</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># We use a weighted dictionary search to find out where i is in</span><br><span class="line"># the array.  We extrapolate position based on the largest num</span><br><span class="line"># in the array and the array size and then do binary search to</span><br><span class="line"># get the exact number.</span><br><span class="line"></span><br><span class="line">if i &amp; (i-1) &#x3D;&#x3D; 0:        # true iff i is a power of 2</span><br></pre></td></tr></table></figure>
<h3 id="类-1"><a href="#类-1" class="headerlink" title="类"></a>类</h3><p>如果一个类不继承自其它类, 就显式的从object继承. 嵌套类也一样.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Yes: class SampleClass(object):</span><br><span class="line">         pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     class OuterClass(object):</span><br><span class="line"></span><br><span class="line">         class InnerClass(object):</span><br><span class="line">             pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     class ChildClass(ParentClass):</span><br><span class="line">         &quot;&quot;&quot;Explicitly inherits from another class already.&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">No: class SampleClass:</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    class OuterClass:</span><br><span class="line"></span><br><span class="line">        class InnerClass:</span><br><span class="line">            pass</span><br></pre></td></tr></table></figure>
<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><p>即使参数都是字符串, 使用%操作符或者格式化方法格式化字符串. 不过也不能一概而论, 你需要在+和%之间好好判定.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Yes: x &#x3D; a + b</span><br><span class="line">     x &#x3D; &#39;%s, %s!&#39; % (imperative, expletive)</span><br><span class="line">     x &#x3D; &#39;&#123;&#125;, &#123;&#125;!&#39;.format(imperative, expletive)</span><br><span class="line">     x &#x3D; &#39;name: %s; score: %d&#39; % (name, n)</span><br><span class="line">     x &#x3D; &#39;name: &#123;&#125;; score: &#123;&#125;&#39;.format(name, n)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">No: x &#x3D; &#39;%s%s&#39; % (a, b)  # use + in this case</span><br><span class="line">    x &#x3D; &#39;&#123;&#125;&#123;&#125;&#39;.format(a, b)  # use + in this case</span><br><span class="line">    x &#x3D; imperative + &#39;, &#39; + expletive + &#39;!&#39;</span><br><span class="line">    x &#x3D; &#39;name: &#39; + name + &#39;; score: &#39; + str(n)</span><br></pre></td></tr></table></figure>
<p>避免在循环中用+和+=操作符来累加字符串. 由于字符串是不可变的, 这样做会创建不必要的临时对象, 并且导致二次方而不是线性的运行时间. 作为替代方案, 你可以将每个子串加入列表, 然后在循环结束后用 .join 连接列表. (也可以将每个子串写入一个 cStringIO.StringIO 缓存中.)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Yes: items &#x3D; [&#39;&lt;table&gt;&#39;]</span><br><span class="line">     for last_name, first_name in employee_list:</span><br><span class="line">         items.append(&#39;&lt;tr&gt;&lt;td&gt;%s, %s&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&#39; % (last_name, first_name))</span><br><span class="line">     items.append(&#39;&lt;&#x2F;table&gt;&#39;)</span><br><span class="line">     employee_table &#x3D; &#39;&#39;.join(items)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">No: employee_table &#x3D; &#39;&lt;table&gt;&#39;</span><br><span class="line">    for last_name, first_name in employee_list:</span><br><span class="line">        employee_table +&#x3D; &#39;&lt;tr&gt;&lt;td&gt;%s, %s&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;&#39; % (last_name, first_name)</span><br><span class="line">    employee_table +&#x3D; &#39;&lt;&#x2F;table&gt;&#39;</span><br></pre></td></tr></table></figure>
<p>在同一个文件中, 保持使用字符串引号的一致性. 使用单引号’或者双引号”之一用以引用字符串, 并在同一文件中沿用. 在字符串内可以使用另外一种引号, 以避免在字符串中使用.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Yes:</span><br><span class="line">     Python(&#39;Why are you hiding your eyes?&#39;)</span><br><span class="line">     Gollum(&quot;I&#39;m scared of lint errors.&quot;)</span><br><span class="line">     Narrator(&#39;&quot;Good!&quot; thought a happy Python reviewer.&#39;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">No:</span><br><span class="line">     Python(&quot;Why are you hiding your eyes?&quot;)</span><br><span class="line">     Gollum(&#39;The lint. It burns. It burns us.&#39;)</span><br><span class="line">     Gollum(&quot;Always the great lint. Watching. Watching.&quot;)</span><br></pre></td></tr></table></figure>
<p>为多行字符串使用三重双引号”“”而非三重单引号’‘’. 当且仅当项目中使用单引号’来引用字符串时, 才可能会使用三重’‘’为非文档字符串的多行字符串来标识引用. 文档字符串必须使用三重双引号”“”. 不过要注意, 通常用隐式行连接更清晰, 因为多行字符串与程序其他部分的缩进方式不一致.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Yes:</span><br><span class="line">    print (&quot;This is much nicer.\n&quot;</span><br><span class="line">           &quot;Do it this way.\n&quot;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">No:</span><br><span class="line">      print &quot;&quot;&quot;This is pretty ugly.</span><br><span class="line">  Don&#39;t do this.</span><br><span class="line">  &quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<h3 id="文件和sockets"><a href="#文件和sockets" class="headerlink" title="文件和sockets"></a>文件和sockets</h3><p>在文件和sockets结束时, 显式的关闭它.<br>推荐使用 “with”语句 以管理文件:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">with open(&quot;hello.txt&quot;) as hello_file:</span><br><span class="line">    for line in hello_file:</span><br><span class="line">        print line</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>对于不支持使用”with”语句的类似文件的对象,使用 contextlib.closing():</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import contextlib</span><br><span class="line"></span><br><span class="line">with contextlib.closing(urllib.urlopen(&quot;http:&#x2F;&#x2F;www.python.org&#x2F;&quot;)) as front_page:</span><br><span class="line">    for line in front_page:</span><br><span class="line">        print line</span><br></pre></td></tr></table></figure>
<h3 id="TODO注释"><a href="#TODO注释" class="headerlink" title="TODO注释"></a>TODO注释</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># TODO(kl@gmail.com): Use a &quot;*&quot; here for string repetition.</span><br><span class="line"># TODO(Zeke) Change this to use relations.</span><br></pre></td></tr></table></figure>
<h3 id="导入格式"><a href="#导入格式" class="headerlink" title="导入格式"></a>导入格式</h3><p>每个导入应该独占一行  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Yes: import os</span><br><span class="line">     import sys</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">No:  import os, sys</span><br></pre></td></tr></table></figure>
<p>每种分组中, 应该根据每个模块的完整包路径按字典序排序, 忽略大小写.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import foo</span><br><span class="line">from foo import bar</span><br><span class="line">from foo.bar import baz</span><br><span class="line">from foo.bar import Quux</span><br><span class="line">from Foob import ar</span><br></pre></td></tr></table></figure>
<h3 id="语句"><a href="#语句" class="headerlink" title="语句"></a>语句</h3><p>通常每个语句应该独占一行<br>不过, 如果测试结果与测试语句在一行放得下, 你也可以将它们放在同一行. 如果是if语句, 只有在没有else时才能这样做. 特别地, 绝不要对 try/except 这样做, 因为try和except不能放在同一行.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Yes:</span><br><span class="line"></span><br><span class="line">  if foo: bar(foo)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">No:</span><br><span class="line"></span><br><span class="line">  if foo: bar(foo)</span><br><span class="line">  else:   baz(foo)</span><br><span class="line"></span><br><span class="line">  try:               bar(foo)</span><br><span class="line">  except ValueError: baz(foo)</span><br><span class="line"></span><br><span class="line">  try:</span><br><span class="line">      bar(foo)</span><br><span class="line">  except ValueError: baz(foo)</span><br></pre></td></tr></table></figure>
<h3 id="访问控制"><a href="#访问控制" class="headerlink" title="访问控制"></a>访问控制</h3><p>在Python中, 对于琐碎又不太重要的访问函数, 你应该直接使用公有变量来取代它们, 这样可以避免额外的函数调用开销. 当添加更多功能时, 你可以用属性(property)来保持语法的一致性.<br>另一方面, 如果访问更复杂, 或者变量的访问开销很显著, 那么你应该使用像 get_foo() 和 set_foo() 这样的函数调用. 如果之前的代码行为允许通过属性(property)访问 , 那么就不要将新的访问函数与属性绑定. 这样, 任何试图通过老方法访问变量的代码就没法运行, 使用者也就会意识到复杂性发生了变化.</p>
<h3 id="命名"><a href="#命名" class="headerlink" title="命名"></a>命名</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">module_name</span><br><span class="line">package_name</span><br><span class="line">ClassName</span><br><span class="line">method_name</span><br><span class="line">ExceptionName</span><br><span class="line">function_name</span><br><span class="line">GLOBAL_VAR_NAME</span><br><span class="line">instance_var_name</span><br><span class="line">function_parameter_name</span><br><span class="line">local_var_name</span><br></pre></td></tr></table></figure>
<p>应该避免的名称：  </p>
<ol>
<li>单字符名称, 除了计数器和迭代器.</li>
<li>包/模块名中的连字符(-)</li>
<li>双下划线开头并结尾的名称(Python保留, 例如<strong>init</strong>)</li>
</ol>
<p>命名约定：  </p>
<ol>
<li>所谓”内部(Internal)”表示仅模块内可用, 或者, 在类内是保护或私有的.</li>
<li>用单下划线( _ )开头表示模块变量或函数是protected的(使用import * from时不会包含).</li>
<li>用双下划线( __ )开头的实例变量或方法表示类内私有.</li>
<li>将相关的类和顶级函数放在同一个模块里. 不像Java, 没必要限制一个类一个模块.</li>
<li>对类名使用大写字母开头的单词(如CapWords, 即Pascal风格), 但是模块名应该用小写加下划线的方式(如lower_with_under.py). 尽管已经有很多现存的模块使用类似于CapWords.py这样的命名, 但现在已经不鼓励这样做, 因为如果模块名碰巧和类名一致, 这会让人困扰.</li>
</ol>
<h3 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h3><p>即使是一个打算被用作脚本的文件, 也应该是可导入的. 并且简单的导入不应该导致这个脚本的主功能(main functionality)被执行, 这是一种副作用. 主功能应该放在一个main()函数中.</p>
<p>在Python中, pydoc以及单元测试要求模块必须是可导入的. 你的代码应该在执行主程序前总是检查 if <strong>name</strong> == ‘<strong>main</strong>‘ , 这样当模块被导入时主程序就不会被执行.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def main():</span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>所有的顶级代码在模块导入时都会被执行. 要小心不要去调用函数, 创建对象, 或者执行那些不应该在使用pydoc时执行的操作.</p>
<h2 id="语法备忘"><a href="#语法备忘" class="headerlink" title="语法备忘"></a>语法备忘</h2><h3 id="Python解释器"><a href="#Python解释器" class="headerlink" title="Python解释器"></a>Python解释器</h3><ul>
<li>CPython - 官方版本的解释,C开发</li>
<li>IPython -  基于CPython之上的一个交互式解释器</li>
<li>PyPy - 采用JIT技术，对Python代码进行动态编译，提高执行速度</li>
<li>Jython - 运行在Java平台</li>
<li>IronPython - 运行在微软.Net平台</li>
</ul>
<h3 id="基本输入输出"><a href="#基本输入输出" class="headerlink" title="基本输入输出"></a>基本输入输出</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(&#39;hello, world&#39;)</span><br><span class="line">name &#x3D; input()</span><br></pre></td></tr></table></figure>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><h4 id="整数"><a href="#整数" class="headerlink" title="整数"></a>整数</h4><p>1，100，-8080，0<br>十六进制 0xff00，0xa5b4c3d2  </p>
<h4 id="浮点数"><a href="#浮点数" class="headerlink" title="浮点数"></a>浮点数</h4><p>1.23，3.14，-9.01<br>浮点数运算有误差  </p>
<h4 id="字符串-1"><a href="#字符串-1" class="headerlink" title="字符串"></a>字符串</h4><p>字符串是以单引号’或双引号”括起来的任意文本，比如’abc’，”xyz”<br>如果字符串内部既包含’又包含”，可以用转义字符\来标识  </p>
<p>\n表示换行，\t表示制表符，字符 \ 本身也要转义</p>
<p>Python允许用’’’…’’’的格式表示多行内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(&#39;&#39;&#39;line1</span><br><span class="line">line2</span><br><span class="line">line3&#39;&#39;&#39;)</span><br></pre></td></tr></table></figure>
<h4 id="布尔值"><a href="#布尔值" class="headerlink" title="布尔值"></a>布尔值</h4><p>True False</p>
<h4 id="空值"><a href="#空值" class="headerlink" title="空值"></a>空值</h4><p>None</p>
<h4 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a &#x3D; 123 # a是整数</span><br><span class="line">print(a)</span><br><span class="line">a &#x3D; &#39;ABC&#39; # a变为字符串</span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>
<h4 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h4><p>通常用全部大写的变量名表示常量：<br>PI = 3.14159265359<br>但事实上PI仍然是一个变量，Python根本没有任何机制保证PI不会被改变  </p>
<h4 id="除法"><a href="#除法" class="headerlink" title="除法"></a>除法</h4><p>有两种除法，一种除法是/，即使是两个整数恰好整除，结果也是浮点数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; 10 &#x2F; 3</span><br><span class="line">3.3333333333333335</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; 9 &#x2F; 3</span><br><span class="line">3.0</span><br></pre></td></tr></table></figure>
<p>还有一种除法是//，称为地板除，两个整数的除法仍然是整数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; 10 &#x2F;&#x2F; 3</span><br><span class="line">3</span><br></pre></td></tr></table></figure>
<p>余数运算：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; 10 % 3</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<h3 id="字符串-2"><a href="#字符串-2" class="headerlink" title="字符串"></a>字符串</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; ord(&#39;A&#39;)</span><br><span class="line">65</span><br><span class="line">&gt;&gt;&gt; ord(&#39;中&#39;)</span><br><span class="line">20013</span><br><span class="line">&gt;&gt;&gt; chr(66)</span><br><span class="line">&#39;B&#39;</span><br><span class="line">&gt;&gt;&gt; chr(25991)</span><br><span class="line">&#39;文&#39;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; len(&#39;ABC&#39;)</span><br><span class="line">3</span><br><span class="line">&gt;&gt;&gt; len(&#39;中文&#39;)</span><br><span class="line">2</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python3</span><br><span class="line"># -*- coding: utf-8 -*-</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; &#39;Hello, %s&#39; % &#39;world&#39;</span><br><span class="line">&#39;Hello, world&#39;</span><br><span class="line">&gt;&gt;&gt; &#39;Hi, %s, you have $%d.&#39; % (&#39;Michael&#39;, 1000000)</span><br><span class="line">&#39;Hi, Michael, you have $1000000.&#39;</span><br></pre></td></tr></table></figure>
<p>%d    整数<br>%f    浮点数<br>%s    字符串<br>%x    十六进制整数</p>
<h3 id="list"><a href="#list" class="headerlink" title="list"></a>list</h3><p>list是一种有序的集合，可以随时添加和删除其中的元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; classmates &#x3D; [&#39;Michael&#39;, &#39;Bob&#39;, &#39;Tracy&#39;]</span><br><span class="line">&gt;&gt;&gt; classmates</span><br><span class="line">[&#39;Michael&#39;, &#39;Bob&#39;, &#39;Tracy&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; len(classmates)</span><br><span class="line">3</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; classmates[0]</span><br><span class="line">&#39;Michael&#39;</span><br><span class="line">&gt;&gt;&gt; classmates[1]</span><br><span class="line">&#39;Bob&#39;</span><br><span class="line">&gt;&gt;&gt; classmates[2]</span><br><span class="line">&#39;Tracy&#39;</span><br><span class="line">&gt;&gt;&gt; classmates[-1]</span><br><span class="line">&#39;Tracy&#39;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; classmates.append(&#39;Adam&#39;)</span><br><span class="line">&gt;&gt;&gt; classmates</span><br><span class="line">[&#39;Michael&#39;, &#39;Bob&#39;, &#39;Tracy&#39;, &#39;Adam&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; classmates.insert(1, &#39;Jack&#39;)</span><br><span class="line">&gt;&gt;&gt; classmates</span><br><span class="line">[&#39;Michael&#39;, &#39;Jack&#39;, &#39;Bob&#39;, &#39;Tracy&#39;, &#39;Adam&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; classmates.pop()</span><br><span class="line">&#39;Adam&#39;</span><br><span class="line">&gt;&gt;&gt; classmates</span><br><span class="line">[&#39;Michael&#39;, &#39;Jack&#39;, &#39;Bob&#39;, &#39;Tracy&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; classmates.pop(1)</span><br><span class="line">&#39;Jack&#39;</span><br><span class="line">&gt;&gt;&gt; classmates</span><br><span class="line">[&#39;Michael&#39;, &#39;Bob&#39;, &#39;Tracy&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; classmates[1] &#x3D; &#39;Sarah&#39;</span><br><span class="line">&gt;&gt;&gt; classmates</span><br><span class="line">[&#39;Michael&#39;, &#39;Sarah&#39;, &#39;Tracy&#39;]</span><br></pre></td></tr></table></figure>
<p>list里面的元素的数据类型也可以不同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; L &#x3D; [&#39;Apple&#39;, 123, True]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>list元素也可以是另一个list，比如  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s &#x3D; [&#39;python&#39;, &#39;java&#39;, [&#39;asp&#39;, &#39;php&#39;], &#39;scheme&#39;]</span><br><span class="line">&gt;&gt;&gt; len(s)</span><br><span class="line">4</span><br></pre></td></tr></table></figure>
<h3 id="tuple"><a href="#tuple" class="headerlink" title="tuple"></a>tuple</h3><p>tuple和list非常类似，但是tuple一旦初始化就不能修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; classmates &#x3D; (&#39;Michael&#39;, &#39;Bob&#39;, &#39;Tracy&#39;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>只有1个元素的tuple定义时必须加一个逗号,，来消除歧义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; t &#x3D; (1,)</span><br><span class="line">&gt;&gt;&gt; t</span><br><span class="line">(1,)</span><br></pre></td></tr></table></figure>
<h3 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">age &#x3D; 3</span><br><span class="line">if age &gt;&#x3D; 18:</span><br><span class="line">    print(&#39;adult&#39;)</span><br><span class="line">elif age &gt;&#x3D; 6:</span><br><span class="line">    print(&#39;teenager&#39;)</span><br><span class="line">else:</span><br><span class="line">    print(&#39;kid&#39;)</span><br></pre></td></tr></table></figure>
<h3 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">names &#x3D; [&#39;Michael&#39;, &#39;Bob&#39;, &#39;Tracy&#39;]</span><br><span class="line">for name in names:</span><br><span class="line">    print(name)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sum &#x3D; 0</span><br><span class="line">n &#x3D; 99</span><br><span class="line">while n &gt; 0:</span><br><span class="line">    sum &#x3D; sum + n</span><br><span class="line">    n &#x3D; n - 2</span><br><span class="line">print(sum)</span><br></pre></td></tr></table></figure>
<h3 id="dict"><a href="#dict" class="headerlink" title="dict"></a>dict</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; &#123;&#39;Michael&#39;: 95, &#39;Bob&#39;: 75, &#39;Tracy&#39;: 85&#125;</span><br><span class="line">&gt;&gt;&gt; d[&#39;Michael&#39;]</span><br><span class="line">95</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; &#39;Thomas&#39; in d</span><br><span class="line">False</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; d.pop(&#39;Bob&#39;)</span><br><span class="line">75</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">&#123;&#39;Michael&#39;: 95, &#39;Tracy&#39;: 85&#125;</span><br></pre></td></tr></table></figure>
<h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><p>set和dict类似，也是一组key的集合，但不存储value。由于key不能重复，所以，在set中，没有重复的key。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s &#x3D; set([1, 1, 2, 2, 3, 3])</span><br><span class="line">&gt;&gt;&gt; s</span><br><span class="line">&#123;1, 2, 3&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s.add(4)</span><br><span class="line">&gt;&gt;&gt; s</span><br><span class="line">&#123;1, 2, 3, 4&#125;</span><br><span class="line">&gt;&gt;&gt; s.add(4)</span><br><span class="line">&gt;&gt;&gt; s</span><br><span class="line">&#123;1, 2, 3, 4&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s.remove(4)</span><br><span class="line">&gt;&gt;&gt; s</span><br><span class="line">&#123;1, 2, 3&#125;</span><br></pre></td></tr></table></figure>
<h3 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; abs(-20)</span><br><span class="line">20</span><br><span class="line">max(2, 3, 1, -5)</span><br><span class="line">3</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; int(12.34)</span><br><span class="line">12</span><br><span class="line">&gt;&gt;&gt; float(&#39;12.34&#39;)</span><br><span class="line">12.34</span><br><span class="line">&gt;&gt;&gt; str(1.23)</span><br><span class="line">&#39;1.23&#39;</span><br><span class="line">&gt;&gt;&gt; str(100)</span><br><span class="line">&#39;100&#39;</span><br><span class="line">&gt;&gt;&gt; bool(1)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; bool(&#39;&#39;)</span><br><span class="line">False</span><br></pre></td></tr></table></figure>
<h3 id="定义函数"><a href="#定义函数" class="headerlink" title="定义函数"></a>定义函数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def power(x):</span><br><span class="line">    return x * x</span><br></pre></td></tr></table></figure>
<p>默认参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def power(x, n&#x3D;2):</span><br><span class="line">    s &#x3D; 1</span><br><span class="line">    while n &gt; 0:</span><br><span class="line">        n &#x3D; n - 1</span><br><span class="line">        s &#x3D; s * x</span><br><span class="line">    return s</span><br></pre></td></tr></table></figure>
<p>可变参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">def calc(*numbers):</span><br><span class="line">    sum &#x3D; 0</span><br><span class="line">    for n in numbers:</span><br><span class="line">        sum &#x3D; sum + n * n</span><br><span class="line">    return sum</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; calc(1, 2)</span><br><span class="line">5</span><br><span class="line">&gt;&gt;&gt; calc()</span><br><span class="line">0</span><br><span class="line">&gt;&gt;&gt; nums &#x3D; [1, 2, 3]</span><br><span class="line">&gt;&gt;&gt; calc(*nums)</span><br><span class="line">14</span><br></pre></td></tr></table></figure>
<p>关键字参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">def person(name, age, **kw):</span><br><span class="line">    print(&#39;name:&#39;, name, &#39;age:&#39;, age, &#39;other:&#39;, kw)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; person(&#39;Bob&#39;, 35, city&#x3D;&#39;Beijing&#39;)</span><br><span class="line">name: Bob age: 35 other: &#123;&#39;city&#39;: &#39;Beijing&#39;&#125;</span><br><span class="line">&gt;&gt;&gt; person(&#39;Adam&#39;, 45, gender&#x3D;&#39;M&#39;, job&#x3D;&#39;Engineer&#39;)</span><br><span class="line">name: Adam age: 45 other: &#123;&#39;gender&#39;: &#39;M&#39;, &#39;job&#39;: &#39;Engineer&#39;&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; extra &#x3D; &#123;&#39;city&#39;: &#39;Beijing&#39;, &#39;job&#39;: &#39;Engineer&#39;&#125;</span><br><span class="line">&gt;&gt;&gt; person(&#39;Jack&#39;, 24, **extra)</span><br><span class="line">name: Jack age: 24 other: &#123;&#39;city&#39;: &#39;Beijing&#39;, &#39;job&#39;: &#39;Engineer&#39;&#125;</span><br></pre></td></tr></table></figure>
<p>命名关键字参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def person(name, age, **kw):</span><br><span class="line">    if &#39;city&#39; in kw:</span><br><span class="line">        # 有city参数</span><br><span class="line">        pass</span><br><span class="line">    if &#39;job&#39; in kw:</span><br><span class="line">        # 有job参数</span><br><span class="line">        pass</span><br><span class="line">    print(&#39;name:&#39;, name, &#39;age:&#39;, age, &#39;other:&#39;, kw)</span><br></pre></td></tr></table></figure>
<p>参数组合</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def f1(a, b, c&#x3D;0, *args, **kw):</span><br><span class="line">    print(&#39;a &#x3D;&#39;, a, &#39;b &#x3D;&#39;, b, &#39;c &#x3D;&#39;, c, &#39;args &#x3D;&#39;, args, &#39;kw &#x3D;&#39;, kw)</span><br><span class="line"></span><br><span class="line">def f2(a, b, c&#x3D;0, *, d, **kw):</span><br><span class="line">    print(&#39;a &#x3D;&#39;, a, &#39;b &#x3D;&#39;, b, &#39;c &#x3D;&#39;, c, &#39;d &#x3D;&#39;, d, &#39;kw &#x3D;&#39;, kw)</span><br></pre></td></tr></table></figure>
<h3 id="递归函数"><a href="#递归函数" class="headerlink" title="递归函数"></a>递归函数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def fact(n):</span><br><span class="line">    return fact_iter(n, 1)</span><br><span class="line"></span><br><span class="line">def fact_iter(num, product):</span><br><span class="line">    if num &#x3D;&#x3D; 1:</span><br><span class="line">        return product</span><br><span class="line">    return fact_iter(num - 1, num * product)</span><br></pre></td></tr></table></figure>
<h3 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; L &#x3D; [&#39;Michael&#39;, &#39;Sarah&#39;, &#39;Tracy&#39;, &#39;Bob&#39;, &#39;Jack&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; L[0:3]</span><br><span class="line">[&#39;Michael&#39;, &#39;Sarah&#39;, &#39;Tracy&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; L[:3]</span><br><span class="line">[&#39;Michael&#39;, &#39;Sarah&#39;, &#39;Tracy&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; L[-2:]</span><br><span class="line">[&#39;Bob&#39;, &#39;Jack&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; L[-2:-1]</span><br><span class="line">[&#39;Bob&#39;]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; L &#x3D; list(range(100))</span><br><span class="line">&gt;&gt;&gt; L</span><br><span class="line">[0, 1, 2, 3, ..., 99]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; L[:10:2]  # 前10个数，每两个取一个：</span><br><span class="line">[0, 2, 4, 6, 8]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; L[::5]  # 所有数，每5个取一个</span><br><span class="line">[0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75, 80, 85, 90, 95]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; L[:]  # 原样复制一个list</span><br><span class="line">[0, 1, 2, 3, ..., 99]</span><br></pre></td></tr></table></figure>
<h3 id="迭代"><a href="#迭代" class="headerlink" title="迭代"></a>迭代</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; &#123;&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;c&#39;: 3&#125;</span><br><span class="line">&gt;&gt;&gt; for key in d:</span><br><span class="line">...     print(key)</span><br><span class="line">...</span><br><span class="line">a</span><br><span class="line">c</span><br><span class="line">b</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; &#123;&#39;x&#39;: &#39;A&#39;, &#39;y&#39;: &#39;B&#39;, &#39;z&#39;: &#39;C&#39; &#125;</span><br><span class="line">&gt;&gt;&gt; for k, v in d.items():</span><br><span class="line">...     print(k, &#39;&#x3D;&#39;, v)</span><br><span class="line">...</span><br><span class="line">y &#x3D; B</span><br><span class="line">x &#x3D; A</span><br><span class="line">z &#x3D; C</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; for ch in &#39;ABC&#39;:</span><br><span class="line">...     print(ch)</span><br><span class="line">...</span><br><span class="line">A</span><br><span class="line">B</span><br><span class="line">C</span><br></pre></td></tr></table></figure>


<p>判断一个对象是可迭代对象：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import Iterable</span><br><span class="line">&gt;&gt;&gt; isinstance(&#39;abc&#39;, Iterable) # str是否可迭代</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; isinstance([1,2,3], Iterable) # list是否可迭代</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; isinstance(123, Iterable) # 整数是否可迭代</span><br><span class="line">False</span><br></pre></td></tr></table></figure>
<h3 id="列表生成"><a href="#列表生成" class="headerlink" title="列表生成"></a>列表生成</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; list(range(1, 11))</span><br><span class="line">[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; [x * x for x in range(1, 11)]</span><br><span class="line">[1, 4, 9, 16, 25, 36, 49, 64, 81, 100]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; [x * x for x in range(1, 11) if x % 2 &#x3D;&#x3D; 0]</span><br><span class="line">[4, 16, 36, 64, 100]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; &#123;&#39;x&#39;: &#39;A&#39;, &#39;y&#39;: &#39;B&#39;, &#39;z&#39;: &#39;C&#39; &#125;</span><br><span class="line">&gt;&gt;&gt; [k + &#39;&#x3D;&#39; + v for k, v in d.items()]</span><br><span class="line">[&#39;y&#x3D;B&#39;, &#39;x&#x3D;A&#39;, &#39;z&#x3D;C&#39;]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; L &#x3D; [&#39;Hello&#39;, &#39;World&#39;, &#39;IBM&#39;, &#39;Apple&#39;]</span><br><span class="line">&gt;&gt;&gt; [s.lower() for s in L]</span><br><span class="line">[&#39;hello&#39;, &#39;world&#39;, &#39;ibm&#39;, &#39;apple&#39;]</span><br></pre></td></tr></table></figure>
<h3 id="生成器"><a href="#生成器" class="headerlink" title="生成器"></a>生成器</h3><p>这种一边循环一边计算的机制，称为生成器：generator。<br>只要把一个列表生成式的[]改成()，就创建了一个generator  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; L &#x3D; [x * x for x in range(10)]</span><br><span class="line">&gt;&gt;&gt; L</span><br><span class="line">[0, 1, 4, 9, 16, 25, 36, 49, 64, 81]</span><br><span class="line">&gt;&gt;&gt; g &#x3D; (x * x for x in range(10))</span><br><span class="line">&gt;&gt;&gt; g</span><br><span class="line">&lt;generator object &lt;genexpr&gt; at 0x1022ef630&gt;</span><br></pre></td></tr></table></figure>
<h3 id="定义模块"><a href="#定义模块" class="headerlink" title="定义模块"></a>定义模块</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python3</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">&#39; a test module &#39;</span><br><span class="line"></span><br><span class="line">__author__ &#x3D; &#39;Michael Liao&#39;</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">def test():</span><br><span class="line">    args &#x3D; sys.argv</span><br><span class="line">    if len(args)&#x3D;&#x3D;1:</span><br><span class="line">        print(&#39;Hello, world!&#39;)</span><br><span class="line">    elif len(args)&#x3D;&#x3D;2:</span><br><span class="line">        print(&#39;Hello, %s!&#39; % args[1])</span><br><span class="line">    else:</span><br><span class="line">        print(&#39;Too many arguments!&#39;)</span><br><span class="line"></span><br><span class="line">if __name__&#x3D;&#x3D;&#39;__main__&#39;:</span><br><span class="line">    test()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="第三方模块"><a href="#第三方模块" class="headerlink" title="第三方模块"></a>第三方模块</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install Pillow</span><br></pre></td></tr></table></figure>
<p>默认情况下，Python解释器会搜索当前目录、所有已安装的内置模块和第三方模块，搜索路径存放在sys模块的path变量中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import sys</span><br><span class="line">&gt;&gt;&gt; sys.path</span><br><span class="line">[&#39;&#39;, &#39;&#x2F;Library&#x2F;Frameworks&#x2F;Python.framework&#x2F;Versions&#x2F;3.4&#x2F;lib&#x2F;python34.zip&#39;, &#39;&#x2F;Library&#x2F;Frameworks&#x2F;Python.framework&#x2F;Versions&#x2F;3.4&#x2F;lib&#x2F;python3.4&#39;, &#39;&#x2F;Library&#x2F;Frameworks&#x2F;Python.framework&#x2F;Versions&#x2F;3.4&#x2F;lib&#x2F;python3.4&#x2F;plat-darwin&#39;, &#39;&#x2F;Library&#x2F;Frameworks&#x2F;Python.framework&#x2F;Versions&#x2F;3.4&#x2F;lib&#x2F;python3.4&#x2F;lib-dynload&#39;, &#39;&#x2F;Library&#x2F;Frameworks&#x2F;Python.framework&#x2F;Versions&#x2F;3.4&#x2F;lib&#x2F;python3.4&#x2F;site-packages&#39;]</span><br></pre></td></tr></table></figure>
<p>添加自己的搜索目录，一是直接修改sys.path，添加要搜索的目录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import sys</span><br><span class="line">&gt;&gt;&gt; sys.path.append(&#39;&#x2F;Users&#x2F;michael&#x2F;my_py_scripts&#39;)</span><br></pre></td></tr></table></figure>
<p>第二种方法是设置环境变量PYTHONPATH，该环境变量的内容会被自动添加到模块搜索路径中。</p>
<h3 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class Student(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self, name, score):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.score &#x3D; score</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; bart &#x3D; Student(&#39;Bart Simpson&#39;, 59)</span><br><span class="line">&gt;&gt;&gt; bart.name</span><br><span class="line">&#39;Bart Simpson&#39;</span><br><span class="line">&gt;&gt;&gt; bart.score</span><br><span class="line">59</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class Student(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self, name, score):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.score &#x3D; score</span><br><span class="line"></span><br><span class="line">    def print_score(self):</span><br><span class="line">        print(&#39;%s: %s&#39; % (self.name, self.score))</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; bart.print_score()</span><br><span class="line">Bart Simpson: 59</span><br></pre></td></tr></table></figure>

<h3 id="访问限制"><a href="#访问限制" class="headerlink" title="访问限制"></a>访问限制</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">class Student(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self, name, score):</span><br><span class="line">        self.__name &#x3D; name</span><br><span class="line">        self.__score &#x3D; score</span><br><span class="line"></span><br><span class="line">    def print_score(self):</span><br><span class="line">        print(&#39;%s: %s&#39; % (self.__name, self.__score))</span><br><span class="line"></span><br><span class="line">    def get_name(self):</span><br><span class="line">        return self.__name</span><br><span class="line"></span><br><span class="line">    def get_score(self):</span><br><span class="line">        return self.__score</span><br><span class="line"></span><br><span class="line">    def set_score(self, score):</span><br><span class="line">        self.__score &#x3D; score</span><br></pre></td></tr></table></figure>
<h3 id="继承和多态"><a href="#继承和多态" class="headerlink" title="继承和多态"></a>继承和多态</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class Animal(object):</span><br><span class="line">    def run(self):</span><br><span class="line">        print(&#39;Animal is running...&#39;)</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class Dog(Animal):</span><br><span class="line"></span><br><span class="line">    def run(self):</span><br><span class="line">        print(&#39;Dog is running...&#39;)</span><br><span class="line"></span><br><span class="line">class Cat(Animal):</span><br><span class="line"></span><br><span class="line">    def run(self):</span><br><span class="line">        print(&#39;Cat is running...&#39;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; isinstance(a, list)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; isinstance(b, Animal)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; isinstance(c, Dog)</span><br><span class="line">True</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="获取对象信息"><a href="#获取对象信息" class="headerlink" title="获取对象信息"></a>获取对象信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; type(123)</span><br><span class="line">&lt;class &#39;int&#39;&gt;</span><br><span class="line">&gt;&gt;&gt; type(&#39;str&#39;)</span><br><span class="line">&lt;class &#39;str&#39;&gt;</span><br><span class="line">&gt;&gt;&gt; type(None)</span><br><span class="line">&lt;type(None) &#39;NoneType&#39;&gt;</span><br><span class="line">&gt;&gt;&gt; type(abs)</span><br><span class="line">&lt;class &#39;builtin_function_or_method&#39;&gt;</span><br><span class="line">&gt;&gt;&gt; type(a)</span><br><span class="line">&lt;class &#39;__main__.Animal&#39;&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import types</span><br><span class="line">&gt;&gt;&gt; def fn():</span><br><span class="line">...     pass</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; type(fn)&#x3D;&#x3D;types.FunctionType</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; type(abs)&#x3D;&#x3D;types.BuiltinFunctionType</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; type(lambda x: x)&#x3D;&#x3D;types.LambdaType</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; type((x for x in range(10)))&#x3D;&#x3D;types.GeneratorType</span><br><span class="line">True</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; isinstance(h, Husky)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; isinstance(&#39;a&#39;, str)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; isinstance(123, int)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; isinstance(b&#39;a&#39;, bytes)</span><br><span class="line">True</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt;&gt;&gt; dir(&#39;ABC&#39;)</span><br><span class="line">[&#39;__add__&#39;, &#39;__class__&#39;, &#39;__contains__&#39;, &#39;__delattr__&#39;, &#39;__dir__&#39;, &#39;__doc__&#39;, &#39;__eq__&#39;, &#39;__format__&#39;, &#39;__ge__&#39;, &#39;__getattribute__&#39;, &#39;__getitem__&#39;, &#39;__getnewargs__&#39;, &#39;__gt__&#39;, &#39;__hash__&#39;, &#39;__init__&#39;, &#39;__iter__&#39;, &#39;__le__&#39;, &#39;__len__&#39;, &#39;__lt__&#39;, &#39;__mod__&#39;, &#39;__mul__&#39;, &#39;__ne__&#39;, &#39;__new__&#39;, &#39;__reduce__&#39;, &#39;__reduce_ex__&#39;, &#39;__repr__&#39;, &#39;__rmod__&#39;, &#39;__rmul__&#39;, &#39;__setattr__&#39;, &#39;__sizeof__&#39;, &#39;__str__&#39;, &#39;__subclasshook__&#39;, &#39;capitalize&#39;, &#39;casefold&#39;, &#39;center&#39;, &#39;count&#39;, &#39;encode&#39;, &#39;endswith&#39;, &#39;expandtabs&#39;, &#39;find&#39;, &#39;format&#39;, &#39;format_map&#39;, &#39;index&#39;, &#39;isalnum&#39;, &#39;isalpha&#39;, &#39;isdecimal&#39;, &#39;isdigit&#39;, &#39;isidentifier&#39;, &#39;islower&#39;, &#39;isnumeric&#39;, &#39;isprintable&#39;, &#39;isspace&#39;, &#39;istitle&#39;, &#39;isupper&#39;, &#39;join&#39;, &#39;ljust&#39;, &#39;lower&#39;, &#39;lstrip&#39;, &#39;maketrans&#39;, &#39;partition&#39;, &#39;replace&#39;, &#39;rfind&#39;, &#39;rindex&#39;, &#39;rjust&#39;, &#39;rpartition&#39;, &#39;rsplit&#39;, &#39;rstrip&#39;, &#39;split&#39;, &#39;splitlines&#39;, &#39;startswith&#39;, &#39;strip&#39;, &#39;swapcase&#39;, &#39;title&#39;, &#39;translate&#39;, &#39;upper&#39;, &#39;zfill&#39;]</span><br></pre></td></tr></table></figure>
<h3 id="实例属性和类属性"><a href="#实例属性和类属性" class="headerlink" title="实例属性和类属性"></a>实例属性和类属性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; class Student(object):</span><br><span class="line">...     name &#x3D; &#39;Student&#39;</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; s &#x3D; Student() # 创建实例s</span><br><span class="line">&gt;&gt;&gt; print(s.name) # 打印name属性，因为实例并没有name属性，所以会继续查找class的name属性</span><br><span class="line">Student</span><br><span class="line">&gt;&gt;&gt; print(Student.name) # 打印类的name属性</span><br><span class="line">Student</span><br><span class="line">&gt;&gt;&gt; s.name &#x3D; &#39;Michael&#39; # 给实例绑定name属性</span><br><span class="line">&gt;&gt;&gt; print(s.name) # 由于实例属性优先级比类属性高，因此，它会屏蔽掉类的name属性</span><br><span class="line">Michael</span><br><span class="line">&gt;&gt;&gt; print(Student.name) # 但是类属性并未消失，用Student.name仍然可以访问</span><br><span class="line">Student</span><br><span class="line">&gt;&gt;&gt; del s.name # 如果删除实例的name属性</span><br><span class="line">&gt;&gt;&gt; print(s.name) # 再次调用s.name，由于实例的name属性没有找到，类的name属性就显示出来了</span><br><span class="line">Student</span><br></pre></td></tr></table></figure>
<h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">    print(&#39;try...&#39;)</span><br><span class="line">    r &#x3D; 10 &#x2F; 0</span><br><span class="line">    print(&#39;result:&#39;, r)</span><br><span class="line">except ZeroDivisionError as e:</span><br><span class="line">    print(&#39;except:&#39;, e)</span><br><span class="line">finally:</span><br><span class="line">    print(&#39;finally...&#39;)</span><br><span class="line">print(&#39;END&#39;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">def foo(s):</span><br><span class="line">    n &#x3D; int(s)</span><br><span class="line">    assert n !&#x3D; 0, &#39;n is zero!&#39;</span><br><span class="line">    return 10 &#x2F; n</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    foo(&#39;0&#39;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line"></span><br><span class="line">s &#x3D; &#39;0&#39;</span><br><span class="line">n &#x3D; int(s)</span><br><span class="line">logging.info(&#39;n &#x3D; %d&#39; % n)</span><br><span class="line">print(10 &#x2F; n)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python3 -m pdb err.py</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="文件读写"><a href="#文件读写" class="headerlink" title="文件读写"></a>文件读写</h3><p>读文件  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; f &#x3D; open(&#39;&#x2F;Users&#x2F;michael&#x2F;test.txt&#39;, &#39;r&#39;)</span><br><span class="line">&gt;&gt;&gt; f.read()</span><br><span class="line">&#39;Hello, world!&#39;</span><br><span class="line">&gt;&gt;&gt; f.close()</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">with open(&#39;&#x2F;path&#x2F;to&#x2F;file&#39;, &#39;r&#39;) as f:</span><br><span class="line">    print(f.read())</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for line in f.readlines():</span><br><span class="line">    print(line.strip())</span><br></pre></td></tr></table></figure>
<p>二进制文件  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; f &#x3D; open(&#39;&#x2F;Users&#x2F;michael&#x2F;test.jpg&#39;, &#39;rb&#39;)</span><br><span class="line">&gt;&gt;&gt; f.read()</span><br><span class="line">b&#39;\xff\xd8\xff\xe1\x00\x18Exif\x00\x00...&#39; # 十六进制表示的字节</span><br></pre></td></tr></table></figure>
<p>指定字符编码  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; f &#x3D; open(&#39;&#x2F;Users&#x2F;michael&#x2F;gbk.txt&#39;, &#39;r&#39;, encoding&#x3D;&#39;gbk&#39;)</span><br><span class="line">&gt;&gt;&gt; f.read()</span><br><span class="line">&#39;测试&#39;</span><br></pre></td></tr></table></figure>
<p>写文件  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; f &#x3D; open(&#39;&#x2F;Users&#x2F;michael&#x2F;test.txt&#39;, &#39;w&#39;)</span><br><span class="line">&gt;&gt;&gt; f.write(&#39;Hello, world!&#39;)</span><br><span class="line">&gt;&gt;&gt; f.close()</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">with open(&#39;&#x2F;Users&#x2F;michael&#x2F;test.txt&#39;, &#39;w&#39;) as f:</span><br><span class="line">    f.write(&#39;Hello, world!&#39;)</span><br></pre></td></tr></table></figure>
<h3 id="操作文件与目录"><a href="#操作文件与目录" class="headerlink" title="操作文件与目录"></a>操作文件与目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import os</span><br><span class="line">&gt;&gt;&gt; os.name # 操作系统类型</span><br><span class="line">&#39;posix&#39;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; os.uname()</span><br><span class="line">posix.uname_result(sysname&#x3D;&#39;Darwin&#39;, nodename&#x3D;&#39;MichaelMacPro.local&#39;, release&#x3D;&#39;14.3.0&#39;, version&#x3D;&#39;Darwin Kernel Version 14.3.0: Mon Mar 23 11:59:05 PDT 2015; root:xnu-2782.20.48~5&#x2F;RELEASE_X86_64&#39;, machine&#x3D;&#39;x86_64&#39;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; os.environ</span><br><span class="line">environ(&#123;&#39;VERSIONER_PYTHON_PREFER_32_BIT&#39;: &#39;no&#39;, &#39;TERM_PROGRAM_VERSION&#39;: &#39;326&#39;, &#39;LOGNAME&#39;: &#39;michael&#39;, &#39;USER&#39;: &#39;michael&#39;, &#39;PATH&#39;: &#39;&#x2F;usr&#x2F;bin:&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;opt&#x2F;X11&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#39;, ...&#125;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; os.environ.get(&#39;PATH&#39;)</span><br><span class="line">&#39;&#x2F;usr&#x2F;bin:&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;opt&#x2F;X11&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#39;</span><br><span class="line">&gt;&gt;&gt; os.environ.get(&#39;x&#39;, &#39;default&#39;)</span><br><span class="line">&#39;default&#39;</span><br><span class="line"></span><br><span class="line"># 查看当前目录的绝对路径:</span><br><span class="line">&gt;&gt;&gt; os.path.abspath(&#39;.&#39;)</span><br><span class="line">&#39;&#x2F;Users&#x2F;michael&#39;</span><br><span class="line"># 在某个目录下创建一个新目录，首先把新目录的完整路径表示出来:</span><br><span class="line">&gt;&gt;&gt; os.path.join(&#39;&#x2F;Users&#x2F;michael&#39;, &#39;testdir&#39;)</span><br><span class="line">&#39;&#x2F;Users&#x2F;michael&#x2F;testdir&#39;</span><br><span class="line"># 然后创建一个目录:</span><br><span class="line">&gt;&gt;&gt; os.mkdir(&#39;&#x2F;Users&#x2F;michael&#x2F;testdir&#39;)</span><br><span class="line"># 删掉一个目录:</span><br><span class="line">&gt;&gt;&gt; os.rmdir(&#39;&#x2F;Users&#x2F;michael&#x2F;testdir&#39;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; os.path.split(&#39;&#x2F;Users&#x2F;michael&#x2F;testdir&#x2F;file.txt&#39;)</span><br><span class="line">(&#39;&#x2F;Users&#x2F;michael&#x2F;testdir&#39;, &#39;file.txt&#39;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; os.path.splitext(&#39;&#x2F;path&#x2F;to&#x2F;file.txt&#39;)</span><br><span class="line">(&#39;&#x2F;path&#x2F;to&#x2F;file&#39;, &#39;.txt&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 对文件重命名:</span><br><span class="line">&gt;&gt;&gt; os.rename(&#39;test.txt&#39;, &#39;test.py&#39;)</span><br><span class="line"># 删掉文件:</span><br><span class="line">&gt;&gt;&gt; os.remove(&#39;test.py&#39;)</span><br></pre></td></tr></table></figure>

<h3 id="内建模块datatime"><a href="#内建模块datatime" class="headerlink" title="内建模块datatime"></a>内建模块datatime</h3><p>获取当前日期和时间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime</span><br><span class="line">&gt;&gt;&gt; now &#x3D; datetime.now() # 获取当前datetime</span><br><span class="line">&gt;&gt;&gt; print(now)</span><br><span class="line">2015-05-18 16:28:07.198690</span><br></pre></td></tr></table></figure>
<p>获取指定日期和时间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime</span><br><span class="line">&gt;&gt;&gt; dt &#x3D; datetime(2015, 4, 19, 12, 20) # 用指定日期时间创建datetime</span><br><span class="line">&gt;&gt;&gt; print(dt)</span><br><span class="line">2015-04-19 12:20:00</span><br></pre></td></tr></table></figure>
<p>datetime转换为timestamp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime</span><br><span class="line">&gt;&gt;&gt; dt &#x3D; datetime(2015, 4, 19, 12, 20) # 用指定日期时间创建datetime</span><br><span class="line">&gt;&gt;&gt; dt.timestamp() # 把datetime转换为timestamp</span><br><span class="line">1429417200.0</span><br></pre></td></tr></table></figure>
<p>timestamp转换为datetime</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime</span><br><span class="line">&gt;&gt;&gt; t &#x3D; 1429417200.0</span><br><span class="line">&gt;&gt;&gt; print(datetime.fromtimestamp(t))</span><br><span class="line">2015-04-19 12:20:00</span><br></pre></td></tr></table></figure>
<p>str转换为datetime</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime</span><br><span class="line">&gt;&gt;&gt; cday &#x3D; datetime.strptime(&#39;2015-6-1 18:19:59&#39;, &#39;%Y-%m-%d %H:%M:%S&#39;)</span><br><span class="line">&gt;&gt;&gt; print(cday)</span><br><span class="line">2015-06-01 18:19:59</span><br></pre></td></tr></table></figure>
<p>datetime转换为str</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime</span><br><span class="line">&gt;&gt;&gt; now &#x3D; datetime.now()</span><br><span class="line">&gt;&gt;&gt; print(now.strftime(&#39;%a, %b %d %H:%M&#39;))</span><br><span class="line">Mon, May 05 16:28</span><br></pre></td></tr></table></figure>
<p>datetime加减</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from datetime import datetime, timedelta</span><br><span class="line">&gt;&gt;&gt; now &#x3D; datetime.now()</span><br><span class="line">&gt;&gt;&gt; now</span><br><span class="line">datetime.datetime(2015, 5, 18, 16, 57, 3, 540997)</span><br><span class="line">&gt;&gt;&gt; now + timedelta(hours&#x3D;10)</span><br><span class="line">datetime.datetime(2015, 5, 19, 2, 57, 3, 540997)</span><br><span class="line">&gt;&gt;&gt; now - timedelta(days&#x3D;1)</span><br><span class="line">datetime.datetime(2015, 5, 17, 16, 57, 3, 540997)</span><br><span class="line">&gt;&gt;&gt; now + timedelta(days&#x3D;2, hours&#x3D;12)</span><br><span class="line">datetime.datetime(2015, 5, 21, 4, 57, 3, 540997)</span><br></pre></td></tr></table></figure>
<h3 id="内建模块base64"><a href="#内建模块base64" class="headerlink" title="内建模块base64"></a>内建模块base64</h3><p>Base64是一种用64个字符来表示任意二进制数据的方法。<br>Base64编码会把3字节的二进制数据编码为4字节的文本数据，长度增加33%。<br>如果二进制数据不是3的倍数，最后剩下1个或2个字节，Base64用<code>\x00</code>字节在末尾补足后，再在编码的末尾加上1个或2个=号，表示补了多少字节，解码的时候，会自动去掉。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import base64</span><br><span class="line">&gt;&gt;&gt; base64.b64encode(b&#39;binary\x00string&#39;)</span><br><span class="line">b&#39;YmluYXJ5AHN0cmluZw&#x3D;&#x3D;&#39;</span><br><span class="line">&gt;&gt;&gt; base64.b64decode(b&#39;YmluYXJ5AHN0cmluZw&#x3D;&#x3D;&#39;)</span><br><span class="line">b&#39;binary\x00string&#39;</span><br></pre></td></tr></table></figure>
<h3 id="内建模块hashlib"><a href="#内建模块hashlib" class="headerlink" title="内建模块hashlib"></a>内建模块hashlib</h3><p>hashlib提供了常见的摘要算法，如MD5，SHA1等等  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line">md5 &#x3D; hashlib.md5()</span><br><span class="line">md5.update(&#39;how to use md5 in python hashlib?&#39;.encode(&#39;utf-8&#39;))</span><br><span class="line">print(md5.hexdigest())</span><br><span class="line">d26a53750bc40b38b65a520292f69306</span><br></pre></td></tr></table></figure>
<h3 id="内建模块contextlib"><a href="#内建模块contextlib" class="headerlink" title="内建模块contextlib"></a>内建模块contextlib</h3><p>使用<code>try...finally</code>关闭资源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">    f &#x3D; open(&#39;&#x2F;path&#x2F;to&#x2F;file&#39;, &#39;r&#39;)</span><br><span class="line">    f.read()</span><br><span class="line">finally:</span><br><span class="line">    if f:</span><br><span class="line">        f.close()</span><br></pre></td></tr></table></figure>
<p>使用<code>with</code>关闭资源，必须实现了上下文管理（通过__enter__和__exit__）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">with open(&#39;&#x2F;path&#x2F;to&#x2F;file&#39;, &#39;r&#39;) as f:</span><br><span class="line">    f.read()</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">class Query(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self, name):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line"></span><br><span class="line">    def __enter__(self):</span><br><span class="line">        print(&#39;Begin&#39;)</span><br><span class="line">        return self</span><br><span class="line"></span><br><span class="line">    def __exit__(self, exc_type, exc_value, traceback):</span><br><span class="line">        if exc_type:</span><br><span class="line">            print(&#39;Error&#39;)</span><br><span class="line">        else:</span><br><span class="line">            print(&#39;End&#39;)</span><br><span class="line"></span><br><span class="line">    def query(self):</span><br><span class="line">        print(&#39;Query info about %s...&#39; % self.name)</span><br><span class="line"></span><br><span class="line">with Query(&#39;Bob&#39;) as q:</span><br><span class="line">    q.query()</span><br></pre></td></tr></table></figure>
<p>@contextmanager，用于简化<strong>enter__和__exit</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">from contextlib import contextmanager</span><br><span class="line"></span><br><span class="line">class Query(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self, name):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line"></span><br><span class="line">    def query(self):</span><br><span class="line">        print(&#39;Query info about %s...&#39; % self.name)</span><br><span class="line"></span><br><span class="line">@contextmanager</span><br><span class="line">def create_query(name):</span><br><span class="line">    print(&#39;Begin&#39;)</span><br><span class="line">    q &#x3D; Query(name)</span><br><span class="line">    yield q</span><br><span class="line">    print(&#39;End&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">with create_query(&#39;Bob&#39;) as q:</span><br><span class="line">    q.query()</span><br></pre></td></tr></table></figure>
<p>望在某段代码执行前后自动执行特定代码，也可以用@contextmanager实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@contextmanager</span><br><span class="line">def tag(name):</span><br><span class="line">    print(&quot;&lt;%s&gt;&quot; % name)</span><br><span class="line">    yield</span><br><span class="line">    print(&quot;&lt;&#x2F;%s&gt;&quot; % name)</span><br><span class="line"></span><br><span class="line">with tag(&quot;h1&quot;):</span><br><span class="line">    print(&quot;hello&quot;)</span><br><span class="line">    print(&quot;world&quot;)</span><br><span class="line"></span><br><span class="line">&lt;h1&gt;</span><br><span class="line">hello</span><br><span class="line">world</span><br><span class="line">&lt;&#x2F;h1&gt;</span><br></pre></td></tr></table></figure>
<p>@closing，把对象变为上下文对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from contextlib import closing</span><br><span class="line">from urllib.request import urlopen</span><br><span class="line"></span><br><span class="line">with closing(urlopen(&#39;https:&#x2F;&#x2F;www.python.org&#39;)) as page:</span><br><span class="line">    for line in page:</span><br><span class="line">        print(line)</span><br></pre></td></tr></table></figure>
<h3 id="内建模块urllib"><a href="#内建模块urllib" class="headerlink" title="内建模块urllib"></a>内建模块urllib</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from urllib import request</span><br><span class="line">with request.urlopen(&#39;https:&#x2F;&#x2F;api.douban.com&#x2F;v2&#x2F;book&#x2F;2129650&#39;) as f:</span><br><span class="line">    data &#x3D; f.read()</span><br><span class="line">    print(&#39;Status:&#39;, f.status, f.reason)</span><br><span class="line">    for k, v in f.getheaders():</span><br><span class="line">        print(&#39;%s: %s&#39; % (k, v))</span><br><span class="line">    print(&#39;Data:&#39;, data.decode(&#39;utf-8&#39;))</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">from urllib import request, parse</span><br><span class="line"></span><br><span class="line">print(&#39;Login to weibo.cn...&#39;)</span><br><span class="line">email &#x3D; input(&#39;Email: &#39;)</span><br><span class="line">passwd &#x3D; input(&#39;Password: &#39;)</span><br><span class="line">login_data &#x3D; parse.urlencode([</span><br><span class="line">    (&#39;username&#39;, email),</span><br><span class="line">    (&#39;password&#39;, passwd),</span><br><span class="line">    (&#39;entry&#39;, &#39;mweibo&#39;),</span><br><span class="line">    (&#39;client_id&#39;, &#39;&#39;),</span><br><span class="line">    (&#39;savestate&#39;, &#39;1&#39;),</span><br><span class="line">    (&#39;ec&#39;, &#39;&#39;),</span><br><span class="line">    (&#39;pagerefer&#39;, &#39;https:&#x2F;&#x2F;passport.weibo.cn&#x2F;signin&#x2F;welcome?entry&#x3D;mweibo&amp;r&#x3D;http%3A%2F%2Fm.weibo.cn%2F&#39;)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">req &#x3D; request.Request(&#39;https:&#x2F;&#x2F;passport.weibo.cn&#x2F;sso&#x2F;login&#39;)</span><br><span class="line">req.add_header(&#39;Origin&#39;, &#39;https:&#x2F;&#x2F;passport.weibo.cn&#39;)</span><br><span class="line">req.add_header(&#39;User-Agent&#39;, &#39;Mozilla&#x2F;6.0 (iPhone; CPU iPhone OS 8_0 like Mac OS X) AppleWebKit&#x2F;536.26 (KHTML, like Gecko) Version&#x2F;8.0 Mobile&#x2F;10A5376e Safari&#x2F;8536.25&#39;)</span><br><span class="line">req.add_header(&#39;Referer&#39;, &#39;https:&#x2F;&#x2F;passport.weibo.cn&#x2F;signin&#x2F;login?entry&#x3D;mweibo&amp;res&#x3D;wel&amp;wm&#x3D;3349&amp;r&#x3D;http%3A%2F%2Fm.weibo.cn%2F&#39;)</span><br><span class="line"></span><br><span class="line">with request.urlopen(req, data&#x3D;login_data.encode(&#39;utf-8&#39;)) as f:</span><br><span class="line">    print(&#39;Status:&#39;, f.status, f.reason)</span><br><span class="line">    for k, v in f.getheaders():</span><br><span class="line">        print(&#39;%s: %s&#39; % (k, v))</span><br><span class="line">    print(&#39;Data:&#39;, f.read().decode(&#39;utf-8&#39;))</span><br></pre></td></tr></table></figure>
<p>urllib可以用requests替代</p>
<h3 id="第三方模块PIL"><a href="#第三方模块PIL" class="headerlink" title="第三方模块PIL"></a>第三方模块PIL</h3><p>安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install pillow</span><br></pre></td></tr></table></figure>
<p>图像缩放</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image</span><br><span class="line"></span><br><span class="line"># 打开一个jpg图像文件，注意是当前路径:</span><br><span class="line">im &#x3D; Image.open(&#39;test.jpg&#39;)</span><br><span class="line"># 获得图像尺寸:</span><br><span class="line">w, h &#x3D; im.size</span><br><span class="line">print(&#39;Original image size: %sx%s&#39; % (w, h))</span><br><span class="line"># 缩放到50%:</span><br><span class="line">im.thumbnail((w&#x2F;&#x2F;2, h&#x2F;&#x2F;2))</span><br><span class="line">print(&#39;Resize image to: %sx%s&#39; % (w&#x2F;&#x2F;2, h&#x2F;&#x2F;2))</span><br><span class="line"># 把缩放后的图像用jpeg格式保存:</span><br><span class="line">im.save(&#39;thumbnail.jpg&#39;, &#39;jpeg&#39;)</span><br></pre></td></tr></table></figure>
<p>生成字母验证码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">from PIL import Image, ImageDraw, ImageFont, ImageFilter</span><br><span class="line">import random</span><br><span class="line"></span><br><span class="line"># 随机字母:</span><br><span class="line">def rndChar():</span><br><span class="line">    return chr(random.randint(65, 90))</span><br><span class="line"></span><br><span class="line"># 随机颜色1:</span><br><span class="line">def rndColor():</span><br><span class="line">    return (random.randint(64, 255), random.randint(64, 255), random.randint(64, 255))</span><br><span class="line"></span><br><span class="line"># 随机颜色2:</span><br><span class="line">def rndColor2():</span><br><span class="line">    return (random.randint(32, 127), random.randint(32, 127), random.randint(32, 127))</span><br><span class="line"></span><br><span class="line"># 240 x 60:</span><br><span class="line">width &#x3D; 60 * 4</span><br><span class="line">height &#x3D; 60</span><br><span class="line">image &#x3D; Image.new(&#39;RGB&#39;, (width, height), (255, 255, 255))</span><br><span class="line"># 创建Font对象:</span><br><span class="line">font &#x3D; ImageFont.truetype(&#39;Arial.ttf&#39;, 36)</span><br><span class="line"># 创建Draw对象:</span><br><span class="line">draw &#x3D; ImageDraw.Draw(image)</span><br><span class="line"># 填充每个像素:</span><br><span class="line">for x in range(width):</span><br><span class="line">    for y in range(height):</span><br><span class="line">        draw.point((x, y), fill&#x3D;rndColor())</span><br><span class="line"># 输出文字:</span><br><span class="line">for t in range(4):</span><br><span class="line">    draw.text((60 * t + 10, 10), rndChar(), font&#x3D;font, fill&#x3D;rndColor2())</span><br><span class="line"># 模糊:</span><br><span class="line">image &#x3D; image.filter(ImageFilter.BLUR)</span><br><span class="line">image.save(&#39;code.jpg&#39;, &#39;jpeg&#39;)</span><br></pre></td></tr></table></figure>
<h3 id="图形界面"><a href="#图形界面" class="headerlink" title="图形界面"></a>图形界面</h3><p>Python支持多种图形界面的第三方库，包括：  </p>
<ul>
<li>Tk  </li>
<li>wxWidgets  </li>
<li>Qt  </li>
<li>GTK<br>Python自带的库是支持Tk的Tkinter，使用Tkinter，无需安装任何包</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">from tkinter import *</span><br><span class="line">import tkinter.messagebox as messagebox</span><br><span class="line"></span><br><span class="line">class Application(Frame):</span><br><span class="line">    def __init__(self, master&#x3D;None):</span><br><span class="line">        Frame.__init__(self, master)</span><br><span class="line">        self.pack()</span><br><span class="line">        self.createWidgets()</span><br><span class="line"></span><br><span class="line">    def createWidgets(self):</span><br><span class="line">        self.nameInput &#x3D; Entry(self)</span><br><span class="line">        self.nameInput.pack()</span><br><span class="line">        self.alertButton &#x3D; Button(self, text&#x3D;&#39;Hello&#39;, command&#x3D;self.hello)</span><br><span class="line">        self.alertButton.pack()</span><br><span class="line"></span><br><span class="line">    def hello(self):</span><br><span class="line">        name &#x3D; self.nameInput.get() or &#39;world&#39;</span><br><span class="line">        messagebox.showinfo(&#39;Message&#39;, &#39;Hello, %s&#39; % name)</span><br><span class="line"></span><br><span class="line">app &#x3D; Application()</span><br><span class="line"># 设置窗口标题:</span><br><span class="line">app.master.title(&#39;Hello World&#39;)</span><br><span class="line"># 主消息循环:</span><br><span class="line">app.mainloop()</span><br></pre></td></tr></table></figure>
<h3 id="发送邮件"><a href="#发送邮件" class="headerlink" title="发送邮件"></a>发送邮件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">from email import encoders</span><br><span class="line">from email.header import Header</span><br><span class="line">from email.mime.text import MIMEText</span><br><span class="line">from email.utils import parseaddr, formataddr</span><br><span class="line"></span><br><span class="line">import smtplib</span><br><span class="line"></span><br><span class="line">def _format_addr(s):</span><br><span class="line">    name, addr &#x3D; parseaddr(s)</span><br><span class="line">    return formataddr((Header(name, &#39;utf-8&#39;).encode(), addr))</span><br><span class="line"></span><br><span class="line">from_addr &#x3D; input(&#39;From: &#39;)</span><br><span class="line">password &#x3D; input(&#39;Password: &#39;)</span><br><span class="line">to_addr &#x3D; input(&#39;To: &#39;)</span><br><span class="line">smtp_server &#x3D; input(&#39;SMTP server: &#39;)</span><br><span class="line"></span><br><span class="line">msg &#x3D; MIMEText(&#39;hello, send by Python...&#39;, &#39;plain&#39;, &#39;utf-8&#39;)</span><br><span class="line">msg[&#39;From&#39;] &#x3D; _format_addr(&#39;Python爱好者 &lt;%s&gt;&#39; % from_addr)</span><br><span class="line">msg[&#39;To&#39;] &#x3D; _format_addr(&#39;管理员 &lt;%s&gt;&#39; % to_addr)</span><br><span class="line">msg[&#39;Subject&#39;] &#x3D; Header(&#39;来自SMTP的问候……&#39;, &#39;utf-8&#39;).encode()</span><br><span class="line"></span><br><span class="line"># 邮件正文是MIMEText:</span><br><span class="line">msg.attach(MIMEText(&#39;send with file...&#39;, &#39;plain&#39;, &#39;utf-8&#39;))</span><br><span class="line"></span><br><span class="line"># 添加附件就是加上一个MIMEBase，从本地读取一个图片:</span><br><span class="line">with open(&#39;&#x2F;Users&#x2F;michael&#x2F;Downloads&#x2F;test.png&#39;, &#39;rb&#39;) as f:</span><br><span class="line">    # 设置附件的MIME和文件名，这里是png类型:</span><br><span class="line">    mime &#x3D; MIMEBase(&#39;image&#39;, &#39;png&#39;, filename&#x3D;&#39;test.png&#39;)</span><br><span class="line">    # 加上必要的头信息:</span><br><span class="line">    mime.add_header(&#39;Content-Disposition&#39;, &#39;attachment&#39;, filename&#x3D;&#39;test.png&#39;)</span><br><span class="line">    mime.add_header(&#39;Content-ID&#39;, &#39;&lt;0&gt;&#39;)</span><br><span class="line">    mime.add_header(&#39;X-Attachment-Id&#39;, &#39;0&#39;)</span><br><span class="line">    # 把附件的内容读进来:</span><br><span class="line">    mime.set_payload(f.read())</span><br><span class="line">    # 用Base64编码:</span><br><span class="line">    encoders.encode_base64(mime)</span><br><span class="line">    # 添加到MIMEMultipart:</span><br><span class="line">    msg.attach(mime)</span><br><span class="line"></span><br><span class="line">server &#x3D; smtplib.SMTP(smtp_server, 25)</span><br><span class="line">server.set_debuglevel(1)</span><br><span class="line">server.login(from_addr, password)</span><br><span class="line">server.sendmail(from_addr, [to_addr], msg.as_string())</span><br><span class="line">server.quit()</span><br></pre></td></tr></table></figure>

<h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install mysql-connector</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 导入MySQL驱动:</span><br><span class="line">&gt;&gt;&gt; import mysql.connector</span><br><span class="line"># 注意把password设为你的root口令:</span><br><span class="line">&gt;&gt;&gt; conn &#x3D; mysql.connector.connect(user&#x3D;&#39;root&#39;, password&#x3D;&#39;password&#39;, database&#x3D;&#39;test&#39;)</span><br><span class="line">&gt;&gt;&gt; cursor &#x3D; conn.cursor()</span><br><span class="line"># 创建user表:</span><br><span class="line">&gt;&gt;&gt; cursor.execute(&#39;create table user (id varchar(20) primary key, name varchar(20))&#39;)</span><br><span class="line"># 插入一行记录，注意MySQL的占位符是%s:</span><br><span class="line">&gt;&gt;&gt; cursor.execute(&#39;insert into user (id, name) values (%s, %s)&#39;, [&#39;1&#39;, &#39;Michael&#39;])</span><br><span class="line">&gt;&gt;&gt; cursor.rowcount</span><br><span class="line">1</span><br><span class="line"># 提交事务:</span><br><span class="line">&gt;&gt;&gt; conn.commit()</span><br><span class="line">&gt;&gt;&gt; cursor.close()</span><br><span class="line"># 运行查询:</span><br><span class="line">&gt;&gt;&gt; cursor &#x3D; conn.cursor()</span><br><span class="line">&gt;&gt;&gt; cursor.execute(&#39;select * from user where id &#x3D; %s&#39;, (&#39;1&#39;,))</span><br><span class="line">&gt;&gt;&gt; values &#x3D; cursor.fetchall()</span><br><span class="line">&gt;&gt;&gt; values</span><br><span class="line">[(&#39;1&#39;, &#39;Michael&#39;)]</span><br><span class="line"># 关闭Cursor和Connection:</span><br><span class="line">&gt;&gt;&gt; cursor.close()</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; conn.close()</span><br></pre></td></tr></table></figure>

<h3 id="多进程"><a href="#多进程" class="headerlink" title="多进程"></a>多进程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line"></span><br><span class="line">print(&#39;Process (%s) start...&#39; % os.getpid())</span><br><span class="line"># Only works on Unix&#x2F;Linux&#x2F;Mac:</span><br><span class="line">pid &#x3D; os.fork()</span><br><span class="line">if pid &#x3D;&#x3D; 0:</span><br><span class="line">    print(&#39;I am child process (%s) and my parent is %s.&#39; % (os.getpid(), os.getppid()))</span><br><span class="line">else:</span><br><span class="line">    print(&#39;I (%s) just created a child process (%s).&#39; % (os.getpid(), pid))</span><br></pre></td></tr></table></figure>
<p>multiprocessing模块就是跨平台版本的多进程模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from multiprocessing import Process</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line"># 子进程要执行的代码</span><br><span class="line">def run_proc(name):</span><br><span class="line">    print(&#39;Run child process %s (%s)...&#39; % (name, os.getpid()))</span><br><span class="line"></span><br><span class="line">if __name__&#x3D;&#x3D;&#39;__main__&#39;:</span><br><span class="line">    print(&#39;Parent process %s.&#39; % os.getpid())</span><br><span class="line">    p &#x3D; Process(target&#x3D;run_proc, args&#x3D;(&#39;test&#39;,))</span><br><span class="line">    print(&#39;Child process will start.&#39;)</span><br><span class="line">    p.start()</span><br><span class="line">    p.join()</span><br><span class="line">    print(&#39;Child process end.&#39;)</span><br></pre></td></tr></table></figure>
<p>用进程池的方式批量创建子进程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">from multiprocessing import Pool</span><br><span class="line">import os, time, random</span><br><span class="line"></span><br><span class="line">def long_time_task(name):</span><br><span class="line">    print(&#39;Run task %s (%s)...&#39; % (name, os.getpid()))</span><br><span class="line">    start &#x3D; time.time()</span><br><span class="line">    time.sleep(random.random() * 3)</span><br><span class="line">    end &#x3D; time.time()</span><br><span class="line">    print(&#39;Task %s runs %0.2f seconds.&#39; % (name, (end - start)))</span><br><span class="line"></span><br><span class="line">if __name__&#x3D;&#x3D;&#39;__main__&#39;:</span><br><span class="line">    print(&#39;Parent process %s.&#39; % os.getpid())</span><br><span class="line">    p &#x3D; Pool(4)</span><br><span class="line">    for i in range(5):</span><br><span class="line">        p.apply_async(long_time_task, args&#x3D;(i,))</span><br><span class="line">    print(&#39;Waiting for all subprocesses done...&#39;)</span><br><span class="line">    p.close()</span><br><span class="line">    p.join()</span><br><span class="line">    print(&#39;All subprocesses done.&#39;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201702/%E4%BD%BF%E7%94%A8Python3%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E7%88%AC%E8%99%AB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201702/%E4%BD%BF%E7%94%A8Python3%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E7%88%AC%E8%99%AB/" class="post-title-link" itemprop="url">使用Python3编写一个爬虫</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-02-20 15:06:10" itemprop="dateCreated datePublished" datetime="2017-02-20T15:06:10+08:00">2017-02-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-26 09:44:33" itemprop="dateModified" datetime="2021-01-26T09:44:33+08:00">2021-01-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="需求简介"><a href="#需求简介" class="headerlink" title="需求简介"></a>需求简介</h2><p>最近厂里有一个新闻采集类的需求，细节大体如下：</p>
<ol>
<li>模拟登录一个内网网站（SSO）</li>
<li>抓取新闻（支持代理服务器的方式访问）</li>
<li>加工内容样式，以适配手机屏幕</li>
<li>将正文中的图片转存到自已的服务器，并替换<img>标签中的url</li>
<li>图片存储服务器需要复用已有的FastDFS分布式文件系统</li>
<li>采集结果导入生产库</li>
<li>支持日志打印</li>
</ol>
<p>初学Python3，正好用这个需求练练手，最后很惊讶的是只用200多行代码就实现了，如果换成Java的话大概需要1200行吧。果然应了那句老话：<strong>人生苦短，我用Python</strong>  </p>
<h2 id="登录页面抓包"><a href="#登录页面抓包" class="headerlink" title="登录页面抓包"></a>登录页面抓包</h2><p>第一步当然是抓包，然后再根据抓到的内容，模拟进行HTTP请求。  </p>
<p>常用的抓包工具，有Mac下的Charles和Windows下的Fiddler。<br>它们的原理都是在本机开一个HTTP或SOCKS代理服务器端口，然后将浏览器的代理服务器设置成这个端口，这样浏览器中所有的HTTP请求都会先经过抓包工具记录下来了。  </p>
<ul>
<li><p>Chrales<br><a target="_blank" rel="noopener" href="https://www.charlesproxy.com/">https://www.charlesproxy.com</a><br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/p74nq.jpg"></p>
</li>
<li><p>Fiddler<br><a target="_blank" rel="noopener" href="http://www.telerik.com/fiddler">http://www.telerik.com/fiddler</a><br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/o552x.jpg"></p>
</li>
</ul>
<p>这里推荐尽量使用Fiddler，原因是Charles对于cookie的展示是有bug的，举个例子，真实情况：请求A返回了LtpaToken这个cookie，请求B中返回了sid这个cookie。但在Charles中的展示是：请求A中已经同时返回了LtpaToken和sid两个cookie，这就很容易误导人了。<br>另外Fiddler现在已经有了Linux的Beta版本，貌似是用类似wine的方式实现的。  </p>
<p>如果网站使用了单点登录，可能会涉及到手工生成cookie。所以不仅需要分析每一条HTTP请求的request和response，以及带回来的cookie，还要对页面中的javascript进行分析，看一下是如何生成cookie的。  </p>
<h2 id="模拟登录"><a href="#模拟登录" class="headerlink" title="模拟登录"></a>模拟登录</h2><p>将页面分析完毕之后，就可以进行模拟HTTP请求了。<br>这里有两个非常好用的第三方库， <strong>request</strong> 和 <strong>BeautifulSoup</strong></p>
<p><strong>requests</strong> 库是用来代替urllib的，可以非常人性化的的生成HTTP请求，模拟session以及伪造cookie更是方便。<br><strong>BeautifulSoup</strong> 用来代替re模块，进行HTML内容解析，可以用tag, class, id来定位想要提取的内容，也支持正则表达式等。  </p>
<p>具体的使用方式直接看官方文档就可以了，写的非常详细，这里直接给出地址：<br><a target="_blank" rel="noopener" href="http://cn.python-requests.org/zh_CN/latest/">requests官方文档</a><br><a target="_blank" rel="noopener" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc.zh/">BeautifulSoup官方文档</a>  </p>
<p>通过pip3来安装这两个模块:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python3-pip</span><br><span class="line">sudo pip3 install requests</span><br><span class="line">sudo pip3 install beautifulsoup4</span><br></pre></td></tr></table></figure>
<p>导入模块：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">from bs4 import BeautifulSoup</span><br></pre></td></tr></table></figure>

<p>模拟登录：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">def sso_login():</span><br><span class="line">    # 调用单点登录工号认证页面</span><br><span class="line">    response &#x3D; session.post(const.SSO_URL,</span><br><span class="line">                            data&#x3D;&#123;&#39;login&#39;: const.LOGIN_USERNAME, &#39;password&#39;: const.LOGIN_PASSWORD, &#39;appid&#39;: &#39;np000&#39;&#125;)</span><br><span class="line"></span><br><span class="line">    # 分析页面，取token及ltpa</span><br><span class="line">    soup &#x3D; BeautifulSoup(response.text, &#39;html.parser&#39;)</span><br><span class="line">    token &#x3D; soup.form.input.get(&#39;value&#39;)</span><br><span class="line">    ltpa &#x3D; soup.form.input.input.input.get(&#39;value&#39;)</span><br><span class="line">    ltpa_value &#x3D; ltpa.split(&#39;;&#39;)[0].split(&#39;&#x3D;&#39;, 1)[1]</span><br><span class="line"></span><br><span class="line">    # 手工设置Cookie</span><br><span class="line">    session.cookies.set(&#39;LtpaToken&#39;, ltpa_value, domain&#x3D;&#39;unicom.local&#39;, path&#x3D;&#39;&#x2F;&#39;)</span><br><span class="line"></span><br><span class="line">    # 调用云门户登录页面(2次）</span><br><span class="line">    payload &#x3D; &#123;&#39;token&#39;: token&#125;</span><br><span class="line">    session.post(const.LOGIN_URL, data&#x3D;payload, proxies&#x3D;const.PROXIES)</span><br><span class="line">    response &#x3D; session.post(const.LOGIN_URL, data&#x3D;payload, proxies&#x3D;const.PROXIES)</span><br><span class="line">    if response.text &#x3D;&#x3D; &quot;success&quot;:</span><br><span class="line">        logging.info(&quot;登录成功&quot;)</span><br><span class="line">        return True</span><br><span class="line">    else:</span><br><span class="line">        logging.info(&quot;登录失败&quot;)</span><br><span class="line">        return False</span><br></pre></td></tr></table></figure>
<p>这里用到了BeautifulSoup进行HTML解析，取出页面中的token、ltpa等字段。<br>然后使用session.cookies.set伪造了一个cookie，注意其中的domain参数，设置成1级域名。<br>然后用这个session，去调用网站页面，换回sid这个token。并可以根据页面的返回信息，来简单判断一下成功还是失败。</p>
<h2 id="列表页面抓取"><a href="#列表页面抓取" class="headerlink" title="列表页面抓取"></a>列表页面抓取</h2><p>登录成功之后，接下来的列表页面抓取就要简单的多了，不考虑分页的话，直接取一个list出来遍历即可。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">def capture_list(list_url):</span><br><span class="line">    response &#x3D; session.get(list_url, proxies&#x3D;const.PROXIES)</span><br><span class="line">    response.encoding &#x3D; &quot;UTF-8&quot;</span><br><span class="line">    soup &#x3D; BeautifulSoup(response.text, &#39;html.parser&#39;)</span><br><span class="line">    news_list &#x3D; soup.find(&#39;div&#39;, &#39;xinwen_list&#39;).find_all(&#39;a&#39;)</span><br><span class="line">    news_list.reverse()</span><br><span class="line">    logging.info(&quot;开始采集&quot;)</span><br><span class="line">    for news_archor in news_list:</span><br><span class="line">        news_cid &#x3D; news_archor.attrs[&#39;href&#39;].split(&#39;&#x3D;&#39;)[1]</span><br><span class="line">        capture_content(news_cid)</span><br><span class="line">    logging.info(&quot;结束采集&quot;)</span><br></pre></td></tr></table></figure>
<p>这里使用了<code>response.encoding = &quot;UTF-8&quot;</code>来手工解决乱码问题。  </p>
<h2 id="新联页面抓取"><a href="#新联页面抓取" class="headerlink" title="新联页面抓取"></a>新联页面抓取</h2><p>新闻页面抓取，涉及到插临时表，这里没有使用每三方库，直接用SQL方式插入。<br>其中涉及到样式处理与图片转存，另写一个模块<code>pconvert</code>来实现。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">def capture_content(news_cid):</span><br><span class="line">    # 建立DB连接</span><br><span class="line">    conn &#x3D; mysql.connector.connect(user&#x3D;const.DB_USERNAME, password&#x3D;const.DB_PASSWORD, host&#x3D;const.DB_HOST,</span><br><span class="line">                                   port&#x3D;const.DB_PORT, database&#x3D;const.DB_DATABASE)</span><br><span class="line">    cursor &#x3D; conn.cursor()</span><br><span class="line"></span><br><span class="line">    # 判断是否已存在</span><br><span class="line">    cursor.execute(&#39;select count(*) from material_prepare where news_cid &#x3D; %s&#39;, (news_cid,))</span><br><span class="line">    news_count &#x3D; cursor.fetchone()[0]</span><br><span class="line">    if news_count &gt; 0:</span><br><span class="line">        logging.info(&quot;采集&quot; + news_cid + &#39;:已存在&#39;)</span><br><span class="line">    else:</span><br><span class="line">        logging.info(&quot;采集&quot; + news_cid + &#39;:新增&#39;)</span><br><span class="line">        news_url &#x3D; const.NEWS_BASE_URL + news_cid</span><br><span class="line">        response &#x3D; session.post(news_url, proxies&#x3D;const.PROXIES)</span><br><span class="line">        response.encoding &#x3D; &quot;UTF-8&quot;</span><br><span class="line">        soup &#x3D; BeautifulSoup(response.text, &#39;html.parser&#39;)</span><br><span class="line">        # logging.info(soup)</span><br><span class="line">        news_title &#x3D; soup.h3.text.strip()[:64]</span><br><span class="line">        news_brief &#x3D; soup.find(&#39;div&#39;, &#39;brief&#39;).p.text.strip()[:100]</span><br><span class="line">        news_author &#x3D; soup.h5.span.a.text.strip()[:100]</span><br><span class="line">        news_content &#x3D; soup.find(&#39;table&#39;, &#39;unis_detail_content&#39;).tr.td.prettify()[66:-7].strip()</span><br><span class="line">        # 样式处理</span><br><span class="line">        news_content &#x3D; pconvert.convert_style(news_content)</span><br><span class="line">        # 将图片转存至DFS并替换URL</span><br><span class="line">        news_content &#x3D; pconvert.convert_img(news_content)</span><br><span class="line">        # 入表</span><br><span class="line">        cursor.execute(</span><br><span class="line">            &#39;INSERT INTO material_prepare (news_cid, title, author, summary, content, add_time, status)  VALUES  (%s, %s, %s, %s, %s, now(), &quot;0&quot;)&#39;</span><br><span class="line">            , [news_cid, news_title, news_author, news_brief, news_content])</span><br><span class="line">    # 提交</span><br><span class="line">    conn.commit()</span><br><span class="line">    cursor.close()</span><br></pre></td></tr></table></figure>
<h2 id="样式处理"><a href="#样式处理" class="headerlink" title="样式处理"></a>样式处理</h2><p>文本样式处理，还是要用到BeautifulSoup，因为原始站点上的新闻内容样式是五花八门的，根据实际情况，一边写一个test函数来生成文本，一边在浏览器上慢慢调试。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def convert_style(rawtext):</span><br><span class="line">    newtext &#x3D; &#39;&lt;div style&#x3D;&quot;margin-left: 0px; margin-right:0px; letter-spacing: 1px; word-spacing:2px;line-height: 1.7em; font-size:18px;text-align:justify; text-justify:inter-ideograph&quot;&gt;&#39; \</span><br><span class="line">              + rawtext + &#39;&lt;&#x2F;div&gt;&#39;</span><br><span class="line">    newtext &#x3D; newtext.replace(&#39; align&#x3D;&quot;center&quot;&#39;, &#39;&#39;)</span><br><span class="line">    soup &#x3D; BeautifulSoup(newtext, &#39;html.parser&#39;)</span><br><span class="line">    img_tags &#x3D; soup.find_all(&quot;img&quot;)</span><br><span class="line">    for img_tag in img_tags:</span><br><span class="line">        del img_tag.parent[&#39;style&#39;]</span><br><span class="line">    return soup.prettify()</span><br></pre></td></tr></table></figure>


<h2 id="图片转存至DFS"><a href="#图片转存至DFS" class="headerlink" title="图片转存至DFS"></a>图片转存至DFS</h2><p>因为原始站点是在内网中的，采集下来的HTML中，<img>标签的地址是内网地址，所以在公网中是展现不出来的，需要将图片转存，并用新的URL替换原有的URL。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def convert_img(rawtext):</span><br><span class="line">    soup &#x3D; BeautifulSoup(rawtext, &#39;html.parser&#39;)</span><br><span class="line">    img_tags &#x3D; soup.find_all(&quot;img&quot;)</span><br><span class="line">    for img_tag in img_tags:</span><br><span class="line">        raw_img_url &#x3D; img_tag[&#39;src&#39;]</span><br><span class="line">        dfs_img_url &#x3D; convert_url(raw_img_url)</span><br><span class="line">        img_tag[&#39;src&#39;] &#x3D; dfs_img_url</span><br><span class="line">        del img_tag[&#39;style&#39;]</span><br><span class="line">    return soup.prettify()</span><br></pre></td></tr></table></figure>
<p>图片转存最简单的方式是保存成本地的文件，然后再通过nginx或httpd服务将图片开放出去：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pic_name &#x3D; raw_img_url.split(&#39;&#x2F;&#39;)[-1]</span><br><span class="line">pic_path &#x3D; TMP_PATH + &#39;&#x2F;&#39; + pic_name</span><br><span class="line">with open(pic_path, &#39;wb&#39;) as pic_file:</span><br><span class="line">   pic_file.write(pic_content)</span><br></pre></td></tr></table></figure>
<p>但这里我们需要复用已有的FastDFS分布式文件系统，要用到它的一个客户端的库<code>fdfs_client-py</code><br>fdfs_client-py不能直接使用pip3安装，需要直接使用一个python3版的源码，并手工修改其中代码。操作过程如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;jefforeilly&#x2F;fdfs_client-py.git</span><br><span class="line">cd dfs_client-py</span><br><span class="line">vi .&#x2F;fdfs_client&#x2F;storage_client.py</span><br><span class="line">将第12行 from fdfs_client.sendfile import * 注释掉</span><br><span class="line">python3 setup.py install</span><br><span class="line"></span><br><span class="line">sudo pip3 install mutagen</span><br></pre></td></tr></table></figure>
<p>客户端的使用上没有什么特别的，直接调用<code>upload_by_buffer</code>，传一个图片的buffer进去就可以了，成功后会返回自动生成的文件名。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from fdfs_client.client import *</span><br><span class="line">dfs_client &#x3D; Fdfs_client(&#39;conf&#x2F;dfs.conf&#39;)</span><br><span class="line">def convert_url(raw_img_url):</span><br><span class="line">    response &#x3D; requests.get(raw_img_url, proxies&#x3D;const.PROXIES)</span><br><span class="line">    pic_buffer &#x3D; response.content</span><br><span class="line">    pic_ext &#x3D; raw_img_url.split(&#39;.&#39;)[-1]</span><br><span class="line">    response &#x3D; dfs_client.upload_by_buffer(pic_buffer, pic_ext)</span><br><span class="line">    dfs_img_url &#x3D; const.DFS_BASE_URL + &#39;&#x2F;&#39; + response[&#39;Remote file_id&#39;]</span><br><span class="line">    return dfs_img_url</span><br></pre></td></tr></table></figure>
<p>其中dfs.conf文件中，主要就是配置一下 <strong>tracker_server</strong></p>
<h2 id="日志处理"><a href="#日志处理" class="headerlink" title="日志处理"></a>日志处理</h2><p>这里使用配置文件的方式处理日志，类似JAVA中的log4j吧，首先新建一个<code>log.conf</code>：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[loggers]</span><br><span class="line">keys&#x3D;root</span><br><span class="line"></span><br><span class="line">[handlers]</span><br><span class="line">keys&#x3D;stream_handler,file_handler</span><br><span class="line"></span><br><span class="line">[formatters]</span><br><span class="line">keys&#x3D;formatter</span><br><span class="line"></span><br><span class="line">[logger_root]</span><br><span class="line">level&#x3D;DEBUG</span><br><span class="line">handlers&#x3D;stream_handler,file_handler</span><br><span class="line"></span><br><span class="line">[handler_stream_handler]</span><br><span class="line">class&#x3D;StreamHandler</span><br><span class="line">level&#x3D;DEBUG</span><br><span class="line">formatter&#x3D;formatter</span><br><span class="line">args&#x3D;(sys.stderr,)</span><br><span class="line"></span><br><span class="line">[handler_file_handler]</span><br><span class="line">class&#x3D;FileHandler</span><br><span class="line">level&#x3D;DEBUG</span><br><span class="line">formatter&#x3D;formatter</span><br><span class="line">args&#x3D;(&#39;logs&#x2F;pspider.log&#39;,&#39;a&#39;,&#39;utf8&#39;)</span><br><span class="line"></span><br><span class="line">[formatter_formatter]</span><br><span class="line">format&#x3D;%(asctime)s %(name)-12s %(levelname)-8s %(message)s</span><br></pre></td></tr></table></figure>
<p>这里通过配置handlers，可以同时将日志打印到stderr和文件。<br>注意<code>args=(&#39;logs/pspider.log&#39;,&#39;a&#39;,&#39;utf8&#39;)</code> 这一行，用来解决文本文件中的中文乱码问题。  </p>
<p>日志初始化：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line">from logging.config import fileConfig</span><br><span class="line"></span><br><span class="line">fileConfig(&#39;conf&#x2F;log.conf&#39;)</span><br></pre></td></tr></table></figure>
<p>日志打印：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.info(&quot;test&quot;)</span><br></pre></td></tr></table></figure>
<h2 id="完整源码"><a href="#完整源码" class="headerlink" title="完整源码"></a>完整源码</h2><p>到此为止，就是如何用Python3写一个爬虫的全部过程了。<br>采集不同的站点，肯定是要有不同的处理，但方法都是大同小异。<br>最后，将源码做了部分裁剪，分享在了GitHub上。<br><a target="_blank" rel="noopener" href="https://github.com/xiiiblue/pspider">https://github.com/xiiiblue/pspider</a><br>最后，将源码做了部分裁剪，分享在了GitLab上。<br><a target="_blank" rel="noopener" href="http://git.si-tech.com.cn/guolei/pspider">http://git.si-tech.com.cn/guolei/pspider</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201702/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7Redmine%E6%93%8D%E4%BD%9C%E6%89%8B%E5%86%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201702/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7Redmine%E6%93%8D%E4%BD%9C%E6%89%8B%E5%86%8C/" class="post-title-link" itemprop="url">项目管理工具Redmine操作手册</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-02-17 17:20:06" itemprop="dateCreated datePublished" datetime="2017-02-17T17:20:06+08:00">2017-02-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-26 09:44:33" itemprop="dateModified" datetime="2021-01-26T09:44:33+08:00">2021-01-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="什么是Redmine"><a href="#什么是Redmine" class="headerlink" title="什么是Redmine"></a>什么是Redmine</h2><p>Redmine是用Ruby On Rails开发的一款基于WEB的项目管理软件。<br>它集成了项目管理所需的各项功能，可以同时处理多个项目。<br>请重点关注 <strong>问题</strong>、<strong>甘特图</strong>、<strong>日历</strong> 三个功能模块。  </p>
<h2 id="我的工作台"><a href="#我的工作台" class="headerlink" title="我的工作台"></a>我的工作台</h2><p>点击左上角 <strong>我的工作台</strong> 按钮</p>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/exphn.jpg"></p>
<ul>
<li><strong>指派给我的问题</strong><br>提供一个跨项目的指派给当前用户的问题列表，显示问题的ID，项目，跟踪标类型签和主题。</li>
<li><strong>已报告的问题</strong><br>提供一个跨项目的由当前用户报告的问题列表，显示问题的ID，项目，跟踪标签类型和主题。 每一个用户可以通过点击”个性化定制本页”的链接个性化我的工作台。 然后用户可以选择哪些可用的模块被显示:</li>
<li><strong>日历</strong><br>提供一个跨项目的每周日历概述</li>
<li><strong>文档</strong><br>提供一个跨项目的最近文档概述</li>
<li><strong>最近的新闻</strong><br>提供一个跨项目的最近新闻概述</li>
<li><strong>耗时</strong><br>提供一个跨项目的关于当前用户最近7天工时的概述</li>
<li><strong>跟踪的问题</strong><br>提供一个跨项目的由当前用户跟踪的问题列表</li>
</ul>
<h2 id="项目概述"><a href="#项目概述" class="headerlink" title="项目概述"></a>项目概述</h2><p>点击左上角 <strong>项目</strong> 按钮，再点击 <strong>渠道移动营销</strong> 项目</p>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/zdths.jpg"></p>
<p>即可查看 <strong>项目概述</strong> 页面<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/6hcy3.jpg"></p>
<h2 id="项目活动"><a href="#项目活动" class="headerlink" title="项目活动"></a>项目活动</h2><p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/qryvj.jpg"><br>该页面列出了该项目所有活动的历史记录, 这些活动包括:</p>
<ul>
<li>问题</li>
<li>变更</li>
<li>新闻</li>
<li>文档</li>
<li>文件</li>
<li>Wiki编辑记录</li>
<li>帖子</li>
<li>耗时</li>
</ul>
<p>该页面的右边栏允许你选择具体显示哪类活动</p>
<h2 id="问题跟踪"><a href="#问题跟踪" class="headerlink" title="问题跟踪"></a>问题跟踪</h2><p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/0qe5i.jpg"></p>
<p>问题是Redmine的核心业务。 一个问题绑定到一个项目, 由某一用于创建, 可以关联到某一版本, 等等。</p>
<ul>
<li><p><strong>查看某一问题</strong><br>在问题列表页面点击某一问题的链接, 可以查看该问题的具体描述。</p>
</li>
<li><p><strong>过滤器的应用</strong><br>默认情况下, 问题列表显示了所有处于打开状态的问题。 你可以添加过滤器, 点击”应用”链接刷新问题列表, 点击”清除”链接删除设置的滤器。<br>可以通过点击”+”号按钮, 为过滤器字段选择多个值。 这时会出现一个选择列表, 按住”ctrl”后, 可选择多个值。</p>
</li>
<li><p><strong>自定义查询</strong><br>当刷新页面后, 刚设置的过滤器就会消失, 可以通过点击”保存”链接保存你设置的过滤器, 从而建立自定义查询。<br>在新建自定义查询的界面输入自定义查询的名称, 以及过滤器和其他属性的设置。<br>点击保存之后, 新建的自定义查询将会出现在问题列表界面的右边栏中。</p>
</li>
<li><p><strong>快捷菜单</strong><br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/7z5vr.jpg"><br>在问题列表的某一个问题上, 点击鼠标右键, 将弹出一个快捷菜单, 用于便捷编辑问题。<br>通过快捷菜单可以快修改问题的进度。  </p>
</li>
<li><p><strong>新建问题</strong><br>要创建新的问题, 需要有新建问题的权限。<br>创建问题时, 最重要的字段是跟踪标签字段, 它决定了问题的类型。<br>默认情况下, Redmine有三种跟踪标签:<br>功能 feature<br>缺陷 bug<br>支持 support  </p>
</li>
</ul>
<h2 id="日历"><a href="#日历" class="headerlink" title="日历"></a>日历</h2><p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/16h73.jpg">  </p>
<p>在问题列表页面, 点击右边栏的”日历”链接, 即可进入日历界面。<br>日历提供了一个按月份显示的项目预览。 在这里你可以看到一个任务状态的起止日期。<br>像Redmine提供的其他视图一样, 可以通过设置过滤器从而决定日历图上显示的内容。</p>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/10hlp.jpg"><br>注意3种图标的含义</p>
<h2 id="甘特图"><a href="#甘特图" class="headerlink" title="甘特图"></a>甘特图</h2><p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/6gsd0.jpg"></p>
<p>在问题列表页面, 点击右边栏的”甘特图”链接, 即可进入甘特图界面。<br>甘特图显示问题的起止日期以及版本的截至日期</p>
<h2 id="新闻"><a href="#新闻" class="headerlink" title="新闻"></a>新闻</h2><p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/3kvy8.jpg"></p>
<p>在”新闻”选项卡下, 你可以发布关于项目的新闻条目, 甚至任何你喜欢的新闻条目。</p>
<h2 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h2><p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/qjsf1.jpg"></p>
<p>在这里可以书写不同类型的文档, 默认有两种文档类型:</p>
<ul>
<li>用户文档</li>
<li>技术文档</li>
</ul>
<p>管理员可以添加文档类型</p>
<h2 id="Wiki"><a href="#Wiki" class="headerlink" title="Wiki"></a>Wiki</h2><p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/my2co.jpg"></p>
<p>在这里可以查看或编辑WIKI页面</p>
<h2 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h2><p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/x21ds.jpg"></p>
<p>在这里可以共享项目需要用到的其他资源</p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="https://www.oschina.net/question/84514_9314#id49">Redmine 用户手册</a>  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201702/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7Redmine%E7%9A%84%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201702/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7Redmine%E7%9A%84%E9%83%A8%E7%BD%B2/" class="post-title-link" itemprop="url">项目管理工具Redmine的部署</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-02-17 17:15:38" itemprop="dateCreated datePublished" datetime="2017-02-17T17:15:38+08:00">2017-02-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-11-06 15:48:00" itemprop="dateModified" datetime="2018-11-06T15:48:00+08:00">2018-11-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="什么是Redmine"><a href="#什么是Redmine" class="headerlink" title="什么是Redmine"></a>什么是Redmine</h2><p>Redmine是用Ruby On Rails开发的一款基于WEB的项目管理软件。<br>它集成了项目管理所需的各项功能：日历、甘特图、问题跟踪和版本控制，可以同时处理多个项目。  </p>
<p>相比禅道等软件，Redmine的安装还是比较繁琐的，一方面是因为它没有一个自动化的安装脚本，另一方面主要是个人对于Ruby初次接触，需要花一些时间在Ruby的学习上。<br>本文仅讨论Redmine的部署方式，关于Redmine使用今后会单独写一篇博文来讲解。  </p>
<h2 id="相关资源"><a href="#相关资源" class="headerlink" title="相关资源"></a>相关资源</h2><p><a target="_blank" rel="noopener" href="http://www.redmine.org/">官网WIKI</a>  </p>
<h2 id="主机环境"><a href="#主机环境" class="headerlink" title="主机环境"></a>主机环境</h2><p>RedHat/CentOS 6.X</p>
<h2 id="代理服务器配置"><a href="#代理服务器配置" class="headerlink" title="代理服务器配置"></a>代理服务器配置</h2><p>如果主机处于内网环境中，无法直连Internet时，需要首先配置可用的网络环境，最简单的方式是使用代理服务器。<br>关于代理服务器的搭建不再赘述了，可以使用<code>srelay</code>+<code>polipo</code>这样的组合，详细步骤请参考之前的一篇文章《内网主机Python3环境搭建》。  </p>
<p>代理服务器配置好之后，我们导入两条环境变量即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export http_proxy&#x3D;&quot;http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:31081&quot;</span><br><span class="line">export https_proxy&#x3D;&quot;http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:31081&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这时wget、curl、yum等已经可以正常使用了。</p>
<h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><p>首先使用yum安装一些基本依赖，以下只是一些参考，可以在具体编译时缺什么补什么。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install nano zip unzip libyaml-devel zlib-devel curl-devel openssl-devel httpd-devel apr-devel apr-util-devel mysql-devel gcc ruby-devel gcc-c++ make postgresql-devel ImageMagick-devel sqlite-devel perl-LDAP mod_perl perl-Digest-SHA</span><br></pre></td></tr></table></figure>
<h2 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h2><p>这里为了省事，使用最简单的yum的方式，直接在本机安装一套MySQL。yumd源中的MySQL版本比较老旧，是5.1.73。如果时间充裕的话，建议使用源码或二进制方式进行安装。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install mysql mysql-server</span><br></pre></td></tr></table></figure>
<p>将MySQL设置为开机自启，并手工启动服务：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chkconfig mysqld on</span><br><span class="line">service mysqld start</span><br></pre></td></tr></table></figure>
<p>初次运行，进行密码等安全性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;bin&#x2F;mysql_secure_installation</span><br></pre></td></tr></table></figure>
<p><code>Disallow root login remotely</code>这一项可以选NO</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Enter current password for root (enter for none):</span><br><span class="line">Set root password? [Y&#x2F;n] y</span><br><span class="line">Remove anonymous users? [Y&#x2F;n] y</span><br><span class="line">Disallow root login remotely? [Y&#x2F;n] n</span><br><span class="line">Remove test database and access to it? [Y&#x2F;n] y</span><br><span class="line">Reload privilege tables now? [Y&#x2F;n] y</span><br></pre></td></tr></table></figure>

<h2 id="新建MySQL数据库及用户"><a href="#新建MySQL数据库及用户" class="headerlink" title="新建MySQL数据库及用户"></a>新建MySQL数据库及用户</h2><p>直接在本机登录mysql，新建一个数据库及用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line">&gt; create database redmine_db character set utf8;</span><br><span class="line">&gt; create user &#39;redmine_admin&#39;@&#39;localhost&#39; identified by &#39;your_new_password&#39;;</span><br><span class="line">&gt; grant all privileges on redmine_db.* to &#39;redmine_admin&#39;@&#39;localhost&#39;;</span><br></pre></td></tr></table></figure>

<h2 id="关闭SELinux"><a href="#关闭SELinux" class="headerlink" title="关闭SELinux"></a>关闭SELinux</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;selinux&#x2F;config</span><br><span class="line">SELINUX&#x3D;disabled</span><br><span class="line"></span><br><span class="line">&#x2F;usr&#x2F;sbin&#x2F;setenforce 0 立刻关闭</span><br></pre></td></tr></table></figure>
<h2 id="配置iptables"><a href="#配置iptables" class="headerlink" title="配置iptables"></a>配置iptables</h2><p>配置iptables防火墙，将3000端口打开</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;sysconfig&#x2F;iptables</span><br><span class="line"></span><br><span class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 3000 -j ACCEPT</span><br></pre></td></tr></table></figure>
<p>重启iptables：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;init.d&#x2F;iptables restart</span><br></pre></td></tr></table></figure>
<h2 id="安装Ruby"><a href="#安装Ruby" class="headerlink" title="安装Ruby"></a>安装Ruby</h2><p>使用RVM进行Ruby的安装。RVM是一个命令行工具,可以提供一个便捷的多版本Ruby环境的管理和切换。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -L https:&#x2F;&#x2F;get.rvm.io | bash</span><br><span class="line">source &#x2F;etc&#x2F;profile.d&#x2F;rvm.sh</span><br></pre></td></tr></table></figure>
<p>列出已知的Ruby版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rvm list known</span><br></pre></td></tr></table></figure>
<p>这里我们选择安装2.3.0：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rvm install 2.3.0</span><br></pre></td></tr></table></figure>
<p>等待编译安装完成之后，可以查看一下版本号，确认安装成功：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ruby -v</span><br><span class="line">ruby 2.3.0p0 (2015-12-25 revision 53290) [x86_64-linux]</span><br></pre></td></tr></table></figure>

<h2 id="安装Rubygems"><a href="#安装Rubygems" class="headerlink" title="安装Rubygems"></a>安装Rubygems</h2><p>RubyGems简称gems，是一个用于对Ruby组件进行打包的Ruby打包系统。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install rubygems</span><br></pre></td></tr></table></figure>

<h2 id="下载Redmine"><a href="#下载Redmine" class="headerlink" title="下载Redmine"></a>下载Redmine</h2><p>我们新建一个redmine用户来进行接下来的操作。首先是从官网下载redmine的安装包并解压：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;www.redmine.org&#x2F;releases&#x2F;redmine-3.3.2.tar.gz</span><br><span class="line">tar -zxvf redmine-3.3.2.tar.gz</span><br><span class="line">mv redmine-3.3.2 redmine</span><br></pre></td></tr></table></figure>
<h2 id="配置数据库连接"><a href="#配置数据库连接" class="headerlink" title="配置数据库连接"></a>配置数据库连接</h2><p>从示例中复制一份database.yml出来：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;path&#x2F;to&#x2F;redmine&#x2F;config</span><br><span class="line">cp database.yml.example database.yml</span><br></pre></td></tr></table></figure>
<p>编辑database.yml，填写刚才新建的数据库的各项参数:   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vi database.yml</span><br><span class="line"></span><br><span class="line">production:</span><br><span class="line">  adapter: mysql2</span><br><span class="line">  database: redmine_db</span><br><span class="line">  host: localhost</span><br><span class="line">  username: redmine_admin</span><br><span class="line">  password: &quot;redmine_password&quot;</span><br><span class="line">  encoding: utf8</span><br></pre></td></tr></table></figure>
<h2 id="使用Bundle设置Rails"><a href="#使用Bundle设置Rails" class="headerlink" title="使用Bundle设置Rails"></a>使用Bundle设置Rails</h2><p>使用Bundle安装依赖的库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gem install bundler</span><br><span class="line">bundle install</span><br><span class="line">rake generate_secret_token</span><br></pre></td></tr></table></figure>
<h2 id="初始化数据库表及数据"><a href="#初始化数据库表及数据" class="headerlink" title="初始化数据库表及数据"></a>初始化数据库表及数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RAILS_ENV&#x3D;production rake db:migrate</span><br><span class="line">RAILS_ENV&#x3D;production rake redmine:load_default_data</span><br></pre></td></tr></table></figure>
<h2 id="设置文件系统权限"><a href="#设置文件系统权限" class="headerlink" title="设置文件系统权限"></a>设置文件系统权限</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p tmp tmp&#x2F;pdf public&#x2F;plugin_assets</span><br><span class="line">sudo chown -R redmine:redmine files log tmp public&#x2F;plugin_assets</span><br><span class="line">sudo chmod -R 755 files log tmp public&#x2F;plugin_assets</span><br></pre></td></tr></table></figure>
<h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bundle exec rails server -b 0.0.0.0 webrick -e production -d</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201611/Cordova%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201611/Cordova%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">Cordova常用操作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-19 15:06:14" itemprop="dateCreated datePublished" datetime="2016-12-19T15:06:14+08:00">2016-12-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-11-06 15:50:18" itemprop="dateModified" datetime="2018-11-06T15:50:18+08:00">2018-11-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>sudo npm install -g cordova<br>cordova create AppName<br>cordova platform add browser<br>cordova run browser<br>cordova platform add android –save<br>cordova platform ls<br>cordova requirements</p>
<h2 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h2><p>cordova build android<br>cordova build android -release<br>cordova emulate android</p>
<h2 id="配置XML"><a href="#配置XML" class="headerlink" title="配置XML"></a>配置XML</h2><p>vi config.xml<br>    <content src="http://IP:PORT/index.html" /><br>    <allow-navigation href="http://*/*" /><br>    <preference name="Fullscreen" value="true" /></p>
<h2 id="签名"><a href="#签名" class="headerlink" title="签名"></a>签名</h2><p>keytool -genkey -v -keystore release-key.keystore -alias cordova-demo -keyalg RSA -keysize 2048 -validity 10000<br>vi build.json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;android&quot;: &#123;</span><br><span class="line">    &quot;release&quot;: &#123;</span><br><span class="line">      &quot;keystore&quot;: &quot;release-key.keystore&quot;,</span><br><span class="line">      &quot;alias&quot;: &quot;cordova-demo&quot;,</span><br><span class="line">      &quot;storePassword&quot;: &quot;password&quot;,</span><br><span class="line">      &quot;password&quot;: &quot;password&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="禁用缓存"><a href="#禁用缓存" class="headerlink" title="禁用缓存"></a>禁用缓存</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import android.webkit.WebSettings;</span><br><span class="line">import android.webkit.WebView;</span><br><span class="line">@Override</span><br><span class="line">protected void onResume() &#123;</span><br><span class="line">    super.onResume();</span><br><span class="line">    &#x2F;&#x2F; Disable caching ..</span><br><span class="line">    WebView wv &#x3D; (WebView) appView.getEngine().getView();</span><br><span class="line">    WebSettings ws &#x3D; wv.getSettings();</span><br><span class="line">    ws.setAppCacheEnabled(false);</span><br><span class="line">    ws.setCacheMode(WebSettings.LOAD_NO_CACHE);</span><br><span class="line">    loadUrl(launchUrl); &#x2F;&#x2F; launchUrl is the default url specified in Config.xml</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201611/WebLogic%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201611/WebLogic%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">WebLogic集群配置</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-19 15:06:07" itemprop="dateCreated datePublished" datetime="2016-12-19T15:06:07+08:00">2016-12-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-11-06 15:52:16" itemprop="dateModified" datetime="2018-11-06T15:52:16+08:00">2018-11-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="通用操作"><a href="#通用操作" class="headerlink" title="通用操作"></a>通用操作</h2><h3 id="后台批杀进程"><a href="#后台批杀进程" class="headerlink" title="后台批杀进程"></a>后台批杀进程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef|grep java|grep webapp|grep -v grep|awk &#39;&#123;print $2&#125;&#39;|xargs kill</span><br></pre></td></tr></table></figure>
<h3 id="简单环境变量"><a href="#简单环境变量" class="headerlink" title="简单环境变量"></a>简单环境变量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export LANG&#x3D;C</span><br><span class="line">export PS1&#x3D;&#39;[\u@\H $PWD]\$&#39;</span><br><span class="line">stty erase ^H</span><br><span class="line">stty erase ^?</span><br></pre></td></tr></table></figure>
<p>注意：LANG=C在HP主机上可以解决乱码文件导致的server无法stage的启动问题，但Linux下似乎无效。</p>
<h3 id="生产环境分布式部署"><a href="#生产环境分布式部署" class="headerlink" title="生产环境分布式部署"></a>生产环境分布式部署</h3><ol>
<li>仅在管理Machine上建立Domain，有且只有一个AdminServer</li>
<li>被管Machine上不需要新建Domain，但需要启动NodeManager并nmEnroll()到AdminServer</li>
<li>Deployment方式，因为有文件乱码，选择第3项 I will make the deployment accessible from the following location。但正式部署时建议选择第二项Copy this application onto every target for me！方便版本发布。</li>
</ol>
<h3 id="Linux主机需优化启动参数配置"><a href="#Linux主机需优化启动参数配置" class="headerlink" title="Linux主机需优化启动参数配置"></a>Linux主机需优化启动参数配置</h3><ol>
<li>commEnv.sh  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;bea&#x2F;weblogic&#x2F;wlserver_10.3&#x2F;common&#x2F;bin&#x2F;commEnv.sh  </span><br><span class="line">约180行，在export JAVA_VM MEM_ARGS JAVA_OPTIONS前新增两行  </span><br><span class="line">MEM_ARGS&#x3D;&quot;-Xms32m -Xmx200m -XX:MaxPermSize&#x3D;128m&quot;  </span><br><span class="line">JAVA_OPTIONS&#x3D;&quot;$&#123;JAVA_OPTIONS&#125;   -Djava.security.egd&#x3D;file:&#x2F;dev&#x2F;zero&quot;  </span><br></pre></td></tr></table></figure></li>
<li>startNodeManager.sh  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;bea&#x2F;weblogic&#x2F;wlserver_10.3&#x2F;server&#x2F;bin&#x2F;startNodeManager.sh  </span><br><span class="line">约80行，新增以下内容  </span><br><span class="line">MEM_ARGS&#x3D;&quot;-Xms512m -Xmx512m -XX:MaxPermSize&#x3D;200m&quot;  </span><br><span class="line">JAVA_OPTIONS&#x3D;&quot;$&#123;JAVA_OPTIONS&#125;   -Djava.security.egd&#x3D;file:&#x2F;dev&#x2F;zero&quot;  </span><br><span class="line">export MEM_ARGS JAVA_OPTIONS  </span><br></pre></td></tr></table></figure></li>
<li>setDomainEnv.sh  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;ngbss&#x2F;webapp&#x2F;domains&#x2F;BSSTST&#x2F;bin&#x2F;setDomainEnv.sh  </span><br><span class="line">约375行 进行修改  </span><br><span class="line">JAVA_OPTIONS&#x3D;&quot;$&#123;JAVA_OPTIONS&#125; -Djava.security.egd&#x3D;file:&#x2F;dev&#x2F;zero&quot;  </span><br><span class="line">export JAVA_OPTIONS  </span><br></pre></td></tr></table></figure>
<h2 id="管理Machine上操作"><a href="#管理Machine上操作" class="headerlink" title="管理Machine上操作"></a>管理Machine上操作</h2><h3 id="建立domain"><a href="#建立domain" class="headerlink" title="建立domain"></a>建立domain</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;bea&#x2F;weblogic&#x2F;wlserver_10.3&#x2F;common&#x2F;bin&#x2F;config.sh</span><br></pre></td></tr></table></figure>
注意：将最新的boss.flds上传到domain下！</li>
</ol>
<h3 id="启动AdminServer"><a href="#启动AdminServer" class="headerlink" title="启动AdminServer"></a>启动AdminServer</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat&gt;start.sh</span><br><span class="line">nohup .&#x2F;startWebLogic.sh&gt;start.log 2&gt;&amp;1 &amp;</span><br><span class="line">^C</span><br></pre></td></tr></table></figure>
<h3 id="修改AdminServer启动参数"><a href="#修改AdminServer启动参数" class="headerlink" title="修改AdminServer启动参数"></a>修改AdminServer启动参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-server -Xms1024m -Xmx1024m -XX:MaxPermSize&#x3D;256m -Djava.awt.headless&#x3D;true -Dcharset&#x3D;GBK -Dfile.encoding&#x3D;GBK -Djava.security.egd&#x3D;file:&#x2F;dev&#x2F;zero</span><br><span class="line">注意：AdminServer中，Configuration-&gt;SSL-&gt;Advanced-&gt;Hostname Verification:None，否则报错：</span><br><span class="line">&lt;Nov 8, 2011 11:56:28 PM CST&gt; &lt;Warning&gt; &lt;Security&gt; &lt;BEA-090504&gt; &lt;Certificate chain received from 132.77.138.144 - 132.77.138.144 failed hostname verification check. Certificate contained bssweb2 but check expected 132.77.138.144&gt;</span><br></pre></td></tr></table></figure>
<p>注意：Automatically Acquire Lock and Activate Changes勾掉</p>
<h3 id="建立Machine"><a href="#建立Machine" class="headerlink" title="建立Machine"></a>建立Machine</h3><p>注意：端口与nodemanger.properties中的设置一致，一般为5556</p>
<h3 id="建立cluster"><a href="#建立cluster" class="headerlink" title="建立cluster"></a>建立cluster</h3><p>IP一般设为224.0.0.1~239.255.255.255<br>多播端口测试：<br>cd  /bea/weblogic/wlserver_10.3/server/lib</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp weblogic.jar  utils.MulticastTest -N server100 -A 224.0.0.110 -P 48001</span><br></pre></td></tr></table></figure>
<h3 id="建立server"><a href="#建立server" class="headerlink" title="建立server"></a>建立server</h3><p>注意：多网卡的主机上需绑定IP，否则远程启动server时启动参数中adminServer会与实际IP不一致</p>
<h3 id="部署deploy"><a href="#部署deploy" class="headerlink" title="部署deploy"></a>部署deploy</h3><p>注意：最后一步一般选择第3项 <code>I will make the deployment accessible from the following location</code>，需分别上传代码至每台主机，但会避免因乱码文件引起的server无法启动问题。<br>第2项：<code>Copy this application onto every target for me</code>，可以只在Admin主机上放置代码，Sever启动时自动上传部署。但如果有乱码文件则无法正常启动。<br>注意：根据application中UploadPath，建立相应上传目录</p>
<h3 id="JDBC配置"><a href="#JDBC配置" class="headerlink" title="JDBC配置"></a>JDBC配置</h3><p>注意：勾选Test Connection On Reserve，断开后自动连接</p>
<h3 id="配置控制台用户"><a href="#配置控制台用户" class="headerlink" title="配置控制台用户"></a>配置控制台用户</h3><p>通常为了weblogic console安全考虑，需要新建多个用户，区分不同的权限：<br>A．管理员：所有权限，主要是进行配置修改时使用<br>B．操作员：可以启停所有服务，主要是日常监控和更新程序使用<br>C．查看者：可以查看所有配合和服务情况，主要是日常监控和巡检使用<br>D．服务调用用户：只能发送T3消息，timerapp和ejb接口使用<br>建立3个用户：<br>administrator:Administrators password:administrator 所有权限<br>operator:Operators password:operator 可以启停不能修改<br>monitor:Monitors password:monitormonitor 只能查看，不能修改、启停  </p>
<h2 id="在被管Machine上操作"><a href="#在被管Machine上操作" class="headerlink" title="在被管Machine上操作"></a>在被管Machine上操作</h2><h3 id="复制nodemanager启动脚本"><a href="#复制nodemanager启动脚本" class="headerlink" title="复制nodemanager启动脚本"></a>复制nodemanager启动脚本</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cp &#x2F;bea&#x2F;weblogic&#x2F;wlserver_10.3&#x2F;server&#x2F;bin&#x2F;startNodeManager.sh ~</span><br><span class="line">cd ~</span><br><span class="line">mkdir nodemanager</span><br><span class="line">vi startNodeManager.sh</span><br><span class="line">NODEMGR_HOME&#x3D;&quot;&#x2F;ngbss&#x2F;webapp&#x2F;nodemanager&quot;</span><br></pre></td></tr></table></figure>
<h3 id="生成nodemanager-domains"><a href="#生成nodemanager-domains" class="headerlink" title="生成nodemanager.domains"></a>生成nodemanager.domains</h3><p>启动AdminServer后  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;bea&#x2F;weblogic&#x2F;wlserver_10.3&#x2F;common&#x2F;bin&#x2F;wlst.sh</span><br><span class="line">connect(&#39;weblogic&#39;,&#39;password&#39;,&#39;t3:&#x2F;&#x2F;xxx.xxx.xxx.xxx:6010&#39;)</span><br><span class="line">nmEnroll(&#39;&#x2F;ngbss&#x2F;bpsapp&#x2F;domains&#x2F;BpsDom&#39;,&#39;&#x2F;ngbss&#x2F;bpsapp&#x2F;nodemanager&#39;)</span><br><span class="line">exit()</span><br></pre></td></tr></table></figure>
<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="应用发布"><a href="#应用发布" class="headerlink" title="应用发布"></a>应用发布</h3><ol>
<li>版本发布不需要重启server，直接在Deployment界面update一下即可，或通过命令行方式java weblogic.Deployer操作，或通过WLST发布。</li>
<li>如果StageMode=stage，server启动时会报Failed to initialize the application ‘examples’ due to error weblogic.management.DeploymentException: Exception occured while downloading files，原因不明，此时需要再手工update一下。</li>
<li>脚本发布工具<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">帮助：  </span><br><span class="line">java -cp &#x2F;bea&#x2F;weblogic&#x2F;wlserver_10.3&#x2F;server&#x2F;lib&#x2F;weblogic.jar weblogic.Deployer -help</span><br><span class="line">重新发布：  </span><br><span class="line">java -cp &#x2F;bea&#x2F;weblogic&#x2F;wlserver_10.3&#x2F;server&#x2F;lib&#x2F;weblogic.jar weblogic.Deployer -adminurl t3:&#x2F;&#x2F;xxx.xxx.xxx.xxx:57001 -username weblogic -password password -name examples -targets testserver1 -redeploy</span><br><span class="line">重新发布部分页面：  </span><br><span class="line">java -cp &#x2F;bea&#x2F;weblogic&#x2F;wlserver_10.3&#x2F;server&#x2F;lib&#x2F;weblogic.jar weblogic.Deployer -adminurl t3:&#x2F;&#x2F;xxx.xxx.xxx.xxx:57001 -username weblogic -password password -name examples -targets testserver1 -redeploy &#x2F;ngbss&#x2F;webapp&#x2F;deployTST&#x2F;examples&#x2F;xxx.html</span><br></pre></td></tr></table></figure></li>
<li>WLST发布工具<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;bea&#x2F;weblogic&#x2F;wlserver_10.3&#x2F;common&#x2F;bin&#x2F;wlst.sh</span><br><span class="line">connect(&#39;weblogic&#39;,&#39;password&#39;,&#39;t3:&#x2F;&#x2F;xxx.xxx.xxx.xxx:57001&#39;)</span><br><span class="line">redeploy(&#39;exmples&#39;,&#39;&#x2F;ngbss&#x2F;webapp&#x2F;deployTST&#x2F;examples&#x2F;&#39;,targets&#x3D;&#39;testserver1&#39;,stageMode&#x3D;&#39;stage&#39;);</span><br></pre></td></tr></table></figure>
<h3 id="3DES加密"><a href="#3DES加密" class="headerlink" title="3DES加密"></a>3DES加密</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java  -cp &#x2F;bea&#x2F;weblogic&#x2F;wlserver_10.3&#x2F;server&#x2F;lib&#x2F;weblogic.jar weblogic.security.Encrypt test123456</span><br></pre></td></tr></table></figure>
<h3 id="WLST启停"><a href="#WLST启停" class="headerlink" title="WLST启停"></a>WLST启停</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">connect(&#39;weblogic&#39;,&#39;password&#39;,&#39;t3:&#x2F;&#x2F;xxx.xxx.xxx.xxx:6001&#39;)</span><br><span class="line">start(&#39;PROXY_CLUSTER&#39;, &#39;Cluster&#39;, block&#x3D;&#39;false&#39;)</span><br><span class="line">start(&#39;proxy_t_13&#39;, &#39;Server&#39;, block&#x3D;&#39;false&#39;)</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201612/AIX%E4%B8%8B%E9%9D%9Eroot%E5%AE%89%E8%A3%85sqlplus%E5%8F%8Amysql%E5%AE%A2%E6%88%B7%E7%AB%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201612/AIX%E4%B8%8B%E9%9D%9Eroot%E5%AE%89%E8%A3%85sqlplus%E5%8F%8Amysql%E5%AE%A2%E6%88%B7%E7%AB%AF/" class="post-title-link" itemprop="url">AIX下非root安装sqlplus及mysql客户端</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-19 14:24:32" itemprop="dateCreated datePublished" datetime="2016-12-19T14:24:32+08:00">2016-12-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-26 09:44:33" itemprop="dateModified" datetime="2021-01-26T09:44:33+08:00">2021-01-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>同事的一个新需求，需要在AIX上以shell脚本的方式，调用sqlplus客户端连接Oracle数据库，调用mysql客户端连接MySQL数据库。<br>想尽量简化开发，只用纯脚本方式实现，不想替换为Java或其它方案，且不想远程调用其它Linux主机上的客户端。<br>故需要在AIX上安装两个客户端（只有普通用户权限，没有root权限）。没什么太特别的地方，简单记录一下过程。   </p>
<h2 id="sqlplus客户端的安装"><a href="#sqlplus客户端的安装" class="headerlink" title="sqlplus客户端的安装"></a>sqlplus客户端的安装</h2><p>Oracle接供了AIX下的InstantClient二进制zip包，其中包含了sqlplus，安装起来比较简单，主要注意一下环境变量的设置。  </p>
<h3 id="下载InstantClient"><a href="#下载InstantClient" class="headerlink" title="下载InstantClient"></a>下载InstantClient</h3><p><a target="_blank" rel="noopener" href="http://www.oracle.com/technetwork/cn/database/features/instant-client/index-092699-zhs.html">这里是Oracle Instant Client的下载地址</a>  ，目前最新版本是11.2.0.1.0  </p>
<ol>
<li>首先根据系统，选择”适用于 AIX5L（64 位）的 Instant Client”<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/d3keo.jpg">  </li>
<li>然后再下载Basic和SQLPlus两个编译好的二进制包，注意两个都要下载<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/yl5kv.jpg">  </li>
</ol>
<h3 id="上传并解压"><a href="#上传并解压" class="headerlink" title="上传并解压"></a>上传并解压</h3><p>将下载好的两个包 <code>basic-11.2.0.1.0-aix-ppc64.zip</code> 和 <code>sqlplus-11.2.0.1.0-aix-ppc64.zip</code>上传至服务器，使用unzip解压至同一目录，例如： /path/to/instantclient。  </p>
<h3 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h3><p>编辑.profile文件，加入以下两行：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export PATH&#x3D;$PATH:&#x2F;path&#x2F;to&#x2F;instantclient</span><br><span class="line">export LIBPATH&#x3D;&#x2F;path&#x2F;to&#x2F;instantclient</span><br></pre></td></tr></table></figure>
<p>注意AIX下要设置LIBPATH环境变量，且只能填写InstantClient一个目录，不能用冒号分割加入其它目录。  </p>
<h2 id="mysql客户端的安装"><a href="#mysql客户端的安装" class="headerlink" title="mysql客户端的安装"></a>mysql客户端的安装</h2><p><a target="_blank" rel="noopener" href="http://dev.mysql.com/downloads/">MySQL官网</a> 目前只提供5.5~5.7的下载，且二进制ZIP包和RPM/DEB包主要针对Linux的各个发行版，没有对应的AIX版本。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/by3i2.jpg"><br>连源码包也是”Generic Linux”的，在AIX下编译的话编译器和依赖都会有问题。Google上可以搜索到MySQL 5.1版本在AIX下成功编译的<a target="_blank" rel="noopener" href="http://bluefinch-nl.blogspot.com/2014/05/installing-mysql-on-aix.html">案例</a>（需要一些trick），不过老源码目前在官网已经下载不到了。<br>第三方网站bullfreeware提供了5.5版本的RPM包。此种方式有安全风险，不过已经是唯一的方案了。  </p>
<h3 id="下载并处理RPM包"><a href="#下载并处理RPM包" class="headerlink" title="下载并处理RPM包"></a>下载并处理RPM包</h3><ol>
<li>在 <a target="_blank" rel="noopener" href="http://www.bullfreeware.com/affichage.php?id=1215">bullfreeware</a> 上下载MySQL5.5版本的客户端 <code>MySQL-client-5.5.10-1.aix5.3.ppc.rpm</code></li>
<li>因为我们是没有root权限的，所有无法直接安装rpm包，需要将包里的二进制内容提取出来直接拷贝到安装目录：<br>将rpm直接使用unzip解压，解出如下的目录结构：<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/trpgr.jpg"><br>直接将bin目录下的二进制文件取出来上传至服务器，路径例如： /path/to/mysqlclient</li>
</ol>
<h3 id="设置环境变量-1"><a href="#设置环境变量-1" class="headerlink" title="设置环境变量"></a>设置环境变量</h3><p>编辑.profile文件，加入PATH：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH&#x3D;$PATH:&#x2F;path&#x2F;to&#x2F;mysqlclient</span><br></pre></td></tr></table></figure>
<p>至此安装完毕  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201612/AIX%E4%B8%8B%E4%BD%BF%E7%94%A8zip+split%E5%AE%9E%E7%8E%B0%E5%88%86%E5%8D%B7%E5%8E%8B%E7%BC%A9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201612/AIX%E4%B8%8B%E4%BD%BF%E7%94%A8zip+split%E5%AE%9E%E7%8E%B0%E5%88%86%E5%8D%B7%E5%8E%8B%E7%BC%A9/" class="post-title-link" itemprop="url">AIX下使用zip+split实现分卷压缩</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-19 10:58:52" itemprop="dateCreated datePublished" datetime="2016-12-19T10:58:52+08:00">2016-12-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-11-06 15:49:28" itemprop="dateModified" datetime="2018-11-06T15:49:28+08:00">2018-11-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>与某第三方厂商使用文件接口传递数据。我们是发送方，对方是接收方，对方的接口规范要求对于大于500M文件，必须使用zip格式分卷压缩。<br>本来在linux下使用zip分卷压缩轻而易举，直接调用系统的zip命令，加上-b参数即可，但恰巧我们的接口机是台IBM小机，AIX系统下的zip不支持分卷功能，需要与split命令结合实现分卷功能。  </p>
<h2 id="实现方案"><a href="#实现方案" class="headerlink" title="实现方案"></a>实现方案</h2><ol>
<li>先使用zip命令将目录打包成单独的zip文件</li>
<li>使用split命令将zip文件拆分</li>
<li>对于拆分出来的散乱文件，按格式要求批量重命名</li>
</ol>
<h2 id="格式要求"><a href="#格式要求" class="headerlink" title="格式要求"></a>格式要求</h2><p>生成的文件名格式如下：<br>yyyymmdd_zzzz_RetentionPhotosSync_iiii_xxxx.zip<br>其中yyyymmdd为时间，xxxx为分卷序列号  </p>
<h2 id="分卷压缩脚本"><a href="#分卷压缩脚本" class="headerlink" title="分卷压缩脚本"></a>分卷压缩脚本</h2><p>下面以名为<code>testfolder</code>的目录为例，以5M大小，进行分卷  </p>
<h3 id="使用zip命令，将整个目录压缩成-zip（对于目录需要使用-r参数）"><a href="#使用zip命令，将整个目录压缩成-zip（对于目录需要使用-r参数）" class="headerlink" title="使用zip命令，将整个目录压缩成.zip（对于目录需要使用-r参数）"></a>使用zip命令，将整个目录压缩成.zip（对于目录需要使用-r参数）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip -r tmpfile.zip testfolder</span><br></pre></td></tr></table></figure>
<h3 id="使用split命令，以5M为单位，将-zip进行拆分，生成xaa、xab、xac…（以此类推）等多个文件"><a href="#使用split命令，以5M为单位，将-zip进行拆分，生成xaa、xab、xac…（以此类推）等多个文件" class="headerlink" title="使用split命令，以5M为单位，将.zip进行拆分，生成xaa、xab、xac…（以此类推）等多个文件"></a>使用split命令，以5M为单位，将.zip进行拆分，生成xaa、xab、xac…（以此类推）等多个文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">split -b 5m tmpfile.zip splitfile-</span><br></pre></td></tr></table></figure>
<h3 id="对于生成的xaa、xab、xac…散乱文件，按格式重命名"><a href="#对于生成的xaa、xab、xac…散乱文件，按格式重命名" class="headerlink" title="对于生成的xaa、xab、xac…散乱文件，按格式重命名"></a>对于生成的xaa、xab、xac…散乱文件，按格式重命名</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nowdate&#x3D;&#96;date +%Y%m%d&#96;;n&#x3D;0; for filename in &#96;ls splitfile* &#96;; do n&#x3D;&#96;expr $&#123;n&#125; + 1&#96;; suffix&#x3D;&#96;printf %04d $&#123;n&#125;&#96;; mv $&#123;filename&#125; $&#123;nowdate&#125;_zzzz_RetentionPhotosSync_iiii_$&#123;suffix&#125;.zip ; done</span><br></pre></td></tr></table></figure>
<h3 id="清理临时文件"><a href="#清理临时文件" class="headerlink" title="清理临时文件"></a>清理临时文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm tmpfile.zip</span><br></pre></td></tr></table></figure>
<h2 id="分卷解压脚本"><a href="#分卷解压脚本" class="headerlink" title="分卷解压脚本"></a>分卷解压脚本</h2><p>如果对端恰巧也是AIX系统，可以用如下方式解压缩  </p>
<h3 id="使用cat命令合并文件"><a href="#使用cat命令合并文件" class="headerlink" title="使用cat命令合并文件"></a>使用cat命令合并文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat yyyymmdd_zzzz_RetentionPhotosSync_iiii_*.zip &gt; yyyymmdd_zzzz_RetentionPhotosSync_iiii.zip</span><br></pre></td></tr></table></figure>
<h3 id="使用unzip命令解压"><a href="#使用unzip命令解压" class="headerlink" title="使用unzip命令解压"></a>使用unzip命令解压</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip yyyymmdd_zzzz_RetentionPhotosSync_iiii.zip</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201612/Git%E5%86%85%E9%83%A8%E5%9F%B9%E8%AE%AD%E8%AF%BE%E4%BB%B6-%E5%85%AC%E5%BC%80%E7%89%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201612/Git%E5%86%85%E9%83%A8%E5%9F%B9%E8%AE%AD%E8%AF%BE%E4%BB%B6-%E5%85%AC%E5%BC%80%E7%89%88/" class="post-title-link" itemprop="url">Git内部培训课件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-12-15 10:01:46" itemprop="dateCreated datePublished" datetime="2016-12-15T10:01:46+08:00">2016-12-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-26 09:44:33" itemprop="dateModified" datetime="2021-01-26T09:44:33+08:00">2021-01-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Git简介"><a href="#Git简介" class="headerlink" title="Git简介"></a>Git简介</h2><h3 id="什么是版本控制"><a href="#什么是版本控制" class="headerlink" title="什么是版本控制"></a>什么是版本控制</h3><p>版本控制系统（Version Control System，简称VCS）是一种记录一个或若干文件内容变化，以便将来查阅特定版本修订情况的系统。</p>
<p>按类型可以分为：  </p>
<ul>
<li><p>本地版本控制系统<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/2016-12-08-18333fig0101-tn.png"><br>例如RCS（至少我是从来没有用过）<br>本地版本控制系统解决了版本的管理问题，再也不用时不时的把工程目录，通过手工拷贝的方式来存档了。但本地版本控制系统的缺点是，无法解决多人协作的问题。</p>
</li>
<li><p>集中化的版本控制系统<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/2016-12-08-011528.jpg"><br>例如CVS，SVN等（公司中SVN应该用的比较多）<br>有一个集中管理的服务器，所有开发人员通过客户端连到这台服务器，取出最新的 <strong>文件</strong> 或者提交更新。管理员可以掌控每个开发者的权限。<br>集中化的VCS不但解决了版本控制问题，还可以多人协作。但缺点也是有的，就是太依赖于远程服务器，CVS服务器宕机后，会影响所有人的工作。版本记录只保存在一台服务器上，会有数据丢失风险。</p>
</li>
<li><p>分布式版本控制系统<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/2016-12-08-011814.jpg"><br>例如Git<br>客户端并不只提取最新版本的文件，而是把 <strong>代码仓库</strong> 完整地镜像下来。每一次的提取操作，实际上都是一次对 <strong>代码仓库</strong> 的完整备份。<br>所以并没有”中心服务器”的概念，所谓的”Git服务器”，也同每个人的电脑一样，只是为了多人协作时，方便大家交换数据而已。    </p>
</li>
</ul>
<h3 id="什么是Git"><a href="#什么是Git" class="headerlink" title="什么是Git"></a>什么是Git</h3><p>Git是目前世界上最先进的分布式版本控制系统（没有之一）<br>好不好用，看看它的开发者是谁就知道了：Linux之父 Linus Torvalds</p>
<p>小历史： Linux内核社区原本使用的是名为BitKeeper的商业化版本控制工具，2005年，因为社区内有人试图破解BitKeeper的协议，BitMover公司收回了免费使用BitKeeper的权力。<br>Linus原本可以出面道个歉，继续使用BitKeeper，然而并没有。。。Linus大神仅用了两周时间，自已用C写了一个分布式版本控制系统，于是Git诞生了！<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/2016-12-08-015752.jpg">  </p>
<h3 id="为什么要使用Git"><a href="#为什么要使用Git" class="headerlink" title="为什么要使用Git"></a>为什么要使用Git</h3><p>为什么要使用Git，或者说Git相比SVN有什么优势呢？</p>
<ul>
<li><p>分布式<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/dkkiz.jpg">  </p>
</li>
<li><p>分支管理<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/wirgm.jpg">  </p>
</li>
<li><p>GitHub<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/pr68v.jpg"></p>
</li>
</ul>
<h3 id="安装Git"><a href="#安装Git" class="headerlink" title="安装Git"></a>安装Git</h3><ul>
<li>大多数Linux发行版已经预装了Git，系统默认自带，如果不带。。可以源码make安装或使用yum/apt等直接安装，过程不赘述了。  </li>
<li>macOS下，安装Xcode后，它的CLI工具里应该会包含Git了。或者使用brew手工安装一下。</li>
<li>Windows下，可以直接下载安装 <a target="_blank" rel="noopener" href="https://git-for-windows.github.io/">msysGit</a> 。  或者如果你的机器上已经有Cygwin，也可以直接用在它下面安装Git。  </li>
<li>图形工具推荐使用 <a target="_blank" rel="noopener" href="https://www.sourcetreeapp.com/">SourceTree</a>，查看分支非常直观 。IntelliJ IDEA等IDE也会自带一些图形化的工具，在合并代码时很高效。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/p69yw.jpg"></li>
</ul>
<h3 id="学习路径"><a href="#学习路径" class="headerlink" title="学习路径"></a>学习路径</h3><ul>
<li>首先，忘掉SVN/CVS，不要把Git的各种操作与它们做类比，切记。  </li>
<li>刚开始不要依赖图形客户端。首先应该将精力用在理解原理上 -&gt; 然后掌握一些基本CLI命令，动手操作实践 -&gt; 最后在实际工作中使用GUI工具以提高效率。  </li>
<li>重度Windows用户使用Git时，与平时熟悉GUI的环境会有些违和感，毕竟Git是Linux下的产物，Git遵循Linux的哲学，Simple，简单直接，但Simple并不等于Easy。需要转换一下思维。</li>
</ul>
<h2 id="了解Git的工作原理"><a href="#了解Git的工作原理" class="headerlink" title="了解Git的工作原理"></a>了解Git的工作原理</h2><h3 id="记录文件整体快照"><a href="#记录文件整体快照" class="headerlink" title="记录文件整体快照"></a>记录文件整体快照</h3><p>Git和其他版本控制系统的主要差别在于，Git只关心文件数据的 <strong>整体</strong> 是否发生变化，而大多数其他系统则只关心 <strong>文件内容</strong> 的具体差异。</p>
<p>SVN在每个版本中，以单一文件为单位，记录各个文件的差异：<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/8wm7e.jpg"></p>
<p>Git在每个版本中，以当时的全部文件为单位，记录一个快照：<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/ufspp.jpg"></p>
<h3 id="大多数操作都在本地执行"><a href="#大多数操作都在本地执行" class="headerlink" title="大多数操作都在本地执行"></a>大多数操作都在本地执行</h3><p>Git的绝大多数操作都只需要访问本地文件和资源，不用连网。因为你的本机上，就已经是完整的代码库了。这样一来，在无法连接公司内网的环境中，也可以愉快的写代码了。<br>例如，如果想看当前版本的文件和一个月前的版本之间有何差异，Git会取出一个月前的快照和当前文件作一次差异运算，而不用每次都请求远程服务器。</p>
<h3 id="时刻保持数据完整性"><a href="#时刻保持数据完整性" class="headerlink" title="时刻保持数据完整性"></a>时刻保持数据完整性</h3><p>在保存到Git之前，所有数据都要进行内容的校验和（checksum）计算，并将此结果作为数据的唯一标识和索引。<br>这项特性作为Git的设计哲学，建在整体架构的最底层。所以如果文件在传输时变得不完整，或者磁盘损坏导致文件数据缺失，Git都能立即察觉。<br>Git使用SHA-1算法计算数据的校验和，通过对文件的内容或目录的结构计算出一个SHA-1哈希值，作为指纹字符串。该字串由40个十六进制字符组成，看起来就像是：<br><code>24b9da6552252987aa493b52f8696cd6d3b00373</code><br>Git的工作完全依赖于这类指纹字串，所以你会经常看到这样的哈希值。实际上，所有保存在 Git数据库中的东西都是用此哈希值来作索引的，而不是靠文件名。</p>
<h3 id="多数操作仅添加数据"><a href="#多数操作仅添加数据" class="headerlink" title="多数操作仅添加数据"></a>多数操作仅添加数据</h3><p>常用的Git操作大多仅仅是把数据添加到数据库，很难让Git执行任何不可逆操作。在Git中一旦提交快照之后就完全不用担心丢失数据，特别是养成定期推送到其他仓库的习惯的话。  </p>
<h3 id="文件的三种状态"><a href="#文件的三种状态" class="headerlink" title="文件的三种状态"></a>文件的三种状态</h3><p>对于任何一个文件，在 Git 内都只有三种状态：已提交（committed） 已修改（modified） 已暂存（staged）<br>已提交表示该文件已经被安全地保存在本地数据库中了；<br>已修改表示修改了某个文件，但还没有提交保存；<br>已暂存表示把已修改的文件放在下次提交时要保存的清单中。  </p>
<p>由此我们看到 Git 管理项目时，文件流转的三个工作区域：Git 的工作目录，暂存区域，以及本地仓库。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/7fm9z.jpg"></p>
<p>每个项目都有一个名为.git的目录，它是 Git用来保存元数据和对象数据库的地方。该目录非常重要，每次克隆镜像仓库的时候，实际拷贝的就是这个目录里面的数据。<br>从项目中取出某个版本的所有文件和目录，用以开始后续工作的叫做工作目录。这些文件实际上都是从Git目录中的压缩对象数据库中提取出来的，接下来就可以在工作目录中对这些文件进行编辑。<br>所谓的暂存区域只不过是个简单的文件，一般都放在 Git 目录中。有时候人们会把这个文件叫做索引文件，不过标准说法还是叫暂存区域。  </p>
<p>基本的 Git 工作流程如下：  </p>
<ol>
<li>在工作目录中修改某些文件。</li>
<li>对修改后的文件进行快照，然后保存到暂存区域。</li>
<li>提交更新，将保存在暂存区域的文件快照永久转储到 Git 目录中。</li>
</ol>
<p>所以，我们可以从文件所处的位置来判断状态：如果是Git目录中保存着的特定版本文件，就属于已提交状态；如果作了修改并已放入暂存区域，就属于已暂存状态；如果自上次取出后，作了修改但还没有放到暂存区域，就是已修改状态。</p>
<h2 id="创建版本库"><a href="#创建版本库" class="headerlink" title="创建版本库"></a>创建版本库</h2><p>有两种取得Git项目仓库的方法。第一种是在现存的目录下，通过导入所有文件来创建新的Git仓库。 第二种是从已有的Git仓库克隆出一个新的镜像仓库来。</p>
<h3 id="在目录中创建新仓库"><a href="#在目录中创建新仓库" class="headerlink" title="在目录中创建新仓库"></a>在目录中创建新仓库</h3><p>如果一个目录还没有使用Git进行管理，只需到此项目所在的目录，执行<code>git init</code>，初始化后，在当前目录下会出现一个名为.git的目录  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir learngit</span><br><span class="line">$ cd learngit</span><br><span class="line">$ git init</span><br></pre></td></tr></table></figure>
<h3 id="从已有的仓库克隆"><a href="#从已有的仓库克隆" class="headerlink" title="从已有的仓库克隆"></a>从已有的仓库克隆</h3><p>如果Git项目已经存在，可以使用<code>git clone</code>从远程服务器上复制一份出来，Git支持多种协议：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git clone mobgit@134.32.51.60:learngit.git  #使用SSH传输协议</span><br><span class="line">$ git clone git:&#x2F;&#x2F;134.32.51.60&#x2F;learngit.git  #使用Git传输协议</span><br><span class="line">$ git clone https:&#x2F;&#x2F;134.32.51.60&#x2F;learngit.git  #使用HTTPS传输协议</span><br></pre></td></tr></table></figure>

<h2 id="版本库基本操作"><a href="#版本库基本操作" class="headerlink" title="版本库基本操作"></a>版本库基本操作</h2><h3 id="检查当前文件状态"><a href="#检查当前文件状态" class="headerlink" title="检查当前文件状态"></a>检查当前文件状态</h3><p>使用<code>git status</code>命令可以查看文件的状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Initial commit</span><br><span class="line">nothing to commit (create&#x2F;copy files and use &quot;git add&quot; to track)</span><br></pre></td></tr></table></figure>
<p>出现如上的提示，说明现在的工作目录相当干净，所有已跟踪文件在上次提交后都未被更改过。</p>
<p>现在我们做一些改动，添加一个readme.txt进去，然后再看一下状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ cat&gt;readme.txt</span><br><span class="line">hello git</span><br><span class="line">^C</span><br><span class="line"></span><br><span class="line">git status</span><br><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">Initial commit</span><br><span class="line"></span><br><span class="line">Untracked files:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line">	readme.txt</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use &quot;git add&quot; to track)</span><br></pre></td></tr></table></figure>
<p>Untracked files显示了这个新创建的readme.txt处于未跟跟踪状态</p>
<h3 id="跟踪新文件"><a href="#跟踪新文件" class="headerlink" title="跟踪新文件"></a>跟踪新文件</h3><p>使用<code>git add</code>命令开始跟踪一个新文件  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">Initial commit</span><br><span class="line"></span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git rm --cached &lt;file&gt;...&quot; to unstage)</span><br><span class="line"></span><br><span class="line">	new file:   readme.txt</span><br></pre></td></tr></table></figure>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/5ixt6.jpg"><br>readme.txt已 <strong>被跟踪</strong> ，并处于 <strong>暂存状态</strong></p>
<h3 id="将本次修改暂存"><a href="#将本次修改暂存" class="headerlink" title="将本次修改暂存"></a>将本次修改暂存</h3><p>现在我们再对readme.txt进行修改，添加一行，再执行<code>git status</code>查看状态  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">Initial commit</span><br><span class="line"></span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git rm --cached &lt;file&gt;...&quot; to unstage)</span><br><span class="line"></span><br><span class="line">	new file:   readme.txt</span><br><span class="line"></span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line"></span><br><span class="line">	modified:   readme.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/z7r01.jpg"></p>
<p>可以看到readme.txt 不仅出现在了Changes to be committed，还出现在了Changes not staged for commit<br>由此可见，Git关心的是 <strong>Changes</strong> ，而不是文件本身。<br>再次执行<code>git add</code>，可以将 <strong>本次修改</strong> 提交到暂存区，Changes not staged for commit提示消失<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/ha8wl.jpg"></p>
<h3 id="提交更新"><a href="#提交更新" class="headerlink" title="提交更新"></a>提交更新</h3><p>使用<code>git commit</code>命令将暂存区中的内容提交至版本库，工作区又是干净的了  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m &quot;my first commit&quot;</span><br><span class="line">[master (root-commit) 6c8912a] my first commit</span><br><span class="line"> 1 file changed, 2 insertions(+)</span><br><span class="line"> create mode 100644 readme.txt</span><br><span class="line"></span><br><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is based on &#39;origin&#x2F;master&#39;, but the upstream is gone.</span><br><span class="line">  (use &quot;git branch --unset-upstream&quot; to fixup)</span><br><span class="line">nothing to commit, working tree clean</span><br></pre></td></tr></table></figure>
<p>注意：一定要使用-m参数加入注释，认真描述本次的提交具体做了些什么，这对于以后我们查询历史记录非常重要。  </p>
<p>如果觉得使用暂存区过于繁琐，可以在commit时直接使用-a参数，Git就会自动把所有已经跟踪过的文件暂存起来一并提交，从而跳过git add步骤。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -a -m &quot;my first commit&quot;</span><br></pre></td></tr></table></figure>
<h3 id="查看历史"><a href="#查看历史" class="headerlink" title="查看历史"></a>查看历史</h3><p>使用<code>git log</code>命令可以查看历史记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git log</span><br><span class="line">commit 43c5d337ffdd76f33ce5f5f90103d57e55474956</span><br><span class="line">Author: BlueXIII &lt;bluexiii@163.com&gt;</span><br><span class="line">Date:   Thu Dec 8 14:45:59 2016 +0800</span><br><span class="line"></span><br><span class="line">    this is my second commit</span><br><span class="line"></span><br><span class="line">commit 6c8912ad2a8e90a7ba32cc8578fd0069a205221b</span><br><span class="line">Author: BlueXIII &lt;bluexiii@163.com&gt;</span><br><span class="line">Date:   Thu Dec 8 14:38:09 2016 +0800</span><br><span class="line"></span><br><span class="line">    my first commit</span><br></pre></td></tr></table></figure>
<p>可以看到，每次更新都有一个SHA-1校验和、作者的名字和电子邮件地址、提交时间、提交说明。</p>
<h3 id="撤消操作"><a href="#撤消操作" class="headerlink" title="撤消操作"></a>撤消操作</h3><p>撤消操作在这里这里不做重点描述了，只列出几个常用命令。<br>修改最后一次提交：<br>git commit –amend<br>取消已经暂存的文件：<br>git reset HEAD readme.txt<br>取消对文件的修改：<br>git checkout – readme.txt</p>
<h2 id="远程仓库"><a href="#远程仓库" class="headerlink" title="远程仓库"></a>远程仓库</h2><p>之前介绍了在本地仓库的一些操作。但当与他人协作开发某个项目时，需要至少使用一个远程仓库，以便推送或拉取数据，分享各自的工作进展。  </p>
<h3 id="克隆远程库"><a href="#克隆远程库" class="headerlink" title="克隆远程库"></a>克隆远程库</h3><p>之前已经在讲新建仓库时已经提到，如何克隆远程库，这里再重复列一遍：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git clone mobgit@134.32.51.60:learngit.git  #使用SSH传输协议</span><br><span class="line">$ git clone git:&#x2F;&#x2F;134.32.51.60&#x2F;learngit.git  #使用Git传输协议</span><br><span class="line">$ git clone https:&#x2F;&#x2F;134.32.51.60&#x2F;learngit.git  #使用HTTPS传输协议</span><br></pre></td></tr></table></figure>
<h3 id="查看绑定的远程库"><a href="#查看绑定的远程库" class="headerlink" title="查看绑定的远程库"></a>查看绑定的远程库</h3><p>如果之前我们使用的<code>git clone</code>命令直接克隆了一个远程仓库到本机，Git就已经默认绑定了一个名为origin的远程库。当然我们还可以手工绑定其它远程库，远程仓库可以有多个。<br>使用<code>git remote -v</code>命令列出我们绑定了哪些远程库：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git remote -v</span><br><span class="line">origin	mobgit@134.32.51.60:learngit.git (fetch)</span><br><span class="line">origin	mobgit@134.32.51.60:learngit.git (push)</span><br></pre></td></tr></table></figure>
<p>接下来还可以使用<code>git remote show origin</code>来查看这个名为origin的远程库的更详细的信息，这里先不细讲  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ git remote show origin</span><br><span class="line">* remote origin</span><br><span class="line">  Fetch URL: mobgit@134.32.51.60:learngit.git</span><br><span class="line">  Push  URL: mobgit@134.32.51.60:learngit.git</span><br><span class="line">  HEAD branch (remote HEAD is ambiguous, may be one of the following):</span><br><span class="line">    dev</span><br><span class="line">    master</span><br><span class="line">    serverfix</span><br><span class="line">    serverfix2</span><br><span class="line">  Remote branches:</span><br><span class="line">    dev        tracked</span><br><span class="line">    master     tracked</span><br><span class="line">    serverfix  tracked</span><br><span class="line">    serverfix2 tracked</span><br><span class="line">  Local branches configured for &#39;git pull&#39;:</span><br><span class="line">    dev        merges with remote dev</span><br><span class="line">    master     merges with remote master</span><br><span class="line">    serverfix  merges with remote serverfix</span><br><span class="line">    serverfix2 merges with remote serverfix2</span><br><span class="line">  Local refs configured for &#39;git push&#39;:</span><br><span class="line">    dev        pushes to dev        (up to date)</span><br><span class="line">    master     pushes to master     (up to date)</span><br><span class="line">    serverfix  pushes to serverfix  (up to date)</span><br><span class="line">    serverfix2 pushes to serverfix2 (up to date)</span><br></pre></td></tr></table></figure>
<h3 id="手工添加一个远程仓库"><a href="#手工添加一个远程仓库" class="headerlink" title="手工添加一个远程仓库"></a>手工添加一个远程仓库</h3><p>我们先让管理员新建一个名为learngit2的远程仓库，再使用<code>remote add</code>命令将它添加进来，取名为repo2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add repo2 mobgit@134.32.51.60:learngit2.git</span><br><span class="line"></span><br><span class="line">$ git remote -v</span><br><span class="line">origin	mobgit@134.32.51.60:learngit.git (fetch)</span><br><span class="line">origin	mobgit@134.32.51.60:learngit.git (push)</span><br><span class="line">repo2	mobgit@134.32.51.60:learngit2.git (fetch)</span><br><span class="line">repo2	mobgit@134.32.51.60:learngit2.git (push)</span><br></pre></td></tr></table></figure>
<p>现在我们有origin和repo2两个远程仓库了</p>
<h3 id="从远程仓库抓取数据"><a href="#从远程仓库抓取数据" class="headerlink" title="从远程仓库抓取数据"></a>从远程仓库抓取数据</h3><p>使用<code>git fetch [remote-name]</code>从远程仓库抓取数据，注意fetch命令只是将远端的数据拉到本地仓库，并不自动合并到当前工作分支(关于分支稍后讲解)<br>例如要抓取名为origin远程仓库：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch origin</span><br></pre></td></tr></table></figure>
<h3 id="推送数据到远程仓库"><a href="#推送数据到远程仓库" class="headerlink" title="推送数据到远程仓库"></a>推送数据到远程仓库</h3><p>使用<code>git push [remote-name] [branch-name]</code>将本机的工作成果推送到远程仓库<br>例如要将本地的master分支推送到origin远程仓库上：    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin master</span><br></pre></td></tr></table></figure>
<h2 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h2><p>也许到之前为止，大家会觉得Git和Svn除了实现原理不同以及实现了分布式之外，在日常使用上并没有什么太大的区别（甚至更繁琐）。但接下来的分支，才是Git的精髓部分。  </p>
<h3 id="为什么要使用分支"><a href="#为什么要使用分支" class="headerlink" title="为什么要使用分支"></a>为什么要使用分支</h3><p>举个简单的例子：假设你准备开发一个新功能，但是需要两周才能完成，第一周你写了50%的代码，如果立刻提交，由于代码还没写完，不完整的代码库会导致别人不能干活了。如果等代码全部写完再一次提交，又存在丢失每天进度的巨大风险。<br>于是你创建了一个属于你自己的分支，别人看不到，还继续在原来的分支上正常工作，而你在自己的分支上干活，想提交就提交，直到开发完毕后，再一次性合并到原来的分支上，这样，既安全，又不影响别人工作。<br>相比于Svn等工具，Git创建、切换分支的开销是非常小的，Git鼓励 <strong>频繁使用分支</strong>  </p>
<h3 id="分支的原理"><a href="#分支的原理" class="headerlink" title="分支的原理"></a>分支的原理</h3><p>要理解分支，需要继续深入一下Git的工作原理</p>
<h4 id="Git如何储存数据"><a href="#Git如何储存数据" class="headerlink" title="Git如何储存数据"></a>Git如何储存数据</h4><p>在Git中提交时，会保存一个提交对象（commit object），该对象包含一个指向暂存内容快照的指针，并同时包含本次提交的作者等相关附属信息，包含零个或多个指向该提交对象的父对象指针（首次提交是没有直接祖先的，普通提交有一个祖先，由两个或多个分支合并产生的提交则有多个祖先）。  </p>
<p>假设在工作目录中有三个文件已经 <strong>修改</strong> 过，准备将它们暂存后提交。<br><code>git add</code>暂存操作时，会对 <strong>每一个文件</strong> 计算校验和，然后把当前版本的文件快照使用 <strong>blog对象</strong> 保存到Git仓库中（为提高性能，若文件没有变化，Git不会再次保存）。将它们的SHA-1校验和加入到暂存区域等待提交。<br><code>git commit</code>提交操作，时，Git首先会计算 <strong>每一个子目录</strong> 的校验和，然后将这些校验和保存为 <strong>tree对象</strong> 。 然后Git会创建一个 <strong>commit对象</strong> ，它包含指向这个树对象的指针及注释、提交人、邮箱等信息。<br>现在，Git仓库中有五个对象：三个blob 对象（保存着文件快照）;一个树对象（记录着目录结构和blob对象索引）以及一个提交对象（包含着指向前述树对象的指针和所有提交信息）。</p>
<p>单个提交对象在仓库中的数据结构：<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/xwmo5.jpg"><br>多个提交对象之间的链接关系：<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/yt3l3.jpg">  </p>
<h4 id="分支是什么"><a href="#分支是什么" class="headerlink" title="分支是什么"></a>分支是什么</h4><p><strong>Git 中的分支，其实本质上仅仅是个指向commit对象的可变指针</strong>。Git会使用master作为分支的默认名字。在若干次提交后，你其实已经有了一个指向最后一次commit对象的master分支。它在每次提交的时候都会自动向前移动。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/wf4i2.jpg"></p>
<p>创建名为testing的新的分支，本质上就是创建一个指针，可以使用<code>git branch</code>命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch testing</span><br></pre></td></tr></table></figure>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/q33ki.jpg"></p>
<h4 id="当前工作在哪个分支"><a href="#当前工作在哪个分支" class="headerlink" title="当前工作在哪个分支"></a>当前工作在哪个分支</h4><p>Git 是如何知道你当前在哪个分支上工作的呢？其实答案也很简单，它还保存着一个名为HEAD的特别指针。它是一个指向你正在工作中的本地分支的指针。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/p88bo.jpg"></p>
<h4 id="切换分支时发生了什么"><a href="#切换分支时发生了什么" class="headerlink" title="切换分支时发生了什么"></a>切换分支时发生了什么</h4><p>切换分支，本质上就是移动HEAD指针。<br>要切换到其他分支，可以执行<code>git checkout</code>命令。我们现在转换到刚才新建的testing分支：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout testing</span><br></pre></td></tr></table></figure>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/mgh91.jpg"></p>
<h3 id="分支切换的实际操作"><a href="#分支切换的实际操作" class="headerlink" title="分支切换的实际操作"></a>分支切换的实际操作</h3><p>为了更好的理解分支，我们接下来模拟实际工作中的场景，进行一系列的切换操作。<br>现在我们已经处于testing分支了，目前testing分支和master分支都是指向同一个commit，所以我们的工作区的内容现在还没有什么变化。<br>现在，我们要在testing分支上做一些文件修改，然后commit:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;testing branch&quot;&gt;&gt;readme.txt</span><br><span class="line">git commit -a -m &quot;modify on testing branch&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/gbveu.jpg"><br>提交后，产生了一个新的commit对象，并且HEAD随着当前testing分支一起向前移动。而master分支则是停在原地不动。</p>
<p>我们可以试着使用<code>git checkout</code>命令切回master分支，看看发生了什么:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br></pre></td></tr></table></figure>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/xfrf7.jpg"><br>这条命令做了两件事：  </p>
<ol>
<li>它把HEAD指针移回到 master 分支。</li>
<li>把工作目录中的文件换成了master分支所指向的快照内容。</li>
</ol>
<p>我们试着在master上再做一些改动并commit：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;testing master&quot;&gt;&gt;readme.txt</span><br><span class="line">git commit -a -m &quot;modify on master branch&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/vs6o3.jpg"><br>现在分支变成了上图所示，我们可以在master与testing间随时切换，并修改工作区的文件内容。必要时再将这两个分支合并。</p>
<h3 id="分支新建与合并的实际操作"><a href="#分支新建与合并的实际操作" class="headerlink" title="分支新建与合并的实际操作"></a>分支新建与合并的实际操作</h3><p>接下来，再以一个比较长的真实的工作场景进行举例</p>
<p>我们首先在master分支上进行工作，并提交了几次更新，测试无误后编译发布至生产系统。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/hh1wm.jpg"></p>
<p>之后我们决定要修补问题追踪系统上的53号问题，这时可以使用<code>git checkout -b</code>命令快速创建一个分支并切换过去：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b iss53</span><br></pre></td></tr></table></figure>
<p>这相当于执行了下面这两条命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git branch iss53</span><br><span class="line">$ git checkout iss53</span><br></pre></td></tr></table></figure>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/v3a5l.jpg"></p>
<p>我们在iss53分支上写了一些代码，并commit  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ vi index.html</span><br><span class="line">$ git commit -a -m &#39;fixed the broken email address&#39;</span><br></pre></td></tr></table></figure>
<p>iss53上的工作还没完成，突然接到通知，生产系统有一个紧急BUG需要立刻修复。所以我们首先切回master分支，然后在master的基础上，又新建出一个hotfix分支来修复BUG。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master    #回到master分支</span><br><span class="line">$ git checkout -b hotfix    #新建一个hotfix分支，并切过去</span><br><span class="line">$ vim index.html    #修改一些东西，修复BUG</span><br><span class="line">$ git commit -a -m &#39;fixed the broken email address&#39;    #提交hotfix</span><br></pre></td></tr></table></figure>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/w3swt.jpg"></p>
<p>在hotfix分支上搞定BUG之后，我们切回master分支，使用<code>git merge</code>把刚才的hotfix合并进来  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master  #切换回master分支</span><br><span class="line">$ git merge hotfix    #将hotfix分支的修改，合并到当前master分支来（注意merge的方向，是从其它分支，合到当前分支）。</span><br><span class="line">Updating f42c576..3a0874c</span><br><span class="line">Fast-forward</span><br><span class="line"> README | 1 -</span><br><span class="line"> 1 file changed, 1 deletion(-)</span><br></pre></td></tr></table></figure>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/bl7k3.jpg"><br>备注：本次合并时出现了“Fast forward”的提示。由于当前 master 分支所在的提交对象是要并入的 hotfix 分支的直接上游，Git 只需把 master 分支指针直接右移。换句话说，如果顺着一个分支走下去可以到达另一个分支的话，那么 Git在合并两者时，只会简单地把指针右移，因为这种单线的历史分支不存在任何需要解决的分歧，所以这种合并过程可以称为快进（Fast forward）。  </p>
<p>这时hotfix分支已经没用了，可以删掉了  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -d hotfix    #只是删除了一个指针</span><br></pre></td></tr></table></figure>
<p>现在回到之前未完成的53号问题上，继续写一些代码  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout iss53</span><br><span class="line">$ vim index.html</span><br><span class="line">$ git commit -a -m &#39;finished the new footer [issue 53]&#39;</span><br></pre></td></tr></table></figure>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/mqmex.jpg"></p>
<p>在问题53相关的工作完成之后，可以合并回master分支。实际操作同前面合并hotfix分支差不多，只需回到master分支，运行git merge命令指定要合并进来的分支。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">$ git merge iss53</span><br><span class="line">Auto-merging README</span><br><span class="line">Merge made by the &#39;recursive&#39; strategy.</span><br><span class="line"> README | 1 +</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/cscqb.jpg"><br>请注意，这次合并操作的底层实现，并不同于之前 hotfix 的并入方式。因为这次你的开发历史是从更早的地方开始分叉的。由于当前 master 分支所指向的提交对象（C4）并不是 iss53 分支的直接祖先，Git 不得不进行一些额外处理。就此例而言，Git 会用两个分支的末端（C4 和 C5）以及它们的共同祖先（C2）进行一次简单的三方合并计算。  </p>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/aal3p.jpg"><br>这次，Git 没有简单地把分支指针右移，而是对三方合并后的结果重新做一个新的快照，并自动创建一个指向它的提交对象（C6）。这个提交对象比较特殊，它有两个祖先（C4 和 C5）。  </p>
<p>有时候合并操作并不会如此顺利。如果在不同的分支中都修改了同一个文件的同一部分，需要手工来处理冲突。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git merge iss53</span><br><span class="line">Auto-merging index.html</span><br><span class="line">CONFLICT (content): Merge conflict in index.html</span><br><span class="line">Automatic merge failed; fix conflicts and then commit the result.</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Git作了合并，但没有提交，它会停下来等你解决冲突。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">You have unmerged paths.</span><br><span class="line">  (fix conflicts and run &quot;git commit&quot;)</span><br><span class="line"></span><br><span class="line">Unmerged paths:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to mark resolution)</span><br><span class="line"></span><br><span class="line">        both modified:      index.html</span><br><span class="line"></span><br><span class="line">no changes added to commit (use &quot;git add&quot; and&#x2F;or &quot;git commit -a&quot;)</span><br></pre></td></tr></table></figure>
<p>任何包含未解决冲突的文件都会以未合并（unmerged）的状态列出。Git 会在有冲突的文件里加入标准的冲突解决标记。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ vi index.html</span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class="line">&lt;div id&#x3D;&quot;footer&quot;&gt;contact : email.support@github.com&lt;&#x2F;div&gt;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&lt;div id&#x3D;&quot;footer&quot;&gt;</span><br><span class="line">  please contact us at support@github.com</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt; iss53</span><br></pre></td></tr></table></figure>
<p>可以看到 ======= 隔开的上半部分是 HEAD，即master，下半部分是在iss53分支中的内容。<br>手工合并代码后，把 &lt;&lt;&lt;&lt;&lt;&lt;&lt;，======= 和 &gt;&gt;&gt;&gt;&gt;&gt;&gt; 这些行也一并删除。这时可以用git commit来提交了。  </p>
<h3 id="分支策略"><a href="#分支策略" class="headerlink" title="分支策略"></a>分支策略</h3><p>实际开发中，对于分支的管理，已经有很多最佳实践，大多数情况下，我们只需要遵守一些基本原则：  </p>
<ul>
<li>首先，master分支应该是非常稳定的，也就是仅用来发布新版本，平时不能在上面工作。  </li>
<li>平时的开发工作都放在dev分支上，也就是说，dev分支是不稳定的。到某个时候，比如测试通过，需要1.2版本发布时，再把dev分支合并到master上，在master分支编译发布1.2版本。  </li>
<li>针对新需求、修复等具体的任务，每次都在dev分支上开一个新的任务分支出来，工作完成后，再向dev分支上合并就可以了。名称没有特别的规范，可以是人名，例如：zhangsan，也可以是任务名、需求编号等，例如：iss03、feature04、hotfix。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/4wfxt.jpg"></li>
</ul>
<h3 id="远程分支"><a href="#远程分支" class="headerlink" title="远程分支"></a>远程分支</h3><p>之前讨论过远程仓库，接着又学习了分支，当二者结合到一起时，又会产生一些有趣的东西。</p>
<h4 id="远程分支的概念"><a href="#远程分支的概念" class="headerlink" title="远程分支的概念"></a>远程分支的概念</h4><p>远程分支（remote branch）,即远程仓库中的分支。同步到本地后，与本地分支不同的是，它们 <strong>无法移动</strong> ；且只有在Git进行网络交互时才会更新。远程分支就像是书签，提醒着你上次连接远程仓库时上面各分支的位置。我们用 (远程仓库名)/(分支名) 这样的形式表示远程分支(例如origin/master)。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/z6u9t.jpg">  </p>
<p>如果我们在本地master分支做了些改动，与此同时，其他人向远程仓库推送了他们的更新，那么服务器上的master分支就会向前推进，而于此同时，我们在本地的提交历史正朝向不同方向发展。（不过只要你不和服务器通讯，你的 origin/master 指针仍然保持原位不会移动。）<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/s1fru.jpg"></p>
<p>可以运行<code>git fetch origin</code>来同步远程服务器上的数据到本地。该命令首先找到origin是哪个服务器，然后从上面获取你尚未拥有的数据，更新你本地的数据库，然后把origin/master的指针移到它最新的位置上。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/3zu6i.jpg"></p>
<p>可以使用<code>git remote</code>命令查看远程仓库的详情  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ git remote -v    #列出远程服务器清单</span><br><span class="line">origin	mobgit@134.32.51.60:learngit.git (fetch)</span><br><span class="line">origin	mobgit@134.32.51.60:learngit.git (push)</span><br><span class="line"></span><br><span class="line">$ git remote show origin   #查询某一个远程服务器的详情</span><br><span class="line">* remote origin</span><br><span class="line">  Fetch URL: mobgit@134.32.51.60:learngit.git</span><br><span class="line">  Push  URL: mobgit@134.32.51.60:learngit.git</span><br><span class="line">  HEAD branch (remote HEAD is ambiguous, may be one of the following):</span><br><span class="line">    dev</span><br><span class="line">    master</span><br><span class="line">  Remote branches:</span><br><span class="line">    dev    tracked</span><br><span class="line">    master tracked</span><br><span class="line">  Local branch configured for &#39;git pull&#39;:</span><br><span class="line">    master merges with remote master</span><br><span class="line">  Local ref configured for &#39;git push&#39;:</span><br><span class="line">    master pushes to master (up to date)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="跟踪远程分支"><a href="#跟踪远程分支" class="headerlink" title="跟踪远程分支"></a>跟踪远程分支</h4><p>从远程分支checkout出来的本地分支，称为跟踪分支 (tracking branch)。跟踪分支是一种和某个远程分支有直接联系的本地分支。<br>在跟踪分支里输入 <code>git push</code>，Git 会自行推断应该向哪个服务器的哪个分支推送数据。同样，在这些分支里运行 <code>git pull</code> 会获取所有远程索引，并把它们的数据都合并到本地分支中来。</p>
<p>在克隆仓库时，Git 通常会自动创建一个名为 master 的分支来跟踪 origin/master。这正是 git push 和 git pull 一开始就能正常工作的原因。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b serverfix origin&#x2F;serverfix</span><br><span class="line">或简化为：</span><br><span class="line">$ git checkout --track origin&#x2F;serverfix</span><br></pre></td></tr></table></figure>
<p>这会新建并切换到serverfix本地分支，其内容同远程分支origin/serverfix一致。</p>
<h4 id="推送本地分支"><a href="#推送本地分支" class="headerlink" title="推送本地分支"></a>推送本地分支</h4><p>要想和其他人分享某个本地分支，你需要把它推送到一个你拥有写权限的远程仓库。<br>例如本地有一个serverfix分支需要和他人一起开发，可以运行 git push (远程仓库名) (分支名)：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin serverfix</span><br><span class="line">Counting objects: 20, done.</span><br><span class="line">Compressing objects: 100% (14&#x2F;14), done.</span><br><span class="line">Writing objects: 100% (15&#x2F;15), 1.74 KiB, done.</span><br><span class="line">Total 15 (delta 5), reused 0 (delta 0)</span><br><span class="line">To git@github.com:schacon&#x2F;simplegit.git</span><br><span class="line"> * [new branch]      serverfix -&gt; serverfix</span><br></pre></td></tr></table></figure>
<p>或者加入–set-upstream设置跟踪后，以后直接使用<code>git push</code>就可以推送了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git push --set-upstream origin serverfix</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="GitHub"><a href="#GitHub" class="headerlink" title="GitHub"></a>GitHub</h2><p>[GitHub]（<a target="_blank" rel="noopener" href="https://github.com)是一个面向开源及私有软件项目的托管平台,因为只支持git作为唯一的版本库格式进行托管,故名github./">https://github.com）是一个面向开源及私有软件项目的托管平台，因为只支持Git作为唯一的版本库格式进行托管，故名GitHub。</a><br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/h6vla.jpg"><br>GitHub本身没有什么好学的，随便看就知道怎么用了 <a target="_blank" rel="noopener" href="https://www.zhihu.com/question/20070065">知乎：怎样使用GitHub</a><br>重点是，GitHub上有非常多优秀的个人项目值得我们学习，我们也可以将自已的代码发布上去。可以看成是程序员的博客吧，只贴代码，不废话。<br>在GitHub上发布开源项目是免费的，但是私有项目收费。</p>
<h2 id="GitLab"><a href="#GitLab" class="headerlink" title="GitLab"></a>GitLab</h2><p>GitLab是一个用Ruby on Rails写的开源的版本管理系统，实现一个自托管的Git项目仓库，可通过Web界面进行访问公开的或者私人项目。它拥有与Github类似的功能，能够浏览源代码，管理缺陷和注释。<br>可以管理团队对仓库的访问，它非常易于浏览提交过的版本并提供一个文件历史库。团队成员可以利用内置的简单聊天程序(Wall)进行交流。它还提供一个代码片段收集功能可以轻松实现代码复用，便于日后有需要的时候进行查找。<br>GitLab是目前搭建内部Git服务器的首选，当然如果要求不高的话，我们也可以直接使用SSH协议来快速搭建Git服务端。</p>
<h2 id="常用Git命令清单"><a href="#常用Git命令清单" class="headerlink" title="常用Git命令清单"></a>常用Git命令清单</h2><p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/5cgpa.jpg"><br>更多内容请直接参考 <a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html">阮一峰的网络日志</a></p>
<h2 id="推荐文档"><a href="#推荐文档" class="headerlink" title="推荐文档"></a>推荐文档</h2><p>不要指忘2小时的培训能带来多大的收益，最简单高效的方式，还是要多看优秀的文档。<br>本文大量参(chao)考(xi)了以下两部文档：<br><a target="_blank" rel="noopener" href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000">廖雪峰的在线教程</a>  适合快速上手<br><a target="_blank" rel="noopener" href="https://www.gitbook.com/book/0532/progit/details">Pro Git中文版</a>   中文第一版  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/21/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><span class="page-number current">22</span><a class="page-number" href="/page/23/">23</a><a class="page-number" href="/page/24/">24</a><a class="extend next" rel="next" href="/page/23/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">BlueXIII</p>
  <div class="site-description" itemprop="description">IT技术类文章、笔记分享</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">231</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/xiiiblue" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;xiiiblue" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/bluexiii" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;bluexiii" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备18050487号-1 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BlueXIII</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
