<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.bluexiii.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="IT技术类文章、笔记分享">
<meta property="og:type" content="website">
<meta property="og:title" content="BlueXIII&#39;s Blog">
<meta property="og:url" content="http://www.bluexiii.com/page/24/index.html">
<meta property="og:site_name" content="BlueXIII&#39;s Blog">
<meta property="og:description" content="IT技术类文章、笔记分享">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="BlueXIII">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://www.bluexiii.com/page/24/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>BlueXIII's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">BlueXIII's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">热爱技术,持续学习</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201703/ulimit%E3%80%81limits.conf%E3%80%81sysctl%E5%92%8Cproc%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201703/ulimit%E3%80%81limits.conf%E3%80%81sysctl%E5%92%8Cproc%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" class="post-title-link" itemprop="url">ulimit、limits.conf、sysctl和proc文件系统</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-06 15:46:36" itemprop="dateCreated datePublished" datetime="2018-11-06T15:46:36+08:00">2018-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>当修改一个Linux系统参数或限制，比如文件打开数时，之前用到过的方式有ulimit、limits.conf、sysctl和/proc文件系统。<br>对这几个东西一直比较困惑，翻了几篇文档，简单写一下它们之间的区别。  </p>
<h2 id="ulimit"><a href="#ulimit" class="headerlink" title="ulimit"></a>ulimit</h2><h3 id="什么是ulimit"><a href="#什么是ulimit" class="headerlink" title="什么是ulimit"></a>什么是ulimit</h3><p>ulimit是linux shell的内键命令，它具有一套参数集，用于对 <strong>shell进程 及其 子进程</strong> 进行 <strong>资源限制</strong>。<br>例如用户同时运行了两个shell终端进程，只在其中一个环境中执行了<code>ulimit – s 100</code>，则该shell进程里创建文件的大小会有相应的限制，而另一个shell终端包括其上运行的子程序都不会受其影响。  </p>
<p>ulimit的设定值是 <strong>per-process</strong> 的，也就是说，每个进程有自己的limits值。<br>使用ulimit进行修改，是 <strong>立即生效</strong> 的。<br>ulimit只影响shell进程及其子进程，用户登出后失效。<br>可以在profile中加入ulimit的设置，变相的做到永久生效。  </p>
<h2 id="查看ulimit的设定值"><a href="#查看ulimit的设定值" class="headerlink" title="查看ulimit的设定值"></a>查看ulimit的设定值</h2><p>使用ulimit -a可以查看所有的设定值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:~ $ ulimit -a</span><br><span class="line">core file size          (blocks, -c) 0</span><br><span class="line">data seg size           (kbytes, -d) unlimited</span><br><span class="line">scheduling priority             (-e) 0</span><br><span class="line">file size               (blocks, -f) unlimited</span><br><span class="line">pending signals                 (-i) 7336</span><br><span class="line">max locked memory       (kbytes, -l) unlimited</span><br><span class="line">max memory size         (kbytes, -m) unlimited</span><br><span class="line">open files                      (-n) 65536</span><br><span class="line">pipe size            (512 bytes, -p) 8</span><br><span class="line">POSIX message queues     (bytes, -q) 819200</span><br><span class="line">real-time priority              (-r) 95</span><br><span class="line">stack size              (kbytes, -s) 8192</span><br><span class="line">cpu time               (seconds, -t) unlimited</span><br><span class="line">max user processes              (-u) 7336</span><br><span class="line">virtual memory          (kbytes, -v) unlimited</span><br><span class="line">file locks                      (-x) unlimited</span><br></pre></td></tr></table></figure>
<h3 id="ulimit的参数"><a href="#ulimit的参数" class="headerlink" title="ulimit的参数"></a>ulimit的参数</h3><ul>
<li>-H 设置硬件资源限制.</li>
<li>-S 设置软件资源限制.</li>
<li>-a 显示当前所有的资源限制.</li>
<li>-c size:设置core文件的最大值.单位:blocks</li>
<li>-d size:设置数据段的最大值.单位:kbytes</li>
<li>-f size:设置创建文件的最大值.单位:blocks</li>
<li>-l size:设置在内存中锁定进程的最大值.单位:kbytes</li>
<li>-m size:设置可以使用的常驻内存的最大值.单位:kbytes</li>
<li>-n size:设置内核可以同时打开的文件描述符的最大值.单位:n</li>
<li>-p size:设置管道缓冲区的最大值.单位:kbytes</li>
<li>-s size:设置堆栈的最大值.单位:kbytes</li>
<li>-t size:设置CPU使用时间的最大上限.单位:seconds</li>
<li>-v size:设置虚拟内存的最大值.单位:kbytes</li>
<li>unlimited 是一个特殊值，用于表示不限制</li>
</ul>
<p>注意：  </p>
<ol>
<li>-n 限制文件描述符的最大值，在Linux下一切资源皆文件，所以该参数也限制了socket链接数</li>
<li>查询时，若不加H或S参数，默认显示的是软限制</li>
<li>修改时，若不加H或S参数，两个参数一起改变</li>
</ol>
<h3 id="设置ulimit的位置"><a href="#设置ulimit的位置" class="headerlink" title="设置ulimit的位置"></a>设置ulimit的位置</h3><p>可以在以下位置进行ulimit设置:  </p>
<ul>
<li><code>/etc/profile</code>  所有用户有效，永久生效  </li>
<li><code>~/.bash_profile</code>  当前用户有效，永久生效  </li>
<li>直接在控制台输入    当前用户有效，临时生效  </li>
<li>放在程序的启动脚本中  </li>
</ul>
<h2 id="limit-conf"><a href="#limit-conf" class="headerlink" title="limit.conf"></a>limit.conf</h2><h3 id="什么是limits-conf"><a href="#什么是limits-conf" class="headerlink" title="什么是limits.conf"></a>什么是limits.conf</h3><p>limits.conf文件实际是Linux PAM中 <strong>pam_limits.so</strong> 的配置文件，pam_limits模块对 <strong>用户的会话</strong> 进行 <strong>资源限制</strong>。    </p>
<p><strong>一个shell的初始limits就是由pam_limits设定的</strong>，用户登录后，pam_limits会给用户的shell设定在limits.conf定义的值。  </p>
<p>pam_limits的设定值也是 <strong>per-process</strong> 的。<br>pam_limits的设置是 <strong>永久生效</strong> 的。  </p>
<h3 id="limits-conf的位置"><a href="#limits-conf的位置" class="headerlink" title="limits.conf的位置"></a>limits.conf的位置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;security&#x2F;limits.conf</span><br></pre></td></tr></table></figure>
<h3 id="配置limits-conf"><a href="#配置limits-conf" class="headerlink" title="配置limits.conf"></a>配置limits.conf</h3><p>示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">*    soft    nofile    655360</span><br><span class="line">*    hard    nofile    655360</span><br><span class="line">*    soft    noproc    655360</span><br><span class="line">*    hard    noproc    655355</span><br><span class="line">*    soft    core      0</span><br><span class="line">*    hard    core      0</span><br></pre></td></tr></table></figure>
<p>4个字段的含义分别为： domain type item value</p>
<ul>
<li>domain:  username|@groupname</li>
<li>type:   soft、hard、-</li>
<li>item:<br>core - 限制内核文件的大小<br>date - 最大数据大小<br>fsize - 最大文件大小<br>memlock - 最大锁定内存地址空间<br>nofile - 打开文件的最大数目<br>rss - 最大持久设置大小<br>stack - 最大栈大小<br>cpu - 以分钟为单位的最多 CPU 时间<br>noproc - 进程的最大数目<br>as - 地址空间限制<br>maxlogins - 此用户允许登录的最大数目</li>
<li>value: 值的大小</li>
</ul>
<h2 id="sysctl"><a href="#sysctl" class="headerlink" title="sysctl"></a>sysctl</h2><h3 id="什么是sysctl"><a href="#什么是sysctl" class="headerlink" title="什么是sysctl"></a>什么是sysctl</h3><p>sysctl是一个允许改变正在运行中的Linux系统的接口，修改的是针对 <strong>整个系统</strong> 的 <strong>内核参数</strong>。<br>sysctl的修改是 <strong>立即</strong> 且 <strong>临时</strong> 的（重启后失效）。<br>可以通过修改sysctl.conf配置文件，达到 <strong>永久</strong> 生效。  </p>
<h3 id="sysctl的选项"><a href="#sysctl的选项" class="headerlink" title="sysctl的选项"></a>sysctl的选项</h3><ul>
<li>-n  打印值时不打印关键字</li>
<li>-e  忽略未知关键字错误</li>
<li>-N  仅打印名称</li>
<li>-w  当改变sysctl设置时使用此项</li>
<li>-p  从配置文件“/etc/sysctl.conf”加载内核参数设置</li>
<li>-a  打印当前所有可用的内核参数变量和值</li>
<li>-A  以表格方式打印当前所有可用的内核参数变量和值</li>
</ul>
<h3 id="查看某个内核参数"><a href="#查看某个内核参数" class="headerlink" title="查看某个内核参数"></a>查看某个内核参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sysctl fs.file-max</span><br><span class="line"></span><br><span class="line">fs.file-max &#x3D; 93796</span><br></pre></td></tr></table></figure>
<h3 id="临时修改某个内核参数"><a href="#临时修改某个内核参数" class="headerlink" title="临时修改某个内核参数"></a>临时修改某个内核参数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w fs.file-max&#x3D;100000  # 设置文件打开数</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w net.ipv4.ip_forward&#x3D;1  # 开启IP转发</span><br></pre></td></tr></table></figure>
<h3 id="sysctl-conf配置文件"><a href="#sysctl-conf配置文件" class="headerlink" title="sysctl.conf配置文件"></a>sysctl.conf配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;sysctl.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="修改sysctl-conf并使其生效"><a href="#修改sysctl-conf并使其生效" class="headerlink" title="修改sysctl.conf并使其生效"></a>修改sysctl.conf并使其生效</h3><p>修改<code>/etc/sysctl.conf</code>可以做到永久生效：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;sysctl.conf</span><br><span class="line"></span><br><span class="line">fs.file-max &#x3D; 100000</span><br></pre></td></tr></table></figure>
<p>最后使用<code>-p</code>命令从配置文件中加载内核参数，使其立即生效：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>
<h3 id="sysctl-conf配置示例"><a href="#sysctl-conf配置示例" class="headerlink" title="sysctl.conf配置示例"></a>sysctl.conf配置示例</h3><p>下面是一个摘抄的配置示例，出处：<a target="_blank" rel="noopener" href="http://www.jianshu.com/p/9a8e383b5b49">http://www.jianshu.com/p/9a8e383b5b49</a>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"># Kernel sysctl configuration file for Red Hat Linux</span><br><span class="line">#</span><br><span class="line"># For binary values, 0 is disabled, 1 is enabled.  See sysctl(8) and</span><br><span class="line"># sysctl.conf(5) for more details.</span><br><span class="line"></span><br><span class="line"># Controls IP packet forwarding</span><br><span class="line">net.ipv4.ip_forward &#x3D; 0</span><br><span class="line"></span><br><span class="line"># Controls source route verification</span><br><span class="line">net.ipv4.conf.default.rp_filter &#x3D; 1</span><br><span class="line"></span><br><span class="line"># Do not accept source routing</span><br><span class="line">net.ipv4.conf.default.accept_source_route &#x3D; 0</span><br><span class="line"></span><br><span class="line"># Controls the System Request debugging functionality of the kernel</span><br><span class="line"></span><br><span class="line"># Controls whether core dumps will append the PID to the core filename.</span><br><span class="line"># Useful for debugging multi-threaded applications.</span><br><span class="line">kernel.core_uses_pid &#x3D; 1</span><br><span class="line"></span><br><span class="line"># Controls the use of TCP syncookies</span><br><span class="line">net.ipv4.tcp_syncookies &#x3D; 1</span><br><span class="line"></span><br><span class="line"># Disable netfilter on bridges.</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables &#x3D; 0</span><br><span class="line">net.bridge.bridge-nf-call-iptables &#x3D; 0</span><br><span class="line">net.bridge.bridge-nf-call-arptables &#x3D; 0</span><br><span class="line"></span><br><span class="line"># Controls the default maxmimum size of a mesage queue</span><br><span class="line">kernel.msgmnb &#x3D; 65536</span><br><span class="line"></span><br><span class="line"># Controls the maximum size of a message, in bytes</span><br><span class="line">kernel.msgmax &#x3D; 65536</span><br><span class="line"></span><br><span class="line"># Controls the maximum shared segment size, in bytes</span><br><span class="line">kernel.shmmax &#x3D; 68719476736</span><br><span class="line"></span><br><span class="line"># Controls the maximum number of shared memory segments, in pages</span><br><span class="line">kernel.shmall &#x3D; 4294967296</span><br><span class="line">net.ipv4.conf.all.send_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.default.send_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.all.secure_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.default.secure_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.all.accept_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.default.accept_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.all.send_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.default.send_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.all.secure_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.default.secure_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.all.accept_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.default.accept_redirects &#x3D; 0</span><br><span class="line">net.netfilter.nf_conntrack_max &#x3D; 1000000</span><br><span class="line">kernel.unknown_nmi_panic &#x3D; 0</span><br><span class="line">kernel.sysrq &#x3D; 0</span><br><span class="line">fs.file-max &#x3D; 1000000</span><br><span class="line">vm.swappiness &#x3D; 10</span><br><span class="line">fs.inotify.max_user_watches &#x3D; 10000000</span><br><span class="line">net.core.wmem_max &#x3D; 327679</span><br><span class="line">net.core.rmem_max &#x3D; 327679</span><br><span class="line">net.ipv4.conf.all.send_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.default.send_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.all.secure_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.default.secure_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.all.accept_redirects &#x3D; 0</span><br><span class="line">net.ipv4.conf.default.accept_redirects &#x3D; 0</span><br></pre></td></tr></table></figure>

<h2 id="proc文件系统"><a href="#proc文件系统" class="headerlink" title="/proc文件系统"></a>/proc文件系统</h2><h3 id="什么是-proc文件系统"><a href="#什么是-proc文件系统" class="headerlink" title="什么是/proc文件系统"></a>什么是/proc文件系统</h3><p>Linux内核提供了一种通过<code>/proc</code>文件系统，在运行时访问内核内部数据结构、改变内核设置的机制。<br>proc文件系统是一个伪文件系统，它只存在内存当中，而不占用外存空间。它以文件系统的方式为访问系统内核数据的操作提供接口。<br>最初开发/proc文件系统是为了提供有关系统中进程的信息。但是由于这个文件系统非常有用，因此内核中的很多元素也开始使用它来报告信息，或启用动态运行时配置。  </p>
<p>对/proc中内核文件的修改，针对的是 <strong>整个系统</strong> 的 <strong>内核参数</strong> ，修改后 <strong>立即生效</strong> ，但修改是 <strong>临时</strong> 的（重启后失效）。</p>
<h3 id="proc文件系统与sysctl-conf的对应关系"><a href="#proc文件系统与sysctl-conf的对应关系" class="headerlink" title="/proc文件系统与sysctl.conf的对应关系"></a>/proc文件系统与sysctl.conf的对应关系</h3><p>/proc/sys下内核文件与配置文件sysctl.conf中变量的对应关系:  </p>
<ol>
<li>去掉前面部分/proc/sys</li>
<li>将文件名中的斜杠变为点</li>
</ol>
<p>例如：</p>
<ul>
<li>/proc/sys/net/ipv4/ip_forward -&gt; net.ipv4.ip_forward</li>
<li>/proc/sys/kernel/hostname -&gt; kernel.hostname</li>
</ul>
<h3 id="proc文件系统中几个常用的内核文件"><a href="#proc文件系统中几个常用的内核文件" class="headerlink" title="/proc文件系统中几个常用的内核文件"></a>/proc文件系统中几个常用的内核文件</h3><p>下面几个是经常会用到的文件：  </p>
<ul>
<li>/proc/meminfo    内存信息</li>
<li>/proc/cpuinfo    CPU信息</li>
<li>/proc/sys/fs/file-max   文件打开数</li>
<li>/proc/sys/fs/file-nr   整个系统目前使用的文件句柄数量</li>
</ul>
<h3 id="proc文件系统中文件的权限"><a href="#proc文件系统中文件的权限" class="headerlink" title="/proc文件系统中文件的权限"></a>/proc文件系统中文件的权限</h3><p>proc 中的每个文件都有一组分配给它的非常特殊的文件许可权，并且每个文件属于特定的用户标识。  </p>
<ul>
<li>只读：任何用户都不能更改该文件；它用于表示系统信息  </li>
<li>root 写：如果 /proc 中的某个文件是可写的，则通常只能由 root 用户来写  </li>
<li>root 读：有些文件对一般系统用户是不可见的，而只对 root 用户是可见的  </li>
</ul>
<h3 id="对-proc进行读写"><a href="#对-proc进行读写" class="headerlink" title="对/proc进行读写"></a>对/proc进行读写</h3><p>以开启IP转发为例：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;ip_forward</span><br><span class="line">0</span><br><span class="line">echo &quot;1&quot; &gt; &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;ip_forward</span><br><span class="line">cat &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;ip_forward</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>当然，也可以使用sysctl来配置这些内核条目</p>
<h3 id="内核文件详解"><a href="#内核文件详解" class="headerlink" title="内核文件详解"></a>内核文件详解</h3><ul>
<li>/proc/buddyinfo 每个内存区中的每个order有多少块可用，和内存碎片问题有关</li>
<li>/proc/cmdline 启动时传递给kernel的参数信息</li>
<li>/proc/cpuinfo cpu的信息</li>
<li>/proc/crypto 内核使用的所有已安装的加密密码及细节</li>
<li>/proc/devices 已经加载的设备并分类</li>
<li>/proc/dma 已注册使用的ISA DMA频道列表</li>
<li>/proc/execdomains Linux内核当前支持的execution domains</li>
<li>/proc/fb 帧缓冲设备列表，包括数量和控制它的驱动</li>
<li>/proc/filesystems 内核当前支持的文件系统类型</li>
<li>/proc/interrupts x86架构中的每个IRQ中断数</li>
<li>/proc/iomem 每个物理设备当前在系统内存中的映射</li>
<li>/proc/ioports 一个设备的输入输出所使用的注册端口范围</li>
<li>/proc/kcore 代表系统的物理内存，存储为核心文件格式，里边显示的是字节数，等于RAM大小加上4kb</li>
<li>/proc/kmsg 记录内核生成的信息，可以通过/sbin/klogd或/bin/dmesg来处理</li>
<li>/proc/loadavg 根据过去一段时间内CPU和IO的状态得出的负载状态，与uptime命令有关</li>
<li>/proc/locks 内核锁住的文件列表</li>
<li>/proc/mdstat 多硬盘，RAID配置信息(md=multiple disks)</li>
<li>/proc/meminfo RAM使用的相关信息</li>
<li>/proc/misc 其他的主要设备(设备号为10)上注册的驱动</li>
<li>/proc/modules 所有加载到内核的模块列表</li>
<li>/proc/mounts 系统中使用的所有挂载</li>
<li>/proc/mtrr 系统使用的Memory Type Range Registers (MTRRs)</li>
<li>/proc/partitions 分区中的块分配信息</li>
<li>/proc/pci 系统中的PCI设备列表</li>
<li>/proc/slabinfo 系统中所有活动的 slab 缓存信息</li>
<li>/proc/stat 所有的CPU活动信息</li>
<li>/proc/sysrq-trigger 使用echo命令来写这个文件的时候，远程root用户可以执行大多数的系统请求关键命令，就好- 像在本地终端执行一样。要写入这个文件，需要把/proc/sys/kernel/sysrq不能设置为0。这个文件对root也是不可- 读的</li>
<li>/proc/uptime 系统已经运行了多久</li>
<li>/proc/swaps 交换空间的使用情况</li>
<li>/proc/version Linux内核版本和gcc版本</li>
<li>/proc/bus 系统总线(Bus)信息，例如pci/usb等</li>
<li>/proc/driver 驱动信息</li>
<li>/proc/fs 文件系统信息</li>
<li>/proc/ide ide设备信息</li>
<li>/proc/irq 中断请求设备信息</li>
<li>/proc/net 网卡设备信息</li>
<li>/proc/scsi scsi设备信息</li>
<li>/proc/tty tty设备信息</li>
<li>/proc/net/dev 显示网络适配器及统计信息</li>
<li>/proc/vmstat 虚拟内存统计信息</li>
<li>/proc/vmcore 内核panic时的内存映像</li>
<li>/proc/diskstats 取得磁盘信息</li>
<li>/proc/schedstat kernel调度器的统计信息</li>
<li>/proc/zoneinfo 显示内存空间的统计信息，对分析虚拟内存行为很有用</li>
</ul>
<p>以下是/proc目录中进程N的信息：</p>
<ul>
<li>/proc/N pid为N的进程信息</li>
<li>/proc/N/cmdline 进程启动命令</li>
<li>/proc/N/cwd 链接到进程当前工作目录</li>
<li>/proc/N/environ 进程环境变量列表</li>
<li>/proc/N/exe 链接到进程的执行命令文件</li>
<li>/proc/N/fd 包含进程相关的所有的文件描述符</li>
<li>/proc/N/maps 与进程相关的内存映射信息</li>
<li>/proc/N/mem 指代进程持有的内存，不可读</li>
<li>/proc/N/root 链接到进程的根目录</li>
<li>/proc/N/stat 进程的状态</li>
<li>/proc/N/statm 进程使用的内存的状态</li>
<li>/proc/N/status 进程状态信息，比stat/statm更具可读性</li>
<li>/proc/self 链接到当前正在运行的进程</li>
</ul>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.ibm.com/developerworks/cn/linux/l-cn-ulimit/">https://www.ibm.com/developerworks/cn/linux/l-cn-ulimit/</a>  </li>
<li><a target="_blank" rel="noopener" href="http://www.linuxhowtos.org/Tips%20and%20Tricks/ulimit.htm">http://www.linuxhowtos.org/Tips%20and%20Tricks/ulimit.htm</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cyberciti.biz/faq/linux-increase-the-maximum-number-of-open-files/">https://www.cyberciti.biz/faq/linux-increase-the-maximum-number-of-open-files/</a></li>
<li><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/23ee9db2a620">http://www.jianshu.com/p/23ee9db2a620</a></li>
<li><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/9a8e383b5b49">http://www.jianshu.com/p/9a8e383b5b49</a></li>
<li><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/d71e20f51aab">http://www.jianshu.com/p/d71e20f51aab</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ibm.com/developerworks/cn/linux/l-proc.html">https://www.ibm.com/developerworks/cn/linux/l-proc.html</a></li>
<li><a target="_blank" rel="noopener" href="http://feichashao.com/ulimit_demo/">http://feichashao.com/ulimit_demo/</a></li>
<li><a target="_blank" rel="noopener" href="http://www.linux-pam.org/Linux-PAM-html/sag-pam_limits.html">http://www.linux-pam.org/Linux-PAM-html/sag-pam_limits.<strong>html</strong></a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201703/crontab%E9%85%8D%E7%BD%AE%E5%8F%8A%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201703/crontab%E9%85%8D%E7%BD%AE%E5%8F%8A%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8/" class="post-title-link" itemprop="url">crontab配置及简单应用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-06 15:46:09" itemprop="dateCreated datePublished" datetime="2018-11-06T15:46:09+08:00">2018-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h2><p>crontab并不陌生，在*nix的操作系统之中，使用它设置周期性被执行的指令.每个用户可以拥有自己的crontab文件；<br>同时，操作系统保存一个针对整个系统的crontab文件，该文件通常存放于/etc或者/etc之下的子目录中。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:&#x2F;etc $ ls -al|grep cron</span><br><span class="line">drwxr-xr-x   2 root root    4096 Jan  1  1970 cron.d</span><br><span class="line">drwxr-xr-x   2 root root    4096 Jan  1  1970 cron.daily</span><br><span class="line">drwxr-xr-x   2 root root    4096 Jan  1  1970 cron.hourly</span><br><span class="line">drwxr-xr-x   2 root root    4096 Jan  1  1970 cron.monthly</span><br><span class="line">drwxr-xr-x   2 root root    4096 Jan  1  1970 cron.weekly</span><br><span class="line">-rw-r--r--   1 root root     722 Sep  5  2015 crontab</span><br></pre></td></tr></table></figure>
<h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><ul>
<li>-u user：用来设定某个用户的crontab服务；</li>
<li>file：file是命令文件的名字,表示将file做为crontab的任务列表文件并载入crontab。如果在命令行中没有指定这个文件，crontab命令将接受标准输入（键盘）上键入的命令，并将它们载入crontab。</li>
<li>-e：编辑某个用户的crontab文件内容。如果不指定用户，则表示编辑当前用户的crontab文件。</li>
<li>-l：显示某个用户的crontab文件内容，如果不指定用户，则表示显示当前用户的crontab文件内容。</li>
<li>-r：从/var/spool/cron目录中删除某个用户的crontab文件，如果不指定用户，则默认删除当前用户的crontab文件。</li>
<li>-i：在删除用户的crontab文件时给确认提示。</li>
</ul>
<p>最常用的参数有<code>-l 查询</code>和<code>-e 编辑</code></p>
<h2 id="配置格式"><a href="#配置格式" class="headerlink" title="配置格式"></a>配置格式</h2><ul>
<li>第1列分钟0～59</li>
<li>第2列小时0～23（0表示子夜）</li>
<li>第3列日1～31</li>
<li>第4列月1～12</li>
<li>第5列星期0～7（0和7表示星期天）</li>
<li>第6列要运行的命令</li>
</ul>
<h2 id="配置示例"><a href="#配置示例" class="headerlink" title="配置示例"></a>配置示例</h2><p>每分钟执行一次:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * &#x2F;path&#x2F;to&#x2F;your&#x2F;app.sh</span><br></pre></td></tr></table></figure>
<p>每半分钟执行一次:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*&#x2F;2 * * * * &#x2F;path&#x2F;to&#x2F;your&#x2F;app.sh</span><br></pre></td></tr></table></figure>
<p>每小时的第3和第15分钟执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3,15 * * * * &#x2F;path&#x2F;to&#x2F;your&#x2F;app.sh</span><br></pre></td></tr></table></figure>
<p>在上午8点到11点的第3和第15分钟执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3,15 8-11 * * * &#x2F;path&#x2F;to&#x2F;your&#x2F;app.sh</span><br></pre></td></tr></table></figure>
<p>每周六23点执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 23 * * 6 &#x2F;etc&#x2F;init.d&#x2F;smb restart</span><br></pre></td></tr></table></figure>
<h2 id="简单应用"><a href="#简单应用" class="headerlink" title="简单应用"></a>简单应用</h2><h3 id="检测并自动重启服务"><a href="#检测并自动重启服务" class="headerlink" title="检测并自动重启服务"></a>检测并自动重启服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br><span class="line">*&#x2F;2 * * * * isfound&#x3D;$(ps | grep &quot;redsocks&quot; | grep -v &quot;grep&quot;); if [ -z &quot;$isfound&quot; ]; then echo &quot;$(date): restart redsocks...&quot;&gt;&gt;&#x2F;tmp&#x2F;log&#x2F;redsocks-mon.log &amp;&amp; &#x2F;etc&#x2F;init.d&#x2F;redsocks restart; fi</span><br></pre></td></tr></table></figure>
<h3 id="检测并自动重启tomcat"><a href="#检测并自动重启tomcat" class="headerlink" title="检测并自动重启tomcat"></a>检测并自动重启tomcat</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*&#x2F;2 * * * * sh &#x2F;path&#x2F;to&#x2F;tomcat_monitor.sh</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vi tomcat_monitor.sh</span><br><span class="line">#!&#x2F;bin&#x2F;sh</span><br><span class="line">source &#x2F;home&#x2F;user&#x2F;.bash_profile</span><br><span class="line">export PATH&#x3D;$PATH:.:&#x2F;bin:&#x2F;sbin:&#x2F;usr&#x2F;bin:</span><br><span class="line">pid_count&#x3D;&#96;ps aux|grep java|grep your-tomcat|grep -v grep|wc -l&#96;</span><br><span class="line">if [ $pid_count -ne 1 ]; then</span><br><span class="line">        echo &quot;stop download-tomcat, time: &#96;date&#96;&quot;</span><br><span class="line">        if [ $pid_count -gt 0 ]; then</span><br><span class="line">                 ps aux|grep java|grep your-tomcat|grep -v grep|awk &#39;&#123;print $2&#125;&#39;|xargs kill</span><br><span class="line">        fi</span><br><span class="line">        sh &#x2F;path&#x2F;to&#x2F;tomcat&#x2F;bin&#x2F;startup.sh</span><br><span class="line">        echo &quot;start download-tomcat finished, time: &#96;date&#96;&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<h3 id="清理30天前的tomcat日志"><a href="#清理30天前的tomcat日志" class="headerlink" title="清理30天前的tomcat日志"></a>清理30天前的tomcat日志</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br><span class="line">0 23 * * * sh &#x2F;path&#x2F;to&#x2F;clean_log.sh</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi clean_log.sh</span><br><span class="line">DATE&#x3D;$(date -d &quot;30 days ago&quot; +%Y-%m-%d)</span><br><span class="line">echo $DATE</span><br><span class="line">rm &#x2F;path&#x2F;to&#x2F;tomcat&#x2F;logs&#x2F;*$DATE*</span><br></pre></td></tr></table></figure>
<h3 id="备份并清理catalina-out"><a href="#备份并清理catalina-out" class="headerlink" title="备份并清理catalina.out"></a>备份并清理catalina.out</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br><span class="line">00 22 * * * sh &#x2F;path&#x2F;to&#x2F;clean_catalina_out.sh</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vi clean_catalina_out.sh</span><br><span class="line">y&#x3D;&#96;date &quot;+%Y&quot;&#96;</span><br><span class="line">m&#x3D;&#96;date &quot;+%m&quot;&#96;</span><br><span class="line">d&#x3D;&#96;date &quot;+%d&quot;&#96;</span><br><span class="line">cp &#x2F;path&#x2F;to&#x2F;tomcat&#x2F;logs&#x2F;catalina.out &#x2F;path&#x2F;to&#x2F;tomcat&#x2F;logs&#x2F;catalina.out.$y-$m-$d</span><br><span class="line">echo &gt; &#x2F;path&#x2F;to&#x2F;tomcat&#x2F;logs&#x2F;catalina.out</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>
<h2 id="注意设置环境变量"><a href="#注意设置环境变量" class="headerlink" title="注意设置环境变量"></a>注意设置环境变量</h2><p>由于crontab执行任务时不加载任何环境变量，可以在脚本中加入必要的环境变量，甚至ulimit设置，以保证程序可以正常执行。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vi start.sh</span><br><span class="line"></span><br><span class="line">!&#x2F;bin&#x2F;sh</span><br><span class="line">source &#x2F;etc&#x2F;profile</span><br><span class="line">export YOUR_ENV&#x3D;value</span><br><span class="line">ulimit -n 10240</span><br><span class="line">&#x2F;path&#x2F;to&#x2F;your&#x2F;app&#x2F;run</span><br></pre></td></tr></table></figure>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a target="_blank" rel="noopener" href="http://www.linuxforums.org/forum/programming-scripting/21764-cron-job-not-taking-ulimits.html">http://www.linuxforums.org/forum/programming-scripting/21764-cron-job-not-taking-ulimits.html</a></li>
<li><a target="_blank" rel="noopener" href="http://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/crontab.html">http://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/crontab.html</a></li>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/Cron">https://zh.wikipedia.org/wiki/Cron</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201704/flask-rest-sample/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201704/flask-rest-sample/" class="post-title-link" itemprop="url">使用Flask快速构建REST应用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-06 15:45:51" itemprop="dateCreated datePublished" datetime="2018-11-06T15:45:51+08:00">2018-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>最近在某个小型项目上进行了一些尝试，目标是用极快的速度构建一套简洁且优雅的小型WEB系统。当然这次尝试可以说是失败的，稍后会提到。  </p>
<p>架构上主要是前后端分离，后端使用Python实现RESTFul API，前端直接套用AdminLTE模版。  </p>
<p>得益于Python动态语言的特性，后端可以做到非常少量的代码实现增删改查等基本功能，大约是可以使用100多行代码写了25个REST服务吧，非常惊人。虽然比较简陋，但比起之前使用Spring Boot全家桶来开发REST，要快得太多。  </p>
<p>但比起后端，前端的代码量，初版写出来之后，是后端的几十倍，使用gulp构建，include等插件后，做到了一定简化，接下来还要做SPA化，引入vue.js、webpack等等，最终会变成 <strong>为了目的不择手段，为了手段而忘记目的</strong> 。一个很重要的前提是，要做一个 <strong>小型WEB系统</strong> ，整体成本要小。所以前后端分离虽然好处多多，但前端太重了，并不适合小型系统。  </p>
<p>最终还是使用了Flask+Jinja，传统的重后端、轻前端的方式来实现，将总体代码量控制到了极少。<br>但这次的REST API部分，不失为一次有益的尝试，单独拿出来做成脚手架，提供给有需要的人吧。  </p>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><p><a target="_blank" rel="noopener" href="http://git.si-tech.com.cn/guolei/flask-rest-sample">http://git.si-tech.com.cn/guolei/flask-rest-sample</a><br><a target="_blank" rel="noopener" href="https://github.com/xiiiblue/flask-rest-sample">https://github.com/xiiiblue/flask-rest-sample</a>  </p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>flask-rest-sample 是一个使用Python编写的REST API，可以对多个资源提供增删改查服务，用于快速构建REST应用。  </p>
<ol>
<li>Web框架使用Flask</li>
<li>ORM框架使用peewee</li>
<li>安全方面使用了flask-jwt插件进行JWT(Json Web Token)认证</li>
<li>由于flask-rest/flask-restplus侵略性较强，本次没有使用。</li>
<li>可以考虑自行使用flasgger添加SwaggerUI文档。</li>
</ol>
<h2 id="第三方依赖"><a href="#第三方依赖" class="headerlink" title="第三方依赖"></a>第三方依赖</h2><ul>
<li>peewee</li>
<li>pymysql</li>
<li>Flask</li>
<li>Flask-JWT</li>
<li>flask-script</li>
</ul>
<h2 id="主要代码示例"><a href="#主要代码示例" class="headerlink" title="主要代码示例"></a>主要代码示例</h2><ol>
<li><p>建模时尽量避免使用外键等约束条件，保证模型结构上一致，可以做到共用一个公共服务。</p>
</li>
<li><p>可使用<code>@rest.route</code>添加多个资源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"># 基本API</span><br><span class="line">@rest.route(&#39;&#x2F;api&#x2F;reports&#39;, methods&#x3D;[&#39;GET&#39;, &#39;POST&#39;])</span><br><span class="line">@rest.route(&#39;&#x2F;api&#x2F;reports&#x2F;&lt;id&gt;&#39;, methods&#x3D;[&#39;GET&#39;, &#39;PUT&#39;, &#39;DELETE&#39;])</span><br><span class="line">@rest.route(&#39;&#x2F;api&#x2F;res2&#39;, methods&#x3D;[&#39;GET&#39;, &#39;POST&#39;])</span><br><span class="line">@rest.route(&#39;&#x2F;api&#x2F;res2&#x2F;&lt;id&gt;&#39;, methods&#x3D;[&#39;GET&#39;, &#39;PUT&#39;, &#39;DELETE&#39;])  #只要模型结构一致，可以添加多个资源</span><br><span class="line">@jwt_required()</span><br><span class="line">def common_rest_api(id&#x3D;None):</span><br><span class="line">    model_name &#x3D; request.path.split(&#39;&#x2F;&#39;)[2]  </span><br><span class="line">    pee_wee_model &#x3D; utils.get_model_by_name(model_name)  #从URL中确定模型</span><br><span class="line">    if not pee_wee_model:</span><br><span class="line">        return utils.jsonresp(status&#x3D;400, errinfo&#x3D;&#39;model_name不正确&#39;)</span><br><span class="line"></span><br><span class="line">    if id:</span><br><span class="line">        # 查询</span><br><span class="line">        if request.method &#x3D;&#x3D; &#39;GET&#39;:</span><br><span class="line">            try:</span><br><span class="line">                model &#x3D; pee_wee_model.get(pee_wee_model.id &#x3D;&#x3D; id)</span><br><span class="line">            except:</span><br><span class="line">                return utils.jsonresp(status&#x3D;404, errinfo&#x3D;&#39;查询不到资料&#39;)</span><br><span class="line">            return utils.jsonresp(jsonobj&#x3D;utils.obj_to_dict(model))</span><br><span class="line">        # 修改</span><br><span class="line">        elif request.method &#x3D;&#x3D; &#39;PUT&#39;:</span><br><span class="line">            json_dict &#x3D; request.get_json(silent&#x3D;True, force&#x3D;True)</span><br><span class="line">            if not json_dict: return utils.jsonresp(status&#x3D;400, errinfo&#x3D;&#39;参数格式不正确&#39;)</span><br><span class="line">            try:</span><br><span class="line">                model &#x3D; pee_wee_model.get(pee_wee_model.id &#x3D;&#x3D; id)</span><br><span class="line">            except:</span><br><span class="line">                return utils.jsonresp(status&#x3D;404, errinfo&#x3D;&#39;查询不到资料&#39;)</span><br><span class="line">            utils.dict_to_obj(dict&#x3D;json_dict, obj&#x3D;model, exclude&#x3D;(&#39;id&#39;,))  # 去掉ID字段</span><br><span class="line">            model.save()</span><br><span class="line">            return utils.jsonresp(status&#x3D;201)</span><br><span class="line">        # 删除</span><br><span class="line">        elif request.method &#x3D;&#x3D; &#39;DELETE&#39;:</span><br><span class="line">            try:</span><br><span class="line">                pee_wee_model.get(pee_wee_model.id &#x3D;&#x3D; id).delete_instance()</span><br><span class="line">            except:</span><br><span class="line">                return utils.jsonresp(status&#x3D;404, errinfo&#x3D;&#39;查询不到资料&#39;)</span><br><span class="line">            return utils.jsonresp(status&#x3D;204)</span><br><span class="line">        else:</span><br><span class="line">            return utils.jsonresp(status&#x3D;405, errinfo&#x3D;&#39;不支持的HTTP方法&#39;)</span><br><span class="line">    else:</span><br><span class="line">        # 全量查询（支持分页、排序、搜索）</span><br><span class="line">        if request.method &#x3D;&#x3D; &#39;GET&#39;:</span><br><span class="line">            # 处理查询参数</span><br><span class="line">            logger.debug(request.args)</span><br><span class="line">            try:</span><br><span class="line">                # 当前页码</span><br><span class="line">                page &#x3D; request.args.get(&#39;page&#39;, &#39;&#39;)</span><br><span class="line">                if page: page &#x3D; int(page) + 1</span><br><span class="line">                # 每页展示数量</span><br><span class="line">                length &#x3D; request.args.get(&#39;length&#39;, &#39;&#39;)</span><br><span class="line">                if length:</span><br><span class="line">                    length &#x3D; int(length)</span><br><span class="line">                else:</span><br><span class="line">                    length &#x3D; cfg.ITEMS_PER_PAGE</span><br><span class="line">                # 排序</span><br><span class="line">                sort &#x3D; request.args.get(&#39;sort&#39;, &#39;&#39;)</span><br><span class="line">                if sort:</span><br><span class="line">                    sort_column &#x3D; sort.split(&#39;,&#39;)[0]</span><br><span class="line">                    sort_direction &#x3D; sort.split(&#39;,&#39;)[1]</span><br><span class="line">            except:</span><br><span class="line">                return utils.jsonresp(status&#x3D;400, errinfo&#x3D;&#39;参数格式不正确&#39;)</span><br><span class="line"></span><br><span class="line">            # 查询</span><br><span class="line">            query &#x3D; pee_wee_model.select()</span><br><span class="line">            total_count &#x3D; query.count()</span><br><span class="line"></span><br><span class="line">            # 排序</span><br><span class="line">            if sort:</span><br><span class="line">                if sort_column in pee_wee_model._meta.fields:</span><br><span class="line">                    field &#x3D; getattr(pee_wee_model, sort_column)</span><br><span class="line">                    if sort_direction !&#x3D; &#39;asc&#39;:</span><br><span class="line">                        field &#x3D; field.desc()</span><br><span class="line">                    query &#x3D; query.order_by(field)</span><br><span class="line">            # 分页</span><br><span class="line">            if page:</span><br><span class="line">                query &#x3D; query.paginate(page, length)</span><br><span class="line"></span><br><span class="line">            dict &#x3D; &#123;&#39;content&#39;: utils.query_to_list(query), &#39;totalElements&#39;: total_count&#125;</span><br><span class="line">            return utils.jsonresp(jsonobj&#x3D;dict)</span><br><span class="line">        # 新增</span><br><span class="line">        elif request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line">            json_dict &#x3D; request.get_json(silent&#x3D;True, force&#x3D;True)</span><br><span class="line">            if not json_dict: return utils.jsonresp(status&#x3D;400, errinfo&#x3D;&#39;参数格式不正确&#39;)</span><br><span class="line">            user &#x3D; utils.dict_to_obj(dict&#x3D;json_dict, obj&#x3D;pee_wee_model(), exclude&#x3D;[&#39;id&#39;])  # 去掉ID字段</span><br><span class="line">            user.save()</span><br><span class="line">            return utils.jsonresp(status&#x3D;201)</span><br><span class="line">        else:</span><br><span class="line">            return utils.jsonresp(status&#x3D;405, errinfo&#x3D;&#39;不支持的HTTP方法&#39;)</span><br></pre></td></tr></table></figure>
<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><h3 id="venv虚拟环境安装配置"><a href="#venv虚拟环境安装配置" class="headerlink" title="venv虚拟环境安装配置"></a>venv虚拟环境安装配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install virtualenv</span><br><span class="line">virtualenv venv</span><br><span class="line">. venv&#x2F;bin&#x2F;activate</span><br></pre></td></tr></table></figure>
<h3 id="第三方依赖安装"><a href="#第三方依赖安装" class="headerlink" title="第三方依赖安装"></a>第三方依赖安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip3 install -r requirements.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="系统参数配置"><a href="#系统参数配置" class="headerlink" title="系统参数配置"></a>系统参数配置</h3></li>
<li><p>编辑<code>config.py</code>， 修改SECRET_KEY及MySQL数据库相关参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SECRET_KEY &#x3D; os.environ.get(&#39;SECRET_KEY&#39;) or &#39;your-secret&#39;</span><br><span class="line">DB_HOST &#x3D; &#39;127.0.0.1&#39;</span><br><span class="line">DB_USER &#x3D; &#39;foobar&#39;</span><br><span class="line">DB_PASSWD &#x3D; &#39;foobar&#39;</span><br><span class="line">DB_DATABASE &#x3D; &#39;foobar&#39;</span><br></pre></td></tr></table></figure></li>
<li><p>编辑log-app.conf，修改日志路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">args&#x3D;(&#39;&#x2F;path&#x2F;to&#x2F;log&#x2F;flask-rest-sample.log&#39;,&#39;a&#39;,&#39;utf8&#39;)</span><br></pre></td></tr></table></figure>
<h3 id="数据库初始化"><a href="#数据库初始化" class="headerlink" title="数据库初始化"></a>数据库初始化</h3></li>
<li><p>自动建表<br>直接运行<code>python3 models.py</code></p>
</li>
<li><p>插入管理员用户（默认admin/admin)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO &#96;user&#96; (&#96;id&#96;, &#96;username&#96;, &#96;password&#96;, &#96;fullname&#96;, &#96;email&#96;, &#96;phone&#96;, &#96;status&#96;)</span><br><span class="line">VALUES</span><br><span class="line">	(1, &#39;admin&#39;, &#39;pbkdf2:sha1:1000$Km1vdx3W$9aa07d3b79ab88aae53e45d26d0d4d4e097a6cd3&#39;, &#39;管理员&#39;, &#39;admin@admin.com&#39;, &#39;18612341234&#39;, 1);</span><br></pre></td></tr></table></figure>
<h3 id="启动应用"><a href="#启动应用" class="headerlink" title="启动应用"></a>启动应用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nohup .&#x2F;manage.py runserver 2&gt;&amp;1 &amp;</span><br><span class="line">或</span><br><span class="line">.&#x2F;run_app_dev.py (仅限测试)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="REST接口说明"><a href="#REST接口说明" class="headerlink" title="REST接口说明"></a>REST接口说明</h2><p>以reports资源为例：</p>
<ul>
<li>GET  /api/reports/<id>  查询<br>200 成功</li>
</ul>
<ul>
<li><p>PUT  /api/reports/<id>  修改<br>201 成功</p>
</li>
<li><p>DELETE  /api/reports/<id>  删除<br>204 成功</p>
</li>
<li><p>POST  /api/reports  新增<br>200 成功</p>
</li>
<li><p>GET  /api/reports  全量查询<br>200 成功</p>
<blockquote>
<p>支持分页（URL参数：page、length）及排序(URL参数：sort)<br>参数示例：<code>?page=1&amp;length=5&amp;sort=serial_number,desc</code>  </p>
</blockquote>
</li>
</ul>
<h2 id="JWT认证简单说明"><a href="#JWT认证简单说明" class="headerlink" title="JWT认证简单说明"></a>JWT认证简单说明</h2><ol>
<li>向/api/auth发起用户认证请求  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST http:&#x2F;&#x2F;127.0.0.1:5000&#x2F;api&#x2F;auth</span><br><span class="line">Content-Type: application&#x2F;json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;username&quot;: &quot;admin&quot;,</span><br><span class="line">    &quot;password&quot;: &quot;admin&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>获取响应，取得access_token<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;access_token&quot;: &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE0OTE2MzUyNTQsIm5iZiI6MTQ5MTYzNTI1NCwiaWRlbnRpdHkiOjEsImV4cCI6MTQ5MTYzNTU1NH0.wq-uer9LbRP5hEYGT4WfD5O4jf7k7du2Q1K6musKzvU&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>在接下来的HTTP请求头中，加入<code>Authorization</code>，值为<code>JWT+空格+access_token</code><br>以获取当前用户信息为例<br>请求：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET http:&#x2F;&#x2F;127.0.0.1:5000&#x2F;api&#x2F;identity</span><br><span class="line">Authorization: JWT eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE0OTE2MzUyNTQsIm5iZiI6MTQ5MTYzNTI1NCwiaWRlbnRpdHkiOjEsImV4cCI6MTQ5MTYzNTU1NH0.wq-uer9LbRP5hEYGT4WfD5O4jf7k7du2Q1K6musKzvU</span><br></pre></td></tr></table></figure>
响应：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;email&quot;: &quot;admin@admin.com&quot;,</span><br><span class="line">  &quot;fullname&quot;: &quot;管理员&quot;,</span><br><span class="line">  &quot;username&quot;: &quot;admin&quot;,</span><br><span class="line">  &quot;phone&quot;: &quot;18612341234&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201704/soapui%E5%9C%A8mac%E4%B8%8B%E5%90%AF%E5%8A%A8%E5%8D%A1%E6%AD%BB%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201704/soapui%E5%9C%A8mac%E4%B8%8B%E5%90%AF%E5%8A%A8%E5%8D%A1%E6%AD%BB%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">SoapUI在macOS下启动卡死问题处理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-06 15:45:43" itemprop="dateCreated datePublished" datetime="2018-11-06T15:45:43+08:00">2018-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h2><p>macOS版SoapUI启动后，窗口卡死，只能Cmd-Option-Esc强制退出。</p>
<blockquote>
<p>系统版本: macOS Sierra 10.12.4<br>SoapUI版本: 5.3.0/5.2.1</p>
</blockquote>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><ol>
<li><p>修改vmoptions.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;Applications&#x2F;SoapUI-5.3.0.app&#x2F;Contents&#x2F;vmoptions.txt</span><br></pre></td></tr></table></figure>
<p>最后下新增一行<code>-Dsoapui.browser.disabled=true</code></p>
</li>
<li><p>修改soapui.sh</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;Applications&#x2F;SoapUI-5.3.0.app&#x2F;Contents&#x2F;java&#x2F;app&#x2F;bin&#x2F;soapui.sh</span><br></pre></td></tr></table></figure>
<p>将<code>JAVA_OPTS=&quot;$JAVA_OPTS -Dsoapui.browser.disabled=true&quot;</code>一行的注释去掉。  </p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201704/Ubuntu%E4%B8%8Bboot%E5%88%86%E5%8C%BA%E7%A9%BA%E9%97%B4%E5%B7%B2%E6%BB%A1%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201704/Ubuntu%E4%B8%8Bboot%E5%88%86%E5%8C%BA%E7%A9%BA%E9%97%B4%E5%B7%B2%E6%BB%A1%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">Ubuntu下boot分区空间已满问题处理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-06 15:45:42" itemprop="dateCreated datePublished" datetime="2018-11-06T15:45:42+08:00">2018-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>最初安装Ubuntu时，/boot分区只给了200M空间（使用CentOS延续下来的习惯），结果每次生级内核时都会报错/boot空间不足。<br>下次全新安装Ubuntu，一定记得分出2G空间来给/boot。  </p>
<h2 id="临时解决方法"><a href="#临时解决方法" class="headerlink" title="临时解决方法"></a>临时解决方法</h2><ol>
<li><code>uname -a</code> 查看目前在用的内核版本  </li>
<li><code>dpkg --get-selections|grep linux-image</code> 显示所有的内核版本  </li>
<li><code>sudo apt remove linux-image-XXXX-generic</code> 卸载旧内核，注意只保留最新的 <strong>两个</strong> 版本   </li>
<li><code>sudo apt autoremove</code> 清理无用的依赖  </li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201704/%E4%BD%BF%E7%94%A8Gradle%E6%9E%84%E5%BB%BA%E5%A4%9A%E6%A8%A1%E5%9D%97Java%E9%A1%B9%E7%9B%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201704/%E4%BD%BF%E7%94%A8Gradle%E6%9E%84%E5%BB%BA%E5%A4%9A%E6%A8%A1%E5%9D%97Java%E9%A1%B9%E7%9B%AE/" class="post-title-link" itemprop="url">使用Gradle构建Java项目</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-06 15:45:41" itemprop="dateCreated datePublished" datetime="2018-11-06T15:45:41+08:00">2018-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Gradle是一种类似Maven的项目构建工具，它没有使用繁琐的XML，而是使用Groovy语言进行配置。<br>作为后起之秀，Gradle继承了Maven的一些思想，并且 <strong>配置简洁</strong> ，有更强的 <strong>灵活性</strong> 。  </p>
<p>Android Studio从一定程度上也加快了Gradle的流行，目前有非常多的开源项目已经迁移到了Gradle。<br>但现阶段Gradle还不能完全替代Maven，从目前GitHub上的趋势看来，二者可能要并存一段时间了。  </p>
<p>从去年开始在一些中小型项目上尝试引入Gradle，仅做简单的项目构建，没有太过深入研究，整体使用下来的体验还是很愉快的。<br>本文主要是作一些科普，抛砖引玉，并贴出两个可以直接拿来使用的示例，帮助大家快速上手。  </p>
<h2 id="与Maven简单对比"><a href="#与Maven简单对比" class="headerlink" title="与Maven简单对比"></a>与Maven简单对比</h2><ol>
<li><p>简洁的配置。现在有很多人都对XML深恶痛绝，在Maven中，添加一个依赖需要编写以下5行配置：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.zaxxer&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;HikariCP&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.5.0&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>
<p>而在Gradle中，只需要一行：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &#39;com.zaxxer:HikariCP:2.5.0&#39;</span><br></pre></td></tr></table></figure>
<p>所以Gradle配置文件的整体长度大约是Maven的1/4到1/5左右，并且更加易读。</p>
</li>
<li><p>灵活性。例如要执行一条shell命令，只需要3行。当然客观来说，灵活往往是复杂的同义词：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">task dropDB(type: Exec) &#123;</span><br><span class="line"> commandLine ‘curl’,’-s’,’s’,’-x’,’DELETE’,&quot;http:&#x2F;&#x2F;$&#123;db.server&#125;:&#123;db.port&#125;&#x2F;db_name&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>约定优于配置。Gradle的Java Plugin，定义了与Maven完全一致的项目布局：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">src&#x2F;main&#x2F;java</span><br><span class="line">src&#x2F;main&#x2F;resources</span><br><span class="line">src&#x2F;test&#x2F;java</span><br><span class="line">src&#x2F;test&#x2F;resources</span><br></pre></td></tr></table></figure>
<p>更多的比较，可以参考 <a target="_blank" rel="noopener" href="https://gradle.org/maven-vs-gradle">https://gradle.org/maven-vs-gradle</a>  </p>
</li>
</ol>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ul>
<li>macOS下安装:  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install gradle</span><br></pre></td></tr></table></figure></li>
<li>Ubuntu下安装:  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install gradle</span><br></pre></td></tr></table></figure></li>
<li>Windows下安装:  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Step1: 在[https:&#x2F;&#x2F;gradle.org&#x2F;releases](https:&#x2F;&#x2F;gradle.org&#x2F;releases) 下载binary-only的zip包  </span><br><span class="line">Step2: 解压至某一目录，如C:&#x2F;bin&#x2F;gradle  </span><br><span class="line">Step3: 在系统属性-高级-环境变量中，新增GRADLE_HOME环境变量来指向安装路径，并在PATH环境变量的最后追加上GRADLE_HOME&#x2F;bin  </span><br></pre></td></tr></table></figure>
<h2 id="学习资源"><a href="#学习资源" class="headerlink" title="学习资源"></a>学习资源</h2>关于Gradle的学习，不再赘述，有大量的资源可供查阅  </li>
<li><a target="_blank" rel="noopener" href="https://gradle.org/">Gradle 官网</a>  </li>
<li><a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/userguide.html">Gradle User Guide</a>  </li>
<li><a target="_blank" rel="noopener" href="https://dongchuan.gitbooks.io/gradle-user-guide-/tutorials/">Gradle User Guide 中文版</a></li>
</ul>
<h2 id="单模块项目构建示例"><a href="#单模块项目构建示例" class="headerlink" title="单模块项目构建示例"></a>单模块项目构建示例</h2><p>下面是一个单模块Spring Boot项目的示例，适合快速搭建小型项目  </p>
<p><strong>/build.gradle</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        flatDir &#123;</span><br><span class="line">            dirs &#39;libs&#39;</span><br><span class="line">        &#125;</span><br><span class="line">        mavenLocal()</span><br><span class="line">        maven &#123; url &quot;http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:8081&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&quot; &#125;</span><br><span class="line">        &#x2F;&#x2F;  &#x2F;&#x2F; mavenCentral()  &#x2F;&#x2F;jcenter()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath(&quot;org.springframework.boot:spring-boot-gradle-plugin:1.4.0.RELEASE&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply plugin: &#39;java&#39;</span><br><span class="line">apply plugin: &quot;spring-boot&quot;</span><br><span class="line"></span><br><span class="line">jar &#123;</span><br><span class="line">    baseName &#x3D; &#39;project&#39;</span><br><span class="line">    version &#x3D; &#39;1.0-SNAPSHOT&#39;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sourceCompatibility &#x3D; 1.7</span><br><span class="line">targetCompatibility &#x3D; 1.7</span><br><span class="line"></span><br><span class="line">repositories &#123;</span><br><span class="line">    mavenCentral()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile &#39;org.springframework.boot:spring-boot-starter&#39;</span><br><span class="line">    compile &#39;org.apache.commons:commons-email:1.4&#39;</span><br><span class="line">    compile files(&#39;libs&#x2F;jxl-2.6.12.jar&#39;)</span><br><span class="line">    runtime &#39;mysql:mysql-connector-java:5.1.36&#39;</span><br><span class="line">    testCompile &#39;org.springframework.boot:spring-boot-starter-test&#39;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test &#123;</span><br><span class="line">    exclude &#39;com&#x2F;foo&#x2F;**&#39;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task listJars(description: &#39;Display all compile jars.&#39;) &lt;&lt; &#123;</span><br><span class="line">    configurations.compile.each &#123; File file -&gt; println file.name &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="多模块项目构建示例"><a href="#多模块项目构建示例" class="headerlink" title="多模块项目构建示例"></a>多模块项目构建示例</h2><p>下面是一个基于Spring Boot的多模块项目示例，可以裁剪后直接拿来做为脚手架使用，适合中型项目  </p>
<p><strong>/settings.gradle</strong>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">include &#39;common&#39;</span><br><span class="line">include &#39;repository&#39;</span><br><span class="line">include &#39;restapi&#39;</span><br></pre></td></tr></table></figure>
<p><strong>/build.gradle</strong>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenLocal()</span><br><span class="line">        maven &#123; url &quot;http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:8081&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&quot; &#125;</span><br><span class="line">        &#x2F;&#x2F;mavenCentral()</span><br><span class="line">        &#x2F;&#x2F;jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath(&quot;org.springframework.boot:spring-boot-gradle-plugin:1.4.0.RELEASE&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">allprojects &#123;</span><br><span class="line">    apply plugin: &#39;idea&#39;</span><br><span class="line">    apply plugin: &#39;eclipse&#39;</span><br><span class="line"></span><br><span class="line">    group &#x3D; &#39;com.foo.bar&#39;</span><br><span class="line">    version &#x3D; &#39;1.0-SNAPSHOT&#39;</span><br><span class="line">    &#x2F;&#x2F;archivesBaseName &#x3D; &#39;project&#39;</span><br><span class="line"></span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenLocal()</span><br><span class="line">        maven &#123; url &quot;http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:8081&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&quot; &#125;</span><br><span class="line">        &#x2F;&#x2F;mavenCentral()</span><br><span class="line">        &#x2F;&#x2F;jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">subprojects &#123;</span><br><span class="line">    apply plugin: &#39;java&#39;</span><br><span class="line">    apply plugin: &quot;spring-boot&quot;</span><br><span class="line"></span><br><span class="line">    sourceCompatibility &#x3D; 1.8</span><br><span class="line">    targetCompatibility &#x3D; 1.8</span><br><span class="line"></span><br><span class="line">    dependencies &#123;</span><br><span class="line">        compile &#39;org.springframework.boot:spring-boot-starter&#39;</span><br><span class="line">        compile &#39;org.springframework.boot:spring-boot-configuration-processor&#39;</span><br><span class="line">        compile &#39;org.springframework.boot:spring-boot-devtools&#39;</span><br><span class="line">        testCompile &#39;org.springframework.boot:spring-boot-starter-test&#39;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    test &#123;</span><br><span class="line">        exclude &#39;com&#x2F;foo&#x2F;bar&#x2F;**&#39;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    task listJars(description: &#39;Display all compile jars.&#39;) &lt;&lt; &#123;</span><br><span class="line">        configurations.compile.each &#123; File file -&gt; println file.name &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task wrapper(type: Wrapper) &#123;</span><br><span class="line">    gradleVersion &#x3D; &#39;3.1&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>/common/build.gradle</strong>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">bootRepackage.enabled &#x3D; false</span><br><span class="line">jar.baseName &#39;project-common&#39;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile project(&#39;:repository&#39;)</span><br><span class="line">    compile &#39;org.springframework.boot:spring-boot-starter-web&#39;</span><br><span class="line">    compile &#39;commons-lang:commons-lang:2.6&#39;</span><br><span class="line">    compile &#39;org.apache.httpcomponents:httpclient:4.5.2&#39;</span><br><span class="line">    compile &#39;org.modelmapper:modelmapper:0.7.5&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>/repository/build.gradle</strong>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">bootRepackage.enabled &#x3D; false</span><br><span class="line">jar.baseName &#39;project-repository&#39;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    &#x2F;&#x2F;spring boot</span><br><span class="line">    compile (&#39;org.springframework.boot:spring-boot-starter-data-jpa&#39;)</span><br><span class="line">    compile &#39;org.springframework.boot:spring-boot-starter-jdbc&#39;</span><br><span class="line">    &#x2F;&#x2F;jackson</span><br><span class="line">    compile &#39;com.fasterxml.jackson.core:jackson-annotations:2.8.1&#39;</span><br><span class="line">    &#x2F;&#x2F;hibernate validator</span><br><span class="line">    compile &#39;javax.validation:validation-api:1.1.0.Final&#39;</span><br><span class="line">    compile &#39;org.hibernate:hibernate-validator:5.2.4.Final&#39;</span><br><span class="line">    compile &#39;org.hibernate:hibernate-validator-cdi:5.2.4.Final&#39;</span><br><span class="line">    compile &#39;javax.el:javax.el-api:2.2.4&#39;</span><br><span class="line">    compile &#39;org.glassfish.web:javax.el:2.2.4&#39;</span><br><span class="line">    &#x2F;&#x2F;swagger</span><br><span class="line">    compile &#39;io.springfox:springfox-swagger2:2.6.0&#39;</span><br><span class="line">    compile &#39;io.springfox:springfox-swagger-ui:2.6.0&#39;</span><br><span class="line">    &#x2F;&#x2F;jdbc driver</span><br><span class="line">    runtime &#39;mysql:mysql-connector-java:5.1.36&#39;</span><br><span class="line">    runtime &#39;com.h2database:h2:1.4.192&#39;</span><br><span class="line">    &#x2F;&#x2F;test</span><br><span class="line">    testCompile &#39;org.springframework.security:spring-security-core:4.1.1.RELEASE&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>/restapi/build.gradle</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">jar.baseName &#39;project-rest-api&#39;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile project(&#39;:repository&#39;)</span><br><span class="line">    compile project(&#39;:common&#39;)</span><br><span class="line">    &#x2F;&#x2F;spring boot</span><br><span class="line">    compile &#39;org.springframework.boot:spring-boot-starter-thymeleaf&#39;</span><br><span class="line">    compile &#39;org.springframework.boot:spring-boot-starter-cache&#39;</span><br><span class="line">    compile &#39;org.springframework.boot:spring-boot-starter-security&#39;</span><br><span class="line">    compile &#39;org.springframework.boot:spring-boot-starter-actuator&#39;</span><br><span class="line">    &#x2F;&#x2F;oauth2</span><br><span class="line">    compile &#39;org.springframework.security.oauth:spring-security-oauth2:2.0.11.RELEASE&#39;</span><br><span class="line">    &#x2F;&#x2F;cache</span><br><span class="line">    compile &#39;net.sf.ehcache:ehcache:2.10.2.2.21&#39;</span><br><span class="line">    &#x2F;&#x2F;pool</span><br><span class="line">    compile &#39;com.alibaba:druid:1.0.23&#39;</span><br><span class="line">    compile &#39;com.zaxxer:HikariCP:2.5.0&#39;</span><br><span class="line">    &#x2F;&#x2F;swagger-staticdocs</span><br><span class="line">    testCompile &#39;io.springfox:springfox-staticdocs:2.6.0&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201704/%E4%BD%BF%E7%94%A8Java%E7%BC%96%E5%86%99%E7%AE%80%E5%8D%95Socket%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%92%8C%E6%9C%8D%E5%8A%A1%E7%AB%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201704/%E4%BD%BF%E7%94%A8Java%E7%BC%96%E5%86%99%E7%AE%80%E5%8D%95Socket%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%92%8C%E6%9C%8D%E5%8A%A1%E7%AB%AF/" class="post-title-link" itemprop="url">使用Java编写简单Socket客户端和服务端</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-06 15:45:39" itemprop="dateCreated datePublished" datetime="2018-11-06T15:45:39+08:00">2018-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>某同事要用Socket连接外围系统，帮忙写了个简单的Demo。<br>包含一个客户端和一个服务端的，仅是示例，比较简陋，服务端也没有用多线程。<br>直接贴代码了。  </p>
<h2 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">import java.io.*;</span><br><span class="line">import java.net.*;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Socket服务端示例</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class SocketServer &#123;</span><br><span class="line">    ServerSocket serverSocket;</span><br><span class="line">    Socket connection &#x3D; null;</span><br><span class="line">    ObjectOutputStream out;</span><br><span class="line">    ObjectInputStream in;</span><br><span class="line">    String message;</span><br><span class="line"></span><br><span class="line">    void runServer() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            &#x2F;&#x2F; 创建服务端监听</span><br><span class="line">            serverSocket &#x3D; new ServerSocket(31313, 10);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 等待客户端连接</span><br><span class="line">            System.out.println(&quot;等待客户端连接...&quot;);</span><br><span class="line">            connection &#x3D; serverSocket.accept();</span><br><span class="line">            System.out.println(&quot;收到客户端连接： &quot; + connection.getInetAddress().getHostName());</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 获取输入输出流</span><br><span class="line">            out &#x3D; new ObjectOutputStream(connection.getOutputStream());</span><br><span class="line">            out.flush();</span><br><span class="line">            in &#x3D; new ObjectInputStream(connection.getInputStream());</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 连接成功后，首先向客户端发成功消息</span><br><span class="line">            sendMsg(&quot;连接成功&quot;);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 发送接收消息</span><br><span class="line">            do &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    message &#x3D; (String) in.readObject();</span><br><span class="line">                    System.out.println(&quot;client&gt;&quot; + message);</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F; 发送退出消息</span><br><span class="line">                    if (message.equals(&quot;bye&quot;)) &#123;</span><br><span class="line">                        sendMsg(&quot;bye&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (ClassNotFoundException ex) &#123;</span><br><span class="line">                    ex.printStackTrace();</span><br><span class="line">                    System.err.println(&quot;数据格式无效&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; while (!message.equals(&quot;bye&quot;));  &#x2F;&#x2F;当对方消息为bye时退出循环</span><br><span class="line">        &#125; catch (IOException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            &#x2F;&#x2F; 关闭Socket连接</span><br><span class="line">            try &#123;</span><br><span class="line">                in.close();</span><br><span class="line">                out.close();</span><br><span class="line">                serverSocket.close();</span><br><span class="line">            &#125; catch (IOException ioException) &#123;</span><br><span class="line">                ioException.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void sendMsg(String msg) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            out.writeObject(msg);</span><br><span class="line">            out.flush();</span><br><span class="line">            System.out.println(&quot;server&gt;&quot; + msg);</span><br><span class="line">        &#125; catch (IOException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String args[]) &#123;</span><br><span class="line">        SocketServer server &#x3D; new SocketServer();</span><br><span class="line">        while (true) &#123;</span><br><span class="line">            server.runServer();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">import java.io.*;</span><br><span class="line">import java.net.*;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Socket客户端示例</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class SocketClient &#123;</span><br><span class="line">    Socket clientSocket;</span><br><span class="line">    ObjectOutputStream out;</span><br><span class="line">    ObjectInputStream in;</span><br><span class="line">    String message;</span><br><span class="line"></span><br><span class="line">    void runClient() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            &#x2F;&#x2F; 连接到服务端</span><br><span class="line">            clientSocket &#x3D; new Socket(&quot;localhost&quot;, 31313);</span><br><span class="line">            System.out.println(&quot;已连接到服务端&quot;);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 获取输入输出流</span><br><span class="line">            out &#x3D; new ObjectOutputStream(clientSocket.getOutputStream());</span><br><span class="line">            out.flush();</span><br><span class="line">            in &#x3D; new ObjectInputStream(clientSocket.getInputStream());</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 发送接收消息</span><br><span class="line">            do &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    &#x2F;&#x2F; 接收消息</span><br><span class="line">                    message &#x3D; (String) in.readObject();</span><br><span class="line">                    System.out.println(&quot;server&gt;&quot; + message);</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F; 发送消息</span><br><span class="line">                    sendMsg(&quot;hello&quot;);</span><br><span class="line">                    sendMsg(&quot;hello again&quot;);</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F; 发送退出消息</span><br><span class="line">                    message &#x3D; &quot;bye&quot;;</span><br><span class="line">                    sendMsg(message);</span><br><span class="line">                &#125; catch (ClassNotFoundException ex) &#123;</span><br><span class="line">                    ex.printStackTrace();</span><br><span class="line">                    System.err.println(&quot;数据格式无效&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; while (!message.equals(&quot;bye&quot;)); &#x2F;&#x2F;当对方消息为bye时退出循环</span><br><span class="line">        &#125; catch (UnknownHostException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">            System.err.println(&quot;无法连接到服务端&quot;);</span><br><span class="line">        &#125; catch (IOException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            &#x2F;&#x2F; 关闭Socket连接</span><br><span class="line">            try &#123;</span><br><span class="line">                in.close();</span><br><span class="line">                out.close();</span><br><span class="line">                clientSocket.close();</span><br><span class="line">            &#125; catch (IOException ex) &#123;</span><br><span class="line">                ex.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void sendMsg(String msg) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            out.writeObject(msg);</span><br><span class="line">            out.flush();</span><br><span class="line">            System.out.println(&quot;client&gt;&quot; + msg);</span><br><span class="line">        &#125; catch (IOException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String args[]) &#123;</span><br><span class="line">        SocketClient client &#x3D; new SocketClient();</span><br><span class="line">        client.runClient();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201706/maven%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201706/maven%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">Maven配置示例</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-06 15:44:11" itemprop="dateCreated datePublished" datetime="2018-11-06T15:44:11+08:00">2018-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="pom-xml配置示例"><a href="#pom-xml配置示例" class="headerlink" title="pom.xml配置示例"></a>pom.xml配置示例</h2><p>以下是一个比较精简的spring-boot项目的配置文件，包含了Swagger和Jacoco插件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.foo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>bar<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>bar<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>blablabla<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-cloud.version</span>&gt;</span>Dalston.RELEASE<span class="tag">&lt;/<span class="name">spring-cloud.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- swagger配置 必需！--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">host</span>&gt;</span>x.x.x.x<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">basepath</span>&gt;</span>/<span class="tag">&lt;/<span class="name">basepath</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mainTitle</span>&gt;</span>bar<span class="tag">&lt;/<span class="name">mainTitle</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mainVersion</span>&gt;</span>v1<span class="tag">&lt;/<span class="name">mainVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>com.foo.bar.web<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">swaggerDirectory</span>&gt;</span>$&#123;basedir&#125;/target<span class="tag">&lt;/<span class="name">swaggerDirectory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">swaggerFileName</span>&gt;</span>swagger<span class="tag">&lt;/<span class="name">swaggerFileName</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 可根据需要增加自己的依赖 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--springboot--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-hystrix-dashboard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- swagger--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>Brixton.SR5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">archive</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">addClasspath</span>&gt;</span>true<span class="tag">&lt;/<span class="name">addClasspath</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">classpathPrefix</span>&gt;</span>lib/<span class="tag">&lt;/<span class="name">classpathPrefix</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.foo.bar.Application<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- swagger插件配置 必需！--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.kongchen<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">apiSources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">apiSource</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">springmvc</span>&gt;</span>true<span class="tag">&lt;/<span class="name">springmvc</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">locations</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">location</span>&gt;</span>$&#123;location&#125;<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">locations</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">schemes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scheme</span>&gt;</span>http<span class="tag">&lt;/<span class="name">scheme</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scheme</span>&gt;</span>https<span class="tag">&lt;/<span class="name">scheme</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">schemes</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">host</span>&gt;</span>$&#123;host&#125;<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">basePath</span>&gt;</span>$&#123;basepath&#125;<span class="tag">&lt;/<span class="name">basePath</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">info</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">title</span>&gt;</span>$&#123;mainTitle&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mainVersion&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">info</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">swaggerDirectory</span>&gt;</span>$&#123;swaggerDirectory&#125;<span class="tag">&lt;/<span class="name">swaggerDirectory</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">swaggerFileName</span>&gt;</span>$&#123;swaggerFileName&#125;<span class="tag">&lt;/<span class="name">swaggerFileName</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">apiSource</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">apiSources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>generate<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- jacoco插件 必需！--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">skip</span>&gt;</span>false<span class="tag">&lt;/<span class="name">skip</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">argLine</span>&gt;</span>$&#123;surefireArgLine&#125;<span class="tag">&lt;/<span class="name">argLine</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jacoco<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jacoco-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.7.7.201606060606<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>default-prepare-agent<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>prepare-agent<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">destFile</span>&gt;</span></span><br><span class="line">                $&#123;project.build.directory&#125;/coverage-reports/jacoco.exec</span><br><span class="line">              <span class="tag">&lt;/<span class="name">destFile</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">propertyName</span>&gt;</span>surefireArgLine<span class="tag">&lt;/<span class="name">propertyName</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="settings-xml配置示例"><a href="#settings-xml配置示例" class="headerlink" title="settings.xml配置示例"></a>settings.xml配置示例</h2><p>以下是一个使用nexus时的settings.xml配置文件示例</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/SETTINGS/1.0.0&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginGroups</span>&gt;</span><span class="tag">&lt;/<span class="name">pluginGroups</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">proxies</span>&gt;</span><span class="tag">&lt;/<span class="name">proxies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password</span>&gt;</span>foobar<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password</span>&gt;</span>foobar<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servers</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://x.x.x.x:8081/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://x.x.x.x:8081/nexus/content/groups/public-snapshots<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://nexus-releases<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://nexus-snapshots<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://nexus-releases<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://nexus-snapshots<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">activeProfiles</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activeProfile</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">activeProfile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">activeProfiles</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="清理脚本"><a href="#清理脚本" class="headerlink" title="清理脚本"></a>清理脚本</h2><p>当maven下载依赖时，如果网络中断，会产生一些.lastUpdated文件，导致下次无法正常下载依赖，以下是一个简单的清理脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~&#x2F;.m2</span><br><span class="line">find . -name &quot;*.lastUpdated&quot; -exec rm -rf &#123;&#125; \;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201706/tmon/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201706/tmon/" class="post-title-link" itemprop="url">tmon-一个简陋的应用健康度检测系统</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-06 15:44:10" itemprop="dateCreated datePublished" datetime="2018-11-06T15:44:10+08:00">2018-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>tmon - 一个简陋的应用健康度检测系统，基于Python3。<br>请注意，这是一个重复的轮子，源于某项目的紧急救火过程中，需要快速搭建一套监控系统实时监控几套后台服务的需求。<br>相较于使用现成的开源系统，花时间进行技术选型、部署、修改源码等操作，重写一套系统花费的时间更少，定制性更高。<br>本系统不再继续完善，仅供学习目的使用，类以的，有更多更为成熟的开源应用，请自行搜索比较。  </p>
<h2 id="功能特性"><a href="#功能特性" class="headerlink" title="功能特性"></a>功能特性</h2><ul>
<li>参数可配置化，可同时配置检测多个后台服务  </li>
<li>多线程并行检测  </li>
<li>支持邮件、短信两种通知方式  </li>
<li>防止重复通知机制、每日频繁通知融熔断机制  </li>
</ul>
<h2 id="检测方式及流程"><a href="#检测方式及流程" class="headerlink" title="检测方式及流程"></a>检测方式及流程</h2><p>可配置检测多个服务，针对某一个单独的服务，分别启两个线程，一个用于服务调用测试（收集样本），另一个用于健康度检测（裁决）  </p>
<p>服务调用测试线程：</p>
<ol>
<li>每隔一定时间（默认5秒）向特定的URL发起一次GET或POST请求。</li>
<li>如果请求的返回结果不是HTTP 2XX，或直接请求失败，则向一个FIFO的测试结果样本池（默认20个）中新增一条失败记录，反之增加一条成功记录。</li>
</ol>
<p>健康度检测线程：</p>
<ol>
<li>每隔一定时间（默认20秒），统计样本池中失败的次数，如果大于阈值（默认2个），则发起告警通知，并休眠一定时间。反之，认为系统运行正常，不做任何操作，仅休眠一定时间。</li>
<li>告警通知分为短信和邮件两类，参数配置实现。</li>
<li>首先判断今日的通知次数是否大于阈值（10次），如果是，则进行熔化断操作，不予发送。避免每天发送过量的SPAM通知。</li>
<li>然后判断re_notify_tag（每次检测时，如果成功，则re_notify_tag会置为True，反之为False），如果为真才会发送通知。re_notify_tag用于避免系统宕机后，重复发送通知。</li>
</ol>
<h2 id="安装及运行"><a href="#安装及运行" class="headerlink" title="安装及运行"></a>安装及运行</h2><h3 id="venv虚拟环境安装配置"><a href="#venv虚拟环境安装配置" class="headerlink" title="venv虚拟环境安装配置"></a>venv虚拟环境安装配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install virtualenv</span><br><span class="line">virtualenv venv</span><br><span class="line">. venv&#x2F;bin&#x2F;activate</span><br></pre></td></tr></table></figure>
<h3 id="第三方依赖安装"><a href="#第三方依赖安装" class="headerlink" title="第三方依赖安装"></a>第三方依赖安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip3 install -r requirements.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="守护进程启动"><a href="#守护进程启动" class="headerlink" title="守护进程启动"></a>守护进程启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup .&#x2F;tmon.py 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
<h2 id="GitLab源码"><a href="#GitLab源码" class="headerlink" title="GitLab源码"></a>GitLab源码</h2><p>更多源码请移步GitLab:<br><a target="_blank" rel="noopener" href="http://git.si-tech.com.cn/guolei/tmon">http://git.si-tech.com.cn/guolei/tmon</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201706/%E9%81%97%E7%95%99%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8Resty%E7%AE%80%E5%8C%96REST%E8%B0%83%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201706/%E9%81%97%E7%95%99%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8Resty%E7%AE%80%E5%8C%96REST%E8%B0%83%E7%94%A8/" class="post-title-link" itemprop="url">在遗留工程中使用Resty简化REST调用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-06 15:44:09" itemprop="dateCreated datePublished" datetime="2018-11-06T15:44:09+08:00">2018-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Spring3.0以下的遗留工程，由于无法使用RestTemplate，所以调用REST接口时会比较繁琐。<br>通过使用第三方REST户端框架Resty，可以大幅简化调用过程。<br>Resty的优势是使用简单，不需要引入过多的依赖。但相比于resttemplate/jersey/resteasy等，Resty还是过于小众，而且已有2年时间没有维护，异常处理也不是很完善。所以只建议在老旧项目中使用。<br>本文演示了Resty各种用法，包括代理设置、Header设置等。  </p>
<h2 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h2><p>对于较老的项目，直接下载并添加resty-0.3.2.jar</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://repo1.maven.org/maven2/us/monoid/web/resty/0.3.2/resty-0.3.2.jar</span><br></pre></td></tr></table></figure>
<p>如果项目使用了maven或gradle，直接添加依赖即可</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>us.monoid.web<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>resty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &#x27;us.monoid.web:resty:0.3.2&#x27;</span><br></pre></td></tr></table></figure>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>初始化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String baseUrl = <span class="string">&quot;http://127.0.0.1:8080/foobar&quot;</span>;</span><br><span class="line">Resty resty = <span class="keyword">new</span> Resty();</span><br></pre></td></tr></table></figure>
<p>设置代理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resty.setProxy(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8888</span>);</span><br></pre></td></tr></table></figure>
<p>设置token</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">resty.setOptions(<span class="keyword">new</span> Resty.Option() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">apply</span><span class="params">(URLConnection aConnection)</span> </span>&#123;</span><br><span class="line">        aConnection.setRequestProperty(<span class="string">&quot;Authorization&quot;</span>, <span class="string">&quot;Bearer foobarboobarfoobar&quot;</span>);</span><br><span class="line">        <span class="keyword">super</span>.apply(aConnection);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>GET 查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String restUrl = baseUrl + <span class="string">&quot;/users/4038488549360733&quot;</span>;</span><br><span class="line">JSONObject jsonObject = resty.json(restUrl).object();</span><br><span class="line">String serialNumber = jsonObject.getString(<span class="string">&quot;serialNumber&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>PUT 修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String restUrl = baseUrl + <span class="string">&quot;/users/4038488549360733&quot;</span>;</span><br><span class="line">String jsonStr = <span class="string">&quot;&#123;\&quot;brandCode\&quot;:\&quot;3G02\&quot;&#125;&quot;</span>;</span><br><span class="line">resty.json(restUrl, Resty.put(<span class="keyword">new</span> Content(<span class="string">&quot;application/json&quot;</span>, jsonStr.getBytes())));</span><br></pre></td></tr></table></figure>
<p>POST 新增</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String restUrl = baseUrl + <span class="string">&quot;/users&quot;</span>;</span><br><span class="line">String jsonStr = <span class="string">&quot;&#123;\&quot;brandCode\&quot;:\&quot;3G03\&quot;&#125;&quot;</span>;</span><br><span class="line">resty.json(restUrl, <span class="keyword">new</span> Content(<span class="string">&quot;application/json&quot;</span>, jsonStr.getBytes()));</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>DELETE 删除</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String restUrl = baseUrl + <span class="string">&quot;/users/4038488549360733&quot;</span>;</span><br><span class="line">resty.json(restUrl, Resty.delete());</span><br></pre></td></tr></table></figure>
<p>综合示例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">String serialNumber = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line">String restUrl;</span><br><span class="line">JSONObject jsonObject;</span><br><span class="line">JSONArray jsonArray;</span><br><span class="line">String itemId = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 查询用户信息，通过serialNumber取到userId</span></span><br><span class="line">    restUrl = baseUrl + <span class="string">&quot;/users?serialNumber=&quot;</span> + serialNumber;</span><br><span class="line">    jsonObject = resty.json(restUrl).object();</span><br><span class="line">    System.out.println(jsonObject);</span><br><span class="line">    String userId = jsonObject.getString(<span class="string">&quot;userId&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询资费信息，通过userId取到所有资费</span></span><br><span class="line">    restUrl = baseUrl + <span class="string">&quot;/discnts?userId=&quot;</span> + userId;</span><br><span class="line">    jsonArray = resty.json(restUrl).array();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; jsonArray.length(); i++) &#123;</span><br><span class="line">        jsonObject = jsonArray.getJSONObject(i);</span><br><span class="line">        System.out.println(jsonObject);</span><br><span class="line">        <span class="comment">// 随机取一个itemId</span></span><br><span class="line">        itemId = jsonObject.getString(<span class="string">&quot;itemId&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更改资费信息，通过itemId修改资费信息</span></span><br><span class="line">    restUrl = baseUrl + <span class="string">&quot;/discnts/&quot;</span> + itemId;</span><br><span class="line">    String jsonStr = <span class="string">&quot;&#123;\&quot;startDate\&quot;:\&quot;2001-01-01 20:01:02\&quot;, \&quot;endDate\&quot;:\&quot;2018-05-08 20:01:02\&quot;&#125;&quot;</span>;</span><br><span class="line">    resty.json(restUrl, Resty.put(<span class="keyword">new</span> Content(<span class="string">&quot;application/json&quot;</span>, jsonStr.getBytes())));</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="GitHub"><a href="#GitHub" class="headerlink" title="GitHub"></a>GitHub</h2><p><a target="_blank" rel="noopener" href="https://github.com/beders/Resty">https://github.com/beders/Resty</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/23/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><span class="page-number current">24</span><a class="page-number" href="/page/25/">25</a><span class="space">&hellip;</span><a class="page-number" href="/page/28/">28</a><a class="extend next" rel="next" href="/page/25/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">BlueXIII</p>
  <div class="site-description" itemprop="description">IT技术类文章、笔记分享</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">273</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/xiiiblue" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;xiiiblue" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/bluexiii" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;bluexiii" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备18050487号-1 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BlueXIII</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
