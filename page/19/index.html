<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.bluexiii.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="IT技术类文章、笔记分享">
<meta property="og:type" content="website">
<meta property="og:title" content="BlueXIII&#39;s Blog">
<meta property="og:url" content="http://blog.bluexiii.com/page/19/index.html">
<meta property="og:site_name" content="BlueXIII&#39;s Blog">
<meta property="og:description" content="IT技术类文章、笔记分享">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="BlueXIII">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://blog.bluexiii.com/page/19/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>BlueXIII's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">BlueXIII's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">热爱技术,持续学习</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201706/tmon/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201706/tmon/" class="post-title-link" itemprop="url">tmon-一个简陋的应用健康度检测系统</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-06-29 21:32:34" itemprop="dateCreated datePublished" datetime="2017-06-29T21:32:34+08:00">2017-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-11-06 15:44:10" itemprop="dateModified" datetime="2018-11-06T15:44:10+08:00">2018-11-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>tmon - 一个简陋的应用健康度检测系统，基于Python3。<br>请注意，这是一个重复的轮子，源于某项目的紧急救火过程中，需要快速搭建一套监控系统实时监控几套后台服务的需求。<br>相较于使用现成的开源系统，花时间进行技术选型、部署、修改源码等操作，重写一套系统花费的时间更少，定制性更高。<br>本系统不再继续完善，仅供学习目的使用，类以的，有更多更为成熟的开源应用，请自行搜索比较。  </p>
<h2 id="功能特性"><a href="#功能特性" class="headerlink" title="功能特性"></a>功能特性</h2><ul>
<li>参数可配置化，可同时配置检测多个后台服务  </li>
<li>多线程并行检测  </li>
<li>支持邮件、短信两种通知方式  </li>
<li>防止重复通知机制、每日频繁通知融熔断机制  </li>
</ul>
<h2 id="检测方式及流程"><a href="#检测方式及流程" class="headerlink" title="检测方式及流程"></a>检测方式及流程</h2><p>可配置检测多个服务，针对某一个单独的服务，分别启两个线程，一个用于服务调用测试（收集样本），另一个用于健康度检测（裁决）  </p>
<p>服务调用测试线程：</p>
<ol>
<li>每隔一定时间（默认5秒）向特定的URL发起一次GET或POST请求。</li>
<li>如果请求的返回结果不是HTTP 2XX，或直接请求失败，则向一个FIFO的测试结果样本池（默认20个）中新增一条失败记录，反之增加一条成功记录。</li>
</ol>
<p>健康度检测线程：</p>
<ol>
<li>每隔一定时间（默认20秒），统计样本池中失败的次数，如果大于阈值（默认2个），则发起告警通知，并休眠一定时间。反之，认为系统运行正常，不做任何操作，仅休眠一定时间。</li>
<li>告警通知分为短信和邮件两类，参数配置实现。</li>
<li>首先判断今日的通知次数是否大于阈值（10次），如果是，则进行熔化断操作，不予发送。避免每天发送过量的SPAM通知。</li>
<li>然后判断re_notify_tag（每次检测时，如果成功，则re_notify_tag会置为True，反之为False），如果为真才会发送通知。re_notify_tag用于避免系统宕机后，重复发送通知。</li>
</ol>
<h2 id="安装及运行"><a href="#安装及运行" class="headerlink" title="安装及运行"></a>安装及运行</h2><h3 id="venv虚拟环境安装配置"><a href="#venv虚拟环境安装配置" class="headerlink" title="venv虚拟环境安装配置"></a>venv虚拟环境安装配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install virtualenv</span><br><span class="line">virtualenv venv</span><br><span class="line">. venv&#x2F;bin&#x2F;activate</span><br></pre></td></tr></table></figure>
<h3 id="第三方依赖安装"><a href="#第三方依赖安装" class="headerlink" title="第三方依赖安装"></a>第三方依赖安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip3 install -r requirements.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="守护进程启动"><a href="#守护进程启动" class="headerlink" title="守护进程启动"></a>守护进程启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup .&#x2F;tmon.py 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
<h2 id="GitLab源码"><a href="#GitLab源码" class="headerlink" title="GitLab源码"></a>GitLab源码</h2><p>更多源码请移步GitLab:<br><a target="_blank" rel="noopener" href="http://git.si-tech.com.cn/guolei/tmon">http://git.si-tech.com.cn/guolei/tmon</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201706/maven%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201706/maven%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">Maven配置示例</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-06-12 09:54:41" itemprop="dateCreated datePublished" datetime="2017-06-12T09:54:41+08:00">2017-06-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-11-06 15:44:11" itemprop="dateModified" datetime="2018-11-06T15:44:11+08:00">2018-11-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="pom-xml配置示例"><a href="#pom-xml配置示例" class="headerlink" title="pom.xml配置示例"></a>pom.xml配置示例</h2><p>以下是一个比较精简的spring-boot项目的配置文件，包含了Swagger和Jacoco插件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.foo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>bar<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>bar<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>blablabla<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-cloud.version</span>&gt;</span>Dalston.RELEASE<span class="tag">&lt;/<span class="name">spring-cloud.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- swagger配置 必需！--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">host</span>&gt;</span>x.x.x.x<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">basepath</span>&gt;</span>/<span class="tag">&lt;/<span class="name">basepath</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mainTitle</span>&gt;</span>bar<span class="tag">&lt;/<span class="name">mainTitle</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mainVersion</span>&gt;</span>v1<span class="tag">&lt;/<span class="name">mainVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>com.foo.bar.web<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">swaggerDirectory</span>&gt;</span>$&#123;basedir&#125;/target<span class="tag">&lt;/<span class="name">swaggerDirectory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">swaggerFileName</span>&gt;</span>swagger<span class="tag">&lt;/<span class="name">swaggerFileName</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 可根据需要增加自己的依赖 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--springboot--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-hystrix-dashboard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- swagger--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>Brixton.SR5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">archive</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">addClasspath</span>&gt;</span>true<span class="tag">&lt;/<span class="name">addClasspath</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">classpathPrefix</span>&gt;</span>lib/<span class="tag">&lt;/<span class="name">classpathPrefix</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.foo.bar.Application<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- swagger插件配置 必需！--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.kongchen<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">apiSources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">apiSource</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">springmvc</span>&gt;</span>true<span class="tag">&lt;/<span class="name">springmvc</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">locations</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">location</span>&gt;</span>$&#123;location&#125;<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">locations</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">schemes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scheme</span>&gt;</span>http<span class="tag">&lt;/<span class="name">scheme</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scheme</span>&gt;</span>https<span class="tag">&lt;/<span class="name">scheme</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">schemes</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">host</span>&gt;</span>$&#123;host&#125;<span class="tag">&lt;/<span class="name">host</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">basePath</span>&gt;</span>$&#123;basepath&#125;<span class="tag">&lt;/<span class="name">basePath</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">info</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">title</span>&gt;</span>$&#123;mainTitle&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mainVersion&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">info</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">swaggerDirectory</span>&gt;</span>$&#123;swaggerDirectory&#125;<span class="tag">&lt;/<span class="name">swaggerDirectory</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">swaggerFileName</span>&gt;</span>$&#123;swaggerFileName&#125;<span class="tag">&lt;/<span class="name">swaggerFileName</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">apiSource</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">apiSources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>generate<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- jacoco插件 必需！--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">skip</span>&gt;</span>false<span class="tag">&lt;/<span class="name">skip</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">argLine</span>&gt;</span>$&#123;surefireArgLine&#125;<span class="tag">&lt;/<span class="name">argLine</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jacoco<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jacoco-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.7.7.201606060606<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>default-prepare-agent<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>prepare-agent<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">destFile</span>&gt;</span></span><br><span class="line">                $&#123;project.build.directory&#125;/coverage-reports/jacoco.exec</span><br><span class="line">              <span class="tag">&lt;/<span class="name">destFile</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">propertyName</span>&gt;</span>surefireArgLine<span class="tag">&lt;/<span class="name">propertyName</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="settings-xml配置示例"><a href="#settings-xml配置示例" class="headerlink" title="settings.xml配置示例"></a>settings.xml配置示例</h2><p>以下是一个使用nexus时的settings.xml配置文件示例</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/SETTINGS/1.0.0&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginGroups</span>&gt;</span><span class="tag">&lt;/<span class="name">pluginGroups</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">proxies</span>&gt;</span><span class="tag">&lt;/<span class="name">proxies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password</span>&gt;</span>foobar<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password</span>&gt;</span>foobar<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servers</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://x.x.x.x:8081/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://x.x.x.x:8081/nexus/content/groups/public-snapshots<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://nexus-releases<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://nexus-snapshots<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://nexus-releases<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://nexus-snapshots<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">activeProfiles</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activeProfile</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">activeProfile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">activeProfiles</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="清理脚本"><a href="#清理脚本" class="headerlink" title="清理脚本"></a>清理脚本</h2><p>当maven下载依赖时，如果网络中断，会产生一些.lastUpdated文件，导致下次无法正常下载依赖，以下是一个简单的清理脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~&#x2F;.m2</span><br><span class="line">find . -name &quot;*.lastUpdated&quot; -exec rm -rf &#123;&#125; \;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201706/spring-boot%E4%BD%BF%E7%94%A8slf4j+log4j/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201706/spring-boot%E4%BD%BF%E7%94%A8slf4j+log4j/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-06-08 15:39:41" itemprop="dateCreated datePublished" datetime="2017-06-08T15:39:41+08:00">2017-06-08</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="spring-boot中使用slf4j-log4j"><a href="#spring-boot中使用slf4j-log4j" class="headerlink" title="spring-boot中使用slf4j+log4j"></a>spring-boot中使用slf4j+log4j</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><blockquote>
<p>spring-boot默认是使用slf4j+logback做日志输出的， 本文主要演示如何切换为slf4j+log4j。<br>正常情况下，建议直接使用logback。</p>
</blockquote>
<p>在某SpringBoot项目中，因为要使用ELK做日志采集，局方要求使用log4j并给出了一组日志格式规范:  </p>
<ol>
<li>日志分为xxx-info和xxx-error两个文件，分开打印  </li>
<li>日志格式要求为  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%d&#123;yyyy-MM-dd HH:mm:ss&#125; [%-5p](%-30c&#123;1&#125;) [TxId : %X&#123;PtxId&#125; , SpanId : %X&#123;PspanId&#125;] [ET:%X&#123;ENV_TYPE&#125;,AN:%X&#123;APP_NAME&#125;,SN:%X&#123;SERVICE_NAME&#125;,CN:%X&#123;CONTAINER_NAME&#125;,CI:%X&#123;CONTAINER_IP&#125;] %m%n</span><br></pre></td></tr></table></figure>
所以只能有两种方案可供选择：  </li>
<li>配置logback，并保证与之前的log4j的行为一致  </li>
<li>将logback切换为log4j  </li>
</ol>
<p>由于面对日志格式中的一大堆%比较头大，于是选择了不怎么优雅的方案2，切换为log4j。</p>
<h2 id="配置Maven依赖"><a href="#配置Maven依赖" class="headerlink" title="配置Maven依赖"></a>配置Maven依赖</h2><p>首先要显式的引入spring-boot-starter，并将其中的spring-boot-starter-logging排除掉<br>然后新增一个spring-boot-starter-log4j的依赖  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="配置log4j"><a href="#配置log4j" class="headerlink" title="配置log4j"></a>配置log4j</h2><p>新建src/resource/log4j.properties，按正常方式配置即可<br>下面是一个双日志输出的样例：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">log4j.rootCategory&#x3D;info,file_info,file_error,stdout</span><br><span class="line">log4j.logger.org.springframework.web.filter.CommonsRequestLoggingFilter&#x3D;debug,file_info,stdout</span><br><span class="line">log4j.additivity.org.springframework.web.filter.CommonsRequestLoggingFilter&#x3D;false</span><br><span class="line"></span><br><span class="line">log4j.appender.stdout&#x3D;org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.stdout.Target&#x3D;System.out</span><br><span class="line">log4j.appender.stdout.layout&#x3D;org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.stdout.layout.ConversionPattern&#x3D;%d&#123;yyyy-MM-dd HH:mm:ss&#125; %-5p %c&#123;1&#125;:%L - %m%n</span><br><span class="line"></span><br><span class="line">log4j.appender.file_info&#x3D;org.apache.log4j.RollingFileAppender</span><br><span class="line">log4j.appender.file_info.layout&#x3D;org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.file_info.MaxFileSize&#x3D;100MB</span><br><span class="line">log4j.appender.file_info.MaxBackupIndex&#x3D;10</span><br><span class="line">log4j.appender.file_info.layout.ConversionPattern&#x3D;%d&#123;yyyy-MM-dd HH:mm:ss&#125; [%-5p](%-30c&#123;1&#125;) [TxId : %X&#123;PtxId&#125; , SpanId : %X&#123;PspanId&#125;] [ET:%X&#123;ENV_TYPE&#125;,AN:%X&#123;APP_NAME&#125;,SN:%X&#123;SERVICE_NAME&#125;,CN:%X&#123;CONTAINER_NAME&#125;,CI:%X&#123;CONTAINER_IP&#125;] %m%n</span><br><span class="line">log4j.appender.file_info.Threshold&#x3D;DEBUG</span><br><span class="line">log4j.appender.file_info.append&#x3D;true</span><br><span class="line">log4j.appender.file_info.File&#x3D;&#x2F;opt&#x2F;logs&#x2F;busi&#x2F;crm_sdtools-info.log</span><br><span class="line"></span><br><span class="line">log4j.appender.file_error&#x3D;org.apache.log4j.RollingFileAppender</span><br><span class="line">log4j.appender.file_error.layout&#x3D;org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.file_error.MaxFileSize&#x3D;100MB</span><br><span class="line">log4j.appender.file_error.MaxBackupIndex&#x3D;10</span><br><span class="line">log4j.appender.file_error.layout.ConversionPattern&#x3D;%d&#123;yyyy-MM-dd HH:mm:ss&#125; [%-5p](%-30c&#123;1&#125;) [TxId : %X&#123;PtxId&#125; , SpanId : %X&#123;PspanId&#125;] [ET:%X&#123;ENV_TYPE&#125;,AN:%X&#123;APP_NAME&#125;,SN:%X&#123;SERVICE_NAME&#125;,CN:%X&#123;CONTAINER_NAME&#125;,CI:%X&#123;CONTAINER_IP&#125;] %m%n</span><br><span class="line">log4j.appender.file_error.Threshold&#x3D;ERROR</span><br><span class="line">log4j.appender.file_error.append&#x3D;true</span><br><span class="line">log4j.appender.file_error.File&#x3D;&#x2F;opt&#x2F;logs&#x2F;busi&#x2F;crm_sdtools-error.log</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201706/%E9%81%97%E7%95%99%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8Resty%E7%AE%80%E5%8C%96REST%E8%B0%83%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201706/%E9%81%97%E7%95%99%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8Resty%E7%AE%80%E5%8C%96REST%E8%B0%83%E7%94%A8/" class="post-title-link" itemprop="url">在遗留工程中使用Resty简化REST调用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-06-08 15:34:57" itemprop="dateCreated datePublished" datetime="2017-06-08T15:34:57+08:00">2017-06-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-11-06 15:44:09" itemprop="dateModified" datetime="2018-11-06T15:44:09+08:00">2018-11-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Spring3.0以下的遗留工程，由于无法使用RestTemplate，所以调用REST接口时会比较繁琐。<br>通过使用第三方REST户端框架Resty，可以大幅简化调用过程。<br>Resty的优势是使用简单，不需要引入过多的依赖。但相比于resttemplate/jersey/resteasy等，Resty还是过于小众，而且已有2年时间没有维护，异常处理也不是很完善。所以只建议在老旧项目中使用。<br>本文演示了Resty各种用法，包括代理设置、Header设置等。  </p>
<h2 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h2><p>对于较老的项目，直接下载并添加resty-0.3.2.jar</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://repo1.maven.org/maven2/us/monoid/web/resty/0.3.2/resty-0.3.2.jar</span><br></pre></td></tr></table></figure>
<p>如果项目使用了maven或gradle，直接添加依赖即可</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>us.monoid.web<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>resty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &#x27;us.monoid.web:resty:0.3.2&#x27;</span><br></pre></td></tr></table></figure>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>初始化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String baseUrl = <span class="string">&quot;http://127.0.0.1:8080/foobar&quot;</span>;</span><br><span class="line">Resty resty = <span class="keyword">new</span> Resty();</span><br></pre></td></tr></table></figure>
<p>设置代理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resty.setProxy(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8888</span>);</span><br></pre></td></tr></table></figure>
<p>设置token</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">resty.setOptions(<span class="keyword">new</span> Resty.Option() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">apply</span><span class="params">(URLConnection aConnection)</span> </span>&#123;</span><br><span class="line">        aConnection.setRequestProperty(<span class="string">&quot;Authorization&quot;</span>, <span class="string">&quot;Bearer foobarboobarfoobar&quot;</span>);</span><br><span class="line">        <span class="keyword">super</span>.apply(aConnection);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>GET 查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String restUrl = baseUrl + <span class="string">&quot;/users/4038488549360733&quot;</span>;</span><br><span class="line">JSONObject jsonObject = resty.json(restUrl).object();</span><br><span class="line">String serialNumber = jsonObject.getString(<span class="string">&quot;serialNumber&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>PUT 修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String restUrl = baseUrl + <span class="string">&quot;/users/4038488549360733&quot;</span>;</span><br><span class="line">String jsonStr = <span class="string">&quot;&#123;\&quot;brandCode\&quot;:\&quot;3G02\&quot;&#125;&quot;</span>;</span><br><span class="line">resty.json(restUrl, Resty.put(<span class="keyword">new</span> Content(<span class="string">&quot;application/json&quot;</span>, jsonStr.getBytes())));</span><br></pre></td></tr></table></figure>
<p>POST 新增</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String restUrl = baseUrl + <span class="string">&quot;/users&quot;</span>;</span><br><span class="line">String jsonStr = <span class="string">&quot;&#123;\&quot;brandCode\&quot;:\&quot;3G03\&quot;&#125;&quot;</span>;</span><br><span class="line">resty.json(restUrl, <span class="keyword">new</span> Content(<span class="string">&quot;application/json&quot;</span>, jsonStr.getBytes()));</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>DELETE 删除</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String restUrl = baseUrl + <span class="string">&quot;/users/4038488549360733&quot;</span>;</span><br><span class="line">resty.json(restUrl, Resty.delete());</span><br></pre></td></tr></table></figure>
<p>综合示例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">String serialNumber = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line">String restUrl;</span><br><span class="line">JSONObject jsonObject;</span><br><span class="line">JSONArray jsonArray;</span><br><span class="line">String itemId = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 查询用户信息，通过serialNumber取到userId</span></span><br><span class="line">    restUrl = baseUrl + <span class="string">&quot;/users?serialNumber=&quot;</span> + serialNumber;</span><br><span class="line">    jsonObject = resty.json(restUrl).object();</span><br><span class="line">    System.out.println(jsonObject);</span><br><span class="line">    String userId = jsonObject.getString(<span class="string">&quot;userId&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询资费信息，通过userId取到所有资费</span></span><br><span class="line">    restUrl = baseUrl + <span class="string">&quot;/discnts?userId=&quot;</span> + userId;</span><br><span class="line">    jsonArray = resty.json(restUrl).array();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; jsonArray.length(); i++) &#123;</span><br><span class="line">        jsonObject = jsonArray.getJSONObject(i);</span><br><span class="line">        System.out.println(jsonObject);</span><br><span class="line">        <span class="comment">// 随机取一个itemId</span></span><br><span class="line">        itemId = jsonObject.getString(<span class="string">&quot;itemId&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更改资费信息，通过itemId修改资费信息</span></span><br><span class="line">    restUrl = baseUrl + <span class="string">&quot;/discnts/&quot;</span> + itemId;</span><br><span class="line">    String jsonStr = <span class="string">&quot;&#123;\&quot;startDate\&quot;:\&quot;2001-01-01 20:01:02\&quot;, \&quot;endDate\&quot;:\&quot;2018-05-08 20:01:02\&quot;&#125;&quot;</span>;</span><br><span class="line">    resty.json(restUrl, Resty.put(<span class="keyword">new</span> Content(<span class="string">&quot;application/json&quot;</span>, jsonStr.getBytes())));</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="GitHub"><a href="#GitHub" class="headerlink" title="GitHub"></a>GitHub</h2><p><a target="_blank" rel="noopener" href="https://github.com/beders/Resty">https://github.com/beders/Resty</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201704/python%E4%BD%BF%E7%94%A8cx_Oracle%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E5%9D%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201704/python%E4%BD%BF%E7%94%A8cx_Oracle%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E5%9D%91/" class="post-title-link" itemprop="url">Python使用cx_Oracle的几个小坑</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-04-27 17:07:29" itemprop="dateCreated datePublished" datetime="2017-04-27T17:07:29+08:00">2017-04-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-26 09:44:33" itemprop="dateModified" datetime="2021-01-26T09:44:33+08:00">2021-01-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>cx_Oracle是Python环境下的一个（好像也是唯一的一个）用于操作Oracle的第三方模块。<br>最近在写某个对帐程序时，不得已要连接一台Oracle库，于是用到了cx_Oracle，总的来说还是比较顺利的，期间遇到几个有意思的小坑写出来分享一下。</p>
<h2 id="RHEL-6-4下安装cx-Oracle"><a href="#RHEL-6-4下安装cx-Oracle" class="headerlink" title="RHEL 6.4下安装cx_Oracle"></a>RHEL 6.4下安装cx_Oracle</h2><p>RHEL6.4和cx_Oracle比较搭，安装时应该不会遇到什么挫折，使用RPM安装好instantclient后，直接用pip3安装cx_Oracle即可。</p>
<p>需要注意地方：</p>
<ol>
<li>尽量使用RPM方式安装instantclient，安装更方便，而且比zip更好管理。  </li>
<li>instantclient的版本选择的是11.2.0.4.0，没有选择12。对于Oracle/WebLogic这类闭源的东西，还是选择次最新版本的比较稳妥。  </li>
</ol>
<p>安装步骤：</p>
<ol>
<li><p>下载Linux版本的instantclient<br>这里是 <a target="_blank" rel="noopener" href="http://www.oracle.com/technetwork/cn/database/features/instant-client/index-097480.html">Oracle官网 instantclient下载页面</a> ，下载以下3个RPM包：<br>oracle-instantclient11.2-basic-11.2.0.4.0-1.x86_64.rpm<br>oracle-instantclient11.2-devel-11.2.0.4.0-1.x86_64.rpm<br>oracle-instantclient11.2-sqlplus-11.2.0.4.0-1.x86_64.rpm  </p>
</li>
<li><p>安装instantclient并设置环境变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum -y install libaio bc flex</span><br><span class="line">rpm -ivh oracle-instantclient11.2-basic-11.2.0.4.0-1.x86_64.rpm</span><br><span class="line">rpm -ivh oracle-instantclient11.2-devel-11.2.0.4.0-1.x86_64.rpm</span><br><span class="line">rpm -ivh oracle-instantclient11.2-sqlplus-11.2.0.4.0-1.x86_64.rpm</span><br></pre></td></tr></table></figure></li>
<li><p>设置环境变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo &#39;export ORACLE_VERSION&#x3D;&quot;11.2&quot;&#39; &gt;&gt; $HOME&#x2F;.bashrc</span><br><span class="line">echo &#39;export ORACLE_HOME&#x3D;&quot;&#x2F;usr&#x2F;lib&#x2F;oracle&#x2F;$ORACLE_VERSION&#x2F;client64&#x2F;&quot;&#39; &gt;&gt; $HOME&#x2F;.bashrc</span><br><span class="line">echo &#39;export PATH&#x3D;$PATH:&quot;$ORACLE_HOME&#x2F;bin&quot;&#39; &gt;&gt; $HOME&#x2F;.bashrc</span><br><span class="line">echo &#39;export LD_LIBRARY_PATH&#x3D;$LD_LIBRARY_PATH:&quot;$ORACLE_HOME&#x2F;lib&quot;&#39; &gt;&gt; $HOME&#x2F;.bashrc</span><br><span class="line">source $HOME&#x2F;.bashrc</span><br></pre></td></tr></table></figure></li>
<li><p>使用pip安装cx_Oracle</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install cx_Oracle</span><br></pre></td></tr></table></figure>
<h2 id="macOS-12下安装cx-Oracle"><a href="#macOS-12下安装cx-Oracle" class="headerlink" title="macOS 12下安装cx_Oracle"></a>macOS 12下安装cx_Oracle</h2><p>macOS下，安装cx_Oracle后的编译过程有可能会报错，一般是因为instantclient安装有误造成的。</p>
</li>
</ol>
<p>需要注意的地方：</p>
<ol>
<li>mac下的instantclient只有zip包一种安装方式，要注意手工建两个软链接。  </li>
<li>pip安装前，注意导入LD_LIBRARY_PATH与DYLD_LIBRARY_PATH两个环境变量。  </li>
</ol>
<p>安装过程：</p>
<ol>
<li><p>下载Mac版本的instantclient<br>下载以下3个zip包，并<code>unzip</code>解压至同一目录：<br>instantclient-basic-macos.x64-11.2.0.4.0.zip<br>instantclient-sdk-macos.x64-11.2.0.4.0.zip<br>instantclient-sqlplus-macos.x64-11.2.0.4.0.zip</p>
</li>
<li><p>建立软链接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;path&#x2F;to&#x2F;instant</span><br><span class="line">ln -s libclntsh.dylib.11.2 libclntsh.dylib</span><br><span class="line">ln -s libocci.dylib.11.2 libocci.dylib</span><br></pre></td></tr></table></figure></li>
<li><p>设置环境变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export ORACLE_VERSION&#x3D;&quot;11.2&quot;</span><br><span class="line">export ORACLE_HOME&#x3D;&quot;&#x2F;path&#x2F;to&#x2F;instantclient_11_2&quot;</span><br><span class="line">export PATH&#x3D;$PATH:&quot;$ORACLE_HOME&quot;</span><br></pre></td></tr></table></figure></li>
<li><p>使用pip安装cx_Oracle，注意提前导入DYLD_LIBRARY_PATH与LD_LIBRARY_PATH</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export DYLD_LIBRARY_PATH&#x3D;&quot;$ORACLE_HOME&quot;</span><br><span class="line">export LD_LIBRARY_PATH&#x3D;&quot;$ORACLE_HOME&quot;</span><br><span class="line">pip3 install cx_Oracle</span><br></pre></td></tr></table></figure>
<h2 id="中文乱码问题"><a href="#中文乱码问题" class="headerlink" title="中文乱码问题"></a>中文乱码问题</h2><p>Oracle中文乱码问题存在已久，使用cx_Oracle时也不例外，解决方法还是设置NLS_LANG环境变量。<br>有两种方式，一是在系统中设置永久环境变量，二是直接在代码中使用<code>os.environ</code>设置环境变量，这里推荐后者。  </p>
</li>
<li><p>方法一：在Shell中设置环境变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export NLS_LANG&#x3D;&quot;SIMPLIFIED CHINESE_CHINA.UTF8&quot;</span><br></pre></td></tr></table></figure></li>
<li><p>方法二：直接在代码中加入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">os.environ[&#39;NLS_LANG&#39;] &#x3D; &#39;SIMPLIFIED CHINESE_CHINA.UTF8&#39;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="PyCharm下不识别cx-Oracle问题"><a href="#PyCharm下不识别cx-Oracle问题" class="headerlink" title="PyCharm下不识别cx_Oracle问题"></a>PyCharm下不识别cx_Oracle问题</h3><p>安装安成后，在python的console中已经可以<code>import cx_Oracle</code>了，但在PyCharm中却提示找不到cx_Oracle。这是一个比较大的坑，可以详细讲一下处理过程。  </p>
<p>首先初步定位到原因，是由于PyCharm中没有定义LD_LIBRARY_PATH与DYLD_LIBRARY_PATH两个环境变量造成的。<br>PyCharm会自动读取系统中的环境变量设置并导入，但唯独这两个没有导进来。不深究原因，先尝试手工在PyCharm中配置这两个环境变量，总共有两处可以配置：</p>
<p>第一处：<br><code>CMD+,</code>打开Preference，找到 Build,Execution,Deployment -&gt; Console -&gt; Python Console -&gt;Enviroment Variables<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/r61vs.jpg"><br>此处的配置会修复PyCharm中的Console。</p>
<p>第二处：<br>右上角 Run -&gt; Edit Configurations，添加两条环境变量<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/09u0q.jpg"><br>此处的配置会修复PyCharm中<code>Ctrl+Shift+R</code>运行代码时的报错。</p>
<p>在以上两处手工添加环境变量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DYLD_LIBRARY_PATH&#x3D;&#x2F;path&#x2F;to&#x2F;instantclient</span><br><span class="line">LD_LIBRARY_PATH&#x2F;path&#x2F;to&#x2F;instantclient</span><br></pre></td></tr></table></figure>
<p>两处的环境变量配置完成后，虽然console中可以正常使用cx_Oracle了，代码也可以正常运行了，但编辑界面中的inspection还是有问题的，提示有Error，并且不能使用自动完成功能。</p>
<p>于是回到之前的问题，为什么明明已经定义了，但PyCharm却没有找到LD_LIBRARY_PATH与DYLD_LIBRARY_PATH？<br>同时偶然发现，在执行<code>env</code>命令查看已定义的环境变量时，也是找不到LD_LIBRARY_PATH与DYLD_LIBRARY_PATH的。<br>这貌似已经不是PyCharm自身的问题了，需要从macOS系统来着手了。  </p>
<p>于是在stackoverflow上找到了这么一段话：  </p>
<blockquote>
<p>El Capitan added system integrity protection (SIP), and one side effect of that is that exporting DYLD_LIBRARY_PATH doesn’t work. That could affect running SQL*Plus from a shell script, for example. There are workarounds for the 11g instant client. The installation notes at the bottom of the download page have changed since I last did this, and it now says to hard link the library files to the user’s ~/lib directory to avoid that issue. Fortunately it looks like you don’t need to worry about that with the 12c client - they’ve fixed the way it’s built.</p>
</blockquote>
<p>看来根本原因是OSX 10.11之后加入的这个SIP引发的了。  </p>
<p>首先想到的最简单的方法，将所有的<code>.dylib</code>和<code>.h</code>都拷贝到系统默认的目录就可以了。<br>但很杯具，<code>/usr/lib</code>和<code>/user/include</code>这两个目录也被SIP保护了。因为不想强制关闭SIP，继续再想别的办法。<br>接着发现<code>/usr/local/lib</code>和<code>/user/local/include</code>目录还是可以操作的，于是拷到这两个目录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;path&#x2F;to&#x2F;instantclient</span><br><span class="line">cp *.dylib &#x2F;usr&#x2F;local&#x2F;lib</span><br><span class="line">cp .&#x2F;sdk&#x2F;include&#x2F;*.h &#x2F;usr&#x2F;local&#x2F;include</span><br></pre></td></tr></table></figure>
<p>再将cx_Oracle卸载后重新编译安装：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 uninstall cx_Oracle</span><br><span class="line">sudo pip3 install cx_Oracle</span><br></pre></td></tr></table></figure>
<p>重启PyCharm后，问题解决。</p>
<h2 id="cx-Oracle的简单使用"><a href="#cx-Oracle的简单使用" class="headerlink" title="cx_Oracle的简单使用"></a>cx_Oracle的简单使用</h2><p>cx_Oracle的使用上没有什么问题，一切按套路来写就可以了。贴一个简单的示例：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import cx_Oracle</span><br><span class="line">conn &#x3D; cx_Oracle.connect(&#39;username&#39;, &#39;password&#39;,&#39;host:port&#x2F;sid&#39;)</span><br><span class="line">cursor &#x3D; conn.cursor()</span><br><span class="line">cursor.execute(&#39;select column from table&#39;)</span><br><span class="line">result &#x3D; cursor.fetchall()</span><br><span class="line">for row in result:</span><br><span class="line">    print(row)</span><br><span class="line">cursor.close()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
<p>更加详细的内容请参考官方文档：<br><a target="_blank" rel="noopener" href="https://cx-oracle.readthedocs.io/en/latest/">https://cx-oracle.readthedocs.io/en/latest/</a><br><a target="_blank" rel="noopener" href="https://oracle.github.io/python-cx_Oracle/">https://oracle.github.io/python-cx_Oracle/</a>  </p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="https://gist.github.com/thom-nic/6011715">https://gist.github.com/thom-nic/6011715</a><br><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/37711482/how-to-install-oracle-instant-client-on-a-mac">http://stackoverflow.com/questions/37711482/how-to-install-oracle-instant-client-on-a-mac</a>  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201704/flask-adminlte-handler/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201704/flask-adminlte-handler/" class="post-title-link" itemprop="url">flask-adminlte-handler</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-04-15 10:50:48" itemprop="dateCreated datePublished" datetime="2017-04-15T10:50:48+08:00">2017-04-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-26 09:44:33" itemprop="dateModified" datetime="2021-01-26T09:44:33+08:00">2021-01-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>继续接着上次的话题，上周整理出来的flask-rest脚手架，用于快速构建Restful API。虽然后端的代码量很少，但前端会变得很重，所以总体开发速度并不算太快，不太适合小型项目。<br>于是又整理了一套flask-adminlte脚手架，目标是用较传统的方式，减少整体的代码量，加快开发速度，以应对一些比较极端的需求。大体估算，开发时间可以做到SpringBoot全家桶的30%左右。  </p>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><p><a target="_blank" rel="noopener" href="http://git.si-tech.com.cn/guolei/flask-adminlte-handler">http://git.si-tech.com.cn/guolei/flask-adminlte-handler</a><br><a target="_blank" rel="noopener" href="https://github.com/xiiiblue/flask-adminlte-handler">https://github.com/xiiiblue/flask-rest-sample</a>  </p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>flask-adminlte-handler是一个Python环境下的WEB后台管理系统脚手架，目标是用极少量的代码，快速构建小型WEB应用。请勿在大中型项目中进行尝试。  </p>
<ol>
<li>使用较传统的重后端+轻前端的方式，降低总体代码量</li>
<li>Web框架使用Flask，默认Jinja模版</li>
<li>ORM框架使用Peewee</li>
<li>前端套用基于BootStrap的AdminLTE模板</li>
</ol>
<h2 id="系统截图"><a href="#系统截图" class="headerlink" title="系统截图"></a>系统截图</h2><ul>
<li><p>登录页<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/0ot1s.jpg"></p>
</li>
<li><p>主页<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/644d6.jpg"></p>
</li>
<li><p>编辑界面<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/fojv1.jpg">  </p>
</li>
<li><p>查询界面<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/vvelb.jpg"></p>
</li>
</ul>
<h2 id="第三方依赖"><a href="#第三方依赖" class="headerlink" title="第三方依赖"></a>第三方依赖</h2><ul>
<li>peewee</li>
<li>pymysql</li>
<li>flask</li>
<li>flask-script</li>
<li>flask-wtf</li>
<li>flask-login</li>
</ul>
<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><h3 id="venv虚拟环境安装配置"><a href="#venv虚拟环境安装配置" class="headerlink" title="venv虚拟环境安装配置"></a>venv虚拟环境安装配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install virtualenv</span><br><span class="line">virtualenv venv</span><br><span class="line">. venv&#x2F;bin&#x2F;activate</span><br></pre></td></tr></table></figure>
<h3 id="第三方依赖安装"><a href="#第三方依赖安装" class="headerlink" title="第三方依赖安装"></a>第三方依赖安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip3 install -r requirements.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="系统参数配置"><a href="#系统参数配置" class="headerlink" title="系统参数配置"></a>系统参数配置</h3><ol>
<li><p>编辑<code>config.py</code>， 修改SECRET_KEY及MySQL数据库相关参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SECRET_KEY &#x3D; os.environ.get(&#39;SECRET_KEY&#39;) or &#39;your-secret&#39;</span><br><span class="line">DB_HOST &#x3D; &#39;127.0.0.1&#39;</span><br><span class="line">DB_USER &#x3D; &#39;foobar&#39;</span><br><span class="line">DB_PASSWD &#x3D; &#39;foobar&#39;</span><br><span class="line">DB_DATABASE &#x3D; &#39;foobar&#39;</span><br></pre></td></tr></table></figure></li>
<li><p>编辑log-app.conf，修改日志路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">args&#x3D;(&#39;&#x2F;path&#x2F;to&#x2F;log&#x2F;flask-rest-sample.log&#39;,&#39;a&#39;,&#39;utf8&#39;)</span><br></pre></td></tr></table></figure>
<h3 id="数据库初始化"><a href="#数据库初始化" class="headerlink" title="数据库初始化"></a>数据库初始化</h3></li>
<li><p>自动建表<br>直接运行<code>python3 models.py</code></p>
</li>
<li><p>插入管理员用户（默认admin/admin)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO &#96;user&#96; (&#96;id&#96;, &#96;username&#96;, &#96;password&#96;, &#96;fullname&#96;, &#96;email&#96;, &#96;phone&#96;, &#96;status&#96;)</span><br><span class="line">VALUES</span><br><span class="line">	(1, &#39;admin&#39;, &#39;pbkdf2:sha1:1000$Km1vdx3W$9aa07d3b79ab88aae53e45d26d0d4d4e097a6cd3&#39;, &#39;管理员&#39;, &#39;admin@admin.com&#39;, &#39;18612341234&#39;, 1);</span><br></pre></td></tr></table></figure>
<h3 id="启动应用"><a href="#启动应用" class="headerlink" title="启动应用"></a>启动应用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nohup .&#x2F;manage.py runserver 2&gt;&amp;1 &amp;</span><br><span class="line">或</span><br><span class="line">.&#x2F;run_app_dev.py (仅限测试)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="项目目录结构"><a href="#项目目录结构" class="headerlink" title="项目目录结构"></a>项目目录结构</h2><p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/963uh.jpg">  </p>
<ul>
<li>/app/auth  用户认证相关代码</li>
<li>/app/main  主要功能点相关代码</li>
<li>/app/static  JS、CSS等静态文件</li>
<li>/app/template  页面模版</li>
<li>/app/models.py  Peewee模型</li>
<li>/app/utils.py  工具模块</li>
<li>/conf  系统参数及日志配置</li>
</ul>
<h2 id="相关学习文档"><a href="#相关学习文档" class="headerlink" title="相关学习文档"></a>相关学习文档</h2><ul>
<li><a target="_blank" rel="noopener" href="http://flask.pocoo.org/">http://flask.pocoo.org</a></li>
<li><a target="_blank" rel="noopener" href="https://flask-login.readthedocs.io/">https://flask-login.readthedocs.io</a></li>
<li><a target="_blank" rel="noopener" href="https://flask-script.readthedocs.io/">https://flask-script.readthedocs.io</a></li>
<li><a target="_blank" rel="noopener" href="https://flask-wtf.readthedocs.io/">https://flask-wtf.readthedocs.io</a></li>
<li><a target="_blank" rel="noopener" href="http://docs.peewee-orm.com/">http://docs.peewee-orm.com</a></li>
<li><a target="_blank" rel="noopener" href="https://almsaeedstudio.com/preview">https://almsaeedstudio.com/preview</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201704/flask-rest-sample/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201704/flask-rest-sample/" class="post-title-link" itemprop="url">使用Flask快速构建REST应用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-04-08 16:55:12" itemprop="dateCreated datePublished" datetime="2017-04-08T16:55:12+08:00">2017-04-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-11-06 15:45:51" itemprop="dateModified" datetime="2018-11-06T15:45:51+08:00">2018-11-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>最近在某个小型项目上进行了一些尝试，目标是用极快的速度构建一套简洁且优雅的小型WEB系统。当然这次尝试可以说是失败的，稍后会提到。  </p>
<p>架构上主要是前后端分离，后端使用Python实现RESTFul API，前端直接套用AdminLTE模版。  </p>
<p>得益于Python动态语言的特性，后端可以做到非常少量的代码实现增删改查等基本功能，大约是可以使用100多行代码写了25个REST服务吧，非常惊人。虽然比较简陋，但比起之前使用Spring Boot全家桶来开发REST，要快得太多。  </p>
<p>但比起后端，前端的代码量，初版写出来之后，是后端的几十倍，使用gulp构建，include等插件后，做到了一定简化，接下来还要做SPA化，引入vue.js、webpack等等，最终会变成 <strong>为了目的不择手段，为了手段而忘记目的</strong> 。一个很重要的前提是，要做一个 <strong>小型WEB系统</strong> ，整体成本要小。所以前后端分离虽然好处多多，但前端太重了，并不适合小型系统。  </p>
<p>最终还是使用了Flask+Jinja，传统的重后端、轻前端的方式来实现，将总体代码量控制到了极少。<br>但这次的REST API部分，不失为一次有益的尝试，单独拿出来做成脚手架，提供给有需要的人吧。  </p>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><p><a target="_blank" rel="noopener" href="http://git.si-tech.com.cn/guolei/flask-rest-sample">http://git.si-tech.com.cn/guolei/flask-rest-sample</a><br><a target="_blank" rel="noopener" href="https://github.com/xiiiblue/flask-rest-sample">https://github.com/xiiiblue/flask-rest-sample</a>  </p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>flask-rest-sample 是一个使用Python编写的REST API，可以对多个资源提供增删改查服务，用于快速构建REST应用。  </p>
<ol>
<li>Web框架使用Flask</li>
<li>ORM框架使用peewee</li>
<li>安全方面使用了flask-jwt插件进行JWT(Json Web Token)认证</li>
<li>由于flask-rest/flask-restplus侵略性较强，本次没有使用。</li>
<li>可以考虑自行使用flasgger添加SwaggerUI文档。</li>
</ol>
<h2 id="第三方依赖"><a href="#第三方依赖" class="headerlink" title="第三方依赖"></a>第三方依赖</h2><ul>
<li>peewee</li>
<li>pymysql</li>
<li>Flask</li>
<li>Flask-JWT</li>
<li>flask-script</li>
</ul>
<h2 id="主要代码示例"><a href="#主要代码示例" class="headerlink" title="主要代码示例"></a>主要代码示例</h2><ol>
<li><p>建模时尽量避免使用外键等约束条件，保证模型结构上一致，可以做到共用一个公共服务。</p>
</li>
<li><p>可使用<code>@rest.route</code>添加多个资源</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"># 基本API</span><br><span class="line">@rest.route(&#39;&#x2F;api&#x2F;reports&#39;, methods&#x3D;[&#39;GET&#39;, &#39;POST&#39;])</span><br><span class="line">@rest.route(&#39;&#x2F;api&#x2F;reports&#x2F;&lt;id&gt;&#39;, methods&#x3D;[&#39;GET&#39;, &#39;PUT&#39;, &#39;DELETE&#39;])</span><br><span class="line">@rest.route(&#39;&#x2F;api&#x2F;res2&#39;, methods&#x3D;[&#39;GET&#39;, &#39;POST&#39;])</span><br><span class="line">@rest.route(&#39;&#x2F;api&#x2F;res2&#x2F;&lt;id&gt;&#39;, methods&#x3D;[&#39;GET&#39;, &#39;PUT&#39;, &#39;DELETE&#39;])  #只要模型结构一致，可以添加多个资源</span><br><span class="line">@jwt_required()</span><br><span class="line">def common_rest_api(id&#x3D;None):</span><br><span class="line">    model_name &#x3D; request.path.split(&#39;&#x2F;&#39;)[2]  </span><br><span class="line">    pee_wee_model &#x3D; utils.get_model_by_name(model_name)  #从URL中确定模型</span><br><span class="line">    if not pee_wee_model:</span><br><span class="line">        return utils.jsonresp(status&#x3D;400, errinfo&#x3D;&#39;model_name不正确&#39;)</span><br><span class="line"></span><br><span class="line">    if id:</span><br><span class="line">        # 查询</span><br><span class="line">        if request.method &#x3D;&#x3D; &#39;GET&#39;:</span><br><span class="line">            try:</span><br><span class="line">                model &#x3D; pee_wee_model.get(pee_wee_model.id &#x3D;&#x3D; id)</span><br><span class="line">            except:</span><br><span class="line">                return utils.jsonresp(status&#x3D;404, errinfo&#x3D;&#39;查询不到资料&#39;)</span><br><span class="line">            return utils.jsonresp(jsonobj&#x3D;utils.obj_to_dict(model))</span><br><span class="line">        # 修改</span><br><span class="line">        elif request.method &#x3D;&#x3D; &#39;PUT&#39;:</span><br><span class="line">            json_dict &#x3D; request.get_json(silent&#x3D;True, force&#x3D;True)</span><br><span class="line">            if not json_dict: return utils.jsonresp(status&#x3D;400, errinfo&#x3D;&#39;参数格式不正确&#39;)</span><br><span class="line">            try:</span><br><span class="line">                model &#x3D; pee_wee_model.get(pee_wee_model.id &#x3D;&#x3D; id)</span><br><span class="line">            except:</span><br><span class="line">                return utils.jsonresp(status&#x3D;404, errinfo&#x3D;&#39;查询不到资料&#39;)</span><br><span class="line">            utils.dict_to_obj(dict&#x3D;json_dict, obj&#x3D;model, exclude&#x3D;(&#39;id&#39;,))  # 去掉ID字段</span><br><span class="line">            model.save()</span><br><span class="line">            return utils.jsonresp(status&#x3D;201)</span><br><span class="line">        # 删除</span><br><span class="line">        elif request.method &#x3D;&#x3D; &#39;DELETE&#39;:</span><br><span class="line">            try:</span><br><span class="line">                pee_wee_model.get(pee_wee_model.id &#x3D;&#x3D; id).delete_instance()</span><br><span class="line">            except:</span><br><span class="line">                return utils.jsonresp(status&#x3D;404, errinfo&#x3D;&#39;查询不到资料&#39;)</span><br><span class="line">            return utils.jsonresp(status&#x3D;204)</span><br><span class="line">        else:</span><br><span class="line">            return utils.jsonresp(status&#x3D;405, errinfo&#x3D;&#39;不支持的HTTP方法&#39;)</span><br><span class="line">    else:</span><br><span class="line">        # 全量查询（支持分页、排序、搜索）</span><br><span class="line">        if request.method &#x3D;&#x3D; &#39;GET&#39;:</span><br><span class="line">            # 处理查询参数</span><br><span class="line">            logger.debug(request.args)</span><br><span class="line">            try:</span><br><span class="line">                # 当前页码</span><br><span class="line">                page &#x3D; request.args.get(&#39;page&#39;, &#39;&#39;)</span><br><span class="line">                if page: page &#x3D; int(page) + 1</span><br><span class="line">                # 每页展示数量</span><br><span class="line">                length &#x3D; request.args.get(&#39;length&#39;, &#39;&#39;)</span><br><span class="line">                if length:</span><br><span class="line">                    length &#x3D; int(length)</span><br><span class="line">                else:</span><br><span class="line">                    length &#x3D; cfg.ITEMS_PER_PAGE</span><br><span class="line">                # 排序</span><br><span class="line">                sort &#x3D; request.args.get(&#39;sort&#39;, &#39;&#39;)</span><br><span class="line">                if sort:</span><br><span class="line">                    sort_column &#x3D; sort.split(&#39;,&#39;)[0]</span><br><span class="line">                    sort_direction &#x3D; sort.split(&#39;,&#39;)[1]</span><br><span class="line">            except:</span><br><span class="line">                return utils.jsonresp(status&#x3D;400, errinfo&#x3D;&#39;参数格式不正确&#39;)</span><br><span class="line"></span><br><span class="line">            # 查询</span><br><span class="line">            query &#x3D; pee_wee_model.select()</span><br><span class="line">            total_count &#x3D; query.count()</span><br><span class="line"></span><br><span class="line">            # 排序</span><br><span class="line">            if sort:</span><br><span class="line">                if sort_column in pee_wee_model._meta.fields:</span><br><span class="line">                    field &#x3D; getattr(pee_wee_model, sort_column)</span><br><span class="line">                    if sort_direction !&#x3D; &#39;asc&#39;:</span><br><span class="line">                        field &#x3D; field.desc()</span><br><span class="line">                    query &#x3D; query.order_by(field)</span><br><span class="line">            # 分页</span><br><span class="line">            if page:</span><br><span class="line">                query &#x3D; query.paginate(page, length)</span><br><span class="line"></span><br><span class="line">            dict &#x3D; &#123;&#39;content&#39;: utils.query_to_list(query), &#39;totalElements&#39;: total_count&#125;</span><br><span class="line">            return utils.jsonresp(jsonobj&#x3D;dict)</span><br><span class="line">        # 新增</span><br><span class="line">        elif request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line">            json_dict &#x3D; request.get_json(silent&#x3D;True, force&#x3D;True)</span><br><span class="line">            if not json_dict: return utils.jsonresp(status&#x3D;400, errinfo&#x3D;&#39;参数格式不正确&#39;)</span><br><span class="line">            user &#x3D; utils.dict_to_obj(dict&#x3D;json_dict, obj&#x3D;pee_wee_model(), exclude&#x3D;[&#39;id&#39;])  # 去掉ID字段</span><br><span class="line">            user.save()</span><br><span class="line">            return utils.jsonresp(status&#x3D;201)</span><br><span class="line">        else:</span><br><span class="line">            return utils.jsonresp(status&#x3D;405, errinfo&#x3D;&#39;不支持的HTTP方法&#39;)</span><br></pre></td></tr></table></figure>
<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><h3 id="venv虚拟环境安装配置"><a href="#venv虚拟环境安装配置" class="headerlink" title="venv虚拟环境安装配置"></a>venv虚拟环境安装配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install virtualenv</span><br><span class="line">virtualenv venv</span><br><span class="line">. venv&#x2F;bin&#x2F;activate</span><br></pre></td></tr></table></figure>
<h3 id="第三方依赖安装"><a href="#第三方依赖安装" class="headerlink" title="第三方依赖安装"></a>第三方依赖安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip3 install -r requirements.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="系统参数配置"><a href="#系统参数配置" class="headerlink" title="系统参数配置"></a>系统参数配置</h3></li>
<li><p>编辑<code>config.py</code>， 修改SECRET_KEY及MySQL数据库相关参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SECRET_KEY &#x3D; os.environ.get(&#39;SECRET_KEY&#39;) or &#39;your-secret&#39;</span><br><span class="line">DB_HOST &#x3D; &#39;127.0.0.1&#39;</span><br><span class="line">DB_USER &#x3D; &#39;foobar&#39;</span><br><span class="line">DB_PASSWD &#x3D; &#39;foobar&#39;</span><br><span class="line">DB_DATABASE &#x3D; &#39;foobar&#39;</span><br></pre></td></tr></table></figure></li>
<li><p>编辑log-app.conf，修改日志路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">args&#x3D;(&#39;&#x2F;path&#x2F;to&#x2F;log&#x2F;flask-rest-sample.log&#39;,&#39;a&#39;,&#39;utf8&#39;)</span><br></pre></td></tr></table></figure>
<h3 id="数据库初始化"><a href="#数据库初始化" class="headerlink" title="数据库初始化"></a>数据库初始化</h3></li>
<li><p>自动建表<br>直接运行<code>python3 models.py</code></p>
</li>
<li><p>插入管理员用户（默认admin/admin)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO &#96;user&#96; (&#96;id&#96;, &#96;username&#96;, &#96;password&#96;, &#96;fullname&#96;, &#96;email&#96;, &#96;phone&#96;, &#96;status&#96;)</span><br><span class="line">VALUES</span><br><span class="line">	(1, &#39;admin&#39;, &#39;pbkdf2:sha1:1000$Km1vdx3W$9aa07d3b79ab88aae53e45d26d0d4d4e097a6cd3&#39;, &#39;管理员&#39;, &#39;admin@admin.com&#39;, &#39;18612341234&#39;, 1);</span><br></pre></td></tr></table></figure>
<h3 id="启动应用"><a href="#启动应用" class="headerlink" title="启动应用"></a>启动应用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nohup .&#x2F;manage.py runserver 2&gt;&amp;1 &amp;</span><br><span class="line">或</span><br><span class="line">.&#x2F;run_app_dev.py (仅限测试)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="REST接口说明"><a href="#REST接口说明" class="headerlink" title="REST接口说明"></a>REST接口说明</h2><p>以reports资源为例：</p>
<ul>
<li>GET  /api/reports/<id>  查询<br>200 成功</li>
</ul>
<ul>
<li><p>PUT  /api/reports/<id>  修改<br>201 成功</p>
</li>
<li><p>DELETE  /api/reports/<id>  删除<br>204 成功</p>
</li>
<li><p>POST  /api/reports  新增<br>200 成功</p>
</li>
<li><p>GET  /api/reports  全量查询<br>200 成功</p>
<blockquote>
<p>支持分页（URL参数：page、length）及排序(URL参数：sort)<br>参数示例：<code>?page=1&amp;length=5&amp;sort=serial_number,desc</code>  </p>
</blockquote>
</li>
</ul>
<h2 id="JWT认证简单说明"><a href="#JWT认证简单说明" class="headerlink" title="JWT认证简单说明"></a>JWT认证简单说明</h2><ol>
<li>向/api/auth发起用户认证请求  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST http:&#x2F;&#x2F;127.0.0.1:5000&#x2F;api&#x2F;auth</span><br><span class="line">Content-Type: application&#x2F;json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;username&quot;: &quot;admin&quot;,</span><br><span class="line">    &quot;password&quot;: &quot;admin&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>获取响应，取得access_token<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;access_token&quot;: &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE0OTE2MzUyNTQsIm5iZiI6MTQ5MTYzNTI1NCwiaWRlbnRpdHkiOjEsImV4cCI6MTQ5MTYzNTU1NH0.wq-uer9LbRP5hEYGT4WfD5O4jf7k7du2Q1K6musKzvU&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>在接下来的HTTP请求头中，加入<code>Authorization</code>，值为<code>JWT+空格+access_token</code><br>以获取当前用户信息为例<br>请求：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET http:&#x2F;&#x2F;127.0.0.1:5000&#x2F;api&#x2F;identity</span><br><span class="line">Authorization: JWT eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE0OTE2MzUyNTQsIm5iZiI6MTQ5MTYzNTI1NCwiaWRlbnRpdHkiOjEsImV4cCI6MTQ5MTYzNTU1NH0.wq-uer9LbRP5hEYGT4WfD5O4jf7k7du2Q1K6musKzvU</span><br></pre></td></tr></table></figure>
响应：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;email&quot;: &quot;admin@admin.com&quot;,</span><br><span class="line">  &quot;fullname&quot;: &quot;管理员&quot;,</span><br><span class="line">  &quot;username&quot;: &quot;admin&quot;,</span><br><span class="line">  &quot;phone&quot;: &quot;18612341234&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201704/%E4%BD%BF%E7%94%A8Gradle%E6%9E%84%E5%BB%BA%E5%A4%9A%E6%A8%A1%E5%9D%97Java%E9%A1%B9%E7%9B%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201704/%E4%BD%BF%E7%94%A8Gradle%E6%9E%84%E5%BB%BA%E5%A4%9A%E6%A8%A1%E5%9D%97Java%E9%A1%B9%E7%9B%AE/" class="post-title-link" itemprop="url">使用Gradle构建Java项目</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-04-08 10:24:06" itemprop="dateCreated datePublished" datetime="2017-04-08T10:24:06+08:00">2017-04-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-11-06 15:45:41" itemprop="dateModified" datetime="2018-11-06T15:45:41+08:00">2018-11-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Gradle是一种类似Maven的项目构建工具，它没有使用繁琐的XML，而是使用Groovy语言进行配置。<br>作为后起之秀，Gradle继承了Maven的一些思想，并且 <strong>配置简洁</strong> ，有更强的 <strong>灵活性</strong> 。  </p>
<p>Android Studio从一定程度上也加快了Gradle的流行，目前有非常多的开源项目已经迁移到了Gradle。<br>但现阶段Gradle还不能完全替代Maven，从目前GitHub上的趋势看来，二者可能要并存一段时间了。  </p>
<p>从去年开始在一些中小型项目上尝试引入Gradle，仅做简单的项目构建，没有太过深入研究，整体使用下来的体验还是很愉快的。<br>本文主要是作一些科普，抛砖引玉，并贴出两个可以直接拿来使用的示例，帮助大家快速上手。  </p>
<h2 id="与Maven简单对比"><a href="#与Maven简单对比" class="headerlink" title="与Maven简单对比"></a>与Maven简单对比</h2><ol>
<li><p>简洁的配置。现在有很多人都对XML深恶痛绝，在Maven中，添加一个依赖需要编写以下5行配置：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.zaxxer&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;HikariCP&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.5.0&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>
<p>而在Gradle中，只需要一行：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &#39;com.zaxxer:HikariCP:2.5.0&#39;</span><br></pre></td></tr></table></figure>
<p>所以Gradle配置文件的整体长度大约是Maven的1/4到1/5左右，并且更加易读。</p>
</li>
<li><p>灵活性。例如要执行一条shell命令，只需要3行。当然客观来说，灵活往往是复杂的同义词：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">task dropDB(type: Exec) &#123;</span><br><span class="line"> commandLine ‘curl’,’-s’,’s’,’-x’,’DELETE’,&quot;http:&#x2F;&#x2F;$&#123;db.server&#125;:&#123;db.port&#125;&#x2F;db_name&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>约定优于配置。Gradle的Java Plugin，定义了与Maven完全一致的项目布局：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">src&#x2F;main&#x2F;java</span><br><span class="line">src&#x2F;main&#x2F;resources</span><br><span class="line">src&#x2F;test&#x2F;java</span><br><span class="line">src&#x2F;test&#x2F;resources</span><br></pre></td></tr></table></figure>
<p>更多的比较，可以参考 <a target="_blank" rel="noopener" href="https://gradle.org/maven-vs-gradle">https://gradle.org/maven-vs-gradle</a>  </p>
</li>
</ol>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ul>
<li>macOS下安装:  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install gradle</span><br></pre></td></tr></table></figure></li>
<li>Ubuntu下安装:  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install gradle</span><br></pre></td></tr></table></figure></li>
<li>Windows下安装:  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Step1: 在[https:&#x2F;&#x2F;gradle.org&#x2F;releases](https:&#x2F;&#x2F;gradle.org&#x2F;releases) 下载binary-only的zip包  </span><br><span class="line">Step2: 解压至某一目录，如C:&#x2F;bin&#x2F;gradle  </span><br><span class="line">Step3: 在系统属性-高级-环境变量中，新增GRADLE_HOME环境变量来指向安装路径，并在PATH环境变量的最后追加上GRADLE_HOME&#x2F;bin  </span><br></pre></td></tr></table></figure>
<h2 id="学习资源"><a href="#学习资源" class="headerlink" title="学习资源"></a>学习资源</h2>关于Gradle的学习，不再赘述，有大量的资源可供查阅  </li>
<li><a target="_blank" rel="noopener" href="https://gradle.org/">Gradle 官网</a>  </li>
<li><a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/userguide.html">Gradle User Guide</a>  </li>
<li><a target="_blank" rel="noopener" href="https://dongchuan.gitbooks.io/gradle-user-guide-/tutorials/">Gradle User Guide 中文版</a></li>
</ul>
<h2 id="单模块项目构建示例"><a href="#单模块项目构建示例" class="headerlink" title="单模块项目构建示例"></a>单模块项目构建示例</h2><p>下面是一个单模块Spring Boot项目的示例，适合快速搭建小型项目  </p>
<p><strong>/build.gradle</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        flatDir &#123;</span><br><span class="line">            dirs &#39;libs&#39;</span><br><span class="line">        &#125;</span><br><span class="line">        mavenLocal()</span><br><span class="line">        maven &#123; url &quot;http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:8081&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&quot; &#125;</span><br><span class="line">        &#x2F;&#x2F;  &#x2F;&#x2F; mavenCentral()  &#x2F;&#x2F;jcenter()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath(&quot;org.springframework.boot:spring-boot-gradle-plugin:1.4.0.RELEASE&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply plugin: &#39;java&#39;</span><br><span class="line">apply plugin: &quot;spring-boot&quot;</span><br><span class="line"></span><br><span class="line">jar &#123;</span><br><span class="line">    baseName &#x3D; &#39;project&#39;</span><br><span class="line">    version &#x3D; &#39;1.0-SNAPSHOT&#39;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sourceCompatibility &#x3D; 1.7</span><br><span class="line">targetCompatibility &#x3D; 1.7</span><br><span class="line"></span><br><span class="line">repositories &#123;</span><br><span class="line">    mavenCentral()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile &#39;org.springframework.boot:spring-boot-starter&#39;</span><br><span class="line">    compile &#39;org.apache.commons:commons-email:1.4&#39;</span><br><span class="line">    compile files(&#39;libs&#x2F;jxl-2.6.12.jar&#39;)</span><br><span class="line">    runtime &#39;mysql:mysql-connector-java:5.1.36&#39;</span><br><span class="line">    testCompile &#39;org.springframework.boot:spring-boot-starter-test&#39;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test &#123;</span><br><span class="line">    exclude &#39;com&#x2F;foo&#x2F;**&#39;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task listJars(description: &#39;Display all compile jars.&#39;) &lt;&lt; &#123;</span><br><span class="line">    configurations.compile.each &#123; File file -&gt; println file.name &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="多模块项目构建示例"><a href="#多模块项目构建示例" class="headerlink" title="多模块项目构建示例"></a>多模块项目构建示例</h2><p>下面是一个基于Spring Boot的多模块项目示例，可以裁剪后直接拿来做为脚手架使用，适合中型项目  </p>
<p><strong>/settings.gradle</strong>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">include &#39;common&#39;</span><br><span class="line">include &#39;repository&#39;</span><br><span class="line">include &#39;restapi&#39;</span><br></pre></td></tr></table></figure>
<p><strong>/build.gradle</strong>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenLocal()</span><br><span class="line">        maven &#123; url &quot;http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:8081&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&quot; &#125;</span><br><span class="line">        &#x2F;&#x2F;mavenCentral()</span><br><span class="line">        &#x2F;&#x2F;jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath(&quot;org.springframework.boot:spring-boot-gradle-plugin:1.4.0.RELEASE&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">allprojects &#123;</span><br><span class="line">    apply plugin: &#39;idea&#39;</span><br><span class="line">    apply plugin: &#39;eclipse&#39;</span><br><span class="line"></span><br><span class="line">    group &#x3D; &#39;com.foo.bar&#39;</span><br><span class="line">    version &#x3D; &#39;1.0-SNAPSHOT&#39;</span><br><span class="line">    &#x2F;&#x2F;archivesBaseName &#x3D; &#39;project&#39;</span><br><span class="line"></span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenLocal()</span><br><span class="line">        maven &#123; url &quot;http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:8081&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&quot; &#125;</span><br><span class="line">        &#x2F;&#x2F;mavenCentral()</span><br><span class="line">        &#x2F;&#x2F;jcenter()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">subprojects &#123;</span><br><span class="line">    apply plugin: &#39;java&#39;</span><br><span class="line">    apply plugin: &quot;spring-boot&quot;</span><br><span class="line"></span><br><span class="line">    sourceCompatibility &#x3D; 1.8</span><br><span class="line">    targetCompatibility &#x3D; 1.8</span><br><span class="line"></span><br><span class="line">    dependencies &#123;</span><br><span class="line">        compile &#39;org.springframework.boot:spring-boot-starter&#39;</span><br><span class="line">        compile &#39;org.springframework.boot:spring-boot-configuration-processor&#39;</span><br><span class="line">        compile &#39;org.springframework.boot:spring-boot-devtools&#39;</span><br><span class="line">        testCompile &#39;org.springframework.boot:spring-boot-starter-test&#39;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    test &#123;</span><br><span class="line">        exclude &#39;com&#x2F;foo&#x2F;bar&#x2F;**&#39;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    task listJars(description: &#39;Display all compile jars.&#39;) &lt;&lt; &#123;</span><br><span class="line">        configurations.compile.each &#123; File file -&gt; println file.name &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task wrapper(type: Wrapper) &#123;</span><br><span class="line">    gradleVersion &#x3D; &#39;3.1&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>/common/build.gradle</strong>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">bootRepackage.enabled &#x3D; false</span><br><span class="line">jar.baseName &#39;project-common&#39;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile project(&#39;:repository&#39;)</span><br><span class="line">    compile &#39;org.springframework.boot:spring-boot-starter-web&#39;</span><br><span class="line">    compile &#39;commons-lang:commons-lang:2.6&#39;</span><br><span class="line">    compile &#39;org.apache.httpcomponents:httpclient:4.5.2&#39;</span><br><span class="line">    compile &#39;org.modelmapper:modelmapper:0.7.5&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>/repository/build.gradle</strong>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">bootRepackage.enabled &#x3D; false</span><br><span class="line">jar.baseName &#39;project-repository&#39;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    &#x2F;&#x2F;spring boot</span><br><span class="line">    compile (&#39;org.springframework.boot:spring-boot-starter-data-jpa&#39;)</span><br><span class="line">    compile &#39;org.springframework.boot:spring-boot-starter-jdbc&#39;</span><br><span class="line">    &#x2F;&#x2F;jackson</span><br><span class="line">    compile &#39;com.fasterxml.jackson.core:jackson-annotations:2.8.1&#39;</span><br><span class="line">    &#x2F;&#x2F;hibernate validator</span><br><span class="line">    compile &#39;javax.validation:validation-api:1.1.0.Final&#39;</span><br><span class="line">    compile &#39;org.hibernate:hibernate-validator:5.2.4.Final&#39;</span><br><span class="line">    compile &#39;org.hibernate:hibernate-validator-cdi:5.2.4.Final&#39;</span><br><span class="line">    compile &#39;javax.el:javax.el-api:2.2.4&#39;</span><br><span class="line">    compile &#39;org.glassfish.web:javax.el:2.2.4&#39;</span><br><span class="line">    &#x2F;&#x2F;swagger</span><br><span class="line">    compile &#39;io.springfox:springfox-swagger2:2.6.0&#39;</span><br><span class="line">    compile &#39;io.springfox:springfox-swagger-ui:2.6.0&#39;</span><br><span class="line">    &#x2F;&#x2F;jdbc driver</span><br><span class="line">    runtime &#39;mysql:mysql-connector-java:5.1.36&#39;</span><br><span class="line">    runtime &#39;com.h2database:h2:1.4.192&#39;</span><br><span class="line">    &#x2F;&#x2F;test</span><br><span class="line">    testCompile &#39;org.springframework.security:spring-security-core:4.1.1.RELEASE&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>/restapi/build.gradle</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">jar.baseName &#39;project-rest-api&#39;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile project(&#39;:repository&#39;)</span><br><span class="line">    compile project(&#39;:common&#39;)</span><br><span class="line">    &#x2F;&#x2F;spring boot</span><br><span class="line">    compile &#39;org.springframework.boot:spring-boot-starter-thymeleaf&#39;</span><br><span class="line">    compile &#39;org.springframework.boot:spring-boot-starter-cache&#39;</span><br><span class="line">    compile &#39;org.springframework.boot:spring-boot-starter-security&#39;</span><br><span class="line">    compile &#39;org.springframework.boot:spring-boot-starter-actuator&#39;</span><br><span class="line">    &#x2F;&#x2F;oauth2</span><br><span class="line">    compile &#39;org.springframework.security.oauth:spring-security-oauth2:2.0.11.RELEASE&#39;</span><br><span class="line">    &#x2F;&#x2F;cache</span><br><span class="line">    compile &#39;net.sf.ehcache:ehcache:2.10.2.2.21&#39;</span><br><span class="line">    &#x2F;&#x2F;pool</span><br><span class="line">    compile &#39;com.alibaba:druid:1.0.23&#39;</span><br><span class="line">    compile &#39;com.zaxxer:HikariCP:2.5.0&#39;</span><br><span class="line">    &#x2F;&#x2F;swagger-staticdocs</span><br><span class="line">    testCompile &#39;io.springfox:springfox-staticdocs:2.6.0&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201704/soapui%E5%9C%A8mac%E4%B8%8B%E5%90%AF%E5%8A%A8%E5%8D%A1%E6%AD%BB%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201704/soapui%E5%9C%A8mac%E4%B8%8B%E5%90%AF%E5%8A%A8%E5%8D%A1%E6%AD%BB%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">SoapUI在macOS下启动卡死问题处理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-04-08 08:47:13" itemprop="dateCreated datePublished" datetime="2017-04-08T08:47:13+08:00">2017-04-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-11-06 15:45:43" itemprop="dateModified" datetime="2018-11-06T15:45:43+08:00">2018-11-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h2><p>macOS版SoapUI启动后，窗口卡死，只能Cmd-Option-Esc强制退出。</p>
<blockquote>
<p>系统版本: macOS Sierra 10.12.4<br>SoapUI版本: 5.3.0/5.2.1</p>
</blockquote>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><ol>
<li><p>修改vmoptions.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;Applications&#x2F;SoapUI-5.3.0.app&#x2F;Contents&#x2F;vmoptions.txt</span><br></pre></td></tr></table></figure>
<p>最后下新增一行<code>-Dsoapui.browser.disabled=true</code></p>
</li>
<li><p>修改soapui.sh</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;Applications&#x2F;SoapUI-5.3.0.app&#x2F;Contents&#x2F;java&#x2F;app&#x2F;bin&#x2F;soapui.sh</span><br></pre></td></tr></table></figure>
<p>将<code>JAVA_OPTS=&quot;$JAVA_OPTS -Dsoapui.browser.disabled=true&quot;</code>一行的注释去掉。  </p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/201704/%E4%BD%BF%E7%94%A8Java%E7%BC%96%E5%86%99%E7%AE%80%E5%8D%95Socket%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%92%8C%E6%9C%8D%E5%8A%A1%E7%AB%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201704/%E4%BD%BF%E7%94%A8Java%E7%BC%96%E5%86%99%E7%AE%80%E5%8D%95Socket%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%92%8C%E6%9C%8D%E5%8A%A1%E7%AB%AF/" class="post-title-link" itemprop="url">使用Java编写简单Socket客户端和服务端</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-04-08 08:46:29" itemprop="dateCreated datePublished" datetime="2017-04-08T08:46:29+08:00">2017-04-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2018-11-06 15:45:39" itemprop="dateModified" datetime="2018-11-06T15:45:39+08:00">2018-11-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>某同事要用Socket连接外围系统，帮忙写了个简单的Demo。<br>包含一个客户端和一个服务端的，仅是示例，比较简陋，服务端也没有用多线程。<br>直接贴代码了。  </p>
<h2 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">import java.io.*;</span><br><span class="line">import java.net.*;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Socket服务端示例</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class SocketServer &#123;</span><br><span class="line">    ServerSocket serverSocket;</span><br><span class="line">    Socket connection &#x3D; null;</span><br><span class="line">    ObjectOutputStream out;</span><br><span class="line">    ObjectInputStream in;</span><br><span class="line">    String message;</span><br><span class="line"></span><br><span class="line">    void runServer() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            &#x2F;&#x2F; 创建服务端监听</span><br><span class="line">            serverSocket &#x3D; new ServerSocket(31313, 10);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 等待客户端连接</span><br><span class="line">            System.out.println(&quot;等待客户端连接...&quot;);</span><br><span class="line">            connection &#x3D; serverSocket.accept();</span><br><span class="line">            System.out.println(&quot;收到客户端连接： &quot; + connection.getInetAddress().getHostName());</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 获取输入输出流</span><br><span class="line">            out &#x3D; new ObjectOutputStream(connection.getOutputStream());</span><br><span class="line">            out.flush();</span><br><span class="line">            in &#x3D; new ObjectInputStream(connection.getInputStream());</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 连接成功后，首先向客户端发成功消息</span><br><span class="line">            sendMsg(&quot;连接成功&quot;);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 发送接收消息</span><br><span class="line">            do &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    message &#x3D; (String) in.readObject();</span><br><span class="line">                    System.out.println(&quot;client&gt;&quot; + message);</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F; 发送退出消息</span><br><span class="line">                    if (message.equals(&quot;bye&quot;)) &#123;</span><br><span class="line">                        sendMsg(&quot;bye&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (ClassNotFoundException ex) &#123;</span><br><span class="line">                    ex.printStackTrace();</span><br><span class="line">                    System.err.println(&quot;数据格式无效&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; while (!message.equals(&quot;bye&quot;));  &#x2F;&#x2F;当对方消息为bye时退出循环</span><br><span class="line">        &#125; catch (IOException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            &#x2F;&#x2F; 关闭Socket连接</span><br><span class="line">            try &#123;</span><br><span class="line">                in.close();</span><br><span class="line">                out.close();</span><br><span class="line">                serverSocket.close();</span><br><span class="line">            &#125; catch (IOException ioException) &#123;</span><br><span class="line">                ioException.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void sendMsg(String msg) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            out.writeObject(msg);</span><br><span class="line">            out.flush();</span><br><span class="line">            System.out.println(&quot;server&gt;&quot; + msg);</span><br><span class="line">        &#125; catch (IOException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String args[]) &#123;</span><br><span class="line">        SocketServer server &#x3D; new SocketServer();</span><br><span class="line">        while (true) &#123;</span><br><span class="line">            server.runServer();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">import java.io.*;</span><br><span class="line">import java.net.*;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Socket客户端示例</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class SocketClient &#123;</span><br><span class="line">    Socket clientSocket;</span><br><span class="line">    ObjectOutputStream out;</span><br><span class="line">    ObjectInputStream in;</span><br><span class="line">    String message;</span><br><span class="line"></span><br><span class="line">    void runClient() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            &#x2F;&#x2F; 连接到服务端</span><br><span class="line">            clientSocket &#x3D; new Socket(&quot;localhost&quot;, 31313);</span><br><span class="line">            System.out.println(&quot;已连接到服务端&quot;);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 获取输入输出流</span><br><span class="line">            out &#x3D; new ObjectOutputStream(clientSocket.getOutputStream());</span><br><span class="line">            out.flush();</span><br><span class="line">            in &#x3D; new ObjectInputStream(clientSocket.getInputStream());</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F; 发送接收消息</span><br><span class="line">            do &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    &#x2F;&#x2F; 接收消息</span><br><span class="line">                    message &#x3D; (String) in.readObject();</span><br><span class="line">                    System.out.println(&quot;server&gt;&quot; + message);</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F; 发送消息</span><br><span class="line">                    sendMsg(&quot;hello&quot;);</span><br><span class="line">                    sendMsg(&quot;hello again&quot;);</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F; 发送退出消息</span><br><span class="line">                    message &#x3D; &quot;bye&quot;;</span><br><span class="line">                    sendMsg(message);</span><br><span class="line">                &#125; catch (ClassNotFoundException ex) &#123;</span><br><span class="line">                    ex.printStackTrace();</span><br><span class="line">                    System.err.println(&quot;数据格式无效&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; while (!message.equals(&quot;bye&quot;)); &#x2F;&#x2F;当对方消息为bye时退出循环</span><br><span class="line">        &#125; catch (UnknownHostException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">            System.err.println(&quot;无法连接到服务端&quot;);</span><br><span class="line">        &#125; catch (IOException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            &#x2F;&#x2F; 关闭Socket连接</span><br><span class="line">            try &#123;</span><br><span class="line">                in.close();</span><br><span class="line">                out.close();</span><br><span class="line">                clientSocket.close();</span><br><span class="line">            &#125; catch (IOException ex) &#123;</span><br><span class="line">                ex.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void sendMsg(String msg) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            out.writeObject(msg);</span><br><span class="line">            out.flush();</span><br><span class="line">            System.out.println(&quot;client&gt;&quot; + msg);</span><br><span class="line">        &#125; catch (IOException ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String args[]) &#123;</span><br><span class="line">        SocketClient client &#x3D; new SocketClient();</span><br><span class="line">        client.runClient();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/18/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><span class="page-number current">19</span><a class="page-number" href="/page/20/">20</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/20/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">BlueXIII</p>
  <div class="site-description" itemprop="description">IT技术类文章、笔记分享</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">223</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/xiiiblue" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;xiiiblue" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/bluexiii" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;bluexiii" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备18050487号-1 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BlueXIII</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
