<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.bluexiii.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="IT技术类文章、笔记分享">
<meta property="og:type" content="website">
<meta property="og:title" content="BlueXIII&#39;s Blog">
<meta property="og:url" content="http://www.bluexiii.com/page/2/index.html">
<meta property="og:site_name" content="BlueXIII&#39;s Blog">
<meta property="og:description" content="IT技术类文章、笔记分享">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="BlueXIII">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://www.bluexiii.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>BlueXIII's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">BlueXIII's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">热爱技术,持续学习</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202309/EMQX%E5%88%9D%E6%8E%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202309/EMQX%E5%88%9D%E6%8E%A2/" class="post-title-link" itemprop="url">EMQX初探</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-09-12 09:23:36" itemprop="dateCreated datePublished" datetime="2023-09-12T09:23:36+08:00">2023-09-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-06-27 11:23:55" itemprop="dateModified" datetime="2024-06-27T11:23:55+08:00">2024-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.emqx.io/downloads">https://www.emqx.io/downloads</a></li>
<li><a target="_blank" rel="noopener" href="https://www.emqx.io/docs/en/v5.1/getting-started/getting-started.html#start-emqx">https://www.emqx.io/docs/en/v5.1/getting-started/getting-started.html#start-emqx</a></li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.emqx.io/docs/en/v5.1/messaging/mqtt-concepts.html#publish-subscribe-pattern">https://www.emqx.io/docs/en/v5.1/messaging/mqtt-concepts.html#publish-subscribe-pattern</a>   MQTT 核心概念</li>
<li><a target="_blank" rel="noopener" href="https://www.emqx.com/en/blog/advanced-features-of-mqtt-topics">https://www.emqx.com/en/blog/advanced-features-of-mqtt-topics</a> MQTT 主题和通配符</li>
</ul>
<h2 id="emqx安装"><a href="#emqx安装" class="headerlink" title="emqx安装"></a>emqx安装</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Docker安装</span></span><br><span class="line">docker pull emqx/emqx:5.2.0</span><br><span class="line">docker run -d --name emqx -p 1883:1883 -p 8083:8083 -p 8084:8084 -p 8883:8883 -p 18083:18083 emqx/emqx:5.2.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ubuntu</span></span><br><span class="line">curl -s https://assets.emqx.com/scripts/install-emqx-deb.sh | sudo bash</span><br><span class="line">sudo apt-get install emqx</span><br><span class="line">sudo systemctl start emqx</span><br><span class="line"></span><br><span class="line"><span class="comment"># UI</span></span><br><span class="line">http://localhost:18083/</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="mqttx客户端"><a href="#mqttx客户端" class="headerlink" title="mqttx客户端"></a>mqttx客户端</h2><h3 id="GUI"><a href="#GUI" class="headerlink" title="GUI"></a>GUI</h3><p><a target="_blank" rel="noopener" href="https://mqttx.app/">https://mqttx.app/</a></p>
<h3 id="CLI"><a href="#CLI" class="headerlink" title="CLI"></a>CLI</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CLI安装</span></span><br><span class="line">brew install emqx/mqttx/mqttx-cli</span><br><span class="line"><span class="comment"># 订阅</span></span><br><span class="line">mqttx sub -t <span class="string">&#x27;testtopic/#&#x27;</span> -q 1 -h <span class="string">&#x27;localhost&#x27;</span> -p 1883 <span class="string">&#x27;public&#x27;</span> -v</span><br><span class="line"><span class="comment"># 发布</span></span><br><span class="line">mqttx pub -t <span class="string">&#x27;testtopic/1&#x27;</span> -q 1 -h <span class="string">&#x27;localhost&#x27;</span> -p 1883 -m <span class="string">&#x27;from MQTTX CLI&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="QOS"><a href="#QOS" class="headerlink" title="QOS"></a>QOS</h2><ul>
<li>QoS 0：最多传递一次消息，可能会丢失；</li>
<li>QoS 1：至少传递一次消息并保证到达，但可能会重复；</li>
<li>QoS 2：仅传递一次消息并保证无重复到达。</li>
</ul>
<h2 id="Make"><a href="#Make" class="headerlink" title="Make"></a>Make</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/emqx/emqx.git</span><br><span class="line"><span class="built_in">cd</span> emqx</span><br><span class="line">make</span><br><span class="line">_build/emqx/rel/emqx/bin/emqx console</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202309/%E7%89%A9%E8%81%94%E7%BD%91%E5%B9%B3%E5%8F%B0%E9%80%89%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202309/%E7%89%A9%E8%81%94%E7%BD%91%E5%B9%B3%E5%8F%B0%E9%80%89%E5%9E%8B/" class="post-title-link" itemprop="url">物联网平台选型</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-09-11 16:40:05" itemprop="dateCreated datePublished" datetime="2023-09-11T16:40:05+08:00">2023-09-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-06-27 11:23:57" itemprop="dateModified" datetime="2024-06-27T11:23:57+08:00">2024-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="MQTT中间件"><a href="#MQTT中间件" class="headerlink" title="MQTT中间件"></a>MQTT中间件</h2><ul>
<li>emqx  Erlang <a target="_blank" rel="noopener" href="https://github.com/emqx/emqx">https://github.com/emqx/emqx</a></li>
<li>mosquitto C <a target="_blank" rel="noopener" href="https://github.com/eclipse/mosquitto">https://github.com/eclipse/mosquitto</a></li>
<li>gmqtt Golang <a target="_blank" rel="noopener" href="https://github.com/DrmagicE/gmqtt">https://github.com/DrmagicE/gmqtt</a></li>
<li>pulsar Java <a target="_blank" rel="noopener" href="https://github.com/apache/pulsar">https://github.com/apache/pulsar</a></li>
</ul>
<h3 id="开源平台"><a href="#开源平台" class="headerlink" title="开源平台"></a>开源平台</h3><ul>
<li>jetlinks Java  <a target="_blank" rel="noopener" href="https://github.com/jetlinks/jetlinks-community">https://github.com/jetlinks/jetlinks-community</a></li>
<li>thingsboard Java  <a target="_blank" rel="noopener" href="https://github.com/thingsboard/thingsboard">https://github.com/thingsboard/thingsboard</a></li>
<li>ThingsPanel  Go <a target="_blank" rel="noopener" href="https://github.com/ThingsPanel/">https://github.com/ThingsPanel/</a></li>
</ul>
<h2 id="云平台"><a href="#云平台" class="headerlink" title="云平台"></a>云平台</h2><ul>
<li>涂鸦      <a target="_blank" rel="noopener" href="https://www.tuya.com/cn/">https://www.tuya.com/cn/</a></li>
<li>阿里云IoT   <a target="_blank" rel="noopener" href="https://iot.aliyun.com/">https://iot.aliyun.com/</a></li>
<li>thingscloud    <a target="_blank" rel="noopener" href="https://www.thingscloud.xyz/">https://www.thingscloud.xyz/</a></li>
</ul>
<h2 id="其它商业化平台"><a href="#其它商业化平台" class="headerlink" title="其它商业化平台"></a>其它商业化平台</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">资方背景 平台分类 本部城市</span><br><span class="line">华为智慧家庭 Openlife 泛 ICT 系 系统平台｜软硬件全连接平台 深圳</span><br><span class="line">谷歌 Brillo 泛 ICT 系 系统平台 美国</span><br><span class="line">高通 AllJoyn 泛 ICT 系 系统平台｜软硬件平台 美国</span><br><span class="line">ARM 基金会 mbed 泛 ICT 系 系统平台｜软硬件平台 英国</span><br><span class="line">微软 Windows 10 for IoT 泛 ICT 系 系统平台 美国</span><br><span class="line">三星 SmartThings 泛 ICT 系 软硬件平台 美国</span><br><span class="line">苹果 Home 泛 ICT 系 系统平台 美国</span><br><span class="line"></span><br><span class="line">科大讯飞 AIUI 方案商系 语音交互软硬件平台 合肥</span><br><span class="line">云知声 hivoice 方案商系 语音交互软硬件平台 北京</span><br><span class="line">思必驰 AIOS 方案商系 语音交互软硬件平台 苏州</span><br><span class="line">庆科 MiCO 方案商系 系统平台｜连接软硬件平台 上海</span><br><span class="line">和而泰 C-Life 方案商系 连接软硬件平台 深圳</span><br><span class="line">硬蛋 Link 方案商系 硬件模块供应链平台 深圳</span><br><span class="line">博联 DNA system 方案商系 连接软硬件平台 杭州</span><br><span class="line">涂鸦 Tuya 方案商系 连接软硬件平台 杭州</span><br><span class="line">酷宅科技 coolkit 方案商系 连接软硬件平台 深圳</span><br><span class="line">氦氪 Hekr 方案商系 连接软硬件平台 杭州</span><br><span class="line">乐鑫 IOT 方案商系 连接软硬件平台 上海</span><br><span class="line">爱悠 everyoo 方案商系 连接软硬件平台 青岛</span><br><span class="line">亿联客 yeelink 方案商系 连接软硬件平台 青岛</span><br><span class="line"></span><br><span class="line">机智云 云计算系 云计算｜连接软硬件平台 广州</span><br><span class="line">云智易 云计算系 云计算｜连接软硬件平台 广州</span><br><span class="line">深智云 DT Kit 云计算系 云计算｜连接软硬件平台 深圳</span><br><span class="line">智云奇点 AbleCloud 云计算系 云计算｜连接软硬件平台 北京</span><br><span class="line">方研矩行科技青莲云 云计算系 云计算｜连接软硬件不详 北京</span><br><span class="line">乐为物联 LEWEI50 云计算系 云计算｜连接软硬件不详 北京</span><br><span class="line">艾拉物联 AylaAgile IoT 云计算系 云计算｜连接软硬件平台 美国</span><br><span class="line"></span><br><span class="line">京东智能云 JD Smart 互联网系 云计算｜连接软硬件平台 北京</span><br><span class="line">阿里智能云 Smart Living 互联网系 云计算｜连接软硬件平台 杭州</span><br><span class="line">腾讯 QQ 物联 互联网系 云计算｜连接软硬件平台 深圳</span><br><span class="line">腾讯智能开放平台 互联网系 云计算｜连接软硬件平台 深圳</span><br><span class="line">百度天工智能物联平台 互联网系 云计算｜连接软硬件平台 北京</span><br><span class="line">小米开放平台 互联网系 云计算｜连接软硬件平台 北京</span><br><span class="line">360 智能云开发者平台 互联网系 云计算｜连接软硬件平台 北京</span><br><span class="line"></span><br><span class="line">大华乐橙 LeChange 设备商系 连接软硬件平台 杭州</span><br><span class="line">海尔 U+ 设备商系 连接软硬件平台 青岛</span><br><span class="line">美的 M-Smart 设备商系 连接软硬件平台 佛山</span><br><span class="line">博西 Home Connect 设备商系 连接软硬件平台 德国</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202308/Prometheus%E6%94%B9%E9%80%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202308/Prometheus%E6%94%B9%E9%80%A0/" class="post-title-link" itemprop="url">Prometheus改造</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-08-17 10:45:54" itemprop="dateCreated datePublished" datetime="2023-08-17T10:45:54+08:00">2023-08-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-06-27 11:23:16" itemprop="dateModified" datetime="2024-06-27T11:23:16+08:00">2024-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/prometheus-community/helm-charts">https://github.com/prometheus-community/helm-charts</a></li>
<li><a target="_blank" rel="noopener" href="https://artifacthub.io/packages/helm/prometheus-community/prometheus">https://artifacthub.io/packages/helm/prometheus-community/prometheus</a></li>
</ul>
<h2 id="helm方式安装"><a href="#helm方式安装" class="headerlink" title="helm方式安装"></a>helm方式安装</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">helm repo add prometheus-community https://prometheus-community.github.io/helm-charts</span><br><span class="line">helm repo update</span><br><span class="line">helm install prometheus prometheus-community/prometheus  --namespace prometheus --create-namespace</span><br><span class="line"></span><br><span class="line"><span class="comment"># UI</span></span><br><span class="line">http://prometheus-server.prometheus:80  <span class="comment"># DNS</span></span><br><span class="line">http://10.193.36.41:30022   <span class="comment"># NodePort</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">prometheus-prometheus-node-exporter.prometheus</span><br><span class="line">node-exporter.kubesphere-monitoring-system</span><br><span class="line">prometheus-k8s.kubesphere-monitoring-system</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开prometheus</span></span><br><span class="line">kubectl port-forward --namespace kubesphere-monitoring-system service/prometheus-k8s 9090:9090</span><br><span class="line">open http://localhost:9090</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="pom-xml配置"><a href="#pom-xml配置" class="headerlink" title="pom.xml配置"></a>pom.xml配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.micrometer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>micrometer-registry-prometheus<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Nacos配置"><a href="#Nacos配置" class="headerlink" title="Nacos配置"></a>Nacos配置</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;health,prometheus&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="临时测试"><a href="#临时测试" class="headerlink" title="临时测试"></a>临时测试</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 本机测试</span></span><br><span class="line"><span class="built_in">cd</span> /Users/bluexiii/Documents/code/devops/dubhe-app/dubhe-metadata/dubhe-metadata-biz/target</span><br><span class="line"><span class="built_in">export</span> NACOS_HOST=10.193.36.41</span><br><span class="line"><span class="built_in">export</span> NACOS_PORT=30101</span><br><span class="line"><span class="built_in">export</span> NACOS_USERNAME=nacos</span><br><span class="line"><span class="built_in">export</span> NACOS_PASSWORD=nacos</span><br><span class="line">java -jar dubhe-metadata-biz.jar</span><br><span class="line">open http://localhost:8600/actuator/prometheus</span><br><span class="line"></span><br><span class="line"><span class="comment"># K8S测试 dubhe-metadata.dubhe-dev</span></span><br><span class="line">kubectl port-forward --namespace dubhe-dev service/dubhe-metadata 8600:8600</span><br><span class="line">open http://localhost:8600/actuator/prometheus</span><br></pre></td></tr></table></figure>
<h2 id="prometheus配置"><a href="#prometheus配置" class="headerlink" title="prometheus配置"></a>prometheus配置</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- job_name: <span class="string">&quot;应用详细指标&quot;</span></span><br><span class="line">  metrics_path: <span class="string">&quot;/actuator/prometheus&quot;</span></span><br><span class="line">  static_configs:</span><br><span class="line">    - targets:</span><br><span class="line">        [</span><br><span class="line">          <span class="string">&quot;dubhe-metadata.dubhe-dev:8600&quot;</span>,</span><br><span class="line">          <span class="string">&quot;dubhe-quality.dubhe-dev:8604&quot;</span></span><br><span class="line">        ]</span><br><span class="line">      labels:</span><br><span class="line">        application: <span class="string">&quot;开发环境&quot;</span></span><br></pre></td></tr></table></figure>


<h2 id="Grafana-配置"><a href="#Grafana-配置" class="headerlink" title="Grafana 配置"></a>Grafana 配置</h2><p>复用Loki的Grafana:<br><a target="_blank" rel="noopener" href="http://10.193.36.41:30016/">http://10.193.36.41:30016</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202308/SkyWalking%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202308/SkyWalking%E9%83%A8%E7%BD%B2/" class="post-title-link" itemprop="url">SkyWalking部署</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-08-11 14:56:05" itemprop="dateCreated datePublished" datetime="2023-08-11T14:56:05+08:00">2023-08-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-06-27 11:23:11" itemprop="dateModified" datetime="2024-06-27T11:23:11+08:00">2024-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://skywalking.apache.org/">https://skywalking.apache.org/</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/apache/skywalking-kubernetes">https://github.com/apache/skywalking-kubernetes</a></li>
<li><a target="_blank" rel="noopener" href="https://skyapm.github.io/document-cn-translation-of-skywalking/zh/8.0.0/setup/">https://skyapm.github.io/document-cn-translation-of-skywalking/zh/8.0.0/setup/</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000042094994">https://segmentfault.com/a/1190000042094994</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/2be063bd9e67">https://www.jianshu.com/p/2be063bd9e67</a></li>
<li><a target="_blank" rel="noopener" href="https://skywalking.apache.org/docs/skywalking-java/next/en/setup/service-agent/java-agent/application-toolkit-logback-1.x/">https://skywalking.apache.org/docs/skywalking-java/next/en/setup/service-agent/java-agent/application-toolkit-logback-1.x/</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/596247594">https://zhuanlan.zhihu.com/p/596247594</a></li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入环境变量</span></span><br><span class="line"><span class="built_in">export</span> SKYWALKING_RELEASE_VERSION=4.5.0</span><br><span class="line"><span class="built_in">export</span> SKYWALKING_RELEASE_NAME=skywalking</span><br><span class="line"><span class="built_in">export</span> SKYWALKING_RELEASE_NAMESPACE=skywalking</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">helm install <span class="string">&quot;<span class="variable">$&#123;SKYWALKING_RELEASE_NAME&#125;</span>&quot;</span> \</span><br><span class="line">  oci://registry-1.docker.io/apache/skywalking-helm \</span><br><span class="line">  --version <span class="string">&quot;<span class="variable">$&#123;SKYWALKING_RELEASE_VERSION&#125;</span>&quot;</span> \</span><br><span class="line">  -n <span class="string">&quot;<span class="variable">$&#123;SKYWALKING_RELEASE_NAMESPACE&#125;</span>&quot;</span> \</span><br><span class="line">  --<span class="built_in">set</span> oap.image.tag=9.2.0 \</span><br><span class="line">  --<span class="built_in">set</span> oap.storageType=elasticsearch \</span><br><span class="line">  --<span class="built_in">set</span> ui.image.tag=9.2.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># UI NodePort</span></span><br><span class="line">http://10.193.36.41:30017</span><br><span class="line"></span><br><span class="line"><span class="comment"># OAP</span></span><br><span class="line">skywalking-skywalking-helm-oap.skywalking:11800</span><br><span class="line">10.193.36.41:30018</span><br></pre></td></tr></table></figure>
<h2 id="应用改造"><a href="#应用改造" class="headerlink" title="应用改造"></a>应用改造</h2><h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">FROM harbor.dubhe:30002/dubhe-base/amazoncorretto:8u372</span><br><span class="line"></span><br><span class="line">MAINTAINER dubhe</span><br><span class="line"></span><br><span class="line">ENV TZ=Asia/Shanghai</span><br><span class="line"></span><br><span class="line">RUN ln -sf /usr/share/zoneinfo/<span class="variable">$TZ</span> /etc/localtime &amp;&amp; \</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$TZ</span> &gt; /etc/timezone &amp;&amp; \</span><br><span class="line">    mkdir -p /app</span><br><span class="line"></span><br><span class="line">WORKDIR /app</span><br><span class="line"></span><br><span class="line">EXPOSE 8600</span><br><span class="line"></span><br><span class="line">ADD ./dubhe-metadata/dubhe-metadata-biz/target/dubhe-metadata-biz.jar ./</span><br><span class="line"></span><br><span class="line">ADD ./deploy/apache-skywalking-java-agent-8.16.0.tgz /</span><br><span class="line"></span><br><span class="line">CMD java -Xms2048m -Xmx2048m -javaagent:/skywalking-agent/skywalking-agent.jar -jar dubhe-metadata-biz.jar</span><br></pre></td></tr></table></figure>
<h3 id="HelmChart"><a href="#HelmChart" class="headerlink" title="HelmChart"></a>HelmChart</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SW_AGENT_NAME</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">dubhe-metadata</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SW_AGENT_COLLECTOR_BACKEND_SERVICES</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">skywalking-skywalking-helm-oap.skywalking:11800</span></span><br></pre></td></tr></table></figure>
<h3 id="忽略部分路径"><a href="#忽略部分路径" class="headerlink" title="忽略部分路径"></a>忽略部分路径</h3><ol>
<li>拷贝skywalking-agent/optional-plugins目录中的apm-trace-ignore-plugin-8.13.0.jar到pulgins</li>
<li>在config目录中新建apm-trace-ignore-plugin.config文件存放忽略端点配置</li>
</ol>
<p>apm-trace-ignore-plugin.config:  </p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">trace.ignore_path</span>=<span class="variable">$&#123;SW_AGENT_TRACE_IGNORE_PATH:GET:/actuator,GET:/actuator/**,/actuator/**,/eureka/**,Druid/**,Mysql/**,Lettuce/**,Gson/**&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="日志改造"><a href="#日志改造" class="headerlink" title="日志改造"></a>日志改造</h2><h3 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.logstash.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logstash-logback-encoder<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>7.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.skywalking<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>apm-toolkit-trace<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>8.16.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.skywalking<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>apm-toolkit-logback-1.x<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>8.16.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="logback-springboot-xml"><a href="#logback-springboot-xml" class="headerlink" title="logback-springboot.xml"></a>logback-springboot.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- SkyWalking转换器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">conversionRule</span> <span class="attr">conversionWord</span>=<span class="string">&quot;tid&quot;</span> <span class="attr">converterClass</span>=<span class="string">&quot;org.apache.skywalking.apm.toolkit.log.logback.v1.x.LogbackPatternConverter&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">conversionRule</span> <span class="attr">conversionWord</span>=<span class="string">&quot;sw_ctx&quot;</span> <span class="attr">converterClass</span>=<span class="string">&quot;org.apache.skywalking.apm.toolkit.log.logback.v1.x.LogbackSkyWalkingContextPatternConverter&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- SkyWalkingGRPC输出 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;grpc-log&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.skywalking.apm.toolkit.log.logback.v1.x.log.GRPCLogClientAppender&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.encoder.LayoutWrappingEncoder&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.skywalking.apm.toolkit.log.logback.v1.x.mdc.TraceIdMDCPatternLogbackLayout&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">Pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%tid] [%thread] %-5level %logger&#123;36&#125; -%msg%n<span class="tag">&lt;/<span class="name">Pattern</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- STDOUT输出 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;console&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">providers</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">timestamp</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">timeZone</span>&gt;</span>UTC<span class="tag">&lt;/<span class="name">timeZone</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">timestamp</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">					&#123;</span><br><span class="line">					&quot;level&quot;: &quot;%level&quot;,</span><br><span class="line">					&quot;tid&quot;: &quot;%tid&quot;,</span><br><span class="line">					&quot;skyWalkingContext&quot;: &quot;%sw_ctx&quot;,</span><br><span class="line">					&quot;thread&quot;: &quot;%thread&quot;,</span><br><span class="line">					&quot;class&quot;: &quot;%logger&#123;1.&#125;:%L&quot;,</span><br><span class="line">					&quot;message&quot;: &quot;%message&quot;,</span><br><span class="line">					&quot;stackTrace&quot;: &quot;%exception&#123;10&#125;&quot;</span><br><span class="line">					&#125;</span><br><span class="line">				<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">providers</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="本机临时测试"><a href="#本机临时测试" class="headerlink" title="本机临时测试"></a>本机临时测试</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /Users/bluexiii/Documents/code/devops/dubhe-app/dubhe-metadata/dubhe-metadata-biz/target</span><br><span class="line"><span class="built_in">export</span> NACOS_HOST=10.193.36.41</span><br><span class="line"><span class="built_in">export</span> NACOS_PORT=30101</span><br><span class="line"><span class="built_in">export</span> NACOS_USERNAME=nacos</span><br><span class="line"><span class="built_in">export</span> NACOS_PASSWORD=nacos</span><br><span class="line"><span class="built_in">export</span> SW_AGENT_NAME=dubhe-metadata</span><br><span class="line"><span class="built_in">export</span> SW_AGENT_COLLECTOR_BACKEND_SERVICES=10.193.36.41:30018</span><br><span class="line"><span class="built_in">export</span> SW_AGENT_TRACE_IGNORE_PATH=<span class="string">&quot;GET:/actuator/**,Lettuce/**,Druid/**&quot;</span></span><br><span class="line">java -javaagent:/Users/bluexiii/opt/skywalking-agent/skywalking-agent.jar -jar dubhe-metadata-biz.jar</span><br><span class="line"></span><br><span class="line">CMD java -Xms2048m -Xmx2048m \</span><br><span class="line">    -Dskywalking.trace.ignore_path=\*/actuator/health,\*/actuator \</span><br><span class="line">    -javaagent:/Users/bluexiii/opt/skywalking-agent/skywalking-agent.jar \</span><br><span class="line">    -jar dubhe-metadata-biz.jar</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202308/Loki%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202308/Loki%E9%83%A8%E7%BD%B2/" class="post-title-link" itemprop="url">Loki部署</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-08-07 14:53:19" itemprop="dateCreated datePublished" datetime="2023-08-07T14:53:19+08:00">2023-08-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-06-27 11:24:00" itemprop="dateModified" datetime="2024-06-27T11:24:00+08:00">2024-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><h3 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h3><ul>
<li><a target="_blank" rel="noopener" href="https://grafana.com/oss/loki/">https://grafana.com/oss/loki/</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/grafana/loki">https://github.com/grafana/loki</a></li>
<li><a target="_blank" rel="noopener" href="https://grafana.com/docs/loki/latest/installation/helm/">https://grafana.com/docs/loki/latest/installation/helm/</a></li>
</ul>
<h3 id="入门教程"><a href="#入门教程" class="headerlink" title="入门教程"></a>入门教程</h3><ul>
<li><a target="_blank" rel="noopener" href="https://juejin.cn/post/6878188974645444621">https://juejin.cn/post/6878188974645444621</a></li>
<li><a target="_blank" rel="noopener" href="https://grafana.com/docs/loki/latest/best-practices/">https://grafana.com/docs/loki/latest/best-practices/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.qikqiak.com/post/grafana-loki-usage/">https://www.qikqiak.com/post/grafana-loki-usage/</a></li>
</ul>
<h3 id="动态标签"><a href="#动态标签" class="headerlink" title="动态标签"></a>动态标签</h3><ul>
<li><a target="_blank" rel="noopener" href="https://grafana.com/blog/2020/08/27/the-concise-guide-to-labels-in-loki/">https://grafana.com/blog/2020/08/27/the-concise-guide-to-labels-in-loki/</a></li>
<li><a target="_blank" rel="noopener" href="https://grafana.com/blog/2020/04/21/how-labels-in-loki-can-make-log-queries-faster-and-easier/">https://grafana.com/blog/2020/04/21/how-labels-in-loki-can-make-log-queries-faster-and-easier/</a></li>
</ul>
<h3 id="日志改造"><a href="#日志改造" class="headerlink" title="日志改造"></a>日志改造</h3><ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/u014163312/article/details/126713959">https://blog.csdn.net/u014163312/article/details/126713959</a></li>
</ul>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><ul>
<li><a target="_blank" rel="noopener" href="https://www.feiyiblog.com/2021/09/16/%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%ADLoki%E7%9A%84%E4%BC%98%E5%8C%96/">https://www.feiyiblog.com/2021/09/16/%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%ADLoki%E7%9A%84%E4%BC%98%E5%8C%96/</a></li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加chart库</span></span><br><span class="line">helm repo add grafana https://grafana.github.io/helm-charts</span><br><span class="line"></span><br><span class="line"><span class="comment"># 单体模式部署</span></span><br><span class="line">helm upgrade --install loki \</span><br><span class="line">--namespace=loki-stack grafana/loki-stack --create-namespace \</span><br><span class="line">--<span class="built_in">set</span> grafana.enabled=<span class="literal">true</span> \</span><br><span class="line">--<span class="built_in">set</span> grafana.image.tag=<span class="string">&quot;9.3.2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 单体模式+指定PVC</span></span><br><span class="line">vi pvc-values.yaml</span><br><span class="line">loki:</span><br><span class="line">  persistence:</span><br><span class="line">    enabled: <span class="literal">true</span></span><br><span class="line">    size: 500Gi</span><br><span class="line"></span><br><span class="line">helm upgrade --install loki --namespace=loki-stack grafana/loki-stack --create-namespace \</span><br><span class="line">--<span class="built_in">set</span> grafana.enabled=<span class="literal">true</span> \</span><br><span class="line">--<span class="built_in">set</span> grafana.image.tag=<span class="string">&quot;9.3.2&quot;</span> \</span><br><span class="line">-f pvc-values.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Grafana密码</span></span><br><span class="line">kubectl get secret --namespace loki-stack loki-grafana -o jsonpath=<span class="string">&quot;&#123;.data.admin-password&#125;&quot;</span> | base64 --decode ; <span class="built_in">echo</span></span><br><span class="line">blwUDUjqhl997xofek3dp06w8Xmc4ZhvwucQnMXw</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开Grafana</span></span><br><span class="line">kubectl port-forward --namespace loki-stack service/loki-grafana 3000:80</span><br><span class="line">open http://localhost:3000</span><br><span class="line">open http://10.193.36.41:30016  <span class="comment"># nodeport</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 部署示例应用</span></span><br><span class="line">kubectl apply -f https://ghproxy.com/https://raw.githubusercontent.com/lyzhang1999/kubernetes-example/main/loki/deployment.yaml</span><br><span class="line">kubectl logs -l app=log-example</span><br></pre></td></tr></table></figure>
<h2 id="Query"><a href="#Query" class="headerlink" title="Query"></a>Query</h2><blockquote>
<p>Grafana 9.X支持图形化查询，TIDB自带的Grafana版本为7.5.11</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Label查询</span></span><br><span class="line">&#123;<span class="string">app=&quot;log-example&quot;</span>&#125; <span class="string">|=</span> <span class="string">``</span></span><br><span class="line"><span class="comment"># 使用logfmt解析器</span></span><br><span class="line">&#123;<span class="string">app=&quot;log-example&quot;</span>&#125; <span class="string">|</span> <span class="string">logfmt</span> <span class="string">|</span> <span class="string">status</span> <span class="string">=</span> <span class="string">`200`</span></span><br><span class="line"><span class="comment"># 使用JSON解析器</span></span><br><span class="line">&#123;<span class="string">app=&quot;log-example&quot;</span>&#125; <span class="string">|</span> <span class="string">json</span> <span class="string">|</span> <span class="string">status</span> <span class="string">=</span> <span class="string">`200`</span></span><br><span class="line"><span class="comment"># 查询状态码不等于200的日志</span></span><br><span class="line">&#123;<span class="string">app=&quot;log-example&quot;</span>&#125; <span class="string">|=</span> <span class="string">`status=`</span> <span class="string">|</span> <span class="string">logfmt</span> <span class="string">|</span> <span class="string">status</span> <span class="type">!=</span> <span class="string">`200`</span></span><br><span class="line"><span class="comment"># 查询状态码在400和500区间的日志</span></span><br><span class="line">&#123;<span class="string">app=&quot;log-example&quot;</span>&#125; <span class="string">|=</span> <span class="string">`status=`</span> <span class="string">|</span> <span class="string">logfmt</span> <span class="string">|</span> <span class="string">status</span> <span class="string">&gt;=</span> <span class="number">400</span> <span class="string">|</span> <span class="string">status</span> <span class="string">&lt;=</span> <span class="number">500</span></span><br><span class="line"><span class="comment"># 查询接口返回时间超过3us的日志</span></span><br><span class="line">&#123;<span class="string">app=&quot;log-example&quot;</span>&#125; <span class="string">|=</span> <span class="string">`status=`</span> <span class="string">|</span> <span class="string">logfmt</span> <span class="string">|</span> <span class="string">duration</span> <span class="string">&gt;</span> <span class="string">3us</span></span><br><span class="line"><span class="comment"># 重新格式化输出日志</span></span><br><span class="line">&#123;<span class="string">app=&quot;log-example&quot;</span>&#125; <span class="string">|=</span> <span class="string">`status=`</span> <span class="string">|</span> <span class="string">logfmt</span> <span class="string">|</span> <span class="string">line_format</span> <span class="string">`&#123;&#123;</span> <span class="string">.duration</span> <span class="string">&#125;&#125;</span> &#123;&#123; <span class="string">.uri</span> &#125;&#125;<span class="string">`</span></span><br><span class="line"><span class="comment"># 分组统计 10s 内 Pod 的日志数量</span></span><br><span class="line"><span class="string">sum</span> <span class="string">by</span> <span class="string">(pod)</span> <span class="string">(count_over_time(&#123;app=&quot;log-example&quot;&#125;</span> <span class="string">|=</span> <span class="string">`status=`</span> <span class="string">|</span> <span class="string">logfmt</span> <span class="string">|</span> <span class="string">duration</span> <span class="string">&gt;</span> <span class="string">4us</span> [<span class="string">10s</span>]<span class="string">))</span></span><br><span class="line"><span class="comment"># 分组统计 1 分钟内的请求状态码数量</span></span><br><span class="line"><span class="string">sum</span> <span class="string">by</span> <span class="string">(status)</span> <span class="string">(</span></span><br><span class="line"><span class="string">count_over_time(&#123;app=&quot;log-example&quot;&#125;</span> <span class="string">|=</span> <span class="string">`status=`</span> <span class="string">|</span> <span class="string">logfmt</span> <span class="string">|</span> <span class="string">__error__=&quot;&quot;[1m])</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"></span><br><span class="line">&#123;<span class="string">app=&quot;dubhe-metadata&quot;</span>&#125; <span class="string">|</span> <span class="string">json</span> <span class="string">|</span> <span class="string">level</span> <span class="string">=</span> <span class="string">`INFO`</span></span><br></pre></td></tr></table></figure>
<h2 id="JSON日志改造"><a href="#JSON日志改造" class="headerlink" title="JSON日志改造"></a>JSON日志改造</h2><h3 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.logstash.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logstash-logback-encoder<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>7.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="logback-spring-xml"><a href="#logback-spring-xml" class="headerlink" title="logback-spring.xml"></a>logback-spring.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;console&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">encoder</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> <span class="attr">class</span>=<span class="string">&quot;net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">providers</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">					&#123;</span><br><span class="line">					&quot;timestamp&quot;: &quot;%date&#123;\&quot;yyyy-MM-dd HH:mm:ss.SSS\&quot;&#125;&quot;,</span><br><span class="line">					&quot;level&quot;: &quot;%level&quot;,</span><br><span class="line">					&quot;pid&quot;: &quot;$&#123;PID:-&#125;&quot;,</span><br><span class="line">					&quot;thread&quot;: &quot;%thread&quot;,</span><br><span class="line">					&quot;class&quot;: &quot;%logger&quot;,</span><br><span class="line">					&quot;method&quot;: &quot;%method&quot;,</span><br><span class="line">					&quot;line&quot;: &quot;%line&quot;,</span><br><span class="line">					&quot;message&quot;: &quot;%message&quot;</span><br><span class="line">					&#125;</span><br><span class="line">				<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">providers</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202307/Nexus%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202307/Nexus%E9%83%A8%E7%BD%B2/" class="post-title-link" itemprop="url">Nexus部署</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-07-07 09:08:41" itemprop="dateCreated datePublished" datetime="2023-07-07T09:08:41+08:00">2023-07-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-06-27 11:24:01" itemprop="dateModified" datetime="2024-06-27T11:24:01+08:00">2024-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="镜像"><a href="#镜像" class="headerlink" title="镜像"></a>镜像</h2><p><a target="_blank" rel="noopener" href="https://hub.docker.com/r/sonatype/nexus3">https://hub.docker.com/r/sonatype/nexus3</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动</span></span><br><span class="line">mkdir -p /dubhe/nexus-data &amp;&amp; chown -R 200 /dubhe/nexus-data</span><br><span class="line">docker run -d -p 8081:8081 --name nexus -v /dubhe/nexus-data:/nexus-data sonatype/nexus3</span><br><span class="line">docker run -d --network host --name nexus -v /dubhe/nexus-data:/nexus-data sonatype/nexus3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止</span></span><br><span class="line">docker stop --time=120 nexus</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录</span></span><br><span class="line">http://10.193.36.33:8081/</span><br><span class="line">admin/yourpass</span><br></pre></td></tr></table></figure>
<h2 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;java.home&#125;/../lib/tools.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jconsole<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;java.home&#125;/../lib/jconsole.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span>&gt;</span>releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>Internal Releases<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url</span>&gt;</span>http://10.193.36.33:8081/repository/maven-releases/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span>&gt;</span>releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>Internal Releases<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url</span>&gt;</span>http://10.193.36.33:8081/repository/maven-snapshots/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="settings-xml"><a href="#settings-xml" class="headerlink" title="settings.xml"></a>settings.xml</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/SETTINGS/1.0.0&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginGroups</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginGroups</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">proxies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">proxies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">password</span>&gt;</span>yourpass<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;mirror&gt;</span></span><br><span class="line"><span class="comment">            &lt;id&gt;nexus-aliyun&lt;/id&gt;</span></span><br><span class="line"><span class="comment">            &lt;mirrorOf&gt;*,!jitpack.io,!elasticsearch-releases,!dtstack-github,!nexus-public,!elastic.co&lt;/mirrorOf&gt;</span></span><br><span class="line"><span class="comment">            &lt;name&gt;Nexus aliyun&lt;/name&gt;</span></span><br><span class="line"><span class="comment">            &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public&lt;/url&gt;</span></span><br><span class="line"><span class="comment">        &lt;/mirror&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyun-central<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun-central<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/central<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyun-jcenter<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>jcenter,public<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun-jcenter<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyun-google<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>google<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun-google<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/google<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyun-spring<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>spring<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun-spring<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/spring<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyun-spring-plugin<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>spring-plugin<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun-spring-plugin<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/spring-plugin<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="build"><a href="#build" class="headerlink" title="build"></a>build</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mvn  -Dmaven.test.skip=<span class="literal">true</span> clean install</span><br><span class="line"></span><br><span class="line">mvn clean package -U -pl efpx-register</span><br><span class="line">mvn clean package -U -pl efpx-gateway</span><br><span class="line">mvn clean package -U -pl efpx-auth</span><br><span class="line">mvn clean package -U -pl efpx-upms/efpx-upms-biz</span><br><span class="line">mvn clean package -U -pl dubhe-metadata/dubhe-metadata-biz</span><br><span class="line">mvn clean package -U -pl dubhe-scheduler/dubhe-scheduler-biz</span><br><span class="line">mvn clean package -U -pl dubhe-data-integration</span><br><span class="line">mvn clean package -U -pl dubhe-alert/dubhe-alert-biz</span><br><span class="line">mvn clean package -U -pl dubhe-api-generation</span><br><span class="line">mvn clean package -U -pl dubhe-quality/dubhe-quality-biz</span><br><span class="line">mvn clean package -U -pl dubhe-encryption/dubhe-encryption-biz</span><br><span class="line">mvn clean package -U -pl dubhe-executor/dubhe-executor-biz</span><br><span class="line">mvn clean package -U -pl efpx-visual/efpx-monitor</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202307/Nocalhost%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202307/Nocalhost%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">Nocalhost笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-07-06 14:02:51" itemprop="dateCreated datePublished" datetime="2023-07-06T14:02:51+08:00">2023-07-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-06-27 11:22:51" itemprop="dateModified" datetime="2024-06-27T11:22:51+08:00">2024-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="配置参数"><a href="#配置参数" class="headerlink" title="配置参数"></a>配置参数</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 镜像名</span></span><br><span class="line">harbor.dubhe:30002/dubhe-base/amazoncorretto:8u372</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动命令</span></span><br><span class="line">mvn install &amp;&amp; mvn spring-boot:run -pl ./dubhe-alert/dubhe-alert-biz</span><br><span class="line">mvn clean package -U -pl dubhe-executor/dubhe-executor-biz</span><br><span class="line"></span><br><span class="line">mvn spring-boot:run -pl dubhe-executor-biz</span><br></pre></td></tr></table></figure>
<h2 id="本机调试"><a href="#本机调试" class="headerlink" title="本机调试"></a>本机调试</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> NACOS_HOST=10.193.36.41</span><br><span class="line"><span class="built_in">export</span> NACOS_PORT=30101</span><br><span class="line"><span class="built_in">export</span> NACOS_USERNAME=nacos</span><br><span class="line"><span class="built_in">export</span> NACOS_PASSWORD=nacos</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202306/%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202306/%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/" class="post-title-link" itemprop="url">基础镜像制作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-07-01 14:58:04" itemprop="dateCreated datePublished" datetime="2023-07-01T14:58:04+08:00">2023-07-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-06-27 11:22:30" itemprop="dateModified" datetime="2024-06-27T11:22:30+08:00">2024-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="docker-manifest用法"><a href="#docker-manifest用法" class="headerlink" title="docker-manifest用法"></a>docker-manifest用法</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker manifest create --insecure harbor.dubhe:30002/dubhe-base/nginx:1.25.1 \</span><br><span class="line">harbor.dubhe:30002/dubhe-base/nginx:1.25.1-arm \</span><br><span class="line">harbor.dubhe:30002/dubhe-base/nginx:1.25.1-x86</span><br><span class="line"></span><br><span class="line">docker manifest push --insecure harbor.dubhe:30002/dubhe-base/nginx:1.25.1</span><br></pre></td></tr></table></figure>
<h2 id="manifest-tool用法"><a href="#manifest-tool用法" class="headerlink" title="manifest-tool用法"></a>manifest-tool用法</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/GoogleContainerTools/kaniko#merging-the-container-manifests">https://github.com/GoogleContainerTools/kaniko#merging-the-container-manifests</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/estesp/manifest-tool/releases">https://github.com/estesp/manifest-tool/releases</a></li>
</ul>
<h2 id="基础镜像制作脚本"><a href="#基础镜像制作脚本" class="headerlink" title="基础镜像制作脚本"></a>基础镜像制作脚本</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">IMAGE=amazoncorretto:8u372</span><br><span class="line"></span><br><span class="line">docker pull --platform linux/arm64 <span class="variable">$&#123;IMAGE&#125;</span></span><br><span class="line">docker tag <span class="variable">$&#123;IMAGE&#125;</span> harbor.dubhe:30002/dubhe-base/<span class="variable">$&#123;IMAGE&#125;</span>-arm64</span><br><span class="line">docker push harbor.dubhe:30002/dubhe-base/<span class="variable">$&#123;IMAGE&#125;</span>-arm64</span><br><span class="line"></span><br><span class="line">docker pull --platform linux/amd64 <span class="variable">$&#123;IMAGE&#125;</span></span><br><span class="line">docker tag <span class="variable">$&#123;IMAGE&#125;</span> harbor.dubhe:30002/dubhe-base/<span class="variable">$&#123;IMAGE&#125;</span>-amd64</span><br><span class="line">docker push harbor.dubhe:30002/dubhe-base/<span class="variable">$&#123;IMAGE&#125;</span>-amd64</span><br><span class="line"></span><br><span class="line">manifest-tool --plain-http --username=admin --password=yourpass push from-args \</span><br><span class="line">--platforms linux/amd64,linux/arm64 \</span><br><span class="line">--template harbor.dubhe:30002/dubhe-base/<span class="variable">$&#123;IMAGE&#125;</span>-ARCH \</span><br><span class="line">--target harbor.dubhe:30002/dubhe-base/<span class="variable">$&#123;IMAGE&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="基础镜像清单"><a href="#基础镜像清单" class="headerlink" title="基础镜像清单"></a>基础镜像清单</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># oracle-jdk8(X86 Only)</span></span><br><span class="line">harbor.dubhe:30002/dubhe-base/java:8u111</span><br><span class="line"></span><br><span class="line"><span class="comment"># dragonwell自制(ARM Only)</span></span><br><span class="line">harbor.dubhe:30002/dubhe-base/dragonwell:8.15.16-arm</span><br><span class="line"></span><br><span class="line"><span class="comment"># openjdk8(双架构)</span></span><br><span class="line">harbor.dubhe:30002/dubhe-base/openjdk:8-jre-slim-buster</span><br><span class="line"></span><br><span class="line"><span class="comment"># correttojdk8(双架构)</span></span><br><span class="line">harbor.dubhe:30002/dubhe-base/amazoncorretto:8u372</span><br><span class="line"></span><br><span class="line"><span class="comment"># 官方镜像</span></span><br><span class="line">harbor.dubhe:30002/dubhe-base/busybox:1.36.0</span><br><span class="line">harbor.dubhe:30002/dubhe-base/nginx:1.25.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自制镜像</span></span><br><span class="line">harbor.dubhe:30002/dubhe-base/alpine:3.16.3</span><br><span class="line">harbor.dubhe:30002/dubhe-base/ubuntu:22.04</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自制镜像(TektonTask X86 Only)</span></span><br><span class="line">harbor.dubhe:30002/dubhe-base/chart-update:latest</span><br><span class="line">harbor.dubhe:30002/dubhe-base/dubhe-buildkit:1.2.0</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202306/ArgoCD%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202306/ArgoCD%E9%83%A8%E7%BD%B2/" class="post-title-link" itemprop="url">ArgoCD部署</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-07-01 09:17:24" itemprop="dateCreated datePublished" datetime="2023-07-01T09:17:24+08:00">2023-07-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-06-27 11:24:03" itemprop="dateModified" datetime="2024-06-27T11:24:03+08:00">2024-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h2><p><a target="_blank" rel="noopener" href="https://argo-cd.readthedocs.io/en/stable/getting_started/">https://argo-cd.readthedocs.io/en/stable/getting_started/</a></p>
<h2 id="镜像清单"><a href="#镜像清单" class="headerlink" title="镜像清单"></a>镜像清单</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">quay.io/argoproj/argocd:v2.7.6</span><br><span class="line">ghcr.io/dexidp/dex:v2.36.0</span><br><span class="line">redis:7.0.11-alpine</span><br></pre></td></tr></table></figure>
<h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">wget https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml</span><br><span class="line">kubectl create namespace argocd</span><br><span class="line">kubectl apply -n argocd -f install.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装cli</span></span><br><span class="line">brew install argocd</span><br><span class="line"></span><br><span class="line"><span class="comment"># cli方式获取实始密码</span></span><br><span class="line">argocd admin initial-password -n argocd</span><br><span class="line">admin/yourpass</span><br><span class="line"></span><br><span class="line"><span class="comment"># kubectl方式获取初始密码(可选)</span></span><br><span class="line">kubectl get secret -n argocd argocd-initial-admin-secret -o yaml</span><br><span class="line"><span class="built_in">echo</span> yourpassbase64== | base64 -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># WEB方式登录</span></span><br><span class="line">https://10.193.36.51:30010</span><br><span class="line"></span><br><span class="line">http://10.193.36.252:30010</span><br></pre></td></tr></table></figure>
<h2 id="禁用https跳转"><a href="#禁用https跳转" class="headerlink" title="禁用https跳转"></a>禁用https跳转</h2><p>修改configmap的方式实测无效，转而通过修改<code>devops-argocd-server</code>的pod启动参数实现</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">command:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">argocd-server</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;--staticassets&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/shared/app</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;--insecure&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="启用webhook"><a href="#启用webhook" class="headerlink" title="启用webhook"></a>启用webhook</h2><p>地址:  <a target="_blank" rel="noopener" href="http://10.193.36.41:30010/api/webhook">http://10.193.36.41:30010/api/webhook</a><br>设置密码: </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit secret argocd-secret -n argocd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 明文填写</span></span><br><span class="line">stringData:</span><br><span class="line">  webhook.gogs.secret: dubhe123</span><br></pre></td></tr></table></figure>
<h2 id="配置开发、测试环境"><a href="#配置开发、测试环境" class="headerlink" title="配置开发、测试环境"></a>配置开发、测试环境</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CLI方式登录</span></span><br><span class="line">argocd login 10.193.36.41:30010  <span class="comment"># admin/yourpass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Git仓库监权</span></span><br><span class="line">argocd repo add http://10.193.36.33:3000/dubhe/dubhe-charts --username dubhe --password yourpass</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建开发应用，自动同步</span></span><br><span class="line">argocd app create dubhe-app-dev \</span><br><span class="line">--sync-policy automated \</span><br><span class="line">--repo http://10.193.36.33:3000/dubhe/dubhe-charts \</span><br><span class="line">--revision develop \</span><br><span class="line">--path dubhe-app \</span><br><span class="line">--dest-namespace dubhe-dev \</span><br><span class="line">--dest-server https://kubernetes.default.svc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建测试应用，手动同步</span></span><br><span class="line">argocd app create dubhe-app-test \</span><br><span class="line">--sync-policy none \</span><br><span class="line">--repo http://10.193.36.33:3000/dubhe/dubhe-charts \</span><br><span class="line">--revision <span class="built_in">test</span> \</span><br><span class="line">--path dubhe-app \</span><br><span class="line">--dest-namespace dubhe-test \</span><br><span class="line">--dest-server https://kubernetes.default.svc</span><br></pre></td></tr></table></figure>
<h2 id="配置仿真环境"><a href="#配置仿真环境" class="headerlink" title="配置仿真环境"></a>配置仿真环境</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CLI方式登录</span></span><br><span class="line">argocd login 10.193.36.51:30010  <span class="comment"># admin/yourpass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Git仓库监权</span></span><br><span class="line">argocd repo add http://10.193.36.50:3000/dubhe/dubhe-charts --username dubhe --password yourpass</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建仿真应用，手动同步</span></span><br><span class="line">argocd app create dubhe-app \</span><br><span class="line">--sync-policy none \</span><br><span class="line">--repo http://10.193.36.50:3000/dubhe/dubhe-charts \</span><br><span class="line">--revision master \</span><br><span class="line">--path dubhe-app \</span><br><span class="line">--dest-namespace dubhe \</span><br><span class="line">--dest-server https://kubernetes.default.svc</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202306/chartmuseum%E9%A2%84%E7%A0%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202306/chartmuseum%E9%A2%84%E7%A0%94/" class="post-title-link" itemprop="url">chartmuseum预研</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-06-29 16:47:45" itemprop="dateCreated datePublished" datetime="2023-06-29T16:47:45+08:00">2023-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-06-27 11:22:35" itemprop="dateModified" datetime="2024-06-27T11:22:35+08:00">2024-06-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="整体说明"><a href="#整体说明" class="headerlink" title="整体说明"></a>整体说明</h2><ul>
<li>harbor早期通过整合第三方的chartmuseum，实现了对helm-chart仓库的支持</li>
<li>chartmuseum归属于helm公司，有独立官网和github仓库</li>
<li>harbor有多种安装方式，例如: 二进制脚本安装、DockerCompose安装、Helm方式在K8S安装(通过一个名为harbor-helm项目)</li>
<li>harbor的二进制脚本安装，在3个月前已经移除对chartmuseum的支持</li>
<li>harbor的Helm安装方式(harbor-helm)，最新仓库中已经没有了chartmuseum的选项，从提交历史上看1.11.0是最后一个包含museum的版本</li>
<li>官方在2023年4月24日的一个Issue中，解释了抛弃chartmusem的原因，以及整个提案的过程</li>
<li>2022年8月，V2.6.0发版说明中提到了已经准备移除Chartmuseum，提到了V2.8.0(2023年4月)将会彻底完成移除</li>
<li>harbor未来会通过OCI规范，直接支持chart仓库</li>
</ul>
<hr>
<h2 id="chartmuseum官网"><a href="#chartmuseum官网" class="headerlink" title="chartmuseum官网"></a>chartmuseum官网</h2><ul>
<li><a target="_blank" rel="noopener" href="https://chartmuseum.com/#Instructions">https://chartmuseum.com/#Instructions</a>  chartmuseum有独立官网</li>
<li><a target="_blank" rel="noopener" href="https://github.com/helm/chartmuseum">https://github.com/helm/chartmuseum</a>   仓库还是归属于helm</li>
<li><a target="_blank" rel="noopener" href="https://github.com/chartmuseum">https://github.com/chartmuseum</a>   但也有自已的独立github用户</li>
</ul>
<h2 id="harbor中关于chartmuseum的一些线索"><a href="#harbor中关于chartmuseum的一些线索" class="headerlink" title="harbor中关于chartmuseum的一些线索"></a>harbor中关于chartmuseum的一些线索</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/goharbor/harbor/blame/d84b1d07d200f1c64708d420cf9903c207e18b81/make/install.sh#L12">https://github.com/goharbor/harbor/blame/d84b1d07d200f1c64708d420cf9903c207e18b81/make/install.sh#L12</a>    harbor常规方式安装脚本，在3个月前已经移除对chartmuseum的支持</li>
<li><a target="_blank" rel="noopener" href="https://github.com/goharbor/harbor-helm/blob/1.11.0/values.yaml">https://github.com/goharbor/harbor-helm/blob/1.11.0/values.yaml</a>   harbor-helm的最新仓库中已经没有chartmuseum的选项，从提交历史上看1.11.0是最后一个包含museum的版本</li>
<li><a target="_blank" rel="noopener" href="https://goharbor.io/docs/2.5.0/working-with-projects/working-with-images/managing-helm-charts/#manage-helm-charts-with-the-chartmuseum-in-harbor-interface">https://goharbor.io/docs/2.5.0/working-with-projects/working-with-images/managing-helm-charts/#manage-helm-charts-with-the-chartmuseum-in-harbor-interface</a>  直到2.5.0文档中有依然有chartmuseum的介绍(最新2.8.0)</li>
<li><a target="_blank" rel="noopener" href="https://github.com/goharbor/harbor/issues/18573">https://github.com/goharbor/harbor/issues/18573</a>  官方在2023年4月24日的一个Issue中，解释了抛弃chartmusem的原因，以及整个提案的过程</li>
<li><a target="_blank" rel="noopener" href="https://github.com/goharbor/harbor/releases/tag/v2.6.0">https://github.com/goharbor/harbor/releases/tag/v2.6.0</a>  最早追溯到2022年8月29日，V2.6.0发版说明中提到了已经准备移除Chartmuseum，V2.8.0将会完成移除</li>
<li><a target="_blank" rel="noopener" href="https://github.com/goharbor/harbor/discussions/15057">https://github.com/goharbor/harbor/discussions/15057</a>  提案</li>
</ul>
<h2 id="harbor版本发布时间梳理"><a href="#harbor版本发布时间梳理" class="headerlink" title="harbor版本发布时间梳理"></a>harbor版本发布时间梳理</h2><ul>
<li>v2.8.0  2023/04</li>
<li>v2.7.0    2022/12</li>
<li>v2.6.0  2022/08</li>
</ul>
<hr>
<h2 id="chartmuseum-docker方式试用"><a href="#chartmuseum-docker方式试用" class="headerlink" title="chartmuseum docker方式试用"></a>chartmuseum docker方式试用</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm -it \</span><br><span class="line">  -p 8080:8080 \</span><br><span class="line">  -e DEBUG=1 \</span><br><span class="line">  -e STORAGE=<span class="built_in">local</span> \</span><br><span class="line">  -e STORAGE_LOCAL_ROOTDIR=/charts \</span><br><span class="line">  -v $(<span class="built_in">pwd</span>)/charts:/charts \</span><br><span class="line">  ghcr.io/helm/chartmuseum:v0.14.0</span><br></pre></td></tr></table></figure>
<blockquote>
<p>只提供API，没有UI，类似docker-registry</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/28/">28</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">BlueXIII</p>
  <div class="site-description" itemprop="description">IT技术类文章、笔记分享</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">273</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/xiiiblue" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;xiiiblue" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/bluexiii" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;bluexiii" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备18050487号-1 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BlueXIII</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
