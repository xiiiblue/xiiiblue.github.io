<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.bluexiii.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="IT技术类文章、笔记分享">
<meta property="og:type" content="website">
<meta property="og:title" content="BlueXIII&#39;s Blog">
<meta property="og:url" content="http://www.bluexiii.com/page/12/index.html">
<meta property="og:site_name" content="BlueXIII&#39;s Blog">
<meta property="og:description" content="IT技术类文章、笔记分享">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="BlueXIII">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://www.bluexiii.com/page/12/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>BlueXIII's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">BlueXIII's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">热爱技术,持续学习</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202109/MongoDB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202109/MongoDB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">MongoDB学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-02 17:14:19" itemprop="dateCreated datePublished" datetime="2022-11-02T17:14:19+08:00">2022-11-02</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/2a65343a857e">https://www.jianshu.com/p/2a65343a857e</a></li>
</ul>
<h2 id="常用查询"><a href="#常用查询" class="headerlink" title="常用查询"></a>常用查询</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">db.getCollection(&#39;policy_content&#39;).find(&#123;&#125;)</span><br><span class="line"></span><br><span class="line"># 条件查询</span><br><span class="line">db.getCollection(&#39;policy_content&#39;).find(&#123;&quot;task_id&quot;:1&#125;);</span><br><span class="line"></span><br><span class="line"># Count</span><br><span class="line">db.getCollection(&#39;policy_content&#39;).find(&#123;&quot;task_id&quot;:1&#125;).count();</span><br><span class="line"># 限制条数</span><br><span class="line">db.getCollection(&#39;policy_content&#39;).find(&#123;&quot;task_id&quot;:1&#125;).limit(5);</span><br><span class="line"># 分页</span><br><span class="line">db.getCollection(&#39;policy_content&#39;).find(&#123;&quot;task_id&quot;:1&#125;).limit(10).skip(5);;</span><br><span class="line"># OR</span><br><span class="line">db.getCollection(&#39;policy_content&#39;).find(&#123;$or:[&#123;column: &quot;2&quot;&#125;, &#123;column1: &quot;24&quot;&#125;]&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 比较查询 $gt&quot; 、&quot;$gte&quot;、 &quot;$lt&quot;、 &quot;$lte&quot;</span><br><span class="line">db.getCollection(&#39;policy_content&#39;).find(&#123;&quot;task_id&quot;:1, &quot;created&quot;:&#123;&quot;&quot;:10000&#125;&#125;).count();</span><br><span class="line">db.getCollection(&#39;policy_content&#39;).find(&#123;&#39;DataTime&#39;:&#123;&#39;$gte&#39;:1518278400&#125;&#125;).count()</span><br><span class="line"></span><br><span class="line"># 时间</span><br><span class="line">db.getCollection(&#39;policy_content&#39;).find(&#123;&quot;task_id&quot;:1, &quot;created&quot;:&#123;$gte:&quot;2021-09-01&quot;,$lte:&quot;2021-9-11&quot;&#125;&#125;)</span><br><span class="line"></span><br><span class="line"># 模糊查询</span><br><span class="line">db.getCollection(&#39;policy_content&#39;).find(&#123; &quot;name&quot; : &#x2F;mongo&#x2F;&#125;);</span><br><span class="line"></span><br><span class="line"># 查询指定条件下指定列</span><br><span class="line">db.getCollection(&#39;policy_content&#39;).find(&#123;&#125;, &#123;&quot;column&quot;:1, &quot;InMongoTimet&quot;:1&#125;);&#x2F;&#x2F;查询column和InMongoTimet这两个字段</span><br><span class="line"></span><br><span class="line"># 建索引</span><br><span class="line">db.policy_content.createIndex(&#123;&quot;index_id&quot;:1&#125;)</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202106/%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202106/%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">爬虫入门学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-02 17:14:01" itemprop="dateCreated datePublished" datetime="2022-11-02T17:14:01+08:00">2022-11-02</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/268769681">https://www.zhihu.com/question/268769681</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/29436838">https://zhuanlan.zhihu.com/p/29436838</a>  XPath</li>
<li><a target="_blank" rel="noopener" href="http://blog.itpub.net/31557738/viewspace-2658869/">http://blog.itpub.net/31557738/viewspace-2658869/</a> Readability 和 Newspaper 的介绍。</li>
<li><a target="_blank" rel="noopener" href="https://xie.infoq.cn/article/60cdd679a5cd5d6da5116aee8">https://xie.infoq.cn/article/60cdd679a5cd5d6da5116aee8</a>  大规模爬虫</li>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1602931">https://cloud.tencent.com/developer/article/1602931</a> 正文提取第三方库goose</li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/65650357">https://zhuanlan.zhihu.com/p/65650357</a> 设计一个一天爬取一百万张页面的大型爬虫</li>
</ul>
<h2 id="关注点"><a href="#关注点" class="headerlink" title="关注点"></a>关注点</h2><ul>
<li>法律风险 </li>
<li>反爬</li>
<li>文本提取 XPATH、正则、NLP、视觉AI、GNE</li>
<li>分布式爬虫、调度</li>
<li>部署任务分派 Crawlab、K8S</li>
<li>URL去重 Redis</li>
<li>自动化渲染技术  Selenium、Puppeteer</li>
<li>消息队列</li>
<li>资源问题 布隆过滤器</li>
</ul>
<h2 id="文本提取"><a href="#文本提取" class="headerlink" title="文本提取"></a>文本提取</h2><ul>
<li>用归类法，相似的内容归类到一起，然后给一类内容配置提取规则 XPATH</li>
<li>用正则，提取指定标签中的内容；</li>
<li>用深度学习，NLP 语义分析出哪里是有意义的内容，提取出来；</li>
<li>用计算机视觉，让人去点击，然后按照页面相似度分类提取（其实就是归类法的自动化版本）；</li>
<li>用算法，计算出文本的密度，然后提取 GNE</li>
</ul>
<h2 id="去重"><a href="#去重" class="headerlink" title="去重"></a>去重</h2><ul>
<li>Redis </li>
<li>MySQL </li>
<li>MongoDB </li>
<li>内存</li>
</ul>
<h2 id="自动化渲染"><a href="#自动化渲染" class="headerlink" title="自动化渲染"></a>自动化渲染</h2><ul>
<li>Rod </li>
<li>Chromedp</li>
<li>Puppeteer/Pyppeteer</li>
<li>Playwright</li>
<li>Selenium</li>
<li>Cypress</li>
</ul>
<h2 id="库"><a href="#库" class="headerlink" title="库"></a>库</h2><ul>
<li>Scrapy <a target="_blank" rel="noopener" href="https://scrapy.org/">https://scrapy.org/</a></li>
</ul>
<h2 id="反爬"><a href="#反爬" class="headerlink" title="反爬"></a>反爬</h2><ul>
<li>UA</li>
<li>IP</li>
<li>登录</li>
<li>token/sign等加密参数</li>
<li>特殊的 headers 头验证</li>
<li>aes 和 des 加密某字段</li>
<li>会员权限等级限制</li>
<li>web 端的 js 混淆</li>
<li>ssl pinning 检测</li>
<li>微信授权登录</li>
</ul>
<h2 id="商业软件"><a href="#商业软件" class="headerlink" title="商业软件"></a>商业软件</h2><p>八爪鱼<br>后羿</p>
<h2 id="crawlab"><a href="#crawlab" class="headerlink" title="crawlab"></a>crawlab</h2><p><a target="_blank" rel="noopener" href="https://www.v2ex.com/t/590527">https://www.v2ex.com/t/590527</a></p>
<h2 id="Java库"><a href="#Java库" class="headerlink" title="Java库"></a>Java库</h2><ul>
<li><a target="_blank" rel="noopener" href="https://jsoup.org/">https://jsoup.org/</a></li>
<li><a target="_blank" rel="noopener" href="https://webmagic.io/">https://webmagic.io/</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904099675111432">https://juejin.cn/post/6844904099675111432</a></li>
</ul>
<h2 id="GNE"><a href="#GNE" class="headerlink" title="GNE"></a>GNE</h2><p><a target="_blank" rel="noopener" href="https://github.com/kingname/GeneralNewsExtractor">https://github.com/kingname/GeneralNewsExtractor</a></p>
<h2 id="书籍"><a href="#书籍" class="headerlink" title="书籍"></a>书籍</h2><p>Python3 网络爬虫宝典</p>
<h2 id="爬虫管理"><a href="#爬虫管理" class="headerlink" title="爬虫管理"></a>爬虫管理</h2><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903912349122573">https://juejin.cn/post/6844903912349122573</a></p>
<h2 id="人名分词"><a href="#人名分词" class="headerlink" title="人名分词"></a>人名分词</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/hankcs/HanLP">https://github.com/hankcs/HanLP</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/fxsjy/jieba">https://github.com/fxsjy/jieba</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/IT_flying625/article/details/88669869">https://blog.csdn.net/IT_flying625/article/details/88669869</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/baiboy/p/nltk2.html">https://www.cnblogs.com/baiboy/p/nltk2.html</a></li>
</ul>
<h2 id="反爬检测"><a href="#反爬检测" class="headerlink" title="反爬检测"></a>反爬检测</h2><p><a target="_blank" rel="noopener" href="https://bot.sannysoft.com/">https://bot.sannysoft.com/</a></p>
<h2 id="正文提取"><a href="#正文提取" class="headerlink" title="正文提取"></a>正文提取</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/codelucas/newspaper">https://github.com/codelucas/newspaper</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/buriy/python-readability">https://github.com/buriy/python-readability</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/goose3/goose3">https://github.com/goose3/goose3</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202106/Elasticsearch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202106/Elasticsearch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">Elasticsearch学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-02 17:13:39" itemprop="dateCreated datePublished" datetime="2022-11-02T17:13:39+08:00">2022-11-02</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="GUI"><a href="#GUI" class="headerlink" title="GUI"></a>GUI</h2><h3 id="elasticvue"><a href="#elasticvue" class="headerlink" title="elasticvue"></a>elasticvue</h3><ul>
<li>chrome插件</li>
<li>查询 + 管理</li>
</ul>
<h3 id="elasticsearch-head"><a href="#elasticsearch-head" class="headerlink" title="elasticsearch-head"></a>elasticsearch-head</h3><p><a target="_blank" rel="noopener" href="https://github.com/mobz/elasticsearch-head">https://github.com/mobz/elasticsearch-head</a></p>
<ul>
<li>chrome插件</li>
<li>查询 + 管理</li>
</ul>
<h3 id="Kaizen"><a href="#Kaizen" class="headerlink" title="Kaizen"></a>Kaizen</h3><p><a target="_blank" rel="noopener" href="https://www.elastic-kaizen.com/">https://www.elastic-kaizen.com/</a></p>
<ul>
<li>java桌面版</li>
<li>纯查询</li>
</ul>
<h3 id="elasticsearch-hq"><a href="#elasticsearch-hq" class="headerlink" title="elasticsearch-hq"></a>elasticsearch-hq</h3><p><a target="_blank" rel="noopener" href="https://github.com/ElasticHQ/elasticsearch-HQ">https://github.com/ElasticHQ/elasticsearch-HQ</a></p>
<p>docker run -p 5000:5000 elastichq/elasticsearch-hq<br>open <a target="_blank" rel="noopener" href="http://localhost:5000/">http://localhost:5000/</a></p>
<ul>
<li>docker run</li>
<li>监控 + 简单查询</li>
</ul>
<h3 id="djavu"><a href="#djavu" class="headerlink" title="djavu"></a>djavu</h3><p><a target="_blank" rel="noopener" href="https://github.com/appbaseio/dejavu/">https://github.com/appbaseio/dejavu/</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 1358:1358 -d appbaseio/dejavu</span><br><span class="line">open http://localhost:1358/</span><br></pre></td></tr></table></figure>

<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2017/08/elasticsearch.html">https://www.ruanyifeng.com/blog/2017/08/elasticsearch.html</a><br><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1547867">https://cloud.tencent.com/developer/article/1547867</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903919013855240">https://juejin.cn/post/6844903919013855240</a><br><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/query-dsl-intro.html">https://www.elastic.co/guide/cn/elasticsearch/guide/current/query-dsl-intro.html</a><br><a target="_blank" rel="noopener" href="https://n3xtchen.github.io/n3xtchen/elasticsearch/2017/07/05/elasticsearch-23-useful-query-example">https://n3xtchen.github.io/n3xtchen/elasticsearch/2017/07/05/elasticsearch-23-useful-query-example</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/eb30eee13923">https://www.jianshu.com/p/eb30eee13923</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/34240906">https://zhuanlan.zhihu.com/p/34240906</a><br><a target="_blank" rel="noopener" href="https://feifeiyum.github.io/2020/02/27/es-mapping/">https://feifeiyum.github.io/2020/02/27/es-mapping/</a><br><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1189279">https://cloud.tencent.com/developer/article/1189279</a></p>
<h2 id="Kibana教程"><a href="#Kibana教程" class="headerlink" title="Kibana教程"></a>Kibana教程</h2><p><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2017/08/elasticsearch.html">https://www.ruanyifeng.com/blog/2017/08/elasticsearch.html</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/7ca9e5b02ef6">https://www.jianshu.com/p/7ca9e5b02ef6</a><br><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/cn/kibana/current/setup.html">https://www.elastic.co/guide/cn/kibana/current/setup.html</a></p>
<h2 id="KibanaDevTool"><a href="#KibanaDevTool" class="headerlink" title="KibanaDevTool"></a>KibanaDevTool</h2><h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看</span></span><br><span class="line">GET /_cat</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Index</span></span><br><span class="line">GET /_cat/indices?v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看健康</span></span><br><span class="line">GET /_cat/health?v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看全部mapping</span></span><br><span class="line">GET /_mapping?pretty=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建索引</span></span><br><span class="line">PUT /customer?pretty</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建文档</span></span><br><span class="line">PUT /customer/_doc/1?pretty</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;John Doe&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据ID查询文档</span></span><br><span class="line">GET /customer/_doc/1?pretty</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询所有文档</span></span><br><span class="line">GET /customer/_search?q=*&amp;sort=name:asc&amp;pretty</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看索引的mapping</span></span><br><span class="line">GET /customer/_mapping?pretty=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看索引的settings</span></span><br><span class="line">GET /customer/_settings?pretty=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /bookdb_index/book/_search?q=guide</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;multi_match&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;query&quot;</span> : <span class="string">&quot;guide&quot;</span>,</span><br><span class="line">            <span class="string">&quot;fields&quot;</span> : [<span class="string">&quot;_all&quot;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="查询2"><a href="#查询2" class="headerlink" title="查询2"></a>查询2</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询</span></span><br><span class="line">GET /crawl_log/_search/</span><br><span class="line">&#123; </span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 基本匹配</span></span><br><span class="line">GET /bookdb_index/book/_search?q=guide</span><br><span class="line"></span><br><span class="line">GET /bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;multi_match&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;query&quot;</span> : <span class="string">&quot;guide&quot;</span>,</span><br><span class="line">            <span class="string">&quot;fields&quot;</span> : [<span class="string">&quot;_all&quot;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 词条查询</span></span><br><span class="line">POST /bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;term&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;publisher&quot;</span>: <span class="string">&quot;manning&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;_source&quot;</span> : [<span class="string">&quot;title&quot;</span>,<span class="string">&quot;publish_date&quot;</span>,<span class="string">&quot;publisher&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多词条查询</span></span><br><span class="line">POST /bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;terms&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;publisher&quot;</span>: [<span class="string">&quot;oreilly&quot;</span>, <span class="string">&quot;packt&quot;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment"># 排序</span></span><br><span class="line">POST /bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;term&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;publisher&quot;</span>: <span class="string">&quot;manning&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;_source&quot;</span> : [<span class="string">&quot;title&quot;</span>,<span class="string">&quot;publish_date&quot;</span>,<span class="string">&quot;publisher&quot;</span>],</span><br><span class="line">    <span class="string">&quot;sort&quot;</span>: [</span><br><span class="line">        &#123; <span class="string">&quot;publish_date&quot;</span>: &#123;<span class="string">&quot;order&quot;</span>:<span class="string">&quot;desc&quot;</span>&#125;&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 范围查询</span></span><br><span class="line">POST /bookdb_index/book/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;range&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;publish_date&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;gte&quot;</span>: <span class="string">&quot;2015-01-01&quot;</span>,</span><br><span class="line">                <span class="string">&quot;lte&quot;</span>: <span class="string">&quot;2015-12-31&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;_source&quot;</span> : [<span class="string">&quot;title&quot;</span>,<span class="string">&quot;publish_date&quot;</span>,<span class="string">&quot;publisher&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="查询3"><a href="#查询3" class="headerlink" title="查询3"></a>查询3</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># match_all</span></span><br><span class="line">POST /crawl_log/_search</span><br><span class="line">&#123; </span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># term</span></span><br><span class="line">POST /crawl_log/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;term&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;task_id&quot;</span>:1</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># from size</span></span><br><span class="line">POST /crawl_log/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;term&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;task_id&quot;</span>:1</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;from&quot;</span>: 10,</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 10</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># match</span></span><br><span class="line">POST /crawl_log/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;message&quot;</span>: <span class="string">&quot;中埃建交五十周年&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># match_phase</span></span><br><span class="line">POST /crawl_log/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;match_phase&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;message&quot;</span>: <span class="string">&quot;中埃建交五十周年&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="日志查询"><a href="#日志查询" class="headerlink" title="日志查询"></a>日志查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;crawl_log</span><br><span class="line"></span><br><span class="line">GET &#x2F;crawl_log&#x2F;_search</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">POST &#x2F;crawl_log&#x2F;_search</span><br><span class="line">&#123; </span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST &#x2F;crawl_log&#x2F;_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [&#123;</span><br><span class="line">          &quot;term&quot;: &#123;</span><br><span class="line">            &quot;task_id&quot;: &quot;1&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;level_name&quot;: &quot;INFO&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;must_not&quot;: [],</span><br><span class="line">      &quot;should&quot;: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 10,</span><br><span class="line">  &quot;sort&quot;: [],</span><br><span class="line">  &quot;aggs&quot;: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="管理"><a href="#管理" class="headerlink" title="管理"></a>管理</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个索引</span></span><br><span class="line">PUT twitte</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;settings&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;number_of_shards&quot;</span> : 3,</span><br><span class="line">        <span class="string">&quot;number_of_replicas&quot;</span> : 2</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建mapping映射</span></span><br><span class="line">PUT twitte</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;settings&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;index&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;number_of_shards&quot;</span> : 3,</span><br><span class="line">            <span class="string">&quot;number_of_replicas&quot;</span> : 2</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">   <span class="string">&quot;mappings&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;type1&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;properties&quot;</span> : &#123;</span><br><span class="line">                <span class="string">&quot;field1&quot;</span> : &#123; <span class="string">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span> &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看索引的定义信息</span></span><br><span class="line">GET /twitte</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除索引</span></span><br><span class="line">DELETE /twitte</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="别名"><a href="#别名" class="headerlink" title="别名"></a>别名</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看别名</span></span><br><span class="line">GET /_cat/aliases</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加一个别名</span></span><br><span class="line">POST /_aliases</span><br><span class="line">&#123;<span class="string">&quot;actions&quot;</span>: [&#123;<span class="string">&quot;add&quot;</span>: &#123;<span class="string">&quot;index&quot;</span>: <span class="string">&quot;twitte&quot;</span>, <span class="string">&quot;alias&quot;</span>: <span class="string">&quot;alias1&quot;</span>&#125;&#125;]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除别名</span></span><br><span class="line">POST /_aliases</span><br><span class="line">&#123;<span class="string">&quot;actions&quot;</span>: [&#123;<span class="string">&quot;remove&quot;</span>: &#123;<span class="string">&quot;index&quot;</span>: <span class="string">&quot;twitte&quot;</span>, <span class="string">&quot;alias&quot;</span>: <span class="string">&quot;alias1&quot;</span>&#125;&#125;]&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一个别名对应多个索引</span></span><br><span class="line">POST /_aliases</span><br><span class="line">&#123;<span class="string">&quot;actions&quot;</span>: &#123;<span class="string">&quot;add&quot;</span>: &#123;<span class="string">&quot;indices&quot;</span>: [<span class="string">&quot;twitte&quot;</span>, <span class="string">&quot;twitte2&quot;</span>], <span class="string">&quot;alias&quot;</span>: <span class="string">&quot;alias1&quot;</span>&#125;&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一个别名对应多个索引(通配符)</span></span><br><span class="line">POST /_aliases</span><br><span class="line">&#123;<span class="string">&quot;actions&quot;</span>: [&#123;<span class="string">&quot;add&quot;</span>: &#123;<span class="string">&quot;index&quot;</span>: <span class="string">&quot;twitte*&quot;</span>, <span class="string">&quot;alias&quot;</span>: <span class="string">&quot;alias1&quot;</span>&#125;&#125;]&#125;</span><br></pre></td></tr></table></figure>
<h3 id="索引复制"><a href="#索引复制" class="headerlink" title="索引复制"></a>索引复制</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /_reindex?slices=9&amp;refresh&amp;wait_for_completion=false</span><br><span class="line"></span><br><span class="line">POST _reindex?wait_for_completion=false</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;source&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;crawl_log&quot;</span> </span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dest&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;crawl_log_bak&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="mapping"><a href="#mapping" class="headerlink" title="mapping"></a>mapping</h3><ul>
<li>字符串: text和keyword</li>
<li>整数 : byte, short, integer, long</li>
<li>浮点数: float, double</li>
<li>布尔型: boolean</li>
<li>日期: date</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建索引</span></span><br><span class="line">PUT /my-index</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;mappings&quot;</span> &#123;</span><br><span class="line">        <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;age&quot;</span>: &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;integer&quot;</span>&#125;,</span><br><span class="line">            <span class="string">&quot;email&quot;</span>: &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span>&#125;,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加字段</span></span><br><span class="line">PUT /my-index/_mapping</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;content&quot;</span>: &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="清空数据"><a href="#清空数据" class="headerlink" title="清空数据"></a>清空数据</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清空索引</span></span><br><span class="line">POST /policies_hydrabot/_delete_by_query?refresh&amp;slices=5&amp;pretty</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Curl请求示例"><a href="#Curl请求示例" class="headerlink" title="Curl请求示例"></a>Curl请求示例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &#39;http:&#x2F;&#x2F;localhost:9200&#x2F;_cat&#x2F;indices?v&#39;</span><br><span class="line">curl -X GET &#39;http:&#x2F;&#x2F;localhost:9200&#x2F;_mapping?pretty&#x3D;true&#39;</span><br><span class="line">curl -X GET &#39;http:&#x2F;&#x2F;localhost:9200&#x2F;crawl_log&#x2F;_mapping?pretty&#x3D;true&#39;</span><br><span class="line"></span><br><span class="line">curl -X PUT &#39;localhost:9200&#x2F;weather&#39;</span><br><span class="line"></span><br><span class="line">curl -X DELETE &#39;localhost:9200&#x2F;weather&#39;</span><br><span class="line"></span><br><span class="line">curl -X PUT &#39;http:&#x2F;&#x2F;localhost:9200&#x2F;accounts&#x2F;person&#x2F;1&#39; \</span><br><span class="line">-H &#39;Content-Type: application&#x2F;json&#39; \</span><br><span class="line">-d &#39;&#123;</span><br><span class="line">  &quot;user&quot;: &quot;张三&quot;,</span><br><span class="line">  &quot;title&quot;: &quot;工程师&quot;,</span><br><span class="line">  &quot;desc&quot;: &quot;数据库管理&quot;</span><br><span class="line">&#125;&#39; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">curl -X POST &#39;http:&#x2F;&#x2F;localhost:9200&#x2F;accounts&#x2F;person&#39; \</span><br><span class="line">-H &#39;Content-Type: application&#x2F;json&#39; \</span><br><span class="line">-d &#39;&#123;</span><br><span class="line">  &quot;user&quot;: &quot;李四&quot;,</span><br><span class="line">  &quot;title&quot;: &quot;工程师&quot;,</span><br><span class="line">  &quot;desc&quot;: &quot;系统管理&quot;</span><br><span class="line">&#125;&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">curl &#39;localhost:9200&#x2F;accounts&#x2F;person&#x2F;1?pretty&#x3D;true&#39;</span><br><span class="line">curl &#39;localhost:9200&#x2F;weather&#x2F;beijing&#x2F;abc?pretty&#x3D;true&#39;</span><br><span class="line"></span><br><span class="line">curl -X DELETE &#39;localhost:9200&#x2F;accounts&#x2F;person&#x2F;1&#39;</span><br><span class="line"></span><br><span class="line">curl &#39;localhost:9200&#x2F;accounts&#x2F;person&#x2F;_search&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">curl &#39;localhost:9200&#x2F;accounts&#x2F;person&#x2F;_search&#39;  \</span><br><span class="line">-H &#39;Content-Type: application&#x2F;json&#39; \</span><br><span class="line">-d &#39; </span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot; : &#123; &quot;match&quot; : &#123; &quot;desc&quot; : &quot;软件&quot; &#125;&#125;</span><br><span class="line">&#125;&#39;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/202110/MySQL5.6JSON%E8%A7%A3%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202110/MySQL5.6JSON%E8%A7%A3%E6%9E%90/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-02 14:48:13" itemprop="dateCreated datePublished" datetime="2022-11-02T14:48:13+08:00">2022-11-02</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MySQL5-6JSON解析"><a href="#MySQL5-6JSON解析" class="headerlink" title="MySQL5.6JSON解析"></a>MySQL5.6JSON解析</h1><h2 id="新建存储过程"><a href="#新建存储过程" class="headerlink" title="新建存储过程"></a>新建存储过程</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">DELIMITER $$</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">function</span> if <span class="keyword">exists</span> json_extract_c$$</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> json_extract_c(</span><br><span class="line">details TEXT,</span><br><span class="line">required_field <span class="type">VARCHAR</span> (<span class="number">255</span>)</span><br><span class="line">) <span class="keyword">RETURNS</span> TEXT CHARSET utf8mb4</span><br><span class="line"><span class="keyword">DETERMINISTIC</span></span><br><span class="line"><span class="keyword">NO</span> <span class="keyword">SQL</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">DECLARE</span> search_term, val TEXT;</span><br><span class="line">  <span class="keyword">DECLARE</span> pos <span class="type">INT</span> signed <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- Remove &#x27;&#123;&#x27; and &#x27;&#125;&#x27;</span></span><br><span class="line">  <span class="keyword">SET</span> details <span class="operator">=</span> SUBSTRING_INDEX(details, &quot;&#123;&quot;, <span class="number">-1</span>);</span><br><span class="line">  <span class="keyword">SET</span> details <span class="operator">=</span> SUBSTRING_INDEX(details, &quot;&#125;&quot;, <span class="number">1</span>);</span><br><span class="line">  <span class="comment">-- Transform &#x27;$.xx&#x27; to be &#x27;&quot;xx&quot;&#x27;</span></span><br><span class="line">  <span class="keyword">SET</span> search_term <span class="operator">=</span> CONCAT(<span class="string">&#x27;&quot;&#x27;</span>, SUBSTRING_INDEX(required_field,<span class="string">&#x27;$.&#x27;</span>, <span class="operator">-</span> <span class="number">1</span>), <span class="string">&#x27;&quot;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  searching: LOOP</span><br><span class="line">    <span class="keyword">SET</span> pos <span class="operator">=</span> LOCATE(search_term, details);</span><br><span class="line">    <span class="comment">-- Keep searching if the field contains escape chars</span></span><br><span class="line">    WHILE pos <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">AND</span> <span class="keyword">RIGHT</span>(<span class="keyword">LEFT</span>(details, pos<span class="number">-1</span>), <span class="number">1</span>) <span class="operator">=</span> <span class="string">&#x27;\\&#x27;</span></span><br><span class="line">    DO</span><br><span class="line">      <span class="keyword">SET</span> details <span class="operator">=</span> SUBSTR(details, pos<span class="operator">+</span>LENGTH(search_term));</span><br><span class="line">      <span class="keyword">SET</span> pos <span class="operator">=</span> LOCATE(search_term, details);</span><br><span class="line">    <span class="keyword">END</span> WHILE;</span><br><span class="line">    <span class="comment">-- Return NULL if not found</span></span><br><span class="line">    IF pos <span class="operator">&lt;=</span> <span class="number">0</span> <span class="keyword">THEN</span></span><br><span class="line">      <span class="keyword">RETURN</span> <span class="keyword">NULL</span>;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">SET</span> pos <span class="operator">=</span> LENGTH(search_term)<span class="operator">+</span>pos;</span><br><span class="line">    <span class="keyword">SET</span> details <span class="operator">=</span> SUBSTR(details, pos);</span><br><span class="line">    <span class="keyword">SET</span> val <span class="operator">=</span> <span class="built_in">TRIM</span>(details);</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- see if we reach the value that is a leading colon &#x27;:&#x27;</span></span><br><span class="line">    IF <span class="keyword">LEFT</span>(val, <span class="number">1</span>) <span class="operator">=</span> <span class="string">&#x27;:&#x27;</span> <span class="keyword">THEN</span></span><br><span class="line">      <span class="keyword">RETURN</span> <span class="built_in">TRIM</span>(</span><br><span class="line">        <span class="keyword">TRAILING</span> <span class="string">&#x27;,&#x27;</span> <span class="keyword">FROM</span> </span><br><span class="line">        <span class="built_in">TRIM</span>(</span><br><span class="line">          SUBSTRING_INDEX(</span><br><span class="line">            <span class="built_in">TRIM</span>(</span><br><span class="line">              <span class="keyword">BOTH</span> <span class="string">&#x27;&quot;&#x27;</span> <span class="keyword">FROM</span> <span class="built_in">TRIM</span>(</span><br><span class="line">                SUBSTR(</span><br><span class="line">                  val</span><br><span class="line">                , <span class="number">2</span></span><br><span class="line">                )</span><br><span class="line">              )</span><br><span class="line">            )</span><br><span class="line">          , <span class="string">&#x27;&quot;&#x27;</span>, <span class="number">1</span></span><br><span class="line">          )</span><br><span class="line">        )</span><br><span class="line">      );</span><br><span class="line">    <span class="keyword">ELSE</span></span><br><span class="line">      ITERATE searching;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line">  <span class="keyword">END</span> LOOP;</span><br><span class="line"><span class="keyword">END</span>$$</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> offer_id</span><br><span class="line">     , terms</span><br><span class="line">     , json_extract_c(terms, <span class="string">&#x27;qty&#x27;</span>) <span class="keyword">as</span> offer_qty  </span><br><span class="line">     , json_extract_c(terms, <span class="string">&#x27;discount&#x27;</span>) <span class="keyword">as</span> offer_discount</span><br><span class="line">     , json_extract_c(terms, <span class="string">&#x27;total&#x27;</span>) <span class="keyword">as</span> offer_total</span><br><span class="line"><span class="keyword">FROM</span> offer; </span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201612/AIX%E4%B8%8B%E9%9D%9Eroot%E5%AE%89%E8%A3%85sqlplus%E5%8F%8Amysql%E5%AE%A2%E6%88%B7%E7%AB%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201612/AIX%E4%B8%8B%E9%9D%9Eroot%E5%AE%89%E8%A3%85sqlplus%E5%8F%8Amysql%E5%AE%A2%E6%88%B7%E7%AB%AF/" class="post-title-link" itemprop="url">AIX下非root安装sqlplus及mysql客户端</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-01-26 09:44:33" itemprop="dateCreated datePublished" datetime="2021-01-26T09:44:33+08:00">2021-01-26</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>同事的一个新需求，需要在AIX上以shell脚本的方式，调用sqlplus客户端连接Oracle数据库，调用mysql客户端连接MySQL数据库。<br>想尽量简化开发，只用纯脚本方式实现，不想替换为Java或其它方案，且不想远程调用其它Linux主机上的客户端。<br>故需要在AIX上安装两个客户端（只有普通用户权限，没有root权限）。没什么太特别的地方，简单记录一下过程。   </p>
<h2 id="sqlplus客户端的安装"><a href="#sqlplus客户端的安装" class="headerlink" title="sqlplus客户端的安装"></a>sqlplus客户端的安装</h2><p>Oracle接供了AIX下的InstantClient二进制zip包，其中包含了sqlplus，安装起来比较简单，主要注意一下环境变量的设置。  </p>
<h3 id="下载InstantClient"><a href="#下载InstantClient" class="headerlink" title="下载InstantClient"></a>下载InstantClient</h3><p><a target="_blank" rel="noopener" href="http://www.oracle.com/technetwork/cn/database/features/instant-client/index-092699-zhs.html">这里是Oracle Instant Client的下载地址</a>  ，目前最新版本是11.2.0.1.0  </p>
<ol>
<li>首先根据系统，选择”适用于 AIX5L（64 位）的 Instant Client”<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/d3keo.jpg">  </li>
<li>然后再下载Basic和SQLPlus两个编译好的二进制包，注意两个都要下载<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/yl5kv.jpg">  </li>
</ol>
<h3 id="上传并解压"><a href="#上传并解压" class="headerlink" title="上传并解压"></a>上传并解压</h3><p>将下载好的两个包 <code>basic-11.2.0.1.0-aix-ppc64.zip</code> 和 <code>sqlplus-11.2.0.1.0-aix-ppc64.zip</code>上传至服务器，使用unzip解压至同一目录，例如： /path/to/instantclient。  </p>
<h3 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h3><p>编辑.profile文件，加入以下两行：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export PATH&#x3D;$PATH:&#x2F;path&#x2F;to&#x2F;instantclient</span><br><span class="line">export LIBPATH&#x3D;&#x2F;path&#x2F;to&#x2F;instantclient</span><br></pre></td></tr></table></figure>
<p>注意AIX下要设置LIBPATH环境变量，且只能填写InstantClient一个目录，不能用冒号分割加入其它目录。  </p>
<h2 id="mysql客户端的安装"><a href="#mysql客户端的安装" class="headerlink" title="mysql客户端的安装"></a>mysql客户端的安装</h2><p><a target="_blank" rel="noopener" href="http://dev.mysql.com/downloads/">MySQL官网</a> 目前只提供5.5~5.7的下载，且二进制ZIP包和RPM/DEB包主要针对Linux的各个发行版，没有对应的AIX版本。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/by3i2.jpg"><br>连源码包也是”Generic Linux”的，在AIX下编译的话编译器和依赖都会有问题。Google上可以搜索到MySQL 5.1版本在AIX下成功编译的<a target="_blank" rel="noopener" href="http://bluefinch-nl.blogspot.com/2014/05/installing-mysql-on-aix.html">案例</a>（需要一些trick），不过老源码目前在官网已经下载不到了。<br>第三方网站bullfreeware提供了5.5版本的RPM包。此种方式有安全风险，不过已经是唯一的方案了。  </p>
<h3 id="下载并处理RPM包"><a href="#下载并处理RPM包" class="headerlink" title="下载并处理RPM包"></a>下载并处理RPM包</h3><ol>
<li>在 <a target="_blank" rel="noopener" href="http://www.bullfreeware.com/affichage.php?id=1215">bullfreeware</a> 上下载MySQL5.5版本的客户端 <code>MySQL-client-5.5.10-1.aix5.3.ppc.rpm</code></li>
<li>因为我们是没有root权限的，所有无法直接安装rpm包，需要将包里的二进制内容提取出来直接拷贝到安装目录：<br>将rpm直接使用unzip解压，解出如下的目录结构：<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/trpgr.jpg"><br>直接将bin目录下的二进制文件取出来上传至服务器，路径例如： /path/to/mysqlclient</li>
</ol>
<h3 id="设置环境变量-1"><a href="#设置环境变量-1" class="headerlink" title="设置环境变量"></a>设置环境变量</h3><p>编辑.profile文件，加入PATH：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH&#x3D;$PATH:&#x2F;path&#x2F;to&#x2F;mysqlclient</span><br></pre></td></tr></table></figure>
<p>至此安装完毕  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201612/%E4%BD%BF%E7%94%A8MarkDown%E5%81%9A%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201612/%E4%BD%BF%E7%94%A8MarkDown%E5%81%9A%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">使用MarkDown做个人知识管理的一些心得</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-01-26 09:44:33" itemprop="dateCreated datePublished" datetime="2021-01-26T09:44:33+08:00">2021-01-26</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="什么是个人知识管理"><a href="#什么是个人知识管理" class="headerlink" title="什么是个人知识管理"></a>什么是个人知识管理</h2><p>个人知识管理，又名PKM（Personal Knowledge Management）, 是一种个人收集，验证，存储，搜索，提取，分享知识的过程。 –WIKI<br>PKM其实是一个很大的命题，包含了很多方面的内容。但我们每个人都在或多或少的使用它，都有自已的一些工具、心得。<br>以下仅讨论一下具体的笔记、摘录等文档的 <strong>编写</strong> 与 <strong>保存</strong>。  </p>
<h2 id="什么是MarkDown"><a href="#什么是MarkDown" class="headerlink" title="什么是MarkDown"></a>什么是MarkDown</h2><p>Markdown是一种轻量级标记语言，它允许人们“使用易读易写的纯文本格式编写文档，然后转换成有效的XHTML(或者HTML)文档”。这种语言吸收了很多在电子邮件中已有的纯文本标记的特性。<br>MarkDown第一眼看上去这个样子的：<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/czwie.jpg"><br>左侧是”源码”，右侧是渲染好的”结果”</p>
<h2 id="MarkDown的优势"><a href="#MarkDown的优势" class="headerlink" title="MarkDown的优势"></a>MarkDown的优势</h2><p>MarkDown有很多先天的优势，决定了它非常适合用来编写文档、记录笔记、撰写文章：  </p>
<ul>
<li>首先，MarkDown是 <strong>纯文本</strong> ，这意味着我们可以使用任何自已喜欢的文本编辑器来进行写作，例如vi/emacs/SublimeText/Atom/VsCode/记事本/EditPlus/UltraEdit等等。  </li>
<li>然后，MarkDown在纯文本的基础上，加入某些极其简单标记，例如用#表示一级标题，##表示二级标题等。相比起HTML，要简单的多，不会对文章内容造成过多的入侵。  </li>
<li>虽然没有官方机构，但MarkDown目前已经是事实上的标准，而且已经非常流行，在GitHub等网站中有很好的应用。  </li>
<li>市面上目前有许多优秀的MarkDown编辑器（或插件），可以提供更优雅、更舒适的写作体验。   </li>
<li>MarkDown很容易导出为HTML或PDF格式，而且大多数工具都可以提供自定义的样式。  </li>
</ul>
<h2 id="MarkDown语法速成"><a href="#MarkDown语法速成" class="headerlink" title="MarkDown语法速成"></a>MarkDown语法速成</h2><p>MarkDown语法非常简单，下面列出一些基本的标记：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">标题:  </span><br><span class="line"># 一级标题</span><br><span class="line">## 二级标题</span><br><span class="line">### 三级标题</span><br><span class="line">#### 四级标题</span><br><span class="line">##### 五级标题</span><br><span class="line">###### 六级标题</span><br><span class="line"></span><br><span class="line">文字样式：  </span><br><span class="line">**用两个星号标记起来，表示加粗**</span><br><span class="line">*一个星号，表示斜体*</span><br><span class="line">~~这样子表示删除线~~</span><br><span class="line"></span><br><span class="line">插入链接：  </span><br><span class="line">[链接名称](http:&#x2F;&#x2F;url.com&#x2F;)</span><br><span class="line"></span><br><span class="line">邮箱链接:  </span><br><span class="line">&lt;myname@example.com&gt;</span><br><span class="line"></span><br><span class="line">插入图片：  </span><br><span class="line">![图片的信息，可为空](这里是图片的url，可以是本地路径，也可以是远程URL)</span><br><span class="line"></span><br><span class="line">无序列表:  </span><br><span class="line">-   Red</span><br><span class="line">-   Green</span><br><span class="line">-   Blue</span><br><span class="line"></span><br><span class="line">有序列表：  </span><br><span class="line">1.  Bird</span><br><span class="line">2.  McHale</span><br><span class="line">3.  Parish</span><br><span class="line"></span><br><span class="line">内容引用：  </span><br><span class="line">&gt; 你</span><br><span class="line">&gt; 一会看我</span><br><span class="line">&gt; 一会看云</span><br><span class="line">&gt;  我觉得</span><br><span class="line">&gt;  你看我时很远</span><br><span class="line">&gt;  你看云时很近</span><br><span class="line"></span><br><span class="line">分割线：  </span><br><span class="line">&#96;-&#96;加上空格组成，三个以上</span><br><span class="line">- - - - - -</span><br><span class="line"></span><br><span class="line">代码高亮：  </span><br><span class="line">使用3个连续的&#96;，将代码内容包起来</span><br><span class="line">&#96; &#96; &#96;</span><br><span class="line">s &#x3D; &#39;hello world&#39;</span><br><span class="line">&#96; &#96; &#96;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="选择适合自已的编辑器"><a href="#选择适合自已的编辑器" class="headerlink" title="选择适合自已的编辑器"></a>选择适合自已的编辑器</h2><p>MarkDown不需要专门工具就可以编写，任何纯文本编辑器都可以胜任。但选择一款适合自已的工具可以提供代码高亮，实时预览，自定义主题，PDF导出等高级功能，极大的提升我们的写作体验。<br>以下列出一些比较热门的工具：  </p>
<p><strong>全平台：</strong><br><a target="_blank" rel="noopener" href="https://atom.io/">Atom</a>  不用过多介绍了，GitHub出品，被称为是新时代的文本编辑器，Emacs的精神继承者。通过非富的插件，很好的支持MarkDown，并提供了无限的可能性。<br><a target="_blank" rel="noopener" href="https://www.sublimetext.com/3">Sublime Text 3</a>  更不用介绍了，同样是利用插件支持。<br><a target="_blank" rel="noopener" href="http://markeditor.com/app/markeditor">MarkEditor</a>  商业软件，使用Electron写的跨平台应用。功能强大，缺点是启动速度较慢。  </p>
<p><strong>Mac平台：</strong><br><a target="_blank" rel="noopener" href="http://zh.mweb.im/">Mweb</a>  商业软件，作者是国人。<br><a target="_blank" rel="noopener" href="http://25.io/mou/">Mou</a>  商业软件，Mac下老牌的编辑器了。<br><a target="_blank" rel="noopener" href="http://macdown.uranusjr.com/">MacDown</a>    功能与Mou基本相同，免费使用。<br><a target="_blank" rel="noopener" href="http://www.typora.io/">Typora</a>  所见即所得的编辑器，输入MarkDown标记后会立刻渲染出结果。  </p>
<p><strong>Win平台：</strong><br><a target="_blank" rel="noopener" href="http://markdownpad.com/">MarkdownPad</a>  Win下的工具比较少，这是个不错的。  </p>
<p>目前笔者常用的是Atom，跨平台，可以很好在工作在macOS和Ubuntu上。另外因为是通用型的编辑器，且插件非富，不仅限于写MarkDown，其它工作也可以胜任。<br>上面提到的工具各有特色，可以都试用一下再选一款适合自已的。  </p>
<h2 id="使用七牛云保存图片"><a href="#使用七牛云保存图片" class="headerlink" title="使用七牛云保存图片"></a>使用七牛云保存图片</h2><p>因为MarkDown是纯文本格式，所以决定了它不可能像Microsoft Word那样内嵌图片。<br>虽然在平时使用MarkDown做个人知识记录的过程中，是极少使用图片的。但如果要撰写给别人看的博客、教程一类的文档，有一些图片总是好的。<br>MarkDown可以使用本地图片，也可以使用URL远程图片。  </p>
<p>不推荐使用本地图片，虽然图片保存在本地比扔在图床上更”安全”，丢失的风险更小，但本地散乱图片会增加我们文件夹的容量，增加文档管理的难度。而且包含本地图片的文章要发布到博客上时，通常需要一张张手工上传图片，费时费力。<br>所以选择一个靠谱的图床，将图片上传后，以URL的方式嵌入MarkDown是最佳选择。鉴于国内的网络环境，以及前一段时间各大云存储厂商的所做所为，国内靠谱的图床确实不多，这里只推荐 <a target="_blank" rel="noopener" href="http://www.qiniu.com/">七牛云</a>。<br>七牛云的CEO是许式伟，曾是金山WPS2005的首席架构师，大神级的人物，所以七牛云的技术方面我们不用过多担心。重度用户可以适当付费支持一下，让七牛云良性的发展下去。<br>七牛云不仅仅是图片存储这么简单，具体的特性不一一介绍了，注册后可以慢慢在官网上看文档。  </p>
<h2 id="使用iPic快速上传图片"><a href="#使用iPic快速上传图片" class="headerlink" title="使用iPic快速上传图片"></a>使用iPic快速上传图片</h2><p>解决了图床的问题，再来看一下如何使用工具快速将图片上传，并获取生成的URL。<br>因为每插入一张图片，都要找开网站，点击上传按钮，找到存在本地磁盘上的图片，点击确定，成功后然后再把URL复制下来，实在是很繁琐。<br>这里推荐一个Mac下的小工具 <a target="_blank" rel="noopener" href="https://toolinbox.net/iPic/">iPic</a> ，下面是一个演示动画：<br><a target="_blank" rel="noopener" href="https://ww2.sinaimg.cn/large/006tNc79gw1fah02zweq2g30j60as7wh.gif">https://ww2.sinaimg.cn/large/006tNc79gw1fah02zweq2g30j60as7wh.gif</a><br>除了拖拽，还有更快捷的操作方式，只要选中本地图片或者复制网页中的图片，然后按下Command+U快捷键就可自动上传并获取URL。</p>
<h2 id="使用坚果云保存文档并同步"><a href="#使用坚果云保存文档并同步" class="headerlink" title="使用坚果云保存文档并同步"></a>使用坚果云保存文档并同步</h2><p>MarkDown文档写好了，保存在本地。一切看上去都很美好，但接下来，我们又有了更多的需求：  </p>
<ol>
<li>重要的文档，特别是我们辛辛苦苦多年积累下来的知识，只保存在本地是不安全的。不要把鸡蛋放在同一个篮子里，要把它备份到云端。  </li>
<li>要实现多设备间的同步，这样在手机上、iPad上、家里的电脑上可以随时查阅、修改。  </li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.jianguoyun.com/">坚果云</a> 是国内一款非常类似于DropBox的云存储应用，它提供了 <strong>全平台</strong> 的非常 <strong>快速</strong> 且 <strong>稳定</strong> 的 <strong>增量同步</strong> 功能。<br>坚果云可以说是国内硕果仅存的一家了，它的增量同步在国内做的是最好的，与百度云等不同，它专注于”同步”，而不是电影等大文件的存储。<br>坚果云的客户端做的也是非常用心，Linux下可以全功能完美使用。手机和iPad上的APP做的也不错。希望坚果云好好存活下去。<br>坚果云的使用非常简单，这里有一个视频教程：<br><a target="_blank" rel="noopener" href="http://help.jianguoyun.com/?p=1964">视频教程链接</a>  </p>
<h2 id="为什么不直接使用云笔记"><a href="#为什么不直接使用云笔记" class="headerlink" title="为什么不直接使用云笔记"></a>为什么不直接使用云笔记</h2><p>目前市面上有非常多的跨平台的云笔记工具可以做到上面的事情，而且可能做的更好。 例如为知笔记、有道云笔记、EverNote、EssentialPIM等，另外还有一些后起之秀。<br>为什么还要使用 MarkDown + 坚果云 这样看上去略显繁琐的组合？  </p>
<ul>
<li>我需要用纯文的方式来管理知识<br>MarkDown相对来说比较”单纯”，而且又有表达”样式”的能力。举个例子，就像我们写代码，当然是要保存”源码”，而不是编译好的”二进制文件”。<br>我们对纯文本有绝对的控制能力，纯文本方便检索，更重要的是方便日后的加工，可以导出PDF、HTML，可以分享发布到博客和专栏。    </li>
<li>我需要一个能随时替换掉的云服务<br>云服务并不可靠，目前大部分国外的服务已经被封锁，国内的因为没有良好的盈利模式，也纷纷关闭，所以不要重度依赖云。既然MarkDown文档首先保存在本地，掌握在自已手中，这也就意味着我可以使用任何云同步服务，不仅仅是坚果云，还可以是OneDrive、DropBox、iCloud，甚至是自已在VPS上搭建的私有Git。</li>
<li>我为什么抛弃了云笔记软件<br>之前使用过的工具中，为知笔记是我最喜爱的（个人认为比EverNote做的要更好）。但它也是有一些缺点的，例如虽然支持MarkDown编写，但本质上还是会保存成HTML富文本。另外它的Mac版做的不如Win版优秀，Linux版也不友好。<br>另外，使用第三方的工具，所有数据保存在云端，在本地没有原始档的备份，会让人有一种深深的”不安感”。再加上很多工具不提供”导出”功能，这意味着我们一旦使用某个工具，就要一直用下去，谁也无法保证5年后这个厂家还能不能存活下来，继续为我们提供服务。  </li>
<li>个人知识管理，不是简单的将文档编写并保存<br>接下来，我们会对它进行搜索，加工，导出，分享，而这正是MarkDown的优势所在。  </li>
</ul>
<p>基于以上几点，我最终选择了使用 MarkDown + 坚果云 这样的组合进行个人知识管理，并准备长期使用下去。  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201612/Git%E5%86%85%E9%83%A8%E5%9F%B9%E8%AE%AD%E8%AF%BE%E4%BB%B6-%E5%85%AC%E5%BC%80%E7%89%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201612/Git%E5%86%85%E9%83%A8%E5%9F%B9%E8%AE%AD%E8%AF%BE%E4%BB%B6-%E5%85%AC%E5%BC%80%E7%89%88/" class="post-title-link" itemprop="url">Git内部培训课件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-01-26 09:44:33" itemprop="dateCreated datePublished" datetime="2021-01-26T09:44:33+08:00">2021-01-26</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Git简介"><a href="#Git简介" class="headerlink" title="Git简介"></a>Git简介</h2><h3 id="什么是版本控制"><a href="#什么是版本控制" class="headerlink" title="什么是版本控制"></a>什么是版本控制</h3><p>版本控制系统（Version Control System，简称VCS）是一种记录一个或若干文件内容变化，以便将来查阅特定版本修订情况的系统。</p>
<p>按类型可以分为：  </p>
<ul>
<li><p>本地版本控制系统<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/2016-12-08-18333fig0101-tn.png"><br>例如RCS（至少我是从来没有用过）<br>本地版本控制系统解决了版本的管理问题，再也不用时不时的把工程目录，通过手工拷贝的方式来存档了。但本地版本控制系统的缺点是，无法解决多人协作的问题。</p>
</li>
<li><p>集中化的版本控制系统<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/2016-12-08-011528.jpg"><br>例如CVS，SVN等（公司中SVN应该用的比较多）<br>有一个集中管理的服务器，所有开发人员通过客户端连到这台服务器，取出最新的 <strong>文件</strong> 或者提交更新。管理员可以掌控每个开发者的权限。<br>集中化的VCS不但解决了版本控制问题，还可以多人协作。但缺点也是有的，就是太依赖于远程服务器，CVS服务器宕机后，会影响所有人的工作。版本记录只保存在一台服务器上，会有数据丢失风险。</p>
</li>
<li><p>分布式版本控制系统<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/2016-12-08-011814.jpg"><br>例如Git<br>客户端并不只提取最新版本的文件，而是把 <strong>代码仓库</strong> 完整地镜像下来。每一次的提取操作，实际上都是一次对 <strong>代码仓库</strong> 的完整备份。<br>所以并没有”中心服务器”的概念，所谓的”Git服务器”，也同每个人的电脑一样，只是为了多人协作时，方便大家交换数据而已。    </p>
</li>
</ul>
<h3 id="什么是Git"><a href="#什么是Git" class="headerlink" title="什么是Git"></a>什么是Git</h3><p>Git是目前世界上最先进的分布式版本控制系统（没有之一）<br>好不好用，看看它的开发者是谁就知道了：Linux之父 Linus Torvalds</p>
<p>小历史： Linux内核社区原本使用的是名为BitKeeper的商业化版本控制工具，2005年，因为社区内有人试图破解BitKeeper的协议，BitMover公司收回了免费使用BitKeeper的权力。<br>Linus原本可以出面道个歉，继续使用BitKeeper，然而并没有。。。Linus大神仅用了两周时间，自已用C写了一个分布式版本控制系统，于是Git诞生了！<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/2016-12-08-015752.jpg">  </p>
<h3 id="为什么要使用Git"><a href="#为什么要使用Git" class="headerlink" title="为什么要使用Git"></a>为什么要使用Git</h3><p>为什么要使用Git，或者说Git相比SVN有什么优势呢？</p>
<ul>
<li><p>分布式<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/dkkiz.jpg">  </p>
</li>
<li><p>分支管理<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/wirgm.jpg">  </p>
</li>
<li><p>GitHub<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/pr68v.jpg"></p>
</li>
</ul>
<h3 id="安装Git"><a href="#安装Git" class="headerlink" title="安装Git"></a>安装Git</h3><ul>
<li>大多数Linux发行版已经预装了Git，系统默认自带，如果不带。。可以源码make安装或使用yum/apt等直接安装，过程不赘述了。  </li>
<li>macOS下，安装Xcode后，它的CLI工具里应该会包含Git了。或者使用brew手工安装一下。</li>
<li>Windows下，可以直接下载安装 <a target="_blank" rel="noopener" href="https://git-for-windows.github.io/">msysGit</a> 。  或者如果你的机器上已经有Cygwin，也可以直接用在它下面安装Git。  </li>
<li>图形工具推荐使用 <a target="_blank" rel="noopener" href="https://www.sourcetreeapp.com/">SourceTree</a>，查看分支非常直观 。IntelliJ IDEA等IDE也会自带一些图形化的工具，在合并代码时很高效。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/p69yw.jpg"></li>
</ul>
<h3 id="学习路径"><a href="#学习路径" class="headerlink" title="学习路径"></a>学习路径</h3><ul>
<li>首先，忘掉SVN/CVS，不要把Git的各种操作与它们做类比，切记。  </li>
<li>刚开始不要依赖图形客户端。首先应该将精力用在理解原理上 -&gt; 然后掌握一些基本CLI命令，动手操作实践 -&gt; 最后在实际工作中使用GUI工具以提高效率。  </li>
<li>重度Windows用户使用Git时，与平时熟悉GUI的环境会有些违和感，毕竟Git是Linux下的产物，Git遵循Linux的哲学，Simple，简单直接，但Simple并不等于Easy。需要转换一下思维。</li>
</ul>
<h2 id="了解Git的工作原理"><a href="#了解Git的工作原理" class="headerlink" title="了解Git的工作原理"></a>了解Git的工作原理</h2><h3 id="记录文件整体快照"><a href="#记录文件整体快照" class="headerlink" title="记录文件整体快照"></a>记录文件整体快照</h3><p>Git和其他版本控制系统的主要差别在于，Git只关心文件数据的 <strong>整体</strong> 是否发生变化，而大多数其他系统则只关心 <strong>文件内容</strong> 的具体差异。</p>
<p>SVN在每个版本中，以单一文件为单位，记录各个文件的差异：<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/8wm7e.jpg"></p>
<p>Git在每个版本中，以当时的全部文件为单位，记录一个快照：<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/ufspp.jpg"></p>
<h3 id="大多数操作都在本地执行"><a href="#大多数操作都在本地执行" class="headerlink" title="大多数操作都在本地执行"></a>大多数操作都在本地执行</h3><p>Git的绝大多数操作都只需要访问本地文件和资源，不用连网。因为你的本机上，就已经是完整的代码库了。这样一来，在无法连接公司内网的环境中，也可以愉快的写代码了。<br>例如，如果想看当前版本的文件和一个月前的版本之间有何差异，Git会取出一个月前的快照和当前文件作一次差异运算，而不用每次都请求远程服务器。</p>
<h3 id="时刻保持数据完整性"><a href="#时刻保持数据完整性" class="headerlink" title="时刻保持数据完整性"></a>时刻保持数据完整性</h3><p>在保存到Git之前，所有数据都要进行内容的校验和（checksum）计算，并将此结果作为数据的唯一标识和索引。<br>这项特性作为Git的设计哲学，建在整体架构的最底层。所以如果文件在传输时变得不完整，或者磁盘损坏导致文件数据缺失，Git都能立即察觉。<br>Git使用SHA-1算法计算数据的校验和，通过对文件的内容或目录的结构计算出一个SHA-1哈希值，作为指纹字符串。该字串由40个十六进制字符组成，看起来就像是：<br><code>24b9da6552252987aa493b52f8696cd6d3b00373</code><br>Git的工作完全依赖于这类指纹字串，所以你会经常看到这样的哈希值。实际上，所有保存在 Git数据库中的东西都是用此哈希值来作索引的，而不是靠文件名。</p>
<h3 id="多数操作仅添加数据"><a href="#多数操作仅添加数据" class="headerlink" title="多数操作仅添加数据"></a>多数操作仅添加数据</h3><p>常用的Git操作大多仅仅是把数据添加到数据库，很难让Git执行任何不可逆操作。在Git中一旦提交快照之后就完全不用担心丢失数据，特别是养成定期推送到其他仓库的习惯的话。  </p>
<h3 id="文件的三种状态"><a href="#文件的三种状态" class="headerlink" title="文件的三种状态"></a>文件的三种状态</h3><p>对于任何一个文件，在 Git 内都只有三种状态：已提交（committed） 已修改（modified） 已暂存（staged）<br>已提交表示该文件已经被安全地保存在本地数据库中了；<br>已修改表示修改了某个文件，但还没有提交保存；<br>已暂存表示把已修改的文件放在下次提交时要保存的清单中。  </p>
<p>由此我们看到 Git 管理项目时，文件流转的三个工作区域：Git 的工作目录，暂存区域，以及本地仓库。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/7fm9z.jpg"></p>
<p>每个项目都有一个名为.git的目录，它是 Git用来保存元数据和对象数据库的地方。该目录非常重要，每次克隆镜像仓库的时候，实际拷贝的就是这个目录里面的数据。<br>从项目中取出某个版本的所有文件和目录，用以开始后续工作的叫做工作目录。这些文件实际上都是从Git目录中的压缩对象数据库中提取出来的，接下来就可以在工作目录中对这些文件进行编辑。<br>所谓的暂存区域只不过是个简单的文件，一般都放在 Git 目录中。有时候人们会把这个文件叫做索引文件，不过标准说法还是叫暂存区域。  </p>
<p>基本的 Git 工作流程如下：  </p>
<ol>
<li>在工作目录中修改某些文件。</li>
<li>对修改后的文件进行快照，然后保存到暂存区域。</li>
<li>提交更新，将保存在暂存区域的文件快照永久转储到 Git 目录中。</li>
</ol>
<p>所以，我们可以从文件所处的位置来判断状态：如果是Git目录中保存着的特定版本文件，就属于已提交状态；如果作了修改并已放入暂存区域，就属于已暂存状态；如果自上次取出后，作了修改但还没有放到暂存区域，就是已修改状态。</p>
<h2 id="创建版本库"><a href="#创建版本库" class="headerlink" title="创建版本库"></a>创建版本库</h2><p>有两种取得Git项目仓库的方法。第一种是在现存的目录下，通过导入所有文件来创建新的Git仓库。 第二种是从已有的Git仓库克隆出一个新的镜像仓库来。</p>
<h3 id="在目录中创建新仓库"><a href="#在目录中创建新仓库" class="headerlink" title="在目录中创建新仓库"></a>在目录中创建新仓库</h3><p>如果一个目录还没有使用Git进行管理，只需到此项目所在的目录，执行<code>git init</code>，初始化后，在当前目录下会出现一个名为.git的目录  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir learngit</span><br><span class="line">$ cd learngit</span><br><span class="line">$ git init</span><br></pre></td></tr></table></figure>
<h3 id="从已有的仓库克隆"><a href="#从已有的仓库克隆" class="headerlink" title="从已有的仓库克隆"></a>从已有的仓库克隆</h3><p>如果Git项目已经存在，可以使用<code>git clone</code>从远程服务器上复制一份出来，Git支持多种协议：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git clone mobgit@134.32.51.60:learngit.git  #使用SSH传输协议</span><br><span class="line">$ git clone git:&#x2F;&#x2F;134.32.51.60&#x2F;learngit.git  #使用Git传输协议</span><br><span class="line">$ git clone https:&#x2F;&#x2F;134.32.51.60&#x2F;learngit.git  #使用HTTPS传输协议</span><br></pre></td></tr></table></figure>

<h2 id="版本库基本操作"><a href="#版本库基本操作" class="headerlink" title="版本库基本操作"></a>版本库基本操作</h2><h3 id="检查当前文件状态"><a href="#检查当前文件状态" class="headerlink" title="检查当前文件状态"></a>检查当前文件状态</h3><p>使用<code>git status</code>命令可以查看文件的状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Initial commit</span><br><span class="line">nothing to commit (create&#x2F;copy files and use &quot;git add&quot; to track)</span><br></pre></td></tr></table></figure>
<p>出现如上的提示，说明现在的工作目录相当干净，所有已跟踪文件在上次提交后都未被更改过。</p>
<p>现在我们做一些改动，添加一个readme.txt进去，然后再看一下状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ cat&gt;readme.txt</span><br><span class="line">hello git</span><br><span class="line">^C</span><br><span class="line"></span><br><span class="line">git status</span><br><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">Initial commit</span><br><span class="line"></span><br><span class="line">Untracked files:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line">	readme.txt</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use &quot;git add&quot; to track)</span><br></pre></td></tr></table></figure>
<p>Untracked files显示了这个新创建的readme.txt处于未跟跟踪状态</p>
<h3 id="跟踪新文件"><a href="#跟踪新文件" class="headerlink" title="跟踪新文件"></a>跟踪新文件</h3><p>使用<code>git add</code>命令开始跟踪一个新文件  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">Initial commit</span><br><span class="line"></span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git rm --cached &lt;file&gt;...&quot; to unstage)</span><br><span class="line"></span><br><span class="line">	new file:   readme.txt</span><br></pre></td></tr></table></figure>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/5ixt6.jpg"><br>readme.txt已 <strong>被跟踪</strong> ，并处于 <strong>暂存状态</strong></p>
<h3 id="将本次修改暂存"><a href="#将本次修改暂存" class="headerlink" title="将本次修改暂存"></a>将本次修改暂存</h3><p>现在我们再对readme.txt进行修改，添加一行，再执行<code>git status</code>查看状态  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">Initial commit</span><br><span class="line"></span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git rm --cached &lt;file&gt;...&quot; to unstage)</span><br><span class="line"></span><br><span class="line">	new file:   readme.txt</span><br><span class="line"></span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line"></span><br><span class="line">	modified:   readme.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/z7r01.jpg"></p>
<p>可以看到readme.txt 不仅出现在了Changes to be committed，还出现在了Changes not staged for commit<br>由此可见，Git关心的是 <strong>Changes</strong> ，而不是文件本身。<br>再次执行<code>git add</code>，可以将 <strong>本次修改</strong> 提交到暂存区，Changes not staged for commit提示消失<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/ha8wl.jpg"></p>
<h3 id="提交更新"><a href="#提交更新" class="headerlink" title="提交更新"></a>提交更新</h3><p>使用<code>git commit</code>命令将暂存区中的内容提交至版本库，工作区又是干净的了  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m &quot;my first commit&quot;</span><br><span class="line">[master (root-commit) 6c8912a] my first commit</span><br><span class="line"> 1 file changed, 2 insertions(+)</span><br><span class="line"> create mode 100644 readme.txt</span><br><span class="line"></span><br><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is based on &#39;origin&#x2F;master&#39;, but the upstream is gone.</span><br><span class="line">  (use &quot;git branch --unset-upstream&quot; to fixup)</span><br><span class="line">nothing to commit, working tree clean</span><br></pre></td></tr></table></figure>
<p>注意：一定要使用-m参数加入注释，认真描述本次的提交具体做了些什么，这对于以后我们查询历史记录非常重要。  </p>
<p>如果觉得使用暂存区过于繁琐，可以在commit时直接使用-a参数，Git就会自动把所有已经跟踪过的文件暂存起来一并提交，从而跳过git add步骤。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -a -m &quot;my first commit&quot;</span><br></pre></td></tr></table></figure>
<h3 id="查看历史"><a href="#查看历史" class="headerlink" title="查看历史"></a>查看历史</h3><p>使用<code>git log</code>命令可以查看历史记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git log</span><br><span class="line">commit 43c5d337ffdd76f33ce5f5f90103d57e55474956</span><br><span class="line">Author: BlueXIII &lt;bluexiii@163.com&gt;</span><br><span class="line">Date:   Thu Dec 8 14:45:59 2016 +0800</span><br><span class="line"></span><br><span class="line">    this is my second commit</span><br><span class="line"></span><br><span class="line">commit 6c8912ad2a8e90a7ba32cc8578fd0069a205221b</span><br><span class="line">Author: BlueXIII &lt;bluexiii@163.com&gt;</span><br><span class="line">Date:   Thu Dec 8 14:38:09 2016 +0800</span><br><span class="line"></span><br><span class="line">    my first commit</span><br></pre></td></tr></table></figure>
<p>可以看到，每次更新都有一个SHA-1校验和、作者的名字和电子邮件地址、提交时间、提交说明。</p>
<h3 id="撤消操作"><a href="#撤消操作" class="headerlink" title="撤消操作"></a>撤消操作</h3><p>撤消操作在这里这里不做重点描述了，只列出几个常用命令。<br>修改最后一次提交：<br>git commit –amend<br>取消已经暂存的文件：<br>git reset HEAD readme.txt<br>取消对文件的修改：<br>git checkout – readme.txt</p>
<h2 id="远程仓库"><a href="#远程仓库" class="headerlink" title="远程仓库"></a>远程仓库</h2><p>之前介绍了在本地仓库的一些操作。但当与他人协作开发某个项目时，需要至少使用一个远程仓库，以便推送或拉取数据，分享各自的工作进展。  </p>
<h3 id="克隆远程库"><a href="#克隆远程库" class="headerlink" title="克隆远程库"></a>克隆远程库</h3><p>之前已经在讲新建仓库时已经提到，如何克隆远程库，这里再重复列一遍：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git clone mobgit@134.32.51.60:learngit.git  #使用SSH传输协议</span><br><span class="line">$ git clone git:&#x2F;&#x2F;134.32.51.60&#x2F;learngit.git  #使用Git传输协议</span><br><span class="line">$ git clone https:&#x2F;&#x2F;134.32.51.60&#x2F;learngit.git  #使用HTTPS传输协议</span><br></pre></td></tr></table></figure>
<h3 id="查看绑定的远程库"><a href="#查看绑定的远程库" class="headerlink" title="查看绑定的远程库"></a>查看绑定的远程库</h3><p>如果之前我们使用的<code>git clone</code>命令直接克隆了一个远程仓库到本机，Git就已经默认绑定了一个名为origin的远程库。当然我们还可以手工绑定其它远程库，远程仓库可以有多个。<br>使用<code>git remote -v</code>命令列出我们绑定了哪些远程库：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git remote -v</span><br><span class="line">origin	mobgit@134.32.51.60:learngit.git (fetch)</span><br><span class="line">origin	mobgit@134.32.51.60:learngit.git (push)</span><br></pre></td></tr></table></figure>
<p>接下来还可以使用<code>git remote show origin</code>来查看这个名为origin的远程库的更详细的信息，这里先不细讲  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ git remote show origin</span><br><span class="line">* remote origin</span><br><span class="line">  Fetch URL: mobgit@134.32.51.60:learngit.git</span><br><span class="line">  Push  URL: mobgit@134.32.51.60:learngit.git</span><br><span class="line">  HEAD branch (remote HEAD is ambiguous, may be one of the following):</span><br><span class="line">    dev</span><br><span class="line">    master</span><br><span class="line">    serverfix</span><br><span class="line">    serverfix2</span><br><span class="line">  Remote branches:</span><br><span class="line">    dev        tracked</span><br><span class="line">    master     tracked</span><br><span class="line">    serverfix  tracked</span><br><span class="line">    serverfix2 tracked</span><br><span class="line">  Local branches configured for &#39;git pull&#39;:</span><br><span class="line">    dev        merges with remote dev</span><br><span class="line">    master     merges with remote master</span><br><span class="line">    serverfix  merges with remote serverfix</span><br><span class="line">    serverfix2 merges with remote serverfix2</span><br><span class="line">  Local refs configured for &#39;git push&#39;:</span><br><span class="line">    dev        pushes to dev        (up to date)</span><br><span class="line">    master     pushes to master     (up to date)</span><br><span class="line">    serverfix  pushes to serverfix  (up to date)</span><br><span class="line">    serverfix2 pushes to serverfix2 (up to date)</span><br></pre></td></tr></table></figure>
<h3 id="手工添加一个远程仓库"><a href="#手工添加一个远程仓库" class="headerlink" title="手工添加一个远程仓库"></a>手工添加一个远程仓库</h3><p>我们先让管理员新建一个名为learngit2的远程仓库，再使用<code>remote add</code>命令将它添加进来，取名为repo2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add repo2 mobgit@134.32.51.60:learngit2.git</span><br><span class="line"></span><br><span class="line">$ git remote -v</span><br><span class="line">origin	mobgit@134.32.51.60:learngit.git (fetch)</span><br><span class="line">origin	mobgit@134.32.51.60:learngit.git (push)</span><br><span class="line">repo2	mobgit@134.32.51.60:learngit2.git (fetch)</span><br><span class="line">repo2	mobgit@134.32.51.60:learngit2.git (push)</span><br></pre></td></tr></table></figure>
<p>现在我们有origin和repo2两个远程仓库了</p>
<h3 id="从远程仓库抓取数据"><a href="#从远程仓库抓取数据" class="headerlink" title="从远程仓库抓取数据"></a>从远程仓库抓取数据</h3><p>使用<code>git fetch [remote-name]</code>从远程仓库抓取数据，注意fetch命令只是将远端的数据拉到本地仓库，并不自动合并到当前工作分支(关于分支稍后讲解)<br>例如要抓取名为origin远程仓库：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch origin</span><br></pre></td></tr></table></figure>
<h3 id="推送数据到远程仓库"><a href="#推送数据到远程仓库" class="headerlink" title="推送数据到远程仓库"></a>推送数据到远程仓库</h3><p>使用<code>git push [remote-name] [branch-name]</code>将本机的工作成果推送到远程仓库<br>例如要将本地的master分支推送到origin远程仓库上：    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin master</span><br></pre></td></tr></table></figure>
<h2 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h2><p>也许到之前为止，大家会觉得Git和Svn除了实现原理不同以及实现了分布式之外，在日常使用上并没有什么太大的区别（甚至更繁琐）。但接下来的分支，才是Git的精髓部分。  </p>
<h3 id="为什么要使用分支"><a href="#为什么要使用分支" class="headerlink" title="为什么要使用分支"></a>为什么要使用分支</h3><p>举个简单的例子：假设你准备开发一个新功能，但是需要两周才能完成，第一周你写了50%的代码，如果立刻提交，由于代码还没写完，不完整的代码库会导致别人不能干活了。如果等代码全部写完再一次提交，又存在丢失每天进度的巨大风险。<br>于是你创建了一个属于你自己的分支，别人看不到，还继续在原来的分支上正常工作，而你在自己的分支上干活，想提交就提交，直到开发完毕后，再一次性合并到原来的分支上，这样，既安全，又不影响别人工作。<br>相比于Svn等工具，Git创建、切换分支的开销是非常小的，Git鼓励 <strong>频繁使用分支</strong>  </p>
<h3 id="分支的原理"><a href="#分支的原理" class="headerlink" title="分支的原理"></a>分支的原理</h3><p>要理解分支，需要继续深入一下Git的工作原理</p>
<h4 id="Git如何储存数据"><a href="#Git如何储存数据" class="headerlink" title="Git如何储存数据"></a>Git如何储存数据</h4><p>在Git中提交时，会保存一个提交对象（commit object），该对象包含一个指向暂存内容快照的指针，并同时包含本次提交的作者等相关附属信息，包含零个或多个指向该提交对象的父对象指针（首次提交是没有直接祖先的，普通提交有一个祖先，由两个或多个分支合并产生的提交则有多个祖先）。  </p>
<p>假设在工作目录中有三个文件已经 <strong>修改</strong> 过，准备将它们暂存后提交。<br><code>git add</code>暂存操作时，会对 <strong>每一个文件</strong> 计算校验和，然后把当前版本的文件快照使用 <strong>blog对象</strong> 保存到Git仓库中（为提高性能，若文件没有变化，Git不会再次保存）。将它们的SHA-1校验和加入到暂存区域等待提交。<br><code>git commit</code>提交操作，时，Git首先会计算 <strong>每一个子目录</strong> 的校验和，然后将这些校验和保存为 <strong>tree对象</strong> 。 然后Git会创建一个 <strong>commit对象</strong> ，它包含指向这个树对象的指针及注释、提交人、邮箱等信息。<br>现在，Git仓库中有五个对象：三个blob 对象（保存着文件快照）;一个树对象（记录着目录结构和blob对象索引）以及一个提交对象（包含着指向前述树对象的指针和所有提交信息）。</p>
<p>单个提交对象在仓库中的数据结构：<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/xwmo5.jpg"><br>多个提交对象之间的链接关系：<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/yt3l3.jpg">  </p>
<h4 id="分支是什么"><a href="#分支是什么" class="headerlink" title="分支是什么"></a>分支是什么</h4><p><strong>Git 中的分支，其实本质上仅仅是个指向commit对象的可变指针</strong>。Git会使用master作为分支的默认名字。在若干次提交后，你其实已经有了一个指向最后一次commit对象的master分支。它在每次提交的时候都会自动向前移动。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/wf4i2.jpg"></p>
<p>创建名为testing的新的分支，本质上就是创建一个指针，可以使用<code>git branch</code>命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch testing</span><br></pre></td></tr></table></figure>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/q33ki.jpg"></p>
<h4 id="当前工作在哪个分支"><a href="#当前工作在哪个分支" class="headerlink" title="当前工作在哪个分支"></a>当前工作在哪个分支</h4><p>Git 是如何知道你当前在哪个分支上工作的呢？其实答案也很简单，它还保存着一个名为HEAD的特别指针。它是一个指向你正在工作中的本地分支的指针。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/p88bo.jpg"></p>
<h4 id="切换分支时发生了什么"><a href="#切换分支时发生了什么" class="headerlink" title="切换分支时发生了什么"></a>切换分支时发生了什么</h4><p>切换分支，本质上就是移动HEAD指针。<br>要切换到其他分支，可以执行<code>git checkout</code>命令。我们现在转换到刚才新建的testing分支：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout testing</span><br></pre></td></tr></table></figure>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/mgh91.jpg"></p>
<h3 id="分支切换的实际操作"><a href="#分支切换的实际操作" class="headerlink" title="分支切换的实际操作"></a>分支切换的实际操作</h3><p>为了更好的理解分支，我们接下来模拟实际工作中的场景，进行一系列的切换操作。<br>现在我们已经处于testing分支了，目前testing分支和master分支都是指向同一个commit，所以我们的工作区的内容现在还没有什么变化。<br>现在，我们要在testing分支上做一些文件修改，然后commit:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;testing branch&quot;&gt;&gt;readme.txt</span><br><span class="line">git commit -a -m &quot;modify on testing branch&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/gbveu.jpg"><br>提交后，产生了一个新的commit对象，并且HEAD随着当前testing分支一起向前移动。而master分支则是停在原地不动。</p>
<p>我们可以试着使用<code>git checkout</code>命令切回master分支，看看发生了什么:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br></pre></td></tr></table></figure>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/xfrf7.jpg"><br>这条命令做了两件事：  </p>
<ol>
<li>它把HEAD指针移回到 master 分支。</li>
<li>把工作目录中的文件换成了master分支所指向的快照内容。</li>
</ol>
<p>我们试着在master上再做一些改动并commit：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;testing master&quot;&gt;&gt;readme.txt</span><br><span class="line">git commit -a -m &quot;modify on master branch&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/vs6o3.jpg"><br>现在分支变成了上图所示，我们可以在master与testing间随时切换，并修改工作区的文件内容。必要时再将这两个分支合并。</p>
<h3 id="分支新建与合并的实际操作"><a href="#分支新建与合并的实际操作" class="headerlink" title="分支新建与合并的实际操作"></a>分支新建与合并的实际操作</h3><p>接下来，再以一个比较长的真实的工作场景进行举例</p>
<p>我们首先在master分支上进行工作，并提交了几次更新，测试无误后编译发布至生产系统。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/hh1wm.jpg"></p>
<p>之后我们决定要修补问题追踪系统上的53号问题，这时可以使用<code>git checkout -b</code>命令快速创建一个分支并切换过去：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b iss53</span><br></pre></td></tr></table></figure>
<p>这相当于执行了下面这两条命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git branch iss53</span><br><span class="line">$ git checkout iss53</span><br></pre></td></tr></table></figure>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/v3a5l.jpg"></p>
<p>我们在iss53分支上写了一些代码，并commit  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ vi index.html</span><br><span class="line">$ git commit -a -m &#39;fixed the broken email address&#39;</span><br></pre></td></tr></table></figure>
<p>iss53上的工作还没完成，突然接到通知，生产系统有一个紧急BUG需要立刻修复。所以我们首先切回master分支，然后在master的基础上，又新建出一个hotfix分支来修复BUG。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master    #回到master分支</span><br><span class="line">$ git checkout -b hotfix    #新建一个hotfix分支，并切过去</span><br><span class="line">$ vim index.html    #修改一些东西，修复BUG</span><br><span class="line">$ git commit -a -m &#39;fixed the broken email address&#39;    #提交hotfix</span><br></pre></td></tr></table></figure>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/w3swt.jpg"></p>
<p>在hotfix分支上搞定BUG之后，我们切回master分支，使用<code>git merge</code>把刚才的hotfix合并进来  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master  #切换回master分支</span><br><span class="line">$ git merge hotfix    #将hotfix分支的修改，合并到当前master分支来（注意merge的方向，是从其它分支，合到当前分支）。</span><br><span class="line">Updating f42c576..3a0874c</span><br><span class="line">Fast-forward</span><br><span class="line"> README | 1 -</span><br><span class="line"> 1 file changed, 1 deletion(-)</span><br></pre></td></tr></table></figure>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/bl7k3.jpg"><br>备注：本次合并时出现了“Fast forward”的提示。由于当前 master 分支所在的提交对象是要并入的 hotfix 分支的直接上游，Git 只需把 master 分支指针直接右移。换句话说，如果顺着一个分支走下去可以到达另一个分支的话，那么 Git在合并两者时，只会简单地把指针右移，因为这种单线的历史分支不存在任何需要解决的分歧，所以这种合并过程可以称为快进（Fast forward）。  </p>
<p>这时hotfix分支已经没用了，可以删掉了  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -d hotfix    #只是删除了一个指针</span><br></pre></td></tr></table></figure>
<p>现在回到之前未完成的53号问题上，继续写一些代码  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout iss53</span><br><span class="line">$ vim index.html</span><br><span class="line">$ git commit -a -m &#39;finished the new footer [issue 53]&#39;</span><br></pre></td></tr></table></figure>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/mqmex.jpg"></p>
<p>在问题53相关的工作完成之后，可以合并回master分支。实际操作同前面合并hotfix分支差不多，只需回到master分支，运行git merge命令指定要合并进来的分支。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">$ git merge iss53</span><br><span class="line">Auto-merging README</span><br><span class="line">Merge made by the &#39;recursive&#39; strategy.</span><br><span class="line"> README | 1 +</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/cscqb.jpg"><br>请注意，这次合并操作的底层实现，并不同于之前 hotfix 的并入方式。因为这次你的开发历史是从更早的地方开始分叉的。由于当前 master 分支所指向的提交对象（C4）并不是 iss53 分支的直接祖先，Git 不得不进行一些额外处理。就此例而言，Git 会用两个分支的末端（C4 和 C5）以及它们的共同祖先（C2）进行一次简单的三方合并计算。  </p>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/aal3p.jpg"><br>这次，Git 没有简单地把分支指针右移，而是对三方合并后的结果重新做一个新的快照，并自动创建一个指向它的提交对象（C6）。这个提交对象比较特殊，它有两个祖先（C4 和 C5）。  </p>
<p>有时候合并操作并不会如此顺利。如果在不同的分支中都修改了同一个文件的同一部分，需要手工来处理冲突。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git merge iss53</span><br><span class="line">Auto-merging index.html</span><br><span class="line">CONFLICT (content): Merge conflict in index.html</span><br><span class="line">Automatic merge failed; fix conflicts and then commit the result.</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Git作了合并，但没有提交，它会停下来等你解决冲突。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">You have unmerged paths.</span><br><span class="line">  (fix conflicts and run &quot;git commit&quot;)</span><br><span class="line"></span><br><span class="line">Unmerged paths:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to mark resolution)</span><br><span class="line"></span><br><span class="line">        both modified:      index.html</span><br><span class="line"></span><br><span class="line">no changes added to commit (use &quot;git add&quot; and&#x2F;or &quot;git commit -a&quot;)</span><br></pre></td></tr></table></figure>
<p>任何包含未解决冲突的文件都会以未合并（unmerged）的状态列出。Git 会在有冲突的文件里加入标准的冲突解决标记。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ vi index.html</span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class="line">&lt;div id&#x3D;&quot;footer&quot;&gt;contact : email.support@github.com&lt;&#x2F;div&gt;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&lt;div id&#x3D;&quot;footer&quot;&gt;</span><br><span class="line">  please contact us at support@github.com</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt; iss53</span><br></pre></td></tr></table></figure>
<p>可以看到 ======= 隔开的上半部分是 HEAD，即master，下半部分是在iss53分支中的内容。<br>手工合并代码后，把 &lt;&lt;&lt;&lt;&lt;&lt;&lt;，======= 和 &gt;&gt;&gt;&gt;&gt;&gt;&gt; 这些行也一并删除。这时可以用git commit来提交了。  </p>
<h3 id="分支策略"><a href="#分支策略" class="headerlink" title="分支策略"></a>分支策略</h3><p>实际开发中，对于分支的管理，已经有很多最佳实践，大多数情况下，我们只需要遵守一些基本原则：  </p>
<ul>
<li>首先，master分支应该是非常稳定的，也就是仅用来发布新版本，平时不能在上面工作。  </li>
<li>平时的开发工作都放在dev分支上，也就是说，dev分支是不稳定的。到某个时候，比如测试通过，需要1.2版本发布时，再把dev分支合并到master上，在master分支编译发布1.2版本。  </li>
<li>针对新需求、修复等具体的任务，每次都在dev分支上开一个新的任务分支出来，工作完成后，再向dev分支上合并就可以了。名称没有特别的规范，可以是人名，例如：zhangsan，也可以是任务名、需求编号等，例如：iss03、feature04、hotfix。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/4wfxt.jpg"></li>
</ul>
<h3 id="远程分支"><a href="#远程分支" class="headerlink" title="远程分支"></a>远程分支</h3><p>之前讨论过远程仓库，接着又学习了分支，当二者结合到一起时，又会产生一些有趣的东西。</p>
<h4 id="远程分支的概念"><a href="#远程分支的概念" class="headerlink" title="远程分支的概念"></a>远程分支的概念</h4><p>远程分支（remote branch）,即远程仓库中的分支。同步到本地后，与本地分支不同的是，它们 <strong>无法移动</strong> ；且只有在Git进行网络交互时才会更新。远程分支就像是书签，提醒着你上次连接远程仓库时上面各分支的位置。我们用 (远程仓库名)/(分支名) 这样的形式表示远程分支(例如origin/master)。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/z6u9t.jpg">  </p>
<p>如果我们在本地master分支做了些改动，与此同时，其他人向远程仓库推送了他们的更新，那么服务器上的master分支就会向前推进，而于此同时，我们在本地的提交历史正朝向不同方向发展。（不过只要你不和服务器通讯，你的 origin/master 指针仍然保持原位不会移动。）<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/s1fru.jpg"></p>
<p>可以运行<code>git fetch origin</code>来同步远程服务器上的数据到本地。该命令首先找到origin是哪个服务器，然后从上面获取你尚未拥有的数据，更新你本地的数据库，然后把origin/master的指针移到它最新的位置上。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/3zu6i.jpg"></p>
<p>可以使用<code>git remote</code>命令查看远程仓库的详情  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ git remote -v    #列出远程服务器清单</span><br><span class="line">origin	mobgit@134.32.51.60:learngit.git (fetch)</span><br><span class="line">origin	mobgit@134.32.51.60:learngit.git (push)</span><br><span class="line"></span><br><span class="line">$ git remote show origin   #查询某一个远程服务器的详情</span><br><span class="line">* remote origin</span><br><span class="line">  Fetch URL: mobgit@134.32.51.60:learngit.git</span><br><span class="line">  Push  URL: mobgit@134.32.51.60:learngit.git</span><br><span class="line">  HEAD branch (remote HEAD is ambiguous, may be one of the following):</span><br><span class="line">    dev</span><br><span class="line">    master</span><br><span class="line">  Remote branches:</span><br><span class="line">    dev    tracked</span><br><span class="line">    master tracked</span><br><span class="line">  Local branch configured for &#39;git pull&#39;:</span><br><span class="line">    master merges with remote master</span><br><span class="line">  Local ref configured for &#39;git push&#39;:</span><br><span class="line">    master pushes to master (up to date)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="跟踪远程分支"><a href="#跟踪远程分支" class="headerlink" title="跟踪远程分支"></a>跟踪远程分支</h4><p>从远程分支checkout出来的本地分支，称为跟踪分支 (tracking branch)。跟踪分支是一种和某个远程分支有直接联系的本地分支。<br>在跟踪分支里输入 <code>git push</code>，Git 会自行推断应该向哪个服务器的哪个分支推送数据。同样，在这些分支里运行 <code>git pull</code> 会获取所有远程索引，并把它们的数据都合并到本地分支中来。</p>
<p>在克隆仓库时，Git 通常会自动创建一个名为 master 的分支来跟踪 origin/master。这正是 git push 和 git pull 一开始就能正常工作的原因。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b serverfix origin&#x2F;serverfix</span><br><span class="line">或简化为：</span><br><span class="line">$ git checkout --track origin&#x2F;serverfix</span><br></pre></td></tr></table></figure>
<p>这会新建并切换到serverfix本地分支，其内容同远程分支origin/serverfix一致。</p>
<h4 id="推送本地分支"><a href="#推送本地分支" class="headerlink" title="推送本地分支"></a>推送本地分支</h4><p>要想和其他人分享某个本地分支，你需要把它推送到一个你拥有写权限的远程仓库。<br>例如本地有一个serverfix分支需要和他人一起开发，可以运行 git push (远程仓库名) (分支名)：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin serverfix</span><br><span class="line">Counting objects: 20, done.</span><br><span class="line">Compressing objects: 100% (14&#x2F;14), done.</span><br><span class="line">Writing objects: 100% (15&#x2F;15), 1.74 KiB, done.</span><br><span class="line">Total 15 (delta 5), reused 0 (delta 0)</span><br><span class="line">To git@github.com:schacon&#x2F;simplegit.git</span><br><span class="line"> * [new branch]      serverfix -&gt; serverfix</span><br></pre></td></tr></table></figure>
<p>或者加入–set-upstream设置跟踪后，以后直接使用<code>git push</code>就可以推送了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git push --set-upstream origin serverfix</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="GitHub"><a href="#GitHub" class="headerlink" title="GitHub"></a>GitHub</h2><p>[GitHub]（<a target="_blank" rel="noopener" href="https://github.com)是一个面向开源及私有软件项目的托管平台,因为只支持git作为唯一的版本库格式进行托管,故名github./">https://github.com）是一个面向开源及私有软件项目的托管平台，因为只支持Git作为唯一的版本库格式进行托管，故名GitHub。</a><br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/h6vla.jpg"><br>GitHub本身没有什么好学的，随便看就知道怎么用了 <a target="_blank" rel="noopener" href="https://www.zhihu.com/question/20070065">知乎：怎样使用GitHub</a><br>重点是，GitHub上有非常多优秀的个人项目值得我们学习，我们也可以将自已的代码发布上去。可以看成是程序员的博客吧，只贴代码，不废话。<br>在GitHub上发布开源项目是免费的，但是私有项目收费。</p>
<h2 id="GitLab"><a href="#GitLab" class="headerlink" title="GitLab"></a>GitLab</h2><p>GitLab是一个用Ruby on Rails写的开源的版本管理系统，实现一个自托管的Git项目仓库，可通过Web界面进行访问公开的或者私人项目。它拥有与Github类似的功能，能够浏览源代码，管理缺陷和注释。<br>可以管理团队对仓库的访问，它非常易于浏览提交过的版本并提供一个文件历史库。团队成员可以利用内置的简单聊天程序(Wall)进行交流。它还提供一个代码片段收集功能可以轻松实现代码复用，便于日后有需要的时候进行查找。<br>GitLab是目前搭建内部Git服务器的首选，当然如果要求不高的话，我们也可以直接使用SSH协议来快速搭建Git服务端。</p>
<h2 id="常用Git命令清单"><a href="#常用Git命令清单" class="headerlink" title="常用Git命令清单"></a>常用Git命令清单</h2><p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/5cgpa.jpg"><br>更多内容请直接参考 <a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html">阮一峰的网络日志</a></p>
<h2 id="推荐文档"><a href="#推荐文档" class="headerlink" title="推荐文档"></a>推荐文档</h2><p>不要指忘2小时的培训能带来多大的收益，最简单高效的方式，还是要多看优秀的文档。<br>本文大量参(chao)考(xi)了以下两部文档：<br><a target="_blank" rel="noopener" href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000">廖雪峰的在线教程</a>  适合快速上手<br><a target="_blank" rel="noopener" href="https://www.gitbook.com/book/0532/progit/details">Pro Git中文版</a>   中文第一版  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201702/WEB%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%96%E4%B8%8D%E5%88%B0%E7%94%A8%E6%88%B7%E7%9A%84MAC%E5%9C%B0%E5%9D%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201702/WEB%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%96%E4%B8%8D%E5%88%B0%E7%94%A8%E6%88%B7%E7%9A%84MAC%E5%9C%B0%E5%9D%80/" class="post-title-link" itemprop="url">WEB服务器为什么取不到用户的MAC地址</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-01-26 09:44:33" itemprop="dateCreated datePublished" datetime="2021-01-26T09:44:33+08:00">2021-01-26</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>起因是某个同事接到了领导安排下来的一个需求，要在一个Web应用（Java+Tomcat）中，记录用户登录时的IP地址和MAC地址，用于安全审计，于是咨询我如何实现。  </p>
<p>第一反应是，这个需求本身是不成立的，根据以往的了解，MAC地址应该是过不了路由器的才对。<br>以往做开发，都是用engineer的思维：先动手做，遇到问题再解决问题。但这个需求，应当用scientist的思维去思考：首先确定能不能做，然后才是怎么做。  </p>
<p>翻查了一些资料，想来证实”<strong>为什么WEB服务器，可以获取到客户端的IP地址，但获取不到MAC地址</strong>“，看着看着才发现，这是个挺大的命题，够写一篇BLOG了。   </p>
<p>PS：由于个人对这块内容了解的不够彻底，<strong>本文很可能会有谬误</strong>，请读者先不要太当真，另外希望平台组的同事给予指证。  </p>
<h2 id="先说结论"><a href="#先说结论" class="headerlink" title="先说结论"></a>先说结论</h2><p>我所认为的结论应该是这样的：  </p>
<ol>
<li>获取远程主机的IP地址是可行的（先不讨论使用代理的情况）  </li>
<li>本地网络下，当我们已知一个IPv4地址后，可以通过ARP请求，获取对应的MAC地址。换句话说，MAC地址，只在本地网络下才有意义。  </li>
<li>但我们无法透过路由器，获取其它网络下的IPv4节点的MAC地址。  </li>
</ol>
<p>下面一步步解释一下。  </p>
<h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><p>先从HTTP说起。<br>HTTP是一个应用层的协议，它建立在TCP协议之上。<br>HTTP请求就是用来发送一段文本。关于这段文本如何组织，第一行写什么，第二行写什么，哪里加一个空行，就是HTTP协议所要规范的内容。<br>举个直接的例子，下面是一个简单的HTTP GET请求，有兴趣可以用telnet模拟一下。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET http:&#x2F;&#x2F;www.fiddler2.com&#x2F;UpdateCheck.aspx?isBeta&#x3D;False HTTP&#x2F;1.1</span><br><span class="line">User-Agent: Fiddler&#x2F;4.6.3.50306 (.NET 4.0; WinNT 5.1.2600 SP3; zh-CN; 2xx86; Auto Update; Full Instance; Extensions: Geoedge, AutoSaveExt, HostsFile, SAZClipboardFactory, EventLog, SimpleFilter, Timeline, APITesting)</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Host: www.fiddler2.com</span><br><span class="line">Accept-Language: zh-CN</span><br><span class="line">Referer: http:&#x2F;&#x2F;fiddler2.com&#x2F;client&#x2F;4.6.3.50306</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>
<p>我们可以看到，HTTP的这段请求中，完全找不到客户端的MAC地址，甚至连IP地址都没有描述。<br>那IP地址是从哪里取到的呢？接下来我们再深入一点，看下一个内容：Socket  </p>
<h2 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h2><p>HTTP的客户端和服务端，是通过Socket进行连接的。  </p>
<p>Socket是什么呢？<strong>Socket是对OSI模型第4层-传输层中的TCP/IP协议的封装</strong>。Socket本身并不是协议，而<strong>是一个调用接口</strong>(API)。Socket和TCP/IP协议没有必然的联系。但通过Socket，我们才能使用TCP/IP协议。应用层不必了解TCP/IP协议细节，直接通过对Socket接口函数的调用完成数据在IP网络的传输。  </p>
<p>Socket包含了网络通信必须的五种信息：<strong>连接使用的协议，本地主机的IP地址，本地进程的协议端口，远地主机的IP地址，远地进程的协议端口</strong>。</p>
<p>所以，因为有了Socket，客户端和服务端完全不需要了解底层细节，直接通过调用Socket来实现就可以了。</p>
<p>这也就是为什么服务器端<strong>可以获取到客户端的IP地址</strong>的原因，因为Socket中包含了远地主机的IP地址。（当然，通过代理服务器进行访问的除外，这种要依靠HTTP协议的X-Forwarded-For头来确认IP，不在本次的讨论范围中）  </p>
<p>那为什么<strong>无法获取到客户端的MAC地址</strong>呢？很简单，同理，因为Socket中无法取到MAC地址。。。</p>
<p>如果继续发问，为什么Socket中都既然都包含IP地址了，为什么偏偏不包含MAC地址信息呢？看来我们还要更深入一点，看一下OSI模型吧。  </p>
<h2 id="OSI七层模型"><a href="#OSI七层模型" class="headerlink" title="OSI七层模型"></a>OSI七层模型</h2><p>首先祭出这张经典的OSI七层模型图，计算机网络的基石，请先盯着看一会儿，认真复习一下<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/um3vu.gif"></p>
<p>这里还有一张OSI七层模型与TCP/IP四层模型的对照图<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/9kstc.jpg"></p>
<p>为了方便理解，再放上一张更直观的，每一层对应的数据型式和主要协议的示意图<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/xifqu.jpg">  </p>
<p>通过上图大体可以知道：  </p>
<ul>
<li>MAC地址是记录在第2层-数据链路层的  </li>
<li>IP地址是记录在第3层-网络层的  </li>
<li>端口号（TCP/UDP）是位于于第4层-传输层的  </li>
<li>HTTP请求报文是记录在第7层-应用层的  </li>
</ul>
<h2 id="当打开一个URL时，究竟发生了什么"><a href="#当打开一个URL时，究竟发生了什么" class="headerlink" title="当打开一个URL时，究竟发生了什么"></a>当打开一个URL时，究竟发生了什么</h2><p>下面举个栗子，当我们在浏览器中打开一个链接后，看看OSI各层倒底发生了什么：<br>这里撇开DNS解析之类东西，只说一下HTTP报文的发送  </p>
<h3 id="1、发送端"><a href="#1、发送端" class="headerlink" title="1、发送端"></a>1、发送端</h3><p>首先来看一下发送端（浏览器所在的主机）。参照第一张OSI模型图，按照从上向下的顺序来看。应用层数据其实只有那么几行文本，然后往下，每过一层，都要被加上首部/尾部。<strong>这个过程就像是一层一层的穿衣服</strong>。   </p>
<p>HTTP请求文本：<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/48yqg.jpg"><br>最后到了数据链路层之后，数据就变成了这个肥肥的样子，最后转换成0和1的电信号发出：  </p>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/w3bim.jpg"><br>下面看看，现实中，每一层都做了些什么（现实中的分层和OSI模型还是有区别的）：  </p>
<ul>
<li><p>第7,6,5层，也就是OSI中的应用层,表示层,会话层（也是TCP/IP分层中的应用层），它创建了一个HTTP请求(例如 GET / HTTP/1.1)，并交给下一层。一个普通的HTTP GET请求就是几行纯文本。<br>处理这三层，是<strong>浏览器</strong>和<strong>WEB服务器</strong>所要做的工作，浏览器发出请求，WEB服务器做出响应。  </p>
</li>
<li><p>第4,3层，也就是传输层/网络层。TCP/IP栈将上层的数据分成包（packets），并将它送往下一层-数据链路层。  </p>
</li>
</ul>
<p><strong>IP地址、端口号记录在这两层中</strong>。<br>处理这两层，是<strong>操作系统</strong>要做的工作，操作系统将这两层封装为了Socket，方便调用。  </p>
<ul>
<li>第2层，数据链路层，将包（package）封装成帧（frame），并将它送到下一层物理层。  </li>
</ul>
<p><strong>MAC地址记录在这一层中</strong>。<br>这一层的工作，交由<strong>网卡</strong>来处理。  </p>
<ul>
<li>第1层，物理层，使用电信号来传送0和1。<br>最后这一层就是<strong>传输介质</strong>的工作了，例如双绞线、光纤、同轴电缆。  </li>
</ul>
<h3 id="2、数据流转"><a href="#2、数据流转" class="headerlink" title="2、数据流转"></a>2、数据流转</h3><p>数据发出去后，再看一下数据在网络上的流转。<br>数据一般要经过交换机、路由器等网络设备，层层转发，这些设备所做的事情就像是： <strong>脱掉一件或几件衣服，做一些修修补补，然后再重新穿回去</strong>。  </p>
<ul>
<li>这里先以L2交换机为例看一下，因为L2交换机会认别到帧这一层，记录/学习MAC地址，并将帧发送到目的地。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/5ad0a.jpg">  </li>
</ul>
<p>通过上面这张图，我们就可以理解，MAC地址在本地网络下的重要作用了。也理解了，本地网络下，是可以查出每个节点的MAC地址的。  </p>
<ul>
<li>下面，再来看一下路由器。当一个LAN希望连接到另一个LAN时，就必须使用路由器设备了。当然，可以通过构建超大型的LAN，来避免使用路由器，但这时，交换机就需要管理大量的MAC地址，同时进行大量的广播通信，设备的负担就会相当大。路由器会进行路由选择，让数据达到下一跳。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/18783.jpg">  </li>
</ul>
<p>经过路由器后，为了能到达下一跳，数据链路层中的MAC地址就被篡改了，下面这张图很能说明问题：<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/js6ab.jpg">  </p>
<h3 id="3、接收端"><a href="#3、接收端" class="headerlink" title="3、接收端"></a>3、接收端</h3><p>最后看一下接收端（WEB服务器所在的主机）。参照第一张OSI模型图，按照从下至上的顺序来看，它要做的事情是： <strong>将衣服一件一件全部脱掉</strong> ，最后WEB服务器就取到了最初的应用层数据。  </p>
<h3 id="4、结论"><a href="#4、结论" class="headerlink" title="4、结论"></a>4、结论</h3><p>所以，当一个以太网帧到达目的主机后，其中的MAC地址早已经不是原来客户端的MAC了，操作系统的Socket自然也无法获取原始的MAC地址了。  </p>
<h2 id="可不可以通过其它方式获取MAC地址"><a href="#可不可以通过其它方式获取MAC地址" class="headerlink" title="可不可以通过其它方式获取MAC地址"></a>可不可以通过其它方式获取MAC地址</h2><p>上面已经证明了，WEB服务端，是无法获取客户端的MAC地址的。<br>那么，能不能通过一些trick来绕道实现呢？<br>想了想，大概可以有如下的思路：</p>
<ol>
<li>通过JavaScrip获取客户端的某块网卡的MAC地址，最好还要同时获取路由表，挑选出走默认路由的那块网卡。  </li>
<li>将MAC地址，偷偷写入应用层的HTTP协议的Header中（类似Content-Type和User-Agent）</li>
<li>服务端直接读Header，就可以取到Mac地址了</li>
</ol>
<p>那么这个思路可不可行呢？  </p>
<ul>
<li>如果客户端是浏览器的话，首先第一步就会被打脸，我想也没有哪个浏览器会允许这种不安全的操作的。但如果硬要通过IE下的ActiveX来取的话，貌似也不是不可以。。。  </li>
<li>但如果客户端是APP的话，通过WebView+JS Bridge方式调用私有的API，应该也是可行的。。。</li>
</ul>
<h2 id="记录MAC地址的意义"><a href="#记录MAC地址的意义" class="headerlink" title="记录MAC地址的意义"></a>记录MAC地址的意义</h2><p>最后的最后，不禁思考，获取MAC的意义在哪里呢？<br>如果单纯是为了取证和审计，我想意义是不大的，甚至不如直接记录IP地址。<br>因为：    </p>
<ul>
<li>对于普通的正常用户而言，通过IP地址，是可以直接定位操作人的，即使IP是动态的。  </li>
<li>对于初级以上Hacker来说，伪造MAC地址和伪造IP地址一样简单，甚至更简单。  </li>
</ul>
<p>所以，一般的安全管控要求下，还是只记录IP吧。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.amazon.cn/%E5%9B%BE%E8%A7%A3%E7%BD%91%E7%BB%9C%E7%A1%AC%E4%BB%B6-%E6%97%A5-%E4%B8%89%E8%BD%AE%E8%B4%A4%E4%B8%80/dp/B01531731E/ref=sr_1_1?s=digital-text&ie=UTF8&qid=1488177601&sr=1-1&keywords=%E5%9B%BE%E8%A7%A3%E7%BD%91%E7%BB%9C%E7%A1%AC%E4%BB%B6">https://www.amazon.cn/图解网络硬件-日-三轮贤一/dp/B01531731E/ref=sr_1_1?s=digital-text&amp;ie=UTF8&amp;qid=1488177601&amp;sr=1-1&amp;keywords=图解网络硬件</a>  </li>
<li><a target="_blank" rel="noopener" href="https://www.amazon.cn/TCP-IP%E5%85%A5%E9%97%A8%E7%BB%8F%E5%85%B8-%E7%BE%8E-Joe-Casad/dp/B00L0WLUGA/ref=sr_1_1?s=digital-text&ie=UTF8&qid=1488177636&sr=1-1&keywords=tcp/ip%E5%85%A5%E9%97%A8">https://www.amazon.cn/图解网络硬件-日-三轮贤一/dp/B01531731E/ref=sr_1_1?s=digital-text&amp;ie=UTF8&amp;qid=1488177601&amp;sr=1-1&amp;keywords=图解网络硬件</a>  </li>
<li><a target="_blank" rel="noopener" href="https://www.amazon.cn/HTTP%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-%E7%BE%8E-David-Gourley-Brian-Totty-Marjorie-Sayer-Sailu-Reddy-Aushu-Aggarwal/dp/B00M2DKYRC/ref=sr_1_1?s=digital-text&ie=UTF8&qid=1488178503&sr=1-1&keywords=HTTP%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97">https://www.amazon.cn/HTTP权威指南-美-David-Gourley-Brian-Totty-Marjorie-Sayer-Sailu-Reddy-Aushu-Aggarwal/dp/B00M2DKYRC/ref=sr_1_1?s=digital-text&amp;ie=UTF8&amp;qid=1488178503&amp;sr=1-1&amp;keywords=HTTP权威指南</a>  </li>
<li><a target="_blank" rel="noopener" href="http://superuser.com/questions/801788/role-of-osi-layers-when-we-open-a-url-in-browser">http://superuser.com/questions/801788/role-of-osi-layers-when-we-open-a-url-in-browser</a>  </li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201702/%E4%BD%BF%E7%94%A8IntelliJIDEA%E6%9B%BF%E4%BB%A3Eclipse/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201702/%E4%BD%BF%E7%94%A8IntelliJIDEA%E6%9B%BF%E4%BB%A3Eclipse/" class="post-title-link" itemprop="url">使用IntelliJ IDEA替代Eclipse</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-01-26 09:44:33" itemprop="dateCreated datePublished" datetime="2021-01-26T09:44:33+08:00">2021-01-26</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="什么是IntelliJ-IDEA"><a href="#什么是IntelliJ-IDEA" class="headerlink" title="什么是IntelliJ IDEA"></a>什么是IntelliJ IDEA</h2><p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/8lug3.jpg"><br>简单来说，IntelliJ Idea是目前最好的Java集成开发环境，没有之一。  </p>
<h2 id="为什么要迁移到Intellij-IDEA"><a href="#为什么要迁移到Intellij-IDEA" class="headerlink" title="为什么要迁移到Intellij IDEA"></a>为什么要迁移到Intellij IDEA</h2><p>Java应该是非常依赖IDE的一门语言了，恐怕也没有几个大牛能够直接用Vim/Emacs愉快的手撸代码，Java程序员离开了IDE基本上生活不能自理，IDE的重要性不言而喻。<br>最近在推行、部署各种自动化工具，但个人认为，相比于各种工具，一个好的IDE更是能 <strong>极大的提升</strong> 工作效率以及编码的爽快感。<br>目前团队中使用的开发工具主要还是Eclipse和NetBeans，所以就想借这篇文章安利一下，希望团队中更多的人能开始尝试并喜欢上IntelliJ IDEA。  </p>
<p>目前常用的IDE主要有3个：  </p>
<ul>
<li>Eclipse  </li>
<li>NetBeans  </li>
<li>IntelliJ IDEA  </li>
</ul>
<p>其中，Eclipse及其衍生品是最为我们所熟知的，Eclipse开源，历史悠久，插件丰富，对一些老项目兼容性也比较好，另外有很多基于Eclipse的项目也很流行，比如STS、MyEclipse。  </p>
<p>NetBeans使用的人稍微少一些，但它有很多比Eclipse更为优秀的地方，例如免费、Oracle自家出品，对于新标准的支持非常好、有中文语言包、界面布局更合理等。</p>
<p>但从目前的统计数据来看，IntelliJ Idea的市场份额已经超过了Eclipse。    </p>
<p>IntelliJ IDEA作为一个商业化的IDE，而且是一个非常昂贵的商业化IDE（499刀/年），能够被如此多的开发人员认可，肯定有它非凡之处，简单罗列几点：    </p>
<ul>
<li>黑色的Darcula主题，我想应该把这个放在第一位</li>
<li>智能化的代码提示、自动补全、重复代码检查、快速修复</li>
<li>更加智能的重构工具，支持跨语言的重构</li>
<li>人性化的调试工具</li>
<li>包含大量的内建工具，开箱即用的，无须配置大量的插件</li>
<li>默认支持git/svn等多种版本控制工具</li>
<li>默认支持Maven, Gradle, Ant等多种构建工具</li>
<li>内建反编译工具，方便查看没有源码的老旧jar包</li>
<li>内建数据库管理工具，可以抛弃toad/Navicat这些东西了</li>
<li>内建REST API测试工具，可以抛弃Postman之类的测试工具了</li>
<li>支持Tomcat、JBoss、WebLogic等主流应用服务器</li>
<li>Google的助攻，Android开发环境由最初基于Eclipse的ADT，迁移到了基于IDEA的Android Studio</li>
</ul>
<h2 id="导入一个工程"><a href="#导入一个工程" class="headerlink" title="导入一个工程"></a>导入一个工程</h2><p>要想开始体验IntelliJ IDEA，首先要新建一个工程(Project)或导入已有的工程。这里我们选择从版本库中导入一个已有的工程。  </p>
<p>在欢迎界面中点击最下方的 <strong>Check out from Version Control</strong><br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/k0u3n.jpg"><br>可以看到，IntelliJ IDEA支持GitHub、CVS、Git、Svn等多种版本库。  </p>
<p>这里我们尝试导入一个GitHub中的工程，填写自已的GitHub用户名、密码<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/w7b49.jpg"></p>
<p>在下拉列表中选择好一个工程后，点击 <strong>Clone</strong><br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/0gpr1.jpg"></p>
<p>如果项目是用Gradle/Maven构建的，还会弹出一个构建工具配置界面<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/mc3b9.jpg"></p>
<p>导入完成后，可以看到主界面了<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/w4xvz.jpg"></p>
<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><p>IntelliJ IDEA中的项目结构和Eclipse有很大的不同。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/aebzo.jpg">  </p>
<ul>
<li>Eclipse中有workspace的概念，可以向workspace中添加多个工程。  </li>
<li>IDEA没有workspace，一个窗口中只能打开一个工程（Project），但一个工程中可以包含多个模块（module)，这种方式更符合多模块应用开发的需求。  </li>
</ul>
<p>界面左侧的Project栏，可以查看项目中的文件结构，通过<code>Cmd+1</code>快捷键调出/关闭。</p>
<p>使用<code>Cmd+;</code> 快捷键，可以打开项目设置界面，在这里配置模块、库、Facets、Artifacts等。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/t1zho.jpg"></p>
<h2 id="Facets"><a href="#Facets" class="headerlink" title="Facets"></a>Facets</h2><p>Facets可以认为是项目支持的特性，例如JPA、Spring、Hibernate等，当一个项目被IDEA扫描完毕之后，它会自动为每个模块添加相应用Facets，当然也可以手工进行添加<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/l2oj8.jpg">  </p>
<h2 id="Artifacts"><a href="#Artifacts" class="headerlink" title="Artifacts"></a>Artifacts</h2><p>Artifacts是项目的打包部署设置。<br>例如，对于WEB工程而言，IDEA通过配置Artifacts，将编译输出的class文件，与jsp/html/css页面等静态文件，以特定的目录结构合并到一起。  </p>
<h2 id="目录图标"><a href="#目录图标" class="headerlink" title="目录图标"></a>目录图标</h2><ul>
<li>蓝色 - 源码根目录</li>
<li>绿色 - 测试代码目录</li>
<li>红色 - 需要排除的目录，例如class/build等包含二进制文件的目录</li>
<li>黄色 - 资源目录，application.yml等会放在这里面</li>
</ul>
<p>点击Project栏中右上角齿轮图标，可以调整目录的展示方式，比如合并中间空目录等：<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/hvfzs.jpg">  </p>
<h2 id="快捷键对比"><a href="#快捷键对比" class="headerlink" title="快捷键对比"></a>快捷键对比</h2><p>下面是一份Eclipse与IntelliJ IDEA的快捷键比对表：<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/fqy52.jpg"><br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/yhy8c.jpg">  </p>
<p>如果不想使用IDEA的默认快捷键，想沿用之前的一些习惯，IDEA也提供了几套其它的配置，使用 <strong>Ctrl+`</strong> 调出菜单<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/wjgg6.jpg">   </p>
<p>选择 <strong>3-Keymap</strong> 即可切换配置<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/2h8se.jpg">  </p>
<p>但建议还是尽量适应IntelliJ IDEA的默认快捷键配置吧。  </p>
<p>下面有几个有趣的与其它IDE的区别：  </p>
<ul>
<li><code>Cmd+D</code><br>在Eclipse中，<code>Cmd+D</code>是删除一行，但在IntelliJ IDEA中，D是指duplicate，复制一行。  </li>
<li><code>Cmd+S</code><br>在其它编辑器中，我们通常会频繁使用Cmd+S进行保存，但在IDEA中，完全不需要这么做。IntelliJ IDEA的自动保存功能做的非常好，不用担心会丢失进度，<code>Cmd+S</code>只能给我们带来一些心理上的”安全感”。  </li>
</ul>
<h2 id="界面布局"><a href="#界面布局" class="headerlink" title="界面布局"></a>界面布局</h2><p>IntelliJ IDEA的默认布局非常的简洁，几乎只有一个编辑器界面，甚至还可以通过<code>Ctrl+Cmd+F</code>全屏显示，以获得更加沉浸式的体验。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/0g472.jpg">  </p>
<p>点击界面最左下角的显示器形状的图标，可以用来切换布局模式，调出或隐藏周边的工具栏<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/q36cu.jpg">  </p>
<p>在使用精简布局时，如果要进行文件定位、打开某个侧边栏等操作，就需要使用一些快捷建进行操作了。</p>
<p>一般是使用<code>Cmd+数字</code>来显示侧边栏，例如<code>Cmd+1</code>显示Project栏，<code>Cmd+9</code>显示版本控制栏，具体数字界面上会有提示。  </p>
<p>另外，<code>Cmd+E</code>不但可以显示最近使用过的文件，还可以在左侧选择打开各个侧边栏，非常好用。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/5rvef.jpg">  </p>
<p>同样的，<code>Ctrl+Tab</code>快捷键可以实现类似的功能，并且效率更高<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/u2888.jpg"></p>
<h2 id="快速查找"><a href="#快速查找" class="headerlink" title="快速查找"></a>快速查找</h2><p>使用<code>Cmd+O</code>可以弹出快速 <strong>查找类名</strong> 窗口，输入类名关键字筛选，可以快速打开类所在的源文件<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/hjtxb.jpg">  </p>
<p>使用<code>Cmd+Shift+O</code>可以弹出快速 <strong>查找文件名</strong> 窗口，输入文件名关键字，可以打开任意文件<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/4tx7p.jpg">  </p>
<p>还有一个更方便的方式，如果不确定要找什么，双击<code>shift</code>键，可以弹出”Search Everywhere”窗口，输入关键词搜索一切吧。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/59lka.jpg"></p>
<p>当然，还可以使用之前提到过的<code>Cmd+E</code>，查看曾经打开过的文件。  </p>
<h2 id="常用设置"><a href="#常用设置" class="headerlink" title="常用设置"></a>常用设置</h2><h3 id="缩进方式配置"><a href="#缩进方式配置" class="headerlink" title="缩进方式配置"></a>缩进方式配置</h3><p>使用空格与TAB键缩进，在码农界争论至今还没有定论，那就不妨根据自已的喜好手工设置一下吧。  </p>
<p>首先使用<code>Cmd+,</code>打开全局设置界面，在<code>Editor → Editor Tabs</code>中可以找到相应的选项：<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/mjl9m.jpg">  </p>
<h3 id="界面主题配置"><a href="#界面主题配置" class="headerlink" title="界面主题配置"></a>界面主题配置</h3><p>在<code>Appearance &amp; Behavior → Appearance</code>中，可以设置喜欢的主题，字体、字号等<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/u49aw.jpg"></p>
<p>这里当然是首推Darcula主题。</p>
<h2 id="代码编辑"><a href="#代码编辑" class="headerlink" title="代码编辑"></a>代码编辑</h2><p>首先要记忆的一个快捷键是<code>Cmd+F12</code>，可以打开 <strong>class outline</strong> 窗口，查看文件中的各个方法。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/qtrp5.jpg"></p>
<p>类似的也可以通过<code>Ctrl+H</code>打开 <strong>type hierarchy</strong> 侧边栏<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/p878n.jpg"></p>
<p>另外，还可以使用<code>Alt+F7</code>，打开 <strong>Find Usages</strong> 底边栏，显示方法的使用者。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/f0ckp.jpg"></p>
<h2 id="自动补全"><a href="#自动补全" class="headerlink" title="自动补全"></a>自动补全</h2><p>使用<code>Ctrl+Space</code>，可以进行代码自动补全。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/jr58p.jpg"></p>
<p><code>Ctrl+Shift+Space</code>，是更加智能的代码补全，它会猜测你的意图，只展示最有用的结果  </p>
<p>另外<code>Alt+Enter</code>也十分有用，当使用了一个类，但它还没有被导入时，可以用它来快速导入<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/x39ry.jpg"></p>
<h2 id="代码生成"><a href="#代码生成" class="headerlink" title="代码生成"></a>代码生成</h2><p>使用<code>Cmd+N</code>可以自动生成代码，比如Getter/Setter/toString()等等<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/uwj87.jpg"></p>
<h2 id="代码重构"><a href="#代码重构" class="headerlink" title="代码重构"></a>代码重构</h2><p>最简单的，可以通过右键菜单或<code>Shift+F6</code>进行重命名，可以是文件，也可以是类名、方法名、变量名等，点击确认后IntelliJ IDEA会跨语言检索全部代码（包括.html/.js)，找到所有相关的地方一起修改。<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/ppq6d.jpg">  </p>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/b1h1o.jpg">  </p>
<h2 id="插入模版"><a href="#插入模版" class="headerlink" title="插入模版"></a>插入模版</h2><p>输入特定的关键字，按TAB后，可以直接在光标处插入模板代码。  </p>
<p>例如，首先输入psvm<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/k0a32.jpg">  </p>
<p>然后按下<code>TAB</code>键，就会自动插入一个main方法的模版，相当快捷<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/6ki6h.jpg">  </p>
<h2 id="其它重要的快捷键"><a href="#其它重要的快捷键" class="headerlink" title="其它重要的快捷键"></a>其它重要的快捷键</h2><ul>
<li>格式化代码 - <code>Cmd+Alt+L</code></li>
<li>编译 - <code>Cmd+F9</code></li>
<li>关闭某个侧边栏 - <code>Shift+ESC</code></li>
</ul>
<h2 id="查找快捷键的快捷键"><a href="#查找快捷键的快捷键" class="headerlink" title="查找快捷键的快捷键"></a>查找快捷键的快捷键</h2><p>到现在为止，已经接触了IntelliJ IDEA的不少快捷键了。<br>其实对于学习一个文本编辑器也好、IDE也好，要想用的得心应手，记忆大量的快捷键都是少不了的步骤。  </p>
<p>但如果记不清快捷键怎么办，去哪里查呢？幸好IntelliJ IDEA为我们提供了一个终级快捷键 <code>Cmd+Shift+A</code>，这是一个用来 <strong>查找快捷键的快捷键</strong> ！其它所有的快捷键都忘了也没有关系，只要记得这一个。。。  </p>
<p><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/ulfq5.jpg"></p>
<h2 id="配置Tomcat"><a href="#配置Tomcat" class="headerlink" title="配置Tomcat"></a>配置Tomcat</h2><p>对于Web应用，如果想在本机直接运行测试，除了使用Maven等构建工具内嵌的Application Server之外，还可以选择直接在IntelliJ中配置一个。  </p>
<p>注意请提前配置好Artifacts，然后点击顶部右侧的 <strong>Run Configuration</strong> 按钮，在新窗口中点击左上角加号，选择Tomcat即可：<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/ktr71.jpg"></p>
<h2 id="代码检查"><a href="#代码检查" class="headerlink" title="代码检查"></a>代码检查</h2><p>在向版本库中提交时，可以在右侧选择进行一些提交前的处理，如代码检查、格式化等：<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/dhiou.jpg"></p>
<h2 id="收藏夹"><a href="#收藏夹" class="headerlink" title="收藏夹"></a>收藏夹</h2><p>在Tab页上点击右键，可以选择<code>Add to Favorites</code><br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/i2jlu.jpg"></p>
<p>然后在左下方的Favorites栏中就可以看到了<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/skk0i.jpg"></p>
<h2 id="版本控制"><a href="#版本控制" class="headerlink" title="版本控制"></a>版本控制</h2><p>在窗口左下方的 <strong>Version Control</strong> 栏中，可以查看到做过变更的文件<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/19xe1.jpg"></p>
<p>在文件上右键，可以进行代码差异比对，回滚等操作<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/1qu43.jpg"></p>
<p>在窗口右上方的工具栏中，可以快速Update/Commit<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/r3yuf.jpg"></p>
<p>在窗口右下方的工具栏中，可以查看/新建/切换Git分支<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/af6q8.jpg"></p>
<h2 id="内嵌工具"><a href="#内嵌工具" class="headerlink" title="内嵌工具"></a>内嵌工具</h2><p>菜单栏中，Tools一项中，可以找到很多内嵌的工具，比如很常用的Rest测试工具<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/3ujan.jpg">  </p>
<h2 id="数据源配置"><a href="#数据源配置" class="headerlink" title="数据源配置"></a>数据源配置</h2><p>在右侧的Database工具栏中，可以配置常用的数据源<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/gfeqz.jpg"></p>
<p>配置好之后，就可以使用内嵌的数据库查询管理工具了，另外在编写配置文件或SQL/JPQL时，也会有对应用智能提示<br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/eumg4.jpg"></p>
<h2 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h2><p>以上介绍的，只是IntelliJ IDEA众多功能中的冰山一角，想要了解更多，请进一步参考官方文档：  </p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.jetbrains.com/idea/documentation/">https://www.jetbrains.com/idea/documentation/</a>  </li>
<li><a target="_blank" rel="noopener" href="https://www.jetbrains.com/idea/help/intellij-idea-quick-start-guide.html">https://www.jetbrains.com/idea/help/intellij-idea-quick-start-guide.html</a>  </li>
</ul>
<p>另外官网上也提供了很多的视频教程，其中有不少小技巧。  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.bluexiii.com/201702/%E4%BD%BF%E7%94%A8Python3%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E7%88%AC%E8%99%AB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/201702/%E4%BD%BF%E7%94%A8Python3%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E7%88%AC%E8%99%AB/" class="post-title-link" itemprop="url">使用Python3编写一个爬虫</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-01-26 09:44:33" itemprop="dateCreated datePublished" datetime="2021-01-26T09:44:33+08:00">2021-01-26</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="需求简介"><a href="#需求简介" class="headerlink" title="需求简介"></a>需求简介</h2><p>最近厂里有一个新闻采集类的需求，细节大体如下：</p>
<ol>
<li>模拟登录一个内网网站（SSO）</li>
<li>抓取新闻（支持代理服务器的方式访问）</li>
<li>加工内容样式，以适配手机屏幕</li>
<li>将正文中的图片转存到自已的服务器，并替换<img>标签中的url</li>
<li>图片存储服务器需要复用已有的FastDFS分布式文件系统</li>
<li>采集结果导入生产库</li>
<li>支持日志打印</li>
</ol>
<p>初学Python3，正好用这个需求练练手，最后很惊讶的是只用200多行代码就实现了，如果换成Java的话大概需要1200行吧。果然应了那句老话：<strong>人生苦短，我用Python</strong>  </p>
<h2 id="登录页面抓包"><a href="#登录页面抓包" class="headerlink" title="登录页面抓包"></a>登录页面抓包</h2><p>第一步当然是抓包，然后再根据抓到的内容，模拟进行HTTP请求。  </p>
<p>常用的抓包工具，有Mac下的Charles和Windows下的Fiddler。<br>它们的原理都是在本机开一个HTTP或SOCKS代理服务器端口，然后将浏览器的代理服务器设置成这个端口，这样浏览器中所有的HTTP请求都会先经过抓包工具记录下来了。  </p>
<ul>
<li><p>Chrales<br><a target="_blank" rel="noopener" href="https://www.charlesproxy.com/">https://www.charlesproxy.com</a><br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/p74nq.jpg"></p>
</li>
<li><p>Fiddler<br><a target="_blank" rel="noopener" href="http://www.telerik.com/fiddler">http://www.telerik.com/fiddler</a><br><img src="https://bluexiii.oss-cn-beijing.aliyuncs.com/o552x.jpg"></p>
</li>
</ul>
<p>这里推荐尽量使用Fiddler，原因是Charles对于cookie的展示是有bug的，举个例子，真实情况：请求A返回了LtpaToken这个cookie，请求B中返回了sid这个cookie。但在Charles中的展示是：请求A中已经同时返回了LtpaToken和sid两个cookie，这就很容易误导人了。<br>另外Fiddler现在已经有了Linux的Beta版本，貌似是用类似wine的方式实现的。  </p>
<p>如果网站使用了单点登录，可能会涉及到手工生成cookie。所以不仅需要分析每一条HTTP请求的request和response，以及带回来的cookie，还要对页面中的javascript进行分析，看一下是如何生成cookie的。  </p>
<h2 id="模拟登录"><a href="#模拟登录" class="headerlink" title="模拟登录"></a>模拟登录</h2><p>将页面分析完毕之后，就可以进行模拟HTTP请求了。<br>这里有两个非常好用的第三方库， <strong>request</strong> 和 <strong>BeautifulSoup</strong></p>
<p><strong>requests</strong> 库是用来代替urllib的，可以非常人性化的的生成HTTP请求，模拟session以及伪造cookie更是方便。<br><strong>BeautifulSoup</strong> 用来代替re模块，进行HTML内容解析，可以用tag, class, id来定位想要提取的内容，也支持正则表达式等。  </p>
<p>具体的使用方式直接看官方文档就可以了，写的非常详细，这里直接给出地址：<br><a target="_blank" rel="noopener" href="http://cn.python-requests.org/zh_CN/latest/">requests官方文档</a><br><a target="_blank" rel="noopener" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc.zh/">BeautifulSoup官方文档</a>  </p>
<p>通过pip3来安装这两个模块:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python3-pip</span><br><span class="line">sudo pip3 install requests</span><br><span class="line">sudo pip3 install beautifulsoup4</span><br></pre></td></tr></table></figure>
<p>导入模块：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">from bs4 import BeautifulSoup</span><br></pre></td></tr></table></figure>

<p>模拟登录：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">def sso_login():</span><br><span class="line">    # 调用单点登录工号认证页面</span><br><span class="line">    response &#x3D; session.post(const.SSO_URL,</span><br><span class="line">                            data&#x3D;&#123;&#39;login&#39;: const.LOGIN_USERNAME, &#39;password&#39;: const.LOGIN_PASSWORD, &#39;appid&#39;: &#39;np000&#39;&#125;)</span><br><span class="line"></span><br><span class="line">    # 分析页面，取token及ltpa</span><br><span class="line">    soup &#x3D; BeautifulSoup(response.text, &#39;html.parser&#39;)</span><br><span class="line">    token &#x3D; soup.form.input.get(&#39;value&#39;)</span><br><span class="line">    ltpa &#x3D; soup.form.input.input.input.get(&#39;value&#39;)</span><br><span class="line">    ltpa_value &#x3D; ltpa.split(&#39;;&#39;)[0].split(&#39;&#x3D;&#39;, 1)[1]</span><br><span class="line"></span><br><span class="line">    # 手工设置Cookie</span><br><span class="line">    session.cookies.set(&#39;LtpaToken&#39;, ltpa_value, domain&#x3D;&#39;unicom.local&#39;, path&#x3D;&#39;&#x2F;&#39;)</span><br><span class="line"></span><br><span class="line">    # 调用云门户登录页面(2次）</span><br><span class="line">    payload &#x3D; &#123;&#39;token&#39;: token&#125;</span><br><span class="line">    session.post(const.LOGIN_URL, data&#x3D;payload, proxies&#x3D;const.PROXIES)</span><br><span class="line">    response &#x3D; session.post(const.LOGIN_URL, data&#x3D;payload, proxies&#x3D;const.PROXIES)</span><br><span class="line">    if response.text &#x3D;&#x3D; &quot;success&quot;:</span><br><span class="line">        logging.info(&quot;登录成功&quot;)</span><br><span class="line">        return True</span><br><span class="line">    else:</span><br><span class="line">        logging.info(&quot;登录失败&quot;)</span><br><span class="line">        return False</span><br></pre></td></tr></table></figure>
<p>这里用到了BeautifulSoup进行HTML解析，取出页面中的token、ltpa等字段。<br>然后使用session.cookies.set伪造了一个cookie，注意其中的domain参数，设置成1级域名。<br>然后用这个session，去调用网站页面，换回sid这个token。并可以根据页面的返回信息，来简单判断一下成功还是失败。</p>
<h2 id="列表页面抓取"><a href="#列表页面抓取" class="headerlink" title="列表页面抓取"></a>列表页面抓取</h2><p>登录成功之后，接下来的列表页面抓取就要简单的多了，不考虑分页的话，直接取一个list出来遍历即可。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">def capture_list(list_url):</span><br><span class="line">    response &#x3D; session.get(list_url, proxies&#x3D;const.PROXIES)</span><br><span class="line">    response.encoding &#x3D; &quot;UTF-8&quot;</span><br><span class="line">    soup &#x3D; BeautifulSoup(response.text, &#39;html.parser&#39;)</span><br><span class="line">    news_list &#x3D; soup.find(&#39;div&#39;, &#39;xinwen_list&#39;).find_all(&#39;a&#39;)</span><br><span class="line">    news_list.reverse()</span><br><span class="line">    logging.info(&quot;开始采集&quot;)</span><br><span class="line">    for news_archor in news_list:</span><br><span class="line">        news_cid &#x3D; news_archor.attrs[&#39;href&#39;].split(&#39;&#x3D;&#39;)[1]</span><br><span class="line">        capture_content(news_cid)</span><br><span class="line">    logging.info(&quot;结束采集&quot;)</span><br></pre></td></tr></table></figure>
<p>这里使用了<code>response.encoding = &quot;UTF-8&quot;</code>来手工解决乱码问题。  </p>
<h2 id="新联页面抓取"><a href="#新联页面抓取" class="headerlink" title="新联页面抓取"></a>新联页面抓取</h2><p>新闻页面抓取，涉及到插临时表，这里没有使用每三方库，直接用SQL方式插入。<br>其中涉及到样式处理与图片转存，另写一个模块<code>pconvert</code>来实现。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">def capture_content(news_cid):</span><br><span class="line">    # 建立DB连接</span><br><span class="line">    conn &#x3D; mysql.connector.connect(user&#x3D;const.DB_USERNAME, password&#x3D;const.DB_PASSWORD, host&#x3D;const.DB_HOST,</span><br><span class="line">                                   port&#x3D;const.DB_PORT, database&#x3D;const.DB_DATABASE)</span><br><span class="line">    cursor &#x3D; conn.cursor()</span><br><span class="line"></span><br><span class="line">    # 判断是否已存在</span><br><span class="line">    cursor.execute(&#39;select count(*) from material_prepare where news_cid &#x3D; %s&#39;, (news_cid,))</span><br><span class="line">    news_count &#x3D; cursor.fetchone()[0]</span><br><span class="line">    if news_count &gt; 0:</span><br><span class="line">        logging.info(&quot;采集&quot; + news_cid + &#39;:已存在&#39;)</span><br><span class="line">    else:</span><br><span class="line">        logging.info(&quot;采集&quot; + news_cid + &#39;:新增&#39;)</span><br><span class="line">        news_url &#x3D; const.NEWS_BASE_URL + news_cid</span><br><span class="line">        response &#x3D; session.post(news_url, proxies&#x3D;const.PROXIES)</span><br><span class="line">        response.encoding &#x3D; &quot;UTF-8&quot;</span><br><span class="line">        soup &#x3D; BeautifulSoup(response.text, &#39;html.parser&#39;)</span><br><span class="line">        # logging.info(soup)</span><br><span class="line">        news_title &#x3D; soup.h3.text.strip()[:64]</span><br><span class="line">        news_brief &#x3D; soup.find(&#39;div&#39;, &#39;brief&#39;).p.text.strip()[:100]</span><br><span class="line">        news_author &#x3D; soup.h5.span.a.text.strip()[:100]</span><br><span class="line">        news_content &#x3D; soup.find(&#39;table&#39;, &#39;unis_detail_content&#39;).tr.td.prettify()[66:-7].strip()</span><br><span class="line">        # 样式处理</span><br><span class="line">        news_content &#x3D; pconvert.convert_style(news_content)</span><br><span class="line">        # 将图片转存至DFS并替换URL</span><br><span class="line">        news_content &#x3D; pconvert.convert_img(news_content)</span><br><span class="line">        # 入表</span><br><span class="line">        cursor.execute(</span><br><span class="line">            &#39;INSERT INTO material_prepare (news_cid, title, author, summary, content, add_time, status)  VALUES  (%s, %s, %s, %s, %s, now(), &quot;0&quot;)&#39;</span><br><span class="line">            , [news_cid, news_title, news_author, news_brief, news_content])</span><br><span class="line">    # 提交</span><br><span class="line">    conn.commit()</span><br><span class="line">    cursor.close()</span><br></pre></td></tr></table></figure>
<h2 id="样式处理"><a href="#样式处理" class="headerlink" title="样式处理"></a>样式处理</h2><p>文本样式处理，还是要用到BeautifulSoup，因为原始站点上的新闻内容样式是五花八门的，根据实际情况，一边写一个test函数来生成文本，一边在浏览器上慢慢调试。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def convert_style(rawtext):</span><br><span class="line">    newtext &#x3D; &#39;&lt;div style&#x3D;&quot;margin-left: 0px; margin-right:0px; letter-spacing: 1px; word-spacing:2px;line-height: 1.7em; font-size:18px;text-align:justify; text-justify:inter-ideograph&quot;&gt;&#39; \</span><br><span class="line">              + rawtext + &#39;&lt;&#x2F;div&gt;&#39;</span><br><span class="line">    newtext &#x3D; newtext.replace(&#39; align&#x3D;&quot;center&quot;&#39;, &#39;&#39;)</span><br><span class="line">    soup &#x3D; BeautifulSoup(newtext, &#39;html.parser&#39;)</span><br><span class="line">    img_tags &#x3D; soup.find_all(&quot;img&quot;)</span><br><span class="line">    for img_tag in img_tags:</span><br><span class="line">        del img_tag.parent[&#39;style&#39;]</span><br><span class="line">    return soup.prettify()</span><br></pre></td></tr></table></figure>


<h2 id="图片转存至DFS"><a href="#图片转存至DFS" class="headerlink" title="图片转存至DFS"></a>图片转存至DFS</h2><p>因为原始站点是在内网中的，采集下来的HTML中，<img>标签的地址是内网地址，所以在公网中是展现不出来的，需要将图片转存，并用新的URL替换原有的URL。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def convert_img(rawtext):</span><br><span class="line">    soup &#x3D; BeautifulSoup(rawtext, &#39;html.parser&#39;)</span><br><span class="line">    img_tags &#x3D; soup.find_all(&quot;img&quot;)</span><br><span class="line">    for img_tag in img_tags:</span><br><span class="line">        raw_img_url &#x3D; img_tag[&#39;src&#39;]</span><br><span class="line">        dfs_img_url &#x3D; convert_url(raw_img_url)</span><br><span class="line">        img_tag[&#39;src&#39;] &#x3D; dfs_img_url</span><br><span class="line">        del img_tag[&#39;style&#39;]</span><br><span class="line">    return soup.prettify()</span><br></pre></td></tr></table></figure>
<p>图片转存最简单的方式是保存成本地的文件，然后再通过nginx或httpd服务将图片开放出去：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pic_name &#x3D; raw_img_url.split(&#39;&#x2F;&#39;)[-1]</span><br><span class="line">pic_path &#x3D; TMP_PATH + &#39;&#x2F;&#39; + pic_name</span><br><span class="line">with open(pic_path, &#39;wb&#39;) as pic_file:</span><br><span class="line">   pic_file.write(pic_content)</span><br></pre></td></tr></table></figure>
<p>但这里我们需要复用已有的FastDFS分布式文件系统，要用到它的一个客户端的库<code>fdfs_client-py</code><br>fdfs_client-py不能直接使用pip3安装，需要直接使用一个python3版的源码，并手工修改其中代码。操作过程如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;jefforeilly&#x2F;fdfs_client-py.git</span><br><span class="line">cd dfs_client-py</span><br><span class="line">vi .&#x2F;fdfs_client&#x2F;storage_client.py</span><br><span class="line">将第12行 from fdfs_client.sendfile import * 注释掉</span><br><span class="line">python3 setup.py install</span><br><span class="line"></span><br><span class="line">sudo pip3 install mutagen</span><br></pre></td></tr></table></figure>
<p>客户端的使用上没有什么特别的，直接调用<code>upload_by_buffer</code>，传一个图片的buffer进去就可以了，成功后会返回自动生成的文件名。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from fdfs_client.client import *</span><br><span class="line">dfs_client &#x3D; Fdfs_client(&#39;conf&#x2F;dfs.conf&#39;)</span><br><span class="line">def convert_url(raw_img_url):</span><br><span class="line">    response &#x3D; requests.get(raw_img_url, proxies&#x3D;const.PROXIES)</span><br><span class="line">    pic_buffer &#x3D; response.content</span><br><span class="line">    pic_ext &#x3D; raw_img_url.split(&#39;.&#39;)[-1]</span><br><span class="line">    response &#x3D; dfs_client.upload_by_buffer(pic_buffer, pic_ext)</span><br><span class="line">    dfs_img_url &#x3D; const.DFS_BASE_URL + &#39;&#x2F;&#39; + response[&#39;Remote file_id&#39;]</span><br><span class="line">    return dfs_img_url</span><br></pre></td></tr></table></figure>
<p>其中dfs.conf文件中，主要就是配置一下 <strong>tracker_server</strong></p>
<h2 id="日志处理"><a href="#日志处理" class="headerlink" title="日志处理"></a>日志处理</h2><p>这里使用配置文件的方式处理日志，类似JAVA中的log4j吧，首先新建一个<code>log.conf</code>：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[loggers]</span><br><span class="line">keys&#x3D;root</span><br><span class="line"></span><br><span class="line">[handlers]</span><br><span class="line">keys&#x3D;stream_handler,file_handler</span><br><span class="line"></span><br><span class="line">[formatters]</span><br><span class="line">keys&#x3D;formatter</span><br><span class="line"></span><br><span class="line">[logger_root]</span><br><span class="line">level&#x3D;DEBUG</span><br><span class="line">handlers&#x3D;stream_handler,file_handler</span><br><span class="line"></span><br><span class="line">[handler_stream_handler]</span><br><span class="line">class&#x3D;StreamHandler</span><br><span class="line">level&#x3D;DEBUG</span><br><span class="line">formatter&#x3D;formatter</span><br><span class="line">args&#x3D;(sys.stderr,)</span><br><span class="line"></span><br><span class="line">[handler_file_handler]</span><br><span class="line">class&#x3D;FileHandler</span><br><span class="line">level&#x3D;DEBUG</span><br><span class="line">formatter&#x3D;formatter</span><br><span class="line">args&#x3D;(&#39;logs&#x2F;pspider.log&#39;,&#39;a&#39;,&#39;utf8&#39;)</span><br><span class="line"></span><br><span class="line">[formatter_formatter]</span><br><span class="line">format&#x3D;%(asctime)s %(name)-12s %(levelname)-8s %(message)s</span><br></pre></td></tr></table></figure>
<p>这里通过配置handlers，可以同时将日志打印到stderr和文件。<br>注意<code>args=(&#39;logs/pspider.log&#39;,&#39;a&#39;,&#39;utf8&#39;)</code> 这一行，用来解决文本文件中的中文乱码问题。  </p>
<p>日志初始化：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import logging</span><br><span class="line">from logging.config import fileConfig</span><br><span class="line"></span><br><span class="line">fileConfig(&#39;conf&#x2F;log.conf&#39;)</span><br></pre></td></tr></table></figure>
<p>日志打印：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.info(&quot;test&quot;)</span><br></pre></td></tr></table></figure>
<h2 id="完整源码"><a href="#完整源码" class="headerlink" title="完整源码"></a>完整源码</h2><p>到此为止，就是如何用Python3写一个爬虫的全部过程了。<br>采集不同的站点，肯定是要有不同的处理，但方法都是大同小异。<br>最后，将源码做了部分裁剪，分享在了GitHub上。<br><a target="_blank" rel="noopener" href="https://github.com/xiiiblue/pspider">https://github.com/xiiiblue/pspider</a><br>最后，将源码做了部分裁剪，分享在了GitLab上。<br><a target="_blank" rel="noopener" href="http://git.si-tech.com.cn/guolei/pspider">http://git.si-tech.com.cn/guolei/pspider</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/11/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/28/">28</a><a class="extend next" rel="next" href="/page/13/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">BlueXIII</p>
  <div class="site-description" itemprop="description">IT技术类文章、笔记分享</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">273</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/xiiiblue" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;xiiiblue" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/bluexiii" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;bluexiii" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备18050487号-1 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BlueXIII</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
