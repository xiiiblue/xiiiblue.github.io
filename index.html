<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.bluexiii.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="IT技术类文章、笔记分享">
<meta property="og:type" content="website">
<meta property="og:title" content="BlueXIII&#39;s Blog">
<meta property="og:url" content="http://blog.bluexiii.com/index.html">
<meta property="og:site_name" content="BlueXIII&#39;s Blog">
<meta property="og:description" content="IT技术类文章、笔记分享">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="BlueXIII">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://blog.bluexiii.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>BlueXIII's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">BlueXIII's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">热爱技术,持续学习</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/202303/%E5%B0%8F%E7%B1%B3%E8%B7%AF%E7%94%B1%E5%99%A8R1D%E6%8A%98%E8%85%BE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202303/%E5%B0%8F%E7%B1%B3%E8%B7%AF%E7%94%B1%E5%99%A8R1D%E6%8A%98%E8%85%BE/" class="post-title-link" itemprop="url">小米路由器R1D折腾</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-03-05 22:17:00" itemprop="dateCreated datePublished" datetime="2023-03-05T22:17:00+08:00">2023-03-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-03-24 09:54:47" itemprop="dateModified" datetime="2023-03-24T09:54:47+08:00">2023-03-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="R1D二级路由规则配置"><a href="#R1D二级路由规则配置" class="headerlink" title="R1D二级路由规则配置"></a>R1D二级路由规则配置</h2><p>参考: <a target="_blank" rel="noopener" href="https://www.right.com.cn/forum/thread-4040453-1-1.html">https://www.right.com.cn/forum/thread-4040453-1-1.html</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/config/firewall</span><br><span class="line">config zone</span><br><span class="line">    option name <span class="string">&#x27;lan&#x27;</span></span><br><span class="line">    option input <span class="string">&#x27;ACCEPT&#x27;</span></span><br><span class="line">    option output <span class="string">&#x27;ACCEPT&#x27;</span></span><br><span class="line">    option forward <span class="string">&#x27;ACCEPT&#x27;</span></span><br><span class="line"></span><br><span class="line">config zone</span><br><span class="line">    option name <span class="string">&#x27;wan&#x27;</span></span><br><span class="line">    option input <span class="string">&#x27;ACCEPT&#x27;</span></span><br><span class="line">    option output <span class="string">&#x27;ACCEPT&#x27;</span></span><br><span class="line">    option forward <span class="string">&#x27;ACCEPT&#x27;</span></span><br><span class="line"></span><br><span class="line">config forwarding</span><br><span class="line">    option src <span class="string">&#x27;wan&#x27;</span></span><br><span class="line">    option dest <span class="string">&#x27;lan&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="R1D开启SSH"><a href="#R1D开启SSH" class="headerlink" title="R1D开启SSH"></a>R1D开启SSH</h2><ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/wxqcom007/article/details/116858099">https://blog.csdn.net/wxqcom007/article/details/116858099</a> 参考文档</li>
<li><a target="_blank" rel="noopener" href="http://www1.miwifi.com/miwifi_download.html">http://www1.miwifi.com/miwifi_download.html</a> 开发版固件2.25.213</li>
<li><a target="_blank" rel="noopener" href="http://d.miwifi.com/rom/ssh">http://d.miwifi.com/rom/ssh</a> 官方SSH工具地址</li>
</ul>
<h2 id="R1D更换硬盘"><a href="#R1D更换硬盘" class="headerlink" title="R1D更换硬盘"></a>R1D更换硬盘</h2><ul>
<li><a target="_blank" rel="noopener" href="https://jingyan.baidu.com/article/e75aca853014b5142edac6d1.html">https://jingyan.baidu.com/article/e75aca853014b5142edac6d1.html</a></li>
<li><a target="_blank" rel="noopener" href="https://www1.miwifi.com/wap_download.html">https://www1.miwifi.com/wap_download.html</a></li>
</ul>
<ol>
<li>使用DiskGenius分区，GPT分区表，4个分区大小为:156M，156M，312M，剩余空间一个区</li>
<li>刷机包名中带有hdk的bin文件，重命名为miwifi.bin, 放在U盘的根目录</li>
</ol>
<h2 id="AC2100刷机教程"><a href="#AC2100刷机教程" class="headerlink" title="AC2100刷机教程"></a>AC2100刷机教程</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.right.com.cn/forum/thread-4054150-1-1.html">https://www.right.com.cn/forum/thread-4054150-1-1.html</a>  AC2100刷Breed</li>
<li><a target="_blank" rel="noopener" href="https://www.right.com.cn/forum/thread-8234820-1-1.html">https://www.right.com.cn/forum/thread-8234820-1-1.html</a>  AC2100 OpenWRT 闭源WIFI</li>
<li><a target="_blank" rel="noopener" href="https://opt.cn2qq.com/padavan/">https://opt.cn2qq.com/padavan/</a>  AC2100 Padavan HIBOY下载</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/202302/OpenWRT%E7%BC%96%E8%AF%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202302/OpenWRT%E7%BC%96%E8%AF%91/" class="post-title-link" itemprop="url">OpenWRT编译</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-02-28 11:15:14" itemprop="dateCreated datePublished" datetime="2023-02-28T11:15:14+08:00">2023-02-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-03-24 09:54:36" itemprop="dateModified" datetime="2023-03-24T09:54:36+08:00">2023-03-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><h3 id="教程"><a href="#教程" class="headerlink" title="教程"></a>教程</h3><ul>
<li><a target="_blank" rel="noopener" href="https://shenyu.me/2021/02/26/x86-64-install-openwrt.html">https://shenyu.me/2021/02/26/x86-64-install-openwrt.html</a></li>
<li><a target="_blank" rel="noopener" href="https://www.openos.org/threads/openwrt-emmc.3523/">https://www.openos.org/threads/openwrt-emmc.3523/</a></li>
</ul>
<h3 id="LEDE源码"><a href="#LEDE源码" class="headerlink" title="LEDE源码"></a>LEDE源码</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/coolsnowwolf/lede">https://github.com/coolsnowwolf/lede</a></li>
<li><a target="_blank" rel="noopener" href="https://shimo.im/docs/gYjt9QVr8T9Vhv9X?fallback=1">https://shimo.im/docs/gYjt9QVr8T9Vhv9X?fallback=1</a></li>
</ul>
<h3 id="openwrt-cc项目"><a href="#openwrt-cc项目" class="headerlink" title="openwrt.cc项目"></a>openwrt.cc项目</h3><ul>
<li><a target="_blank" rel="noopener" href="https://openwrt.cc/releases/targets/x86/64/">https://openwrt.cc/releases/targets/x86/64/</a></li>
</ul>
<h2 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 安装依赖</span></span><br><span class="line">sudo apt update -y</span><br><span class="line">sudo apt full-upgrade -y</span><br><span class="line">sudo apt install -y ack antlr3 aria2 asciidoc autoconf automake autopoint binutils bison build-essential \</span><br><span class="line">bzip2 ccache cmake cpio curl device-tree-compiler fastjar flex gawk gettext gcc-multilib g++-multilib \</span><br><span class="line">git gperf haveged help2man intltool libc6-dev-i386 libelf-dev libglib2.0-dev libgmp3-dev libltdl-dev \</span><br><span class="line">libmpc-dev libmpfr-dev libncurses5-dev libncursesw5-dev libreadline-dev libssl-dev libtool lrzsz \</span><br><span class="line">mkisofs msmtp nano ninja-build p7zip p7zip-full patch pkgconf python2.7 python3 python3-pip libpython3-dev qemu-utils \</span><br><span class="line">rsync scons squashfs-tools subversion swig texinfo uglifyjs upx-ucl unzip vim wget xmlto xxd zlib1g-dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载源代码</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/coolsnowwolf/lede</span><br><span class="line"><span class="built_in">cd</span> lede</span><br><span class="line"></span><br><span class="line"><span class="comment"># 缝合其他插件</span></span><br><span class="line">vi feeds.conf.default</span><br><span class="line">src-git kenzo https://github.com/kenzok8/openwrt-packages</span><br><span class="line">src-git small https://github.com/kenzok8/small</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置</span></span><br><span class="line">./scripts/feeds update -a</span><br><span class="line">./scripts/feeds install -a</span><br><span class="line">make menuconfig</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载并编译</span></span><br><span class="line">make download -j8 &amp;&amp; make V=s -j1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 二次编译</span></span><br><span class="line"><span class="built_in">cd</span> lede</span><br><span class="line">git pull</span><br><span class="line">./scripts/feeds update -a</span><br><span class="line">./scripts/feeds install -a</span><br><span class="line">make defconfig</span><br><span class="line">make download -j8</span><br><span class="line">make V=s -j$(nproc)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新配置</span></span><br><span class="line">rm -rf ./tmp &amp;&amp; rm -rf .config</span><br><span class="line">make menuconfig</span><br><span class="line">make V=s -j$(nproc)</span><br></pre></td></tr></table></figure>

<h2 id="常用包"><a href="#常用包" class="headerlink" title="常用包"></a>常用包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">passwall ** </span><br><span class="line">全能推送</span><br><span class="line">OpenClash</span><br><span class="line">动态DNS luci-app-ddns</span><br><span class="line">迅雷快鸟 luci-app-xlnetacc</span><br><span class="line">Frpc luci-app-frpc</span><br><span class="line">Frps luci-app-frps</span><br><span class="line">Docker luci-app-dockerman</span><br><span class="line">OpenVPN服务器 luci-app-openvpn-server</span><br><span class="line">静态路由</span><br><span class="line">IP&#x2F;MAC绑定</span><br><span class="line">Turbo ACC网络加速 luci-app-turboacc</span><br><span class="line">宽带监控</span><br><span class="line">UPnp</span><br><span class="line">ip限速  luci-app-eqos</span><br><span class="line">Qos流量控制 luci-app-sqm</span><br><span class="line">磁盘管理 luci-app-diskman</span><br><span class="line">USB打印机 luci-app-usb-printer</span><br><span class="line">网页命令行 luci-app-ttyd</span><br><span class="line">KMS服务器 luci-app-vlmcsd</span><br><span class="line">流量监控 luci-app-wrtbwmon</span><br><span class="line">释放内存 luci-app-ramfree</span><br><span class="line">负载均衡 luci-app-mwan3</span><br><span class="line">多播 luci-app-syncdial</span><br><span class="line">wireguard luci-app-wireguard</span><br><span class="line">网络唤醒 luci-app-wolplus</span><br><span class="line"></span><br><span class="line">## 虚拟机</span><br><span class="line">qemu-ga</span><br><span class="line">open-vm-tools</span><br><span class="line"></span><br><span class="line"># 其它</span><br><span class="line">luci-app-ddns</span><br><span class="line">luci-app-xlnetacc</span><br><span class="line">luci-app-frpc</span><br><span class="line">luci-app-frps</span><br><span class="line">luci-app-dockerman **</span><br><span class="line">luci-app-openvpn-server</span><br><span class="line">luci-app-turboacc</span><br><span class="line">luci-app-eqos</span><br><span class="line">luci-app-sqm</span><br><span class="line">luci-app-diskman</span><br><span class="line">luci-app-usb-printer</span><br><span class="line">luci-app-ttyd</span><br><span class="line">luci-app-vlmcsd</span><br><span class="line">luci-app-wrtbwmon</span><br><span class="line">luci-app-ramfree</span><br><span class="line">luci-app-mwan3</span><br><span class="line">luci-app-syncdial</span><br><span class="line">luci-app-wireguard</span><br><span class="line">luci-app-wolplus</span><br><span class="line">qemu-ga</span><br><span class="line">open-vm-tools</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/202302/Chronyd%E7%AE%80%E6%98%93%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202302/Chronyd%E7%AE%80%E6%98%93%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">Chronyd简易配置</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-02-27 17:18:03" itemprop="dateCreated datePublished" datetime="2023-02-27T17:18:03+08:00">2023-02-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-03-24 09:54:25" itemprop="dateModified" datetime="2023-03-24T09:54:25+08:00">2023-03-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a target="_blank" rel="noopener" href="https://blog.51cto.com/u_13737725/3179352">https://blog.51cto.com/u_13737725/3179352</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ibm.com/docs/zh/db2/11.1?topic=suntp-setting-up-chrony-as-network-time-protocol-server-client-by-using-chronyd-linux">https://www.ibm.com/docs/zh/db2/11.1?topic=suntp-setting-up-chrony-as-network-time-protocol-server-client-by-using-chronyd-linux</a></li>
</ul>
<h2 id="常规操作"><a href="#常规操作" class="headerlink" title="常规操作"></a>常规操作</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置文件</span></span><br><span class="line">vi /etc/chrony.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看同步状态</span></span><br><span class="line">timedatectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开机自启</span></span><br><span class="line">systemctl status chronyd</span><br><span class="line">systemctl start chronyd</span><br><span class="line">systemctl <span class="built_in">enable</span> chronyd</span><br></pre></td></tr></table></figure>
<h2 id="服务端配置"><a href="#服务端配置" class="headerlink" title="服务端配置"></a>服务端配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">driftfile &#x2F;var&#x2F;lib&#x2F;chrony&#x2F;drift</span><br><span class="line">local stratum 8</span><br><span class="line">manual</span><br><span class="line">allow 0.0.0.0&#x2F;0</span><br></pre></td></tr></table></figure>
<h2 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server master iburst</span><br><span class="line">driftfile &#x2F;var&#x2F;lib&#x2F;chrony&#x2F;drift</span><br><span class="line">logdir &#x2F;var&#x2F;log&#x2F;chrony</span><br><span class="line">log measurements statistics tracking</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/202302/Linux%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202302/Linux%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">Linux虚拟网络学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-02-23 15:35:37" itemprop="dateCreated datePublished" datetime="2023-02-23T15:35:37+08:00">2023-02-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-03-24 09:54:30" itemprop="dateModified" datetime="2023-03-24T09:54:30+08:00">2023-03-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a target="_blank" rel="noopener" href="https://blog.phpgao.com/openwrt-interface.html">https://blog.phpgao.com/openwrt-interface.html</a>  openwrt中br-lan,eth0,eth0.1,eth0.2</li>
<li><a target="_blank" rel="noopener" href="http://www.kdyzm.cn/post/121">http://www.kdyzm.cn/post/121</a> 主路由、旁路由、单臂路由的区别</li>
<li><a target="_blank" rel="noopener" href="https://thiscute.world/posts/linux-virtual-network-interfaces">https://thiscute.world/posts/linux-virtual-network-interfaces</a> Linux 中的虚拟网络接口</li>
<li><a target="_blank" rel="noopener" href="https://thiscute.world/posts/iptables-and-container-networks">https://thiscute.world/posts/iptables-and-container-networks</a> iptables 及 docker 容器网络分析</li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zylSec/p/14743285.html">https://www.cnblogs.com/zylSec/p/14743285.html</a>  VLAN虚拟局域网知识笔记之(二)</li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/469430240">https://zhuanlan.zhihu.com/p/469430240</a>  交换机和路由器到底有什么区别</li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/293658778">https://zhuanlan.zhihu.com/p/293658778</a> Linux tun:tap 详解</li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/293659939">https://zhuanlan.zhihu.com/p/293659939</a> Linux veth pair 详解</li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/293659403">https://zhuanlan.zhihu.com/p/293659403</a> Linux netns 详解</li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/293667316">https://zhuanlan.zhihu.com/p/293667316</a> Linux Bridge 详解</li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/351560182">https://zhuanlan.zhihu.com/p/351560182</a> Linux 环回网络接口</li>
</ul>
<h2 id="tun-tap"><a href="#tun-tap" class="headerlink" title="tun/tap"></a>tun/tap</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 tap </span></span><br><span class="line">ip tuntap add dev tap0 mode tap </span><br><span class="line"><span class="comment"># 创建 tun</span></span><br><span class="line">ip tuntap add dev tun0 mode tun </span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除 tap</span></span><br><span class="line">ip tuntap del dev tap0 mode tap</span><br><span class="line"><span class="comment"># 删除 tun</span></span><br><span class="line">ip tuntap del dev tun0 mode tun </span><br><span class="line"></span><br><span class="line"><span class="comment"># 例如使用ip link命令也可以删除tun/tap设备</span></span><br><span class="line">ip link del tap0</span><br><span class="line">ip link del tun0</span><br></pre></td></tr></table></figure>
<h2 id="netns"><a href="#netns" class="headerlink" title="netns"></a>netns</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">ip netns list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加并启动虚拟网卡tap设备</span></span><br><span class="line">ip tuntap add dev tap0 mode tap </span><br><span class="line">ip tuntap add dev tap1 mode tap </span><br><span class="line">ip link <span class="built_in">set</span> tap0 up</span><br><span class="line">ip link <span class="built_in">set</span> tap1 up</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置IP</span></span><br><span class="line">ip addr add 10.0.0.1/24 dev tap0</span><br><span class="line">ip addr add 10.0.0.2/24 dev tap1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加netns</span></span><br><span class="line">ip netns add ns0</span><br><span class="line">ip netns add ns1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将虚拟网卡tap0，tap1分别移动到ns0和ns1中</span></span><br><span class="line">ip link <span class="built_in">set</span> tap0 netns ns0</span><br><span class="line">ip link <span class="built_in">set</span> tap1 netns ns1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定netns后查看网卡</span></span><br><span class="line">ip netns <span class="built_in">exec</span> ns0 ip a</span><br><span class="line">ip netns <span class="built_in">exec</span> ns1 ip a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新启动网卡并设置IP</span></span><br><span class="line">ip netns <span class="built_in">exec</span> ns0 ip link <span class="built_in">set</span> lo up</span><br><span class="line">ip netns <span class="built_in">exec</span> ns0 ip link <span class="built_in">set</span> tap0 up</span><br><span class="line">ip netns <span class="built_in">exec</span> ns0 ip addr add 10.0.0.1/24 dev tap0</span><br><span class="line"></span><br><span class="line">ip netns <span class="built_in">exec</span> ns1 ip link <span class="built_in">set</span> lo up</span><br><span class="line">ip netns <span class="built_in">exec</span> ns1 ip link <span class="built_in">set</span> tap1 up</span><br><span class="line">ip netns <span class="built_in">exec</span> ns1 ip addr add 10.0.0.2/24 dev tap1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定netns后ping</span></span><br><span class="line">ip netns <span class="built_in">exec</span> ns0 ping 10.0.0.1</span><br><span class="line">ip netns <span class="built_in">exec</span> ns1 ping 10.0.0.2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理</span></span><br><span class="line">ip netns delete ns0</span><br><span class="line">ip netns delete ns1</span><br></pre></td></tr></table></figure>
<h2 id="vethpair"><a href="#vethpair" class="headerlink" title="vethpair"></a>vethpair</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加netns</span></span><br><span class="line">ip netns add ns0</span><br><span class="line">ip netns add ns1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一对veth</span></span><br><span class="line">ip link add veth0 <span class="built_in">type</span> veth peer name veth1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将veth移动到netns中</span></span><br><span class="line">ip link <span class="built_in">set</span> veth0 netns ns0</span><br><span class="line">ip link <span class="built_in">set</span> veth1 netns ns1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定netns后查看网卡</span></span><br><span class="line">ip netns <span class="built_in">exec</span> ns0 ip a</span><br><span class="line">ip netns <span class="built_in">exec</span> ns1 ip a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动</span></span><br><span class="line">ip netns <span class="built_in">exec</span> ns0 ip link <span class="built_in">set</span> veth0 up</span><br><span class="line">ip netns <span class="built_in">exec</span> ns1 ip link <span class="built_in">set</span> veth1 up</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看路由表</span></span><br><span class="line">ip netns <span class="built_in">exec</span> ns0 route -n</span><br><span class="line">ip netns <span class="built_in">exec</span> ns1 route -n</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改路由出口为veth</span></span><br><span class="line">ip netns <span class="built_in">exec</span> ns0 ip route change 10.0.0.0/24 via 0.0.0.0 dev veth0</span><br><span class="line">ip netns <span class="built_in">exec</span> ns1 ip route change 10.0.0.0/24 via 0.0.0.0 dev veth1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 跨ns互ping</span></span><br><span class="line">ip netns <span class="built_in">exec</span> ns0 ping 10.0.0.2</span><br><span class="line">ip netns <span class="built_in">exec</span> ns1 ping 10.0.0.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理</span></span><br><span class="line">ip netns delete ns0</span><br><span class="line">ip netns delete ns1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="bridge"><a href="#bridge" class="headerlink" title="bridge"></a>bridge</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装bridge-utils</span></span><br><span class="line">yum install -y bridge-utils</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加网桥</span></span><br><span class="line">brctl addbr br0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动网桥</span></span><br><span class="line">ip link <span class="built_in">set</span> br0 up</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新增三个netns</span></span><br><span class="line">ip netns add ns0</span><br><span class="line">ip netns add ns1</span><br><span class="line">ip netns add ns2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新增两对veth</span></span><br><span class="line">ip link add veth0-ns <span class="built_in">type</span> veth peer name veth0-br</span><br><span class="line">ip link add veth1-ns <span class="built_in">type</span> veth peer name veth1-br</span><br><span class="line">ip link add veth2-ns <span class="built_in">type</span> veth peer name veth2-br</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将veth的一端移动到netns中</span></span><br><span class="line">ip link <span class="built_in">set</span> veth0-ns netns ns0</span><br><span class="line">ip link <span class="built_in">set</span> veth1-ns netns ns1</span><br><span class="line">ip link <span class="built_in">set</span> veth2-ns netns ns2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将netns中的本地环回和veth启动并配置IP</span></span><br><span class="line">ip netns <span class="built_in">exec</span> ns0 ip link <span class="built_in">set</span> lo up</span><br><span class="line">ip netns <span class="built_in">exec</span> ns0 ip link <span class="built_in">set</span> veth0-ns up</span><br><span class="line">ip netns <span class="built_in">exec</span> ns0 ip addr add 10.0.0.1/24 dev veth0-ns</span><br><span class="line"></span><br><span class="line">ip netns <span class="built_in">exec</span> ns1 ip link <span class="built_in">set</span> lo up</span><br><span class="line">ip netns <span class="built_in">exec</span> ns1 ip link <span class="built_in">set</span> veth1-ns up</span><br><span class="line">ip netns <span class="built_in">exec</span> ns1 ip addr add 10.0.0.2/24 dev veth1-ns</span><br><span class="line"></span><br><span class="line">ip netns <span class="built_in">exec</span> ns2 ip link <span class="built_in">set</span> lo up</span><br><span class="line">ip netns <span class="built_in">exec</span> ns2 ip link <span class="built_in">set</span> veth2-ns up</span><br><span class="line">ip netns <span class="built_in">exec</span> ns2 ip addr add 10.0.0.3/24 dev veth2-ns</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看网卡</span></span><br><span class="line">ip netns <span class="built_in">exec</span> ns0 ip a</span><br><span class="line">ip netns <span class="built_in">exec</span> ns1 ip a</span><br><span class="line">ip netns <span class="built_in">exec</span> ns2 ip a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看路由表</span></span><br><span class="line">ip netns <span class="built_in">exec</span> ns0 route -n</span><br><span class="line">ip netns <span class="built_in">exec</span> ns1 route -n</span><br><span class="line">ip netns <span class="built_in">exec</span> ns2 route -n</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将veth的另一端启动并挂载到网桥上</span></span><br><span class="line">ip link <span class="built_in">set</span> veth0-br up</span><br><span class="line">ip link <span class="built_in">set</span> veth1-br up</span><br><span class="line">ip link <span class="built_in">set</span> veth2-br up</span><br><span class="line">brctl addif br0 veth0-br</span><br><span class="line">brctl addif br0 veth1-br</span><br><span class="line">brctl addif br0 veth2-br</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询网桥</span></span><br><span class="line">brctl show</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加iptables规则</span></span><br><span class="line">iptables -A FORWARD -i br0 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试网络连通性</span></span><br><span class="line">ip netns <span class="built_in">exec</span> ns0 ping 10.0.0.1</span><br><span class="line">ip netns <span class="built_in">exec</span> ns0 ping 10.0.0.2</span><br><span class="line">ip netns <span class="built_in">exec</span> ns0 ping 10.0.0.3</span><br></pre></td></tr></table></figure>
<h2 id="localhost"><a href="#localhost" class="headerlink" title="localhost"></a>localhost</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查本地的路由表</span></span><br><span class="line">ip route show table <span class="built_in">local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查主路由表</span></span><br><span class="line">ip route show table main</span><br><span class="line"></span><br><span class="line"><span class="comment"># 环回网络接口</span></span><br><span class="line">ifconfig lo</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/202301/Prometheus%E7%9B%91%E6%8E%A7%E8%AF%A6%E7%BB%86%E6%AD%A5%E9%AA%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202301/Prometheus%E7%9B%91%E6%8E%A7%E8%AF%A6%E7%BB%86%E6%AD%A5%E9%AA%A4/" class="post-title-link" itemprop="url">Prometheus监控详细步骤</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-01-13 09:44:10" itemprop="dateCreated datePublished" datetime="2023-01-13T09:44:10+08:00">2023-01-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-03-24 09:54:50" itemprop="dateModified" datetime="2023-03-24T09:54:50+08:00">2023-03-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h2><ul>
<li><a target="_blank" rel="noopener" href="https://grafana.com/grafana/download?edition=oss">https://grafana.com/grafana/download?edition=oss</a></li>
<li><a target="_blank" rel="noopener" href="https://prometheus.io/download/">https://prometheus.io/download/</a></li>
</ul>
<h2 id="Grafana"><a href="#Grafana" class="headerlink" title="Grafana"></a>Grafana</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rpm方式安装</span></span><br><span class="line">wget https://dl.grafana.com/oss/release/grafana-9.3.2-1.x86_64.rpm</span><br><span class="line">sudo yum install grafana-9.3.2-1.x86_64.rpm</span><br><span class="line">systemctl start grafana-server</span><br><span class="line">systemctl <span class="built_in">enable</span> grafana-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># 二进制方式安装</span></span><br><span class="line">nohup ./grafana-server 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录地址</span></span><br><span class="line">http://192.168.101.211:3000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 钉钉推送地址</span></span><br><span class="line">https://oapi.zingtalk.com/robot/send?access_token=........</span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份</span></span><br><span class="line">/var/lib/grafana/grafana.db</span><br><span class="line">/etc/grafana/grafana.ini</span><br></pre></td></tr></table></figure>
<h2 id="Prometheus"><a href="#Prometheus" class="headerlink" title="Prometheus"></a>Prometheus</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装Prometheus</span></span><br><span class="line">wget https://github.com/prometheus/prometheus/releases/download/v2.41.0/prometheus-2.41.0.linux-amd64.tar.gz</span><br><span class="line">nohup ./prometheus --config.file=prometheus.yml 2&gt;&amp;1 &amp;</span><br><span class="line">open http://192.168.101.211:9090</span><br></pre></td></tr></table></figure>
<h2 id="BlackboxExporter"><a href="#BlackboxExporter" class="headerlink" title="BlackboxExporter"></a>BlackboxExporter</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装BlackboxExporter</span></span><br><span class="line">wget https://github.com/prometheus/blackbox_exporter/releases/download/v0.23.0/blackbox_exporter-0.23.0.linux-amd64.tar.gz</span><br><span class="line">nohup ./blackbox_exporter 2&gt;&amp;1 &amp;</span><br><span class="line">open http://192.168.101.211:9115</span><br></pre></td></tr></table></figure>
<h2 id="NodeExporter"><a href="#NodeExporter" class="headerlink" title="NodeExporter"></a>NodeExporter</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装NodeExporter</span></span><br><span class="line">wget https://github.com/prometheus/node_exporter/releases/download/v1.5.0/node_exporter-1.5.0.linux-amd64.tar.gz</span><br><span class="line">nohup ./node_exporter --web.config.file=config.yml --web.listen-address=:19100 2&gt;&amp;1 &amp;</span><br><span class="line">open http://192.168.101.211:19100</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置开机自启</span></span><br><span class="line">cat &lt;&lt; <span class="string">EOF &gt;/etc/systemd/system/node_exporter.service</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=node_exporter Monitoring System</span></span><br><span class="line"><span class="string">Documentation=node_exporter Monitoring System</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">ExecStart=/opt/node_exporter/node_exporter --web.config.file=/opt/node_exporter/config.yml --web.listen-address=:19100</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start node_exporter.service</span><br><span class="line">systemctl status node_exporter.service</span><br><span class="line">systemctl <span class="built_in">enable</span> node_exporter.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可选: 生成密码</span></span><br><span class="line">yum install httpd-tools -y</span><br><span class="line">htpasswd -nBC 12 <span class="string">&#x27;&#x27;</span> | tr -d <span class="string">&#x27;:\n&#x27;</span>   <span class="comment"># 输入密码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可选:配置密码</span></span><br><span class="line">cat &lt;&lt; <span class="string">EOF &gt;/opt/node_exporter/config.yml</span></span><br><span class="line"><span class="string">basic_auth_users:</span></span><br><span class="line"><span class="string">  prometheus: \$2y\$12\$hj1xMjOs1iH.......</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可选: 卸载</span></span><br><span class="line">ps -ef|grep node_exporter</span><br><span class="line">systemctl stop node_exporter.service</span><br><span class="line">systemctl <span class="built_in">disable</span> node_exporter.service</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">rm -f /etc/systemd/system/node_exporter.service</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/202301/%E6%96%87%E4%BB%B6%E6%89%93%E5%BC%80%E6%95%B0%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%AD%A5%E9%AA%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202301/%E6%96%87%E4%BB%B6%E6%89%93%E5%BC%80%E6%95%B0%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%AD%A5%E9%AA%A4/" class="post-title-link" itemprop="url">文件打开数问题排查步骤</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-01-12 09:21:02" itemprop="dateCreated datePublished" datetime="2023-01-12T09:21:02+08:00">2023-01-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-03-24 09:54:49" itemprop="dateModified" datetime="2023-03-24T09:54:49+08:00">2023-03-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看系统最大FD总和</span></span><br><span class="line">cat /proc/sys/fs/file-max</span><br><span class="line">或 sysctl -a|grep fs.file-max</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置系统最大FD总和</span></span><br><span class="line">vi /etc/sysctl.conf</span><br><span class="line">fs.file-max=3244084</span><br><span class="line">sysctl -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看进程最大FD</span></span><br><span class="line"><span class="built_in">ulimit</span> -n</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置进程最大FD</span></span><br><span class="line">vim /etc/security/limits.conf</span><br><span class="line">* soft nofile 65535</span><br><span class="line">* hard nofile 65535</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进程FD排行(此方式准确)</span></span><br><span class="line">find /proc -<span class="built_in">print</span> | grep -P <span class="string">&#x27;/proc/\d+/fd/&#x27;</span>| awk -F <span class="string">&#x27;/&#x27;</span> <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> | uniq -c | sort -rn | head -10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进程FD排行(网上流传的此方式，在CentOS7.3之后多了一列线程ID，算成了笛卡尔积)</span></span><br><span class="line">lsof -n|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>|sort|uniq -c|sort -nr|head -10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进程内线程数排行</span></span><br><span class="line">ps -efT|grep java|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>|sort|uniq -c|sort -nr|head -10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进程TCP连接排行</span></span><br><span class="line">lsof -n -i tcp | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>|sort|uniq -c|sort -nr|head -10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看指定进程的FD数</span></span><br><span class="line">ls /proc/32484/fd -l | wc -l </span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看指定进程的线程数</span></span><br><span class="line">ps huH p 25439 | wc -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看系统所有TCP CLOSE-WAIT数</span></span><br><span class="line">ss -tan|grep CLOSE-WAIT|wc -l</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/202301/OpenSSH%E5%8D%87%E7%BA%A7%E8%AF%A6%E7%BB%86%E6%AD%A5%E9%AA%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202301/OpenSSH%E5%8D%87%E7%BA%A7%E8%AF%A6%E7%BB%86%E6%AD%A5%E9%AA%A4/" class="post-title-link" itemprop="url">OpenSSH升级详细步骤</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-01-09 09:07:03" itemprop="dateCreated datePublished" datetime="2023-01-09T09:07:03+08:00">2023-01-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-03-24 09:54:50" itemprop="dateModified" datetime="2023-03-24T09:54:50+08:00">2023-03-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="确定当前版本号"><a href="#确定当前版本号" class="headerlink" title="确定当前版本号"></a>确定当前版本号</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">openssl version</span><br><span class="line">OpenSSL 1.0.2k-fips  26 Jan 2017</span><br><span class="line"></span><br><span class="line">ssh -V</span><br><span class="line">OpenSSH_7.4p1, OpenSSL 1.0.2k-fips  26 Jan 2017</span><br></pre></td></tr></table></figure>
<p>即将升级为: </p>
<ul>
<li>OpenSSL: 1.0.2k-fips -&gt; 1.1.1s(最新稳定版)</li>
<li>OpenSSH: 7.4p1 -&gt; 9.1p1(最新稳定版)</li>
</ul>
<h2 id="安装TelnetServer"><a href="#安装TelnetServer" class="headerlink" title="安装TelnetServer"></a>安装TelnetServer</h2><p>OpenSSH升级有风险，当SSH服务无法正常启动时，需要通过Telnet远程登录并修复。临时开启Telnet，升版完成后再将期关闭。  </p>
<p>直接通过本地yum源安装:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装telnet-server</span></span><br><span class="line">yum install telnet-server -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">systemctl <span class="built_in">enable</span> telnet.socket</span><br><span class="line">systemctl start telnet.socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试能否正常连接（此时可以连接，但禁止登录）</span></span><br><span class="line">telnet 192.168.23.11</span><br></pre></td></tr></table></figure>
<p>由于PAM规则的限制，telnet默认不允许root用户远程登录，最简单且合法的方式是新建一个临时用户，登录后再su到root:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新建临时用户</span></span><br><span class="line">useradd tmpuser</span><br><span class="line">passwd tmpuser <span class="comment"># 密码设为 yourpass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试使用临时用户登录</span></span><br><span class="line">telnet -l tmpuser 192.168.23.11  <span class="comment"># 密码 yourpass</span></span><br><span class="line">su -</span><br></pre></td></tr></table></figure>
<h2 id="下载源码"><a href="#下载源码" class="headerlink" title="下载源码"></a>下载源码</h2><p>安全加固需要最新稳定版，而CentOS的yum源中版太旧，所以需要在OpenSSL与OpenSSH官网下载源码编译安装</p>
<p>官网地址:  </p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.openssl.org/source/">OpenSSL官网</a></li>
<li><a target="_blank" rel="noopener" href="https://www.openssh.com/portable.html">OpenSSH官网</a></li>
</ul>
<p>下载链接: </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.openssl.org/<span class="built_in">source</span>/openssl-1.1.1s.tar.gz</span><br><span class="line">wget https://cdn.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-9.1p1.tar.gz</span><br></pre></td></tr></table></figure>
<h2 id="升级OpenSSL"><a href="#升级OpenSSL" class="headerlink" title="升级OpenSSL"></a>升级OpenSSL</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看版本号</span></span><br><span class="line">openssl version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装gcc相关依赖</span></span><br><span class="line">yum install gcc gcc-c++ autoconf automake zlib zlib-devel pcre-devel -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压</span></span><br><span class="line">tar -zxvf openssl-1.1.1s.tar.gz</span><br><span class="line"><span class="built_in">cd</span> openssl-1.1.1s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译</span></span><br><span class="line"><span class="built_in">export</span> LANG=C</span><br><span class="line">./config shared </span><br><span class="line">make</span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份</span></span><br><span class="line">mv /usr/bin/openssl /usr/bin/openssl_old</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建软链接</span></span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/bin/openssl /usr/bin/openssl</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/lib64/libssl.so.1.1 /usr/lib64/</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/lib64/libcrypto.so.1.1 /usr/lib64/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看版本号</span></span><br><span class="line">openssl version</span><br></pre></td></tr></table></figure>
<h2 id="升级OpenSSH"><a href="#升级OpenSSH" class="headerlink" title="升级OpenSSH"></a>升级OpenSSH</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看版本号</span></span><br><span class="line">ssh -V</span><br><span class="line">OpenSSH_7.4p1, OpenSSL 1.0.2k-fips  26 Jan 2017</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装相关依赖</span></span><br><span class="line">yum install zlib-devel openssl-devel pam-devel -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压</span></span><br><span class="line">tar -zxvf openssh-9.1p1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> openssh-9.1p1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译</span></span><br><span class="line">./configure \</span><br><span class="line">--prefix=/usr/ \</span><br><span class="line">--sysconfdir=/etc/ssh \</span><br><span class="line">--with-ssl-dir=/usr/<span class="built_in">local</span>/lib64/ \</span><br><span class="line">--with-zlib \</span><br><span class="line">--with-pam \</span><br><span class="line">--with-md5-password \</span><br><span class="line">--with-ssl-engine \</span><br><span class="line">--with-selinux</span><br><span class="line"></span><br><span class="line">make</span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份</span></span><br><span class="line">mkdir /etc/ssh_old</span><br><span class="line">mv /etc/ssh/* /etc/ssh_old/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看新版本号</span></span><br><span class="line">ssh -V</span><br><span class="line">OpenSSH_9.1p1, OpenSSL 1.1.1s  1 Nov 2022</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新配置sshd_config</span></span><br><span class="line">vi /etc/ssh/sshd_config</span><br><span class="line">PermitRootLogin yes  <span class="comment"># 允许root登录</span></span><br><span class="line">Port 2205  <span class="comment"># 修改成之前的端口</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 移走以前的ssh服务, 防止与新的冲突</span></span><br><span class="line">mv /usr/lib/systemd/system/sshd.service /etc/ssh_old/sshd.service</span><br><span class="line">mv /usr/lib/systemd/system/sshd.socket /etc/ssh_old/sshd.socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在解压包中拷贝一些文件</span></span><br><span class="line">cp -a contrib/redhat/sshd.init /etc/init.d/sshd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启服务</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart sshd</span><br><span class="line">systemctl status sshd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试登录</span></span><br><span class="line">ssh root@192.168.23.11 -p2205</span><br></pre></td></tr></table></figure>
<h2 id="配置SSH互信"><a href="#配置SSH互信" class="headerlink" title="配置SSH互信"></a>配置SSH互信</h2><p>TiDB与DS所在的服务器，需要重新配置SSH互信。其它服务器不需要配置。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id root@192.168.23.XX</span><br></pre></td></tr></table></figure>
<h2 id="关闭TelnetServer"><a href="#关闭TelnetServer" class="headerlink" title="关闭TelnetServer"></a>关闭TelnetServer</h2><p>确认OpenSSH升级成功后，关闭TelnetServer，并删除临时用户</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关闭Telnet服务</span></span><br><span class="line">systemctl <span class="built_in">disable</span> telnet.socket</span><br><span class="line">systemctl stop telnet.socket</span><br><span class="line">systemctl status telnet.socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除临时用户</span></span><br><span class="line">userdel tmpuser</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/202211/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4%E6%B2%B9%E7%8C%B4%E8%84%9A%E6%9C%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202211/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4%E6%B2%B9%E7%8C%B4%E8%84%9A%E6%9C%AC/" class="post-title-link" itemprop="url">极客时间油猴脚本</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-01-07 13:27:01" itemprop="dateCreated datePublished" datetime="2023-01-07T13:27:01+08:00">2023-01-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-03-24 09:54:51" itemprop="dateModified" datetime="2023-03-24T09:54:51+08:00">2023-03-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h2><p>一个Tampermonkey脚本，用于破解极客时间HTML页面，使其允许选择复制文本</p>
<h2 id="油猴插件安装"><a href="#油猴插件安装" class="headerlink" title="油猴插件安装"></a>油猴插件安装</h2><p><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo?utm_source=chrome-ntp-icon">https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo?utm_source=chrome-ntp-icon</a></p>
<blockquote>
<p>安装后需要右击图标进入插件配置页面，选中<code>Allow access to file URLs</code></p>
</blockquote>
<h2 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         极客时间允许复制</span></span><br><span class="line"><span class="comment">// @namespace    https://www.yourdomain.com/</span></span><br><span class="line"><span class="comment">// @version      1.0</span></span><br><span class="line"><span class="comment">// @description  极客时间允许复制</span></span><br><span class="line"><span class="comment">// @author       yourname</span></span><br><span class="line"><span class="comment">// @match        file:///path/to*</span></span><br><span class="line"><span class="comment">// @icon         https://www.google.com/s2/favicons?sz=64&amp;domain=undefined.</span></span><br><span class="line"><span class="comment">// @run-at       document-body</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">    &#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="keyword">var</span> eles = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;*&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; eles.length; i++) &#123;</span><br><span class="line">        eles[i].style.userSelect = <span class="string">&#x27;text&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意将@match 修改为本机路径</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/202210/Jenkins%E5%A4%A7%E4%BB%93%E5%BA%93%E7%B2%BE%E5%87%86%E6%9E%84%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202210/Jenkins%E5%A4%A7%E4%BB%93%E5%BA%93%E7%B2%BE%E5%87%86%E6%9E%84%E5%BB%BA/" class="post-title-link" itemprop="url">Jenkins大仓库精准构建</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-10-31 11:49:59" itemprop="dateCreated datePublished" datetime="2022-10-31T11:49:59+08:00">2022-10-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-02 17:24:42" itemprop="dateModified" datetime="2022-11-02T17:24:42+08:00">2022-11-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ul>
<li>针对老项目，多个模块共用一个git仓库的情况，识别出每次push的变更，只构建对应的模块</li>
<li>如果配置多个git地址相同的Jenkins流水线，他们的hook地址也是相同的，无法单独触发其中一个流水线。所以要配置多个镜像仓库。</li>
<li>使用原始方式配置最便捷，不使用gitlab、gogs</li>
<li>当使用ssh协议对外暴露git时，由于jenkins的bug?，可以手工构建但无法通过hook触发。所以必须再配置httpd服务通过http对外暴露。</li>
</ul>
<h2 id="git镜像仓库配置"><a href="#git镜像仓库配置" class="headerlink" title="git镜像仓库配置"></a>git镜像仓库配置</h2><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/mxdzchallpp/article/details/80597126">https://blog.csdn.net/mxdzchallpp/article/details/80597126</a></p>
<ul>
<li>使用http协议对外暴露，搭建方式不再赘述</li>
<li>为一个仓库配置多个镜像时，可以用<code>ln -s</code>软链接方式实现</li>
</ul>
<h2 id="Jenkins流水线配置"><a href="#Jenkins流水线配置" class="headerlink" title="Jenkins流水线配置"></a>Jenkins流水线配置</h2><p>为每个模块配置独立的流水线，使用独立的仓库</p>
<p>自动构建测试:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;10.133.0.186&#x2F;devops_webhook&#x2F;git&#x2F;?url&#x3D;http:&#x2F;&#x2F;10.193.2.12:8081&#x2F;git&#x2F;develop-alert</span><br></pre></td></tr></table></figure>

<h2 id="Git镜像库同步脚本"><a href="#Git镜像库同步脚本" class="headerlink" title="Git镜像库同步脚本"></a>Git镜像库同步脚本</h2><blockquote>
<p>使用后台进程while do循环方式，每10秒pull一次</p>
</blockquote>
<p>sync.sh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">GIT_PATH=/dubhe/git/develop</span><br><span class="line">BASE_PATH=/dubhe/git/sync-dev</span><br><span class="line">SLEEP_SEC=10</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> :</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> Git同步开始 `date +<span class="string">&quot;%Y/%m/%d %H:%M:%S&quot;</span>` | tee -a sync.log</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 拉取git仓库更新日志到sync.dat</span></span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$GIT_PATH</span></span><br><span class="line">    oldsha=`git rev-parse HEAD`</span><br><span class="line">    git pull</span><br><span class="line">    git diff --name-only <span class="variable">$oldsha</span> | tee -a <span class="string">&quot;<span class="variable">$BASE_PATH</span>/sync.dat&quot;</span> <span class="string">&quot;<span class="variable">$BASE_PATH</span>/sync.log&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 判断发生变更的模块并发送通知到Jenkins</span></span><br><span class="line">    <span class="built_in">cd</span> <span class="variable">$BASE_PATH</span></span><br><span class="line">    cat sync.cfg|<span class="keyword">while</span> <span class="built_in">read</span> line</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        module=`<span class="built_in">echo</span> <span class="variable">$line</span>|awk -F <span class="string">&#x27; &#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>`</span><br><span class="line">        hook=`<span class="built_in">echo</span> <span class="variable">$line</span>|awk -F <span class="string">&#x27; &#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line">        count=`cat sync.dat | grep <span class="string">&quot;<span class="variable">$module</span>&quot;</span>|wc -l`</span><br><span class="line">        <span class="comment">#echo $module $hook $count</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">test</span> <span class="variable">$count</span> -gt 0</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> 触发构建 <span class="variable">$module</span> 模块 | tee -a sync.log</span><br><span class="line">            curl -s <span class="variable">$hook</span> &gt;/dev/null</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> Git同步完成 `date +<span class="string">&quot;%Y/%m/%d %H:%M:%S&quot;</span>` | tee -a sync.log</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 清空dat文件</span></span><br><span class="line">    &gt; sync.dat</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&quot;</span> | tee -a sync.log</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 休眠</span></span><br><span class="line">    sleep <span class="variable">$SLEEP_SEC</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>sync.cfg</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">efpx-ui    http:&#x2F;&#x2F;10.133.0.186&#x2F;devops_webhook&#x2F;git&#x2F;?url&#x3D;http:&#x2F;&#x2F;10.193.2.12:8081&#x2F;git&#x2F;develop-ui</span><br><span class="line">efpx-upms    http:&#x2F;&#x2F;10.133.0.186&#x2F;devops_webhook&#x2F;git&#x2F;?url&#x3D;http:&#x2F;&#x2F;10.193.2.12:8081&#x2F;git&#x2F;develop-upms</span><br><span class="line">dubhe-metadata    http:&#x2F;&#x2F;10.133.0.186&#x2F;devops_webhook&#x2F;git&#x2F;?url&#x3D;http:&#x2F;&#x2F;10.193.2.12:8081&#x2F;git&#x2F;develop-metadata</span><br><span class="line">dubhe-scheduler    http:&#x2F;&#x2F;10.133.0.186&#x2F;devops_webhook&#x2F;git&#x2F;?url&#x3D;http:&#x2F;&#x2F;10.193.2.12:8081&#x2F;git&#x2F;develop-scheduler</span><br><span class="line">dubhe-data-integration    http:&#x2F;&#x2F;10.133.0.186&#x2F;devops_webhook&#x2F;git&#x2F;?url&#x3D;http:&#x2F;&#x2F;10.193.2.12:8081&#x2F;git&#x2F;develop-data-integration</span><br><span class="line">dubhe-alert    http:&#x2F;&#x2F;10.133.0.186&#x2F;devops_webhook&#x2F;git&#x2F;?url&#x3D;http:&#x2F;&#x2F;10.193.2.12:8081&#x2F;git&#x2F;develop-alert</span><br><span class="line">dubhe-api-generation    http:&#x2F;&#x2F;10.133.0.186&#x2F;devops_webhook&#x2F;git&#x2F;?url&#x3D;http:&#x2F;&#x2F;10.193.2.12:8081&#x2F;git&#x2F;develop-api-generation</span><br><span class="line">dubhe-quality    http:&#x2F;&#x2F;10.133.0.186&#x2F;devops_webhook&#x2F;git&#x2F;?url&#x3D;http:&#x2F;&#x2F;10.193.2.12:8081&#x2F;git&#x2F;develop-quality</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="监听钩子-已废弃"><a href="#监听钩子-已废弃" class="headerlink" title="监听钩子(已废弃)"></a>监听钩子(已废弃)</h2><blockquote>
<p>使用nc搭建简易HTTP服务器<br>因gitlat至镜像服务器的网络不可达，此方案废弃</p>
</blockquote>
<p>listen.sh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    cat index.http | nc -l 8082</span><br><span class="line">    <span class="comment"># echo &quot;开始同步git&quot;</span></span><br><span class="line">    <span class="comment"># call sync shell</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>index.http</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br><span class="line">Server: netcat!</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>开始同步GIT<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;10.193.2.12:8082</span><br><span class="line">curl http:&#x2F;&#x2F;10.193.2.12:8083</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://blog.bluexiii.com/202210/KubeSphere%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="BlueXIII">
      <meta itemprop="description" content="IT技术类文章、笔记分享">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BlueXIII's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/202210/KubeSphere%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/" class="post-title-link" itemprop="url">KubeSphere滚动更新</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-10-24 14:23:53" itemprop="dateCreated datePublished" datetime="2022-10-24T14:23:53+08:00">2022-10-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-02 17:24:55" itemprop="dateModified" datetime="2022-11-02T17:24:55+08:00">2022-11-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html#actuator.endpoints.kubernetes-probes">https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html#actuator.endpoints.kubernetes-probes</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/actuator-api/html/#metrics">https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/actuator-api/html/#metrics</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/white_ice/article/details/80511588">https://blog.csdn.net/white_ice/article/details/80511588</a></li>
<li><a target="_blank" rel="noopener" href="https://ost.51cto.com/posts/128">https://ost.51cto.com/posts/128</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.51cto.com/u_14320361/2466479">https://blog.51cto.com/u_14320361/2466479</a></li>
</ul>
<h2 id="配置健康测试端点"><a href="#配置健康测试端点" class="headerlink" title="配置健康测试端点"></a>配置健康测试端点</h2><p>修改Nacos配置，在<code>application-dev.yml</code>中添加<code>management.endpoint.health.show-details</code>参数，注意低版本的SpringBoot中<code>endpoint</code>没有’s’</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoint:</span></span><br><span class="line">    <span class="attr">health:</span></span><br><span class="line">      <span class="attr">show-details:</span> <span class="string">&quot;ALWAYS&quot;</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure>
<p>健康测试:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.133.0.63:30508/actuator/health/ping</span><br><span class="line">&#123;<span class="string">&quot;status&quot;</span>:<span class="string">&quot;UP&quot;</span>&#125;</span><br></pre></td></tr></table></figure>
<h2 id="修改K8S配置添加readinessProbe"><a href="#修改K8S配置添加readinessProbe" class="headerlink" title="修改K8S配置添加readinessProbe"></a>修改K8S配置添加readinessProbe</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">readinessProbe:</span></span><br><span class="line">  <span class="attr">httpGet:</span></span><br><span class="line">    <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/actuator/health/ping</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">4000</span></span><br><span class="line">  <span class="attr">initialDelaySeconds:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">periodSeconds:</span> <span class="number">5</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">BlueXIII</p>
  <div class="site-description" itemprop="description">IT技术类文章、笔记分享</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">231</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/xiiiblue" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;xiiiblue" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/bluexiii" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;bluexiii" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">鲁ICP备18050487号-1 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BlueXIII</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
